{"version":3,"sources":["webpack:///./src/templates/devices.internal.vue?19af","webpack:///./src/templates/devices.internal.vue?97ac","webpack:///./src/templates/devices.internal.vue"],"names":["__exports__","store","route","router","uncache","Date","getTime","uploading","flyToDevice","contextOpenRef","editDeviceRef","attrComplete","query","edit","openEdit","getFavorites","position","tmp","getters","getDeviceAttributes","forEach","f","value","findAttribute","id","push","name","type","getAttributes","k","kk","find","a","Object","keys","attributes","result","eval","actFav","evt","add","state","auth","administrator","findAttr","dispatch","commands","text","cb","openMenu","menus","actBlock","window","$traccar","getAvailableCommands","parseInt","params","deviceId","response","availableSaved","data","confirm","device","confirmButtonText","cancelButtonText","then","changeNative","sendCommand","title","message","catch","error","actUnlock","actContext","e","c","description","console","log","editDevice","doDelete","changeImage","file","document","createElement","click","onchange","formData","FormData","append","files","post","headers"],"mappings":"uIAAA,W,0FCMA,MAAMA,EAA2B,IAAgB,OAAQ,CAAC,CAAC,YAAY,qBAExD,gB,ugWCuNf,IAAMC,MAAQ,kDACRC,MAAQ,wDACRC,OAAS,wDACTC,QAAU,kDAAI,IAAIC,MAAOC,WACzBC,UAAY,kDAAI,GAEhBC,YAAc,oDAAO,eACrBC,eAAiB,oDAAO,eAExBC,cAAgB,oDAAO,eACvBC,aAAe,kDAAI,GAEzB,wDAAU,WACLT,MAAMU,MAAMC,MACbC,cAKJ,IAAMC,aAAe,SAACC,GACpB,IAAIC,EAAM,GAQV,OAPAhB,MAAMiB,QAAQC,oBAAoBC,SAAQ,SAACC,GACvC,IAAMC,EAAQC,cAAcP,EAASK,EAAEG,IACpCF,GACDL,EAAIQ,KAAK,CAACC,KAAML,EAAEG,GAAIF,MAAOA,EAAMK,KAAMN,EAAEM,UAI1CV,GAGHW,cAAgB,SAACZ,GAGrB,IAFA,IAAIC,EAAM,GADsB,aAG5B,IAAMY,EAAC,KACT,GAAO,eAAJA,EACD,IADkB,iBACd,IAAMC,EAAE,KACPd,EAAS,cAAcc,KAAQ7B,MAAMiB,QAAQC,oBAAoBY,MAAK,SAACC,GAAD,OAAMA,EAAER,KAAM,cAAcM,MACnGb,EAAIQ,KAAK,CAACC,KAAM,cAAcI,EAAIR,MAAON,EAAS,cAAcc,MAFpE,MAAgBG,OAAOC,KAAKlB,EAASmB,YAArC,eAAiD,SAM9CnB,EAASa,KAAQ5B,MAAMiB,QAAQC,oBAAoBY,MAAK,SAACC,GAAD,OAAMA,EAAER,KAAOK,MACxEZ,EAAIQ,KAAK,CAACC,KAAMG,EAAGP,MAAON,EAASa,MATzC,MAAeI,OAAOC,KAAKlB,GAA3B,eAAqC,IAcrC,OAAOC,GAIHM,cAAgB,SAAhBA,cAAiBP,SAASgB,GAE9B,IAAII,OAAS,GAIb,OAFAC,KAAK,qBAAqBL,GAEnBI,QAGHE,OAAS,SAACC,EAAIf,EAAGgB,GAErB,GAAGvC,MAAMwC,MAAMC,KAAKC,gBAAkBH,EAAK,CACvC,IAAMI,EAAW3C,MAAMiB,QAAQC,oBAAoBY,MAAK,SAACC,GAAD,OAAMA,EAAER,KAAOA,KACpD,WAAhBoB,EAASjB,KACV1B,MAAM4C,SAAS,YAAa,CAACrB,GAAG,IAEhCvB,MAAM4C,SAAS,UAAW,CAACrB,GAAG,SAI9B,GAAGvB,MAAMwC,MAAMC,KAAKC,cAAe,CACvC,IAAIG,EAAW,GACfA,EAASrB,KAAK,CACZsB,KAAM,WAAYC,GAAI,WACpB/C,MAAM4C,SAAS,YAAa,CAACrB,EAAGgB,OAGpCM,EAASrB,KAAK,CACZsB,KAAM,UAAWC,GAAI,WACnB/C,MAAM4C,SAAS,UAAW,CAACrB,EAAGgB,OAMlC/B,eAAea,MAAM2B,SAAS,CAACV,IAAKA,EAAKW,MAAOJ,SAEhD7C,MAAM4C,SAAS,UAAW,CAACrB,EAAGgB,KAQ5BW,SAAQ,mKAAG,sHAEQC,OAAOC,SAASC,qBAAqBC,SAASrD,MAAMsD,OAAOC,WAFnE,OAETC,EAFS,OAGTC,EAAiBD,EAASE,KAEhC,gDAAaC,QACT,wCAAwCC,OAAOxC,MAAMI,KAAK,KAC1D,UACA,CACEqC,kBAAmB,KACnBC,iBAAkB,WAClBrC,KAAM,YAEVsC,MAAK,WACL,IAAMC,EAAeP,EAAe5B,MAAK,SAACC,GAAD,OAAMA,EAAEG,WAAW,wBAAkE,eAAxCH,EAAEG,WAAW,0BAChG+B,EACDd,OAAOC,SAASc,YAAhB,+OAAgCD,GAAgB,CAACT,SAAUK,OAAOxC,MAAME,MAExE4B,OAAOC,SAASc,YAAY,CAACV,SAAUK,OAAOxC,MAAME,GAAGG,KAAM,eAI/D,wDAAe,CACbyC,MAAO,WACPC,QAAS,wCACT1C,KAAM,eAEP2C,OAAM,WACP,gDAAUC,MAAM,kCA5BH,2CAAH,qDAgCRC,UAAS,mKAAG,sHACOpB,OAAOC,SAASC,qBAAqBC,SAASrD,MAAMsD,OAAOC,WADlE,OACVC,EADU,OAEVC,EAAiBD,EAASE,KAGhC,gDAAaC,QACT,2CAA2CC,OAAOxC,MAAMI,KAAK,KAC7D,UACA,CACEqC,kBAAmB,KACnBC,iBAAkB,WAClBrC,KAAM,YAEVsC,MAAK,WACL,IAAMC,EAAeP,EAAe5B,MAAK,SAACC,GAAD,OAAMA,EAAEG,WAAW,wBAAkE,iBAAxCH,EAAEG,WAAW,0BAChG+B,EACDd,OAAOC,SAASc,YAAhB,+OAAgCD,GAAgB,CAACT,SAAUK,OAAOxC,MAAME,MAExE4B,OAAOC,SAASc,YAAY,CAACV,SAAUK,OAAOxC,MAAME,GAAGG,KAAM,iBAI/D,wDAAe,CACbyC,MAAO,WACPC,QAAS,wCACT1C,KAAM,eAEP2C,OAAM,WACP,gDAAUC,MAAM,kCA5BF,2CAAH,qDAgCTE,WAAU,mKAAG,WAAOC,GAAP,2GAEMtB,OAAOC,SAASC,qBAAqBC,SAASrD,MAAMsD,OAAOC,WAFjE,OAEXC,EAFW,OAGXC,EAAiBD,EAASE,KAE5Bd,EAAW,GACfa,EAAevC,SAAQ,SAACuD,GACtB7B,EAASrB,KAAK,CACZsB,KAAM4B,EAAEC,YAAa5B,GAAI,WACvB,gDAAaa,QACT,+DAA+DC,OAAOxC,MAAMI,KAAK,oFACjF,UACA,CACEqC,kBAAmB,KACnBC,iBAAkB,WAClBrC,KAAM,YAEVsC,MAAK,WACLb,OAAOC,SAASc,YAAhB,+OAAgCQ,GAAK,CAAClB,SAAUK,OAAOxC,MAAME,MAE7D,wDAAe,CACb4C,MAAO,WACPC,QAAS,wCACT1C,KAAM,eAEP2C,OAAM,WACP,gDAAUC,MAAM,wCAOxB9D,eAAea,MAAM2B,SAAS,CAACV,IAAKmC,EAAGxB,MAAOJ,IAjC7B,2CAAH,sDAsChB,oDAAM,kBAAK5C,MAAMsD,OAAOC,YAAS,WAC/B,IAAMxC,EAAMhB,MAAMiB,QAAQ,qBAAqBqC,SAASrD,MAAMsD,OAAOC,WAClExC,GACDT,YAAYS,MAKhB,oDAAM,kBAAKf,MAAMU,MAAMC,QAAK,SAACmB,GACxBA,GACDlB,cAIJ,IAAMgD,OAAS,uDAAS,WACtB,OAAO7D,MAAMiB,QAAQ,qBAAqBqC,SAASrD,MAAMsD,OAAOC,cAI5D3C,SAAW,WAEb+D,QAAQC,IAAIpE,eAEZA,cAAcY,MAAMyD,WAAWjB,OAAOxC,MAAME,KAG1CwD,SAAW,WACf,gDAAanB,QAAQ,6CAA6C,gBAAgBI,MAAK,WACrFhE,MAAM4C,SAAS,iBAAiBiB,OAAOxC,MAAME,IAAIyC,MAAK,WAEpD,wDAAe,CACbG,MAAO,OACPC,QAAS,mCACT1C,KAAM,SAGRxB,OAAOsB,KAAK,eACX6C,OAAM,WACP,wDAAe,CACbF,MAAO,OACPC,QAAS,yDACT1C,KAAM,kBAQRsD,YAAc,WAClB,IAAMC,EAAOC,SAASC,cAAc,SAC9BF,EAAKvD,KAAO,OACZuD,EAAKG,QACLH,EAAKI,SAAW,WAEd/E,UAAUe,OAAQ,EAElB,IAAIiE,EAAW,IAAIC,SACnBD,EAASE,OAAO,WAAWvF,MAAMsD,OAAOC,UACxC8B,EAASE,OAAO,QAASP,EAAKQ,MAAM,IACpC,4CAAA1D,EAAM2D,KAAK,mBAAmBzF,MAAMsD,OAAOC,SAAS,SAAU8B,EAAU,CACtEK,QAAS,CACP,eAAgB,yBAEjB3B,MAAK,WAEN7D,QAAQkB,OAAQ,IAAIjB,MAAOC,UAC3BC,UAAUe,OAAQ,O","file":"js/chunk-3be4585a.344f85fd.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./devices.internal.vue?vue&type=style&index=0&id=2fe2849c&scoped=true&lang=css\"","import script from \"./devices.internal.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./devices.internal.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./devices.internal.vue?vue&type=style&index=0&id=2fe2849c&scoped=true&lang=css\"\n\nimport exportComponent from \"E:\\\\Vue3\\\\tarkan-basic\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-2fe2849c\"]])\n\nexport default __exports__","<template>\r\n  <div :set=\"position = store.getters['devices/getPosition'](device.id)\">\r\n\r\n\r\n  <div id=\"kr-actions\" style=\"display: flex;justify-content: space-between;align-content: space-between;\">\r\n  <div class=\"kr-spacer\" style=\"width: 60%;\"></div>\r\n\r\n    <el-tooltip\r\n        effect=\"dark\"\r\n        content=\"Excluir Dispositivo\"\r\n        placement=\"bottom\"\r\n    >\r\n      <el-button type=\"danger\" @click=\"doDelete()\" plain><i class=\"fas fa-trash\"></i></el-button>\r\n    </el-tooltip>\r\n\r\n    <el-tooltip\r\n        effect=\"dark\"\r\n        content=\"Visualizar Rotas\"\r\n        placement=\"bottom\"\r\n    >\r\n      <el-button type=\"primary\" @click=\"$router.push('/history?deviceId='+device.id)\" plain><i class=\"fas fa-route\"></i></el-button>\r\n    </el-tooltip>\r\n\r\n\r\n    <el-tooltip v-if=\"position && position.attributes.blocked\"\r\n                effect=\"dark\"\r\n                content=\"Desbloquear Dispositivo\"\r\n                placement=\"bottom\"\r\n    >\r\n      <el-button type=\"success\" @click=\"actUnlock()\" @contextmenu.prevent=\"actContext($event)\" plain><i class=\"fas fa-unlock\"></i></el-button>\r\n    </el-tooltip>\r\n\r\n    <el-tooltip v-else\r\n                effect=\"dark\"\r\n                content=\"Bloquear Dispositivo\"\r\n                placement=\"bottom\"\r\n    >\r\n      <el-button type=\"warning\" @click=\"actBlock()\" @contextmenu.prevent=\"actContext($event)\" plain><i class=\"fas fa-lock\"></i></el-button>\r\n    </el-tooltip>\r\n\r\n    <el-tooltip\r\n        effect=\"dark\"\r\n        content=\"Editar Dispositivo\"\r\n        placement=\"bottom\"\r\n    >\r\n      <el-button type=\"primary\" @click=\"openEdit()\"><i class=\"fas fa-edit\"></i></el-button>\r\n    </el-tooltip>\r\n\r\n\r\n    <el-tooltip\r\n        effect=\"dark\"\r\n        content=\"Vista da Rua\"\r\n        placement=\"bottom\"\r\n    >\r\n      <el-button  plain @click=\"store.dispatch('devices/toggleStreet')\">\r\n        <i class=\"fas fa-street-view\"></i>\r\n      </el-button>\r\n    </el-tooltip>\r\n\r\n  </div>\r\n\r\n\r\n  <div  class=\"device\"  :class=\"{isAttrComplete: attrComplete}\">\r\n    <div class=\"name\" >{{device.name}}</div>\r\n    <div class=\"resume\">\r\n      <div v-if=\"position\" class=\"icons\">\r\n        <el-tooltip v-if=\"position.attributes.ignition===true\" :content=\"'Ignição Ligada'\">\r\n          <div :style=\"{color: 'green'}\"><i class=\"fas fa-key\"></i></div>\r\n        </el-tooltip>\r\n        <el-tooltip v-else-if=\"position.attributes.ignition===false\" :content=\"'Ignição Desligada'\">\r\n          <div :style=\"{color: 'red'}\"><i class=\"fas fa-key\"></i></div>\r\n        </el-tooltip>\r\n        <el-tooltip v-else :content=\"'Desconhecido'\">\r\n          <div :style=\"{color: 'silver'}\"><i class=\"fas fa-key\"></i></div>\r\n        </el-tooltip>\r\n\r\n        <el-tooltip v-if=\"position.attributes.blocked===true\" :content=\"'Ignição Bloqueada'\">\r\n          <div :style=\"{color: 'red'}\"><i class=\"fas fa-lock\"></i></div>\r\n        </el-tooltip>\r\n        <el-tooltip v-else-if=\"position.attributes.blocked===false\"  :content=\"'Ignição Desbloqueada'\">\r\n          <div :style=\"{color: 'green'}\"><i class=\"fas fa-lock-open\"></i></div>\r\n        </el-tooltip>\r\n        <el-tooltip v-else :content=\"'Desconhecido'\">\r\n          <div :style=\"{color: 'silver'}\"><i class=\"fas fa-lock-open\"></i></div>\r\n        </el-tooltip>\r\n\r\n        <el-tooltip v-if=\"position.attributes.rssi\" :content=\"'Sinal RSSI'\">\r\n          <div ><i class=\"fas fa-signal\"></i> <span>{{position.attributes.rssi}}</span></div>\r\n        </el-tooltip>\r\n\r\n        <el-tooltip v-if=\"position.attributes.sat\" :content=\"'Quantidade de Sateletes'\">\r\n          <div v-if=\"position.attributes.sat\"><i class=\"fas fa-satellite\"></i> <span>{{position.attributes.sat}}</span></div>\r\n        </el-tooltip>\r\n\r\n\r\n        <el-tooltip v-if=\"position.attributes.power\" :content=\"'Tensão da Bateria do Veiculo'\">\r\n          <div v-if=\"position.attributes.power\"><i class=\"fas fa-car-battery\"></i> <span>{{position.attributes.power}}v</span></div>\r\n        </el-tooltip>\r\n\r\n        <el-tooltip v-else-if=\"position.attributes.batteryLevel\" :content=\"'Carga da Bateria Interna'\">\r\n          <div>\r\n            <i v-if=\"position.attributes.batteryLevel>80\" style=\"color: green;\" class=\"fas fa-battery-full\"></i>\r\n            <i v-else-if=\"position.attributes.batteryLevel>60\" class=\"fas fa-battery-three-quarters\"></i>\r\n            <i v-else-if=\"position.attributes.batteryLevel>40\" class=\"fas fa-battery-half\"></i>\r\n            <i v-else-if=\"position.attributes.batteryLevel>30\" class=\"fas fa-battery-quarter\"></i>\r\n            <i v-else-if=\"position.attributes.batteryLevel>20\" style=\"color: orange;\" class=\"fas fa-battery-empty\"></i>\r\n            <i v-else style=\"color: red;\" class=\"fas fa-battery-empty\"></i>\r\n            <span v-if=\"position.attributes.battery\">{{position.attributes.battery}}v</span>\r\n            <span v-else>{{position.attributes.batteryLevel}}%</span>\r\n          </div>\r\n        </el-tooltip>\r\n\r\n\r\n\r\n        <div v-if=\"position.attributes.alarm\">\r\n          <el-tooltip :content=\"position.attributes.alarm\">\r\n            <i style=\"color: red;\" class=\"fas fa-exclamation-triangle\"></i>\r\n          </el-tooltip>\r\n        </div>\r\n\r\n\r\n          <el-tooltip :content=\"(device.status==='offline')?'Offline':(device.status==='online')?'Online':'Desconhecido'\">\r\n            <div>\r\n            <i class=\"fas fa-question-circle\" :style=\"{color: (device.status==='offline')?'red':(device.status==='online')?'green':'orange'}\"></i>\r\n            </div>\r\n          </el-tooltip>\r\n\r\n      </div>\r\n      <div class=\"info\" style=\"display: flex;border-bottom: silver 1px dotted;\">\r\n      <div style=\"flex: 1;border-right: silver 1px dotted;justify-content: center;align-content: center;display: flex;align-items: center;\">\r\n          <div  class=\"carImage\" style=\"background-image: url('img/upload.png');border: silver 1px solid;background-size: cover;background-position: center;width: 170px;height: 140px;border-radius: 5px; vertical-align: middle;\">\r\n            <div :style=\"{'background-image': 'url(/tarkan/images/'+device.id+'.jpg'+((uncache!==0)?'?uncache='+uncache:'')+')'}\" style=\"background-size: cover;background-position: center;width: 170px;height: 140px;border-radius: 5px; vertical-align: middle;\">\r\n              <div v-if=\"!store.state.auth.deviceReadonly\" @click=\"changeImage()\" id=\"changeImage\">Alterar Imagem</div>\r\n              <div v-if=\"uploading\" id=\"uploading\">Enviando Imagem...</div>\r\n            </div>\r\n          </div>\r\n      </div>\r\n      <div style=\"flex: 1;\">\r\n\r\n        <div style=\"border-bottom: silver 1px dotted;\">\r\n        <div style=\"text-transform: uppercase;margin-top: 20px;font-size: 11px;color: #757575;\">Placa</div>\r\n        <div style=\"margin-top: 10px;margin-bottom: 20px;font-size: 20px;color: var(--text-blue)\">{{device.attributes['placa'] || 'N/A'}}</div>\r\n        </div>\r\n        <div style=\"text-transform: uppercase;margin-top: 20px;font-size: 11px;color: #757575;\">Modelo</div>\r\n        <div style=\"margin-top: 10px;margin-bottom: 20px;font-size: 20px;color: var(--text-blue)\">{{device.model || 'N/A'}}</div>\r\n\r\n      </div>\r\n\r\n    </div>\r\n\r\n      <div class=\"stats\" v-if=\"position\">\r\n      <div class=\"subtitle\"><i class=\"fas fa-map-marker-alt\"></i> Localização Atual</div>\r\n      <div class=\"updated\">\r\n        Atualizado em {{new Date(position.serverTime).toLocaleString()}}\r\n      </div>\r\n      <div v-if=\"position.address\" class=\"address\">{{position.address}}</div>\r\n      <div v-else class=\"address\">{{position.latitude}}, {{position.longitude}}</div>\r\n    </div>\r\n      <div class=\"stats\" v-else>\r\n      <div class=\"updated\" style=\"padding: 10px;\">Não há informação de posição ainda</div>\r\n    </div>\r\n\r\n      <div class=\"info\" style=\"display: flex;border-top: silver 1px dotted;\">\r\n      <div style=\"flex: 1;border-right: silver 1px dotted;\">\r\n        <div style=\"text-transform: uppercase;margin-top: 20px;font-size: 11px;color: #757575;\">Velocidade Atual</div>\r\n        <div style=\"margin-top: 10px;margin-bottom: 20px;font-size: 20px;color: var(--text-blue)\">{{parseInt(position.speed)}} km/h</div>\r\n\r\n      </div>\r\n      <div style=\"flex: 1;\">\r\n        <div style=\"text-transform: uppercase;margin-top: 20px;font-size: 11px;color: #757575;\">Distância Total</div>\r\n        <div style=\"margin-top: 10px;margin-bottom: 20px;font-size: 20px;color: var(--text-blue)\">{{position.attributes.totalDistance}} km</div>\r\n\r\n      </div>\r\n\r\n    </div>\r\n\r\n    </div>\r\n\r\n\r\n    <div class=\"favorites\" style=\"border-top: silver 1px dotted;\">\r\n      <div v-for=\"(a,b) in getFavorites(position)\" :key=\"b\" :class=\"{tr1: (b%2),tr2: !(b%2)}\" style=\"display: flex;\">\r\n        <div style=\"flex: 1;border-right: silver 1px dotted;padding: 6px;font-size: 12px;text-align: right;\">{{a.name}}</div>\r\n        <div style=\"flex: 1;padding: 6px;font-size: 12px;text-align: left;\">\r\n          {{a.value}}\r\n        </div>\r\n        <div v-if=\"attrComplete && !(a.type==='server' && !store.state.auth.administrator )\" class=\"favBtn\"   @click=\"actFav($event,a.name,false)\" style=\"text-align: right;box-sizing: border-box;padding: 7px;font-size: 13px;width: 50px;\">\r\n          <i class=\"fas fa-thumbtack\"></i>\r\n        </div>\r\n        <div v-else style=\"width: 50px;text-align: center;box-sizing: border-box;\">\r\n\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"complete\" :set=\"ll = getFavorites(position).length\">\r\n        <div v-for=\"(a,b) in getAttributes(position)\" :key=\"b\" :class=\"{tr1: ((b+ll)%2),tr2: !((b+ll)%2)}\" style=\"display: flex;\">\r\n          <div style=\"flex: 1;border-right: silver 1px dotted;padding: 6px;font-size: 12px;text-align: right;\">{{a.name}}</div>\r\n          <div style=\"flex: 1;padding: 6px;font-size: 12px;text-align: left;\">\r\n            {{a.value}}\r\n          </div>\r\n          <div class=\"favBtn\"  style=\"padding: 7px;font-size: 13px;color: silver;width: 50px;text-align: right;box-sizing: border-box;\" @click=\"actFav($event,a.name,true)\">\r\n            <i class=\"fas fa-thumbtack\"></i>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div @click=\"attrComplete = !attrComplete\" style=\"padding: 5px;background: #e7e7e7;\">\r\n        <i class=\"allBtn fas fa-angle-double-down\"></i>\r\n      </div>\r\n    </div>\r\n\r\n\r\n  </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\n\r\nimport {useRoute,useRouter} from 'vue-router';\r\n\r\nimport {ref,computed,watch,inject,onMounted} from 'vue';\r\nimport {useStore} from \"vuex\"\r\nimport {ElMessage, ElMessageBox, ElNotification} from \"element-plus\";\r\n\r\nconst store = useStore();\r\nconst route = useRoute();\r\nconst router = useRouter();\r\nconst uncache = ref(new Date().getTime());\r\nconst uploading = ref(false);\r\n\r\nconst flyToDevice = inject('flyToDevice');\r\nconst contextOpenRef = inject('contextMenu');\r\n\r\nconst editDeviceRef = inject('edit-device');\r\nconst attrComplete = ref(false);\r\n\r\nonMounted(()=>{\r\n  if(route.query.edit){\r\n    openEdit();\r\n  }\r\n})\r\n\r\n\r\nconst getFavorites = (position) => {\r\n  let tmp = [];\r\n  store.getters.getDeviceAttributes.forEach((f)=>{\r\n      const value = findAttribute(position,f.id);\r\n      if(value){\r\n        tmp.push({name: f.id, value: value,type: f.type});\r\n      }\r\n  })\r\n\r\n  return tmp;\r\n}\r\n\r\nconst getAttributes = (position)=>{\r\n  let tmp = [];\r\n\r\n  for(const k of Object.keys(position)){\r\n    if(k==='attributes'){\r\n      for(const kk of Object.keys(position.attributes)){\r\n        if(position['attributes'][kk] && !store.getters.getDeviceAttributes.find((a)=> a.id ==='attributes.'+kk)) {\r\n          tmp.push({name: 'attributes.'+kk, value: position['attributes'][kk]});\r\n        }\r\n      }\r\n    }else {\r\n      if(position[k]  && !store.getters.getDeviceAttributes.find((a)=> a.id === k)) {\r\n        tmp.push({name: k, value: position[k]});\r\n      }\r\n    }\r\n  }\r\n\r\n  return tmp;\r\n}\r\n\r\n\r\nconst findAttribute = (position,a)=>{\r\n\r\n  let result = '';\r\n\r\n  eval('result = position.'+a);\r\n\r\n  return result;\r\n}\r\n\r\nconst actFav = (evt,id,add)=>{\r\n\r\n  if(store.state.auth.administrator && !add) {\r\n      const findAttr = store.getters.getDeviceAttributes.find((a)=> a.id === id);\r\n      if(findAttr.type==='server'){\r\n        store.dispatch(\"pinServer\", [id,false]);\r\n      }else{\r\n        store.dispatch(\"pinUser\", [id,false]);\r\n      }\r\n\r\n\r\n  }else if(store.state.auth.administrator) {\r\n    let commands = [];\r\n    commands.push({\r\n      text: 'Servidor', cb: () => {\r\n        store.dispatch(\"pinServer\", [id,add]);\r\n      }\r\n    });\r\n    commands.push({\r\n      text: 'Pessoal', cb: () => {\r\n        store.dispatch(\"pinUser\", [id,add]);\r\n\r\n      }\r\n    });\r\n\r\n\r\n    contextOpenRef.value.openMenu({evt: evt, menus: commands})\r\n  }else{\r\n    store.dispatch(\"pinUser\", [id,add]);\r\n  }\r\n\r\n\r\n\r\n}\r\n\r\n\r\nconst actBlock = async ()=>{\r\n\r\n  const response = await window.$traccar.getAvailableCommands(parseInt(route.params.deviceId));\r\n  const availableSaved = response.data;\r\n\r\n  ElMessageBox.confirm(\r\n      'Deseja realmente bloquear o veiculo \"'+device.value.name+'\"?',\r\n      'Warning',\r\n      {\r\n        confirmButtonText: 'OK',\r\n        cancelButtonText: 'Cancelar',\r\n        type: 'warning',\r\n      }\r\n  ).then(()=>{\r\n    const changeNative = availableSaved.find((a)=> a.attributes['tarkan.changeNative'] && a.attributes['tarkan.changeNative'] === 'engineStop' );\r\n    if(changeNative){\r\n      window.$traccar.sendCommand({...changeNative,...{deviceId: device.value.id}});\r\n    }else{\r\n      window.$traccar.sendCommand({deviceId: device.value.id,type: \"engineStop\"});\r\n    }\r\n\r\n\r\n    ElNotification({\r\n      title: 'Successo',\r\n      message: 'Comando enviado para o dispositivo...',\r\n      type: 'success',\r\n    });\r\n  }).catch(()=>{\r\n    ElMessage.error('Ação cancelada pelo usuário');\r\n  })\r\n}\r\n\r\nconst actUnlock = async ()=>{\r\n  const response = await window.$traccar.getAvailableCommands(parseInt(route.params.deviceId));\r\n  const availableSaved = response.data;\r\n\r\n\r\n  ElMessageBox.confirm(\r\n      'Deseja realmente desbloquear o veiculo \"'+device.value.name+'\"?',\r\n      'Warning',\r\n      {\r\n        confirmButtonText: 'OK',\r\n        cancelButtonText: 'Cancelar',\r\n        type: 'warning',\r\n      }\r\n  ).then(()=>{\r\n    const changeNative = availableSaved.find((a)=> a.attributes['tarkan.changeNative'] && a.attributes['tarkan.changeNative'] === 'engineResume' );\r\n    if(changeNative){\r\n      window.$traccar.sendCommand({...changeNative,...{deviceId: device.value.id}});\r\n    }else{\r\n      window.$traccar.sendCommand({deviceId: device.value.id,type: \"engineResume\"});\r\n    }\r\n\r\n\r\n    ElNotification({\r\n      title: 'Successo',\r\n      message: 'Comando enviado para o dispositivo...',\r\n      type: 'success',\r\n    });\r\n  }).catch(()=>{\r\n    ElMessage.error('Ação cancelada pelo usuário');\r\n  })\r\n}\r\n\r\nconst actContext = async (e)=>{\r\n\r\n  const response = await window.$traccar.getAvailableCommands(parseInt(route.params.deviceId));\r\n  const availableSaved = response.data;\r\n\r\n  let commands = [];\r\n  availableSaved.forEach((c)=> {\r\n    commands.push({\r\n      text: c.description, cb: () => {\r\n        ElMessageBox.confirm(\r\n            'Você está enviando um comando personalizado para o veiculo \"'+device.value.name+'\", alguns comandos podem prejudicar o funcionamento do sistema! Deseja continuar?',\r\n            'Warning',\r\n            {\r\n              confirmButtonText: 'OK',\r\n              cancelButtonText: 'Cancelar',\r\n              type: 'warning',\r\n            }\r\n        ).then(()=>{\r\n          window.$traccar.sendCommand({...c,...{deviceId: device.value.id}});\r\n\r\n          ElNotification({\r\n            title: 'Successo',\r\n            message: 'Comando enviado para o dispositivo...',\r\n            type: 'success',\r\n          });\r\n        }).catch(()=>{\r\n          ElMessage.error('Ação cancelada pelo usuário');\r\n        })\r\n      }\r\n    });\r\n  });\r\n\r\n\r\n  contextOpenRef.value.openMenu({evt: e, menus: commands})\r\n\r\n\r\n}\r\n\r\nwatch(()=> route.params.deviceId,()=>{\r\n  const tmp = store.getters['devices/getDevice'](parseInt(route.params.deviceId));\r\n  if(tmp) {\r\n    flyToDevice(tmp);\r\n  }\r\n})\r\n\r\n\r\nwatch(()=> route.query.edit,(a)=>{\r\n  if(a){\r\n    openEdit();\r\n  }\r\n})\r\n\r\nconst device = computed(()=> {\r\n  return store.getters['devices/getDevice'](parseInt(route.params.deviceId));\r\n});\r\n\r\n\r\nconst openEdit = ()=>{\r\n\r\n    console.log(editDeviceRef)\r\n\r\n    editDeviceRef.value.editDevice(device.value.id);\r\n}\r\n\r\nconst doDelete = ()=>{\r\n  ElMessageBox.confirm('Deseja realmente excluir este dispositivo?','Tem certeza?').then(()=>{\r\n    store.dispatch(\"devices/delete\",device.value.id).then(()=>{\r\n\r\n      ElNotification({\r\n        title: 'Info',\r\n        message: 'Dispositivo deletado com suceso.',\r\n        type: 'info',\r\n      });\r\n\r\n      router.push('/devices');\r\n    }).catch(()=>{\r\n      ElNotification({\r\n        title: 'Erro',\r\n        message: 'Ocorreu um erro inesperado ao excluir seu dispositivo.',\r\n        type: 'danger',\r\n      });\r\n    });\r\n  });\r\n}\r\n\r\nimport axios from 'axios';\r\n\r\nconst changeImage = ()=>{\r\n  const file = document.createElement(\"input\");\r\n        file.type = 'file';\r\n        file.click();\r\n        file.onchange = ()=>{\r\n\r\n          uploading.value = true;\r\n\r\n          var formData = new FormData();\r\n          formData.append(\"deviceId\",route.params.deviceId);\r\n          formData.append(\"image\", file.files[0]);\r\n          axios.post('/tarkan/devices/'+route.params.deviceId+'/photo', formData, {\r\n            headers: {\r\n              'Content-Type': 'multipart/form-data'\r\n            }\r\n          }).then(()=>{\r\n\r\n            uncache.value = new Date().getTime();\r\n            uploading.value = false;\r\n\r\n          });\r\n\r\n        }\r\n}\r\n\r\n\r\n</script>\r\n\r\n<style scoped>\r\n  .device{\r\n    border: silver 1px solid;\r\n    border-radius: 5px;\r\n    margin-top: 10px;\r\n    display: flex;\r\n    flex-direction: column;\r\n    text-align: center;\r\n  }\r\n\r\n  .device .name{\r\n    border-bottom: silver 1px dotted;\r\n    font-size: 18px;\r\n    padding: 5px;\r\n    font-weight: bold;\r\n\r\n  }\r\n\r\n  .icons{\r\n    display: flex;\r\n    justify-content: center;\r\n  }\r\n\r\n  .icons div{\r\n    display: flex;\r\n    justify-content: center;\r\n    flex: 1;\r\n    border-bottom: silver 1px dotted;\r\n    border-right: silver 1px dotted;\r\n    padding: 7px;\r\n    font-size: 11px;\r\n  }\r\n  .icons div i{\r\n    font-size: 16px;\r\n  }\r\n\r\n  .icons div:last-child{\r\n    border-right: none;\r\n  }\r\n\r\n  .icons div span{\r\n    display: flex;\r\n    padding: 2px;\r\n    padding-left: 5px;\r\n  }\r\n\r\n  .subtitle{\r\n    margin-top: 20px;\r\n    font-weight: bold;\r\n    font-size: 14px;\r\n    text-transform: uppercase;\r\n    color: var(--text-black);\r\n  }\r\n\r\n  .subtitle i{\r\n    font-size: 12px;\r\n    margin-right: 3px;\r\n  }\r\n\r\n  .updated{\r\n    font-size: 12px;\r\n    margin-top: 5px;\r\n    color: var(--text-silver);\r\n  }\r\n\r\n  .address{\r\n    color: var(--text-blue);\r\n    font-size: 15px;\r\n    margin-top: 10px;\r\n    margin-bottom: 10px;\r\n    padding: 10px;\r\n    line-height: 20px;\r\n  }\r\n\r\n  .tr1{\r\n    background: #f3f3f3;\r\n  }\r\n\r\n  .tr2{\r\n    background: #f8f8f8;\r\n  }\r\n\r\n\r\n  .resume{\r\n    transition: max-height 0.15s ease;\r\n    max-height: 100vh;\r\n    overflow: hidden;\r\n  }\r\n\r\n  .complete{\r\n    max-height: 0vh;\r\n    overflow: hidden;\r\n    transition: max-height 0.15s ease;\r\n  }\r\n\r\n  .isAttrComplete .resume{\r\n    max-height: 0vh;\r\n  }\r\n\r\n  .isAttrComplete .complete{\r\n    max-height: 100vh;\r\n  }\r\n\r\n  .isAttrComplete .favorites{\r\n    border-top: none !important;\r\n  }\r\n\r\n  .device .allBtn{\r\n    transition: all 0.15s;\r\n  }\r\n\r\n  .isAttrComplete .allBtn{\r\n    transform: rotate(180deg);\r\n  }\r\n\r\n  .favBtn{\r\n    cursor: pointer;\r\n  }\r\n\r\n  .favBtn:hover{\r\n    color: #05a7e3 !important;\r\n  }\r\n\r\n  .carImage{\r\n    position: relative;\r\n  }\r\n\r\n  .carImage #changeImage{\r\n    position: absolute;\r\n    background: rgba(0,0,0,0.5);\r\n    left: 50%;\r\n    top: 50%;\r\n    padding: 10px;\r\n    color: white;\r\n    transform: translate(-50%,-50%);\r\n    opacity: 0;\r\n    transition: all 0.3s;\r\n    cursor: pointer;\r\n  }\r\n\r\n  .carImage:hover #changeImage{\r\n    opacity: 1;\r\n  }\r\n\r\n  #uploading{\r\n    position: absolute;\r\n    background: rgba(0,0,0,0.5);\r\n    left: 50%;\r\n    top: 50%;\r\n    padding: 10px;\r\n    color: white;\r\n    transform: translate(-50%,-50%);\r\n    opacity: 1;\r\n    transition: all 0.3s;\r\n    cursor: pointer;\r\n  }\r\n\r\n</style>"],"sourceRoot":""}