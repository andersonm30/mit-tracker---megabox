(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d166a130"],{"0829":function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return Cl})),n.d(t,"b",(function(){return Su})),n.d(t,"c",(function(){return fu})),n.d(t,"d",(function(){return Rc})),n.d(t,"e",(function(){return Nl})),n.d(t,"f",(function(){return Ou})),n.d(t,"g",(function(){return T})),n.d(t,"h",(function(){return Nu})),n.d(t,"i",(function(){return Rl})),n.d(t,"j",(function(){return Dl})),n.d(t,"k",(function(){return F})),n.d(t,"l",(function(){return Xl})),n.d(t,"m",(function(){return je})),n.d(t,"n",(function(){return K})),n.d(t,"o",(function(){return z})),n.d(t,"p",(function(){return kc})),n.d(t,"q",(function(){return w})),n.d(t,"r",(function(){return Ce})),n.d(t,"s",(function(){return m})),n.d(t,"t",(function(){return bc})),n.d(t,"u",(function(){return Wl})),n.d(t,"v",(function(){return ih})),n.d(t,"w",(function(){return rh})),n.d(t,"x",(function(){return wu})),n.d(t,"y",(function(){return Pc})),n.d(t,"z",(function(){return Mc})),n.d(t,"A",(function(){return Nc})),n.d(t,"B",(function(){return Kl})),n.d(t,"C",(function(){return th})),n.d(t,"D",(function(){return Tu})),n.d(t,"E",(function(){return jc})),n.d(t,"F",(function(){return yu})),n.d(t,"G",(function(){return _u})),n.d(t,"H",(function(){return Iu})),n.d(t,"I",(function(){return bl})),n.d(t,"J",(function(){return wl})),n.d(t,"K",(function(){return gu})),n.d(t,"L",(function(){return Hl})),n.d(t,"M",(function(){return Ml})),n.d(t,"N",(function(){return Ll})),n.d(t,"O",(function(){return Fl})),n.d(t,"P",(function(){return Ul})),n.d(t,"Q",(function(){return Vl})),n.d(t,"R",(function(){return ql})),n.d(t,"S",(function(){return sh})),n.d(t,"T",(function(){return pl})),n.d(t,"U",(function(){return gl})),n.d(t,"V",(function(){return Eu})),n.d(t,"W",(function(){return ku})),n.d(t,"X",(function(){return $l})),n.d(t,"Y",(function(){return Gl})),n.d(t,"Z",(function(){return dl})),n.d(t,"ab",(function(){return cl})),n.d(t,"bb",(function(){return Fc})),n.d(t,"cb",(function(){return Lc})),n.d(t,"db",(function(){return eh})),n.d(t,"eb",(function(){return nh})),n.d(t,"fb",(function(){return Bl})),n.d(t,"gb",(function(){return f})),n.d(t,"hb",(function(){return Pl})),n.d(t,"ib",(function(){return _l})),n.d(t,"jb",(function(){return yl})),n.d(t,"kb",(function(){return zl})),n.d(t,"lb",(function(){return bu})),n.d(t,"mb",(function(){return ll}));var r=n("589b"),i=n("22e5"),s=n("e691"),o=n("1fd5"),a=n("8f6b");const c="@firebase/firestore";class u{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}u.UNAUTHENTICATED=new u(null),u.GOOGLE_CREDENTIALS=new u("google-credentials-uid"),u.FIRST_PARTY=new u("first-party-uid"),u.MOCK_USER=new u("mock-user");let l="9.13.0";const h=new s["b"]("@firebase/firestore");function d(){return h.logLevel}function f(e){h.setLogLevel(e)}function p(e,...t){if(h.logLevel<=s["a"].DEBUG){const n=t.map(y);h.debug(`Firestore (${l}): ${e}`,...n)}}function g(e,...t){if(h.logLevel<=s["a"].ERROR){const n=t.map(y);h.error(`Firestore (${l}): ${e}`,...n)}}function m(e,...t){if(h.logLevel<=s["a"].WARN){const n=t.map(y);h.warn(`Firestore (${l}): ${e}`,...n)}}function y(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function _(e="Unexpected state"){const t=`FIRESTORE (${l}) INTERNAL ASSERTION FAILED: `+e;throw g(t),new Error(t)}function v(e,t){e||_()}function w(e,t){e||_()}function b(e,t){return e}const I={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class T extends o["c"]{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class E{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class k{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer "+e)}}class C{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(u.UNAUTHENTICATED))}shutdown(){}}class S{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class O{constructor(e){this.t=e,this.currentUser=u.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new E;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new E,e.enqueueRetryable(()=>r(this.currentUser))};const s=()=>{const t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},o=e=>{p("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(p("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new E)}},0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(p("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(v("string"==typeof t.accessToken),new k(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return v(null===e||"string"==typeof e),new u(e)}}class A{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r,this.type="FirstParty",this.user=u.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(v(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class N{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r}getToken(){return Promise.resolve(new A(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(u.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class R{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class D{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const n=e=>{null!=e.error&&p("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: "+e.error.message);const n=e.token!==this.A;return this.A=e.token,p("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const r=e=>{p("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.T.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){const e=this.T.getImmediate({optional:!0});e?r(e):p("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(v("string"==typeof e.token),this.A=e.token,new R(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function x(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}class P{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const r=x(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function M(e,t){return e<t?-1:e>t?1:0}function j(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}function L(e){return e+"\0"}class F{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new T(I.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new T(I.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new T(I.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new T(I.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return F.fromMillis(Date.now())}static fromDate(e){return F.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new F(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?M(this.nanoseconds,e.nanoseconds):M(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class U{constructor(e){this.timestamp=e}static fromTimestamp(e){return new U(e)}static min(){return new U(new F(0,0))}static max(){return new U(new F(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class V{constructor(e,t,n){void 0===t?t=0:t>e.length&&_(),void 0===n?n=e.length-t:n>e.length-t&&_(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===V.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof V?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class q extends V{construct(e,t,n){return new q(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new T(I.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new q(t)}static emptyPath(){return new q([])}}const B=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class z extends V{construct(e,t,n){return new z(e,t,n)}static isValidIdentifier(e){return B.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),z.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new z(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new T(I.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new T(I.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new T(I.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new T(I.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new z(t)}static emptyPath(){return new z([])}}class K{constructor(e){this.path=e}static fromPath(e){return new K(q.fromString(e))}static fromName(e){return new K(q.fromString(e).popFirst(5))}static empty(){return new K(q.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===q.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return q.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new K(new q(e.slice()))}}class W{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function $(e){return e.fields.find(e=>2===e.kind)}function G(e){return e.fields.filter(e=>2!==e.kind)}W.UNKNOWN_ID=-1;class H{constructor(e,t){this.fieldPath=e,this.kind=t}}class Q{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Q(0,J.min())}}function Y(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=U.fromTimestamp(1e9===r?new F(n+1,0):new F(n,r));return new J(i,K.empty(),t)}function X(e){return new J(e.readTime,e.key,-1)}class J{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new J(U.min(),K.empty(),-1)}static max(){return new J(U.max(),K.empty(),-1)}}function Z(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=K.comparator(e.documentKey,t.documentKey),0!==n?n:M(e.largestBatchId,t.largestBatchId))}const ee="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class te{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function ne(e){if(e.code!==I.FAILED_PRECONDITION||e.message!==ee)throw e;p("LocalStore","Unexpectedly lost primary lease")}class re{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&_(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new re((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof re?t:re.resolve(t)}catch(e){return re.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):re.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):re.reject(t)}static resolve(e){return new re((t,n)=>{t(e)})}static reject(e){return new re((t,n)=>{n(e)})}static waitFor(e){return new re((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=re.resolve(!1);for(const n of e)t=t.next(e=>e?re.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new re((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next(e=>{s[c]=e,++o,o===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new re((n,r)=>{const i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}class ie{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.P=new E,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{t.error?this.P.reject(new ae(e,t.error)):this.P.resolve()},this.transaction.onerror=t=>{const n=de(t.target.error);this.P.reject(new ae(e,n))}}static open(e,t,n,r){try{return new ie(t,e.transaction(r,n))}catch(e){throw new ae(t,e)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(p("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new ue(t)}}class se{constructor(e,t,n){this.name=e,this.version=t,this.S=n,12.2===se.D(Object(o["A"])())&&g("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return p("SimpleDb","Removing database:",e),le(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!Object(o["G"])())return!1;if(se.N())return!0;const e=Object(o["A"])(),t=se.D(e),n=0<t&&t<10,r=se.k(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static N(){var t;return"undefined"!=typeof e&&"YES"===(null===(t=Object({NODE_ENV:"production",VUE_APP_I18N_FALLBACK_LOCALE:"en-US",VUE_APP_I18N_LOCALE:"en-US",BASE_URL:"/"}))||void 0===t?void 0:t.O)}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static k(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async F(e){return this.db||(p("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new ae(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new T(I.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new T(I.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new ae(e,r))},r.onupgradeneeded=e=>{p("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.S.$(t,r.transaction,e.oldVersion,this.version).next(()=>{p("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.F(e);const t=ie.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.V(),e)).catch(e=>(t.abort(e),re.reject(e))).toPromise();return s.catch(()=>{}),await t.v,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(p("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class oe{constructor(e){this.U=e,this.q=!1,this.K=null}get isDone(){return this.q}get G(){return this.K}set cursor(e){this.U=e}done(){this.q=!0}j(e){this.K=e}delete(){return le(this.U.delete())}}class ae extends T{constructor(e,t){super(I.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ce(e){return"IndexedDbTransactionError"===e.name}class ue{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(p("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(p("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),le(n)}add(e){return p("SimpleDb","ADD",this.store.name,e,e),le(this.store.add(e))}get(e){return le(this.store.get(e)).next(t=>(void 0===t&&(t=null),p("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return p("SimpleDb","DELETE",this.store.name,e),le(this.store.delete(e))}count(){return p("SimpleDb","COUNT",this.store.name),le(this.store.count())}W(e,t){const n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){const e=this.cursor(n),t=[];return this.H(e,(e,n)=>{t.push(n)}).next(()=>t)}{const e=this.store.getAll(n.range);return new re((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}}J(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new re((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}Y(e,t){p("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.X=!1;const r=this.cursor(n);return this.H(r,(e,t,n)=>n.delete())}Z(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.H(r,t)}tt(e){const t=this.cursor({});return new re((n,r)=>{t.onerror=e=>{const t=de(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():n()}):n()}})}H(e,t){const n=[];return new re((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new oe(i),o=t(i.primaryKey,i.value,s);if(o instanceof re){const e=o.catch(e=>(s.done(),re.reject(e)));n.push(e)}s.isDone?r():null===s.G?i.continue():i.continue(s.G)}}).next(()=>re.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.X?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function le(e){return new re((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=de(e.target.error);n(t)}})}let he=!1;function de(e){const t=se.D(Object(o["A"])());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new T("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return he||(he=!0,setTimeout(()=>{throw e},0)),e}}return e}class fe{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){p("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{p("IndexBackiller","Documents written: "+await this.et.st())}catch(e){ce(e)?p("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await ne(e)}await this.nt(6e4)})}}class pe{constructor(e,t){this.localStore=e,this.persistence=t}async st(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.it(t,e))}it(e,t){const n=new Set;let r=t,i=!0;return re.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!n.has(t))return p("IndexBackiller","Processing collection: "+t),this.rt(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}rt(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.ot(r,n)).next(n=>(p("IndexBackiller","Updating offset: "+n),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}ot(e,t){let n=e;return t.changes.forEach((e,t)=>{const r=X(t);Z(r,n)>0&&(n=r)}),new J(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class ge{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ut(e),this.ct=e=>t.writeSequenceNumber(e))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ct&&this.ct(e),e}}function me(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ye(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function _e(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}ge.at=-1;class ve{constructor(e,t){this.comparator=e,this.root=t||be.EMPTY}insert(e,t){return new ve(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,be.BLACK,null,null))}remove(e){return new ve(this.comparator,this.root.remove(e,this.comparator).copy(null,null,be.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new we(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new we(this.root,e,this.comparator,!1)}getReverseIterator(){return new we(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new we(this.root,e,this.comparator,!0)}}class we{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class be{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:be.RED,this.left=null!=r?r:be.EMPTY,this.right=null!=i?i:be.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new be(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return be.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return be.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,be.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,be.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw _();if(this.right.isRed())throw _();const e=this.left.check();if(e!==this.right.check())throw _();return e+(this.isRed()?0:1)}}be.EMPTY=null,be.RED=!0,be.BLACK=!1,be.EMPTY=new class{constructor(){this.size=0}get key(){throw _()}get value(){throw _()}get color(){throw _()}get left(){throw _()}get right(){throw _()}copy(e,t,n,r,i){return this}insert(e,t,n){return new be(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ie{constructor(e){this.comparator=e,this.data=new ve(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Te(this.data.getIterator())}getIteratorFrom(e){return new Te(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof Ie))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ie(this.comparator);return t.data=e,t}}class Te{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ee(e){return e.hasNext()?e.getNext():void 0}class ke{constructor(e){this.fields=e,e.sort(z.comparator)}static empty(){return new ke([])}unionWith(e){let t=new Ie(z.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new ke(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return j(this.fields,e.fields,(e,t)=>e.isEqual(t))}}function Ce(){return"undefined"!=typeof atob}class Se{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new Se(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Se(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return M(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Se.EMPTY_BYTE_STRING=new Se("");const Oe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ae(e){if(v(!!e),"string"==typeof e){let t=0;const n=Oe.exec(e);if(v(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Ne(e.seconds),nanos:Ne(e.nanos)}}function Ne(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Re(e){return"string"==typeof e?Se.fromBase64String(e):Se.fromUint8Array(e)}function De(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function xe(e){const t=e.mapValue.fields.__previous_value__;return De(t)?xe(t):t}function Pe(e){const t=Ae(e.mapValue.fields.__local_write_time__.timestampValue);return new F(t.seconds,t.nanos)}class Me{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class je{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new je("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof je&&e.projectId===this.projectId&&e.database===this.database}}function Le(e){return null==e}function Fe(e){return 0===e&&1/e==-1/0}function Ue(e){return"number"==typeof e&&Number.isInteger(e)&&!Fe(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}const Ve={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},qe={nullValue:"NULL_VALUE"};function Be(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?De(e)?4:nt(e)?9007199254740991:10:_()}function ze(e,t){if(e===t)return!0;const n=Be(e);if(n!==Be(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Pe(e).isEqual(Pe(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Ae(e.timestampValue),r=Ae(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Re(e.bytesValue).isEqual(Re(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Ne(e.geoPointValue.latitude)===Ne(t.geoPointValue.latitude)&&Ne(e.geoPointValue.longitude)===Ne(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Ne(e.integerValue)===Ne(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Ne(e.doubleValue),r=Ne(t.doubleValue);return n===r?Fe(n)===Fe(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return j(e.arrayValue.values||[],t.arrayValue.values||[],ze);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(me(n)!==me(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!ze(n[i],r[i])))return!1;return!0}(e,t);default:return _()}}function Ke(e,t){return void 0!==(e.values||[]).find(e=>ze(e,t))}function We(e,t){if(e===t)return 0;const n=Be(e),r=Be(t);if(n!==r)return M(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return M(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Ne(e.integerValue||e.doubleValue),r=Ne(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return $e(e.timestampValue,t.timestampValue);case 4:return $e(Pe(e),Pe(t));case 5:return M(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Re(e),r=Re(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const e=M(n[i],r[i]);if(0!==e)return e}return M(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=M(Ne(e.latitude),Ne(t.latitude));return 0!==n?n:M(Ne(e.longitude),Ne(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const e=We(n[i],r[i]);if(e)return e}return M(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===Ve.mapValue&&t===Ve.mapValue)return 0;if(e===Ve.mapValue)return 1;if(t===Ve.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const e=M(r[o],s[o]);if(0!==e)return e;const t=We(n[r[o]],i[s[o]]);if(0!==t)return t}return M(r.length,s.length)}(e.mapValue,t.mapValue);default:throw _()}}function $e(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return M(e,t);const n=Ae(e),r=Ae(t),i=M(n.seconds,r.seconds);return 0!==i?i:M(n.nanos,r.nanos)}function Ge(e){return He(e)}function He(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Ae(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Re(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,K.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=He(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${He(e.fields[i])}`;return n+"}"}(e.mapValue):_();var t,n}function Qe(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Ye(e){return!!e&&"integerValue"in e}function Xe(e){return!!e&&"arrayValue"in e}function Je(e){return!!e&&"nullValue"in e}function Ze(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function et(e){return!!e&&"mapValue"in e}function tt(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return ye(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=tt(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=tt(e.arrayValue.values[n]);return t}return Object.assign({},e)}function nt(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function rt(e){return"nullValue"in e?qe:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?Qe(je.empty(),K.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:_()}function it(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?Qe(je.empty(),K.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?Ve:_()}function st(e,t){const n=We(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function ot(e,t){const n=We(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class at{constructor(e){this.value=e}static empty(){return new at({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!et(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=tt(t)}setAll(e){let t=z.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=tt(e):r.push(i.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());et(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ze(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];et(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){ye(t,(t,n)=>e[t]=n);for(const r of n)delete e[r]}clone(){return new at(tt(this.value))}}function ct(e){const t=[];return ye(e.fields,(e,n)=>{const r=new z([e]);if(et(n)){const e=ct(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)}),new ke(t)}class ut{constructor(e,t,n,r,i,s){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.data=i,this.documentState=s}static newInvalidDocument(e){return new ut(e,0,U.min(),U.min(),at.empty(),0)}static newFoundDocument(e,t,n){return new ut(e,1,t,U.min(),n,0)}static newNoDocument(e,t){return new ut(e,2,t,U.min(),at.empty(),0)}static newUnknownDocument(e,t){return new ut(e,3,t,U.min(),at.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=at.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=at.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=U.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ut&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ut(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class lt{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ht=null}}function ht(e,t=null,n=[],r=[],i=null,s=null,o=null){return new lt(e,t,n,r,i,s,o)}function dt(e){const t=b(e);if(null===t.ht){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>{return(t=e).field.canonicalString()+t.op.toString()+Ge(t.value);var t}).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),Le(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Ge(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Ge(e)).join(",")),t.ht=e}return t.ht}function ft(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>{return`${(t=e).field.canonicalString()} ${t.op} ${Ge(t.value)}`;var t}).join(", ")}]`),Le(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Ge(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Ge(e)).join(",")),`Target(${t})`}function pt(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++)if(!Nt(e.orderBy[i],t.orderBy[i]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let i=0;i<e.filters.length;i++)if(n=e.filters[i],r=t.filters[i],n.op!==r.op||!n.field.isEqual(r.field)||!ze(n.value,r.value))return!1;var n,r;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Dt(e.startAt,t.startAt)&&Dt(e.endAt,t.endAt)}function gt(e){return K.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function mt(e,t){return e.filters.filter(e=>e instanceof vt&&e.field.isEqual(t))}function yt(e,t,n){let r=qe,i=!0;for(const s of mt(e,t)){let e=qe,t=!0;switch(s.op){case"<":case"<=":e=rt(s.value);break;case"==":case"in":case">=":e=s.value;break;case">":e=s.value,t=!1;break;case"!=":case"not-in":e=qe}st({value:r,inclusive:i},{value:e,inclusive:t})<0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];st({value:r,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function _t(e,t,n){let r=Ve,i=!0;for(const s of mt(e,t)){let e=Ve,t=!0;switch(s.op){case">=":case">":e=it(s.value),t=!1;break;case"==":case"in":case"<=":e=s.value;break;case"<":e=s.value,t=!1;break;case"!=":case"not-in":e=Ve}ot({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];ot({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class vt extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.lt(e,t,n):new wt(e,t,n):"array-contains"===t?new Et(e,n):"in"===t?new kt(e,n):"not-in"===t?new Ct(e,n):"array-contains-any"===t?new St(e,n):new vt(e,t,n)}static lt(e,t,n){return"in"===t?new bt(e,n):new It(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.ft(We(t,this.value)):null!==t&&Be(this.value)===Be(t)&&this.ft(We(t,this.value))}ft(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return _()}}dt(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class wt extends vt{constructor(e,t,n){super(e,t,n),this.key=K.fromName(n.referenceValue)}matches(e){const t=K.comparator(e.key,this.key);return this.ft(t)}}class bt extends vt{constructor(e,t){super(e,"in",t),this.keys=Tt("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class It extends vt{constructor(e,t){super(e,"not-in",t),this.keys=Tt("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Tt(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>K.fromName(e.referenceValue))}class Et extends vt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Xe(t)&&Ke(t.arrayValue,this.value)}}class kt extends vt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Ke(this.value.arrayValue,t)}}class Ct extends vt{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ke(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Ke(this.value.arrayValue,t)}}class St extends vt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Xe(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Ke(this.value.arrayValue,e))}}class Ot{constructor(e,t){this.position=e,this.inclusive=t}}class At{constructor(e,t="asc"){this.field=e,this.dir=t}}function Nt(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function Rt(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?K.comparator(K.fromName(o.referenceValue),n.key):We(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function Dt(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!ze(e.position[n],t.position[n]))return!1;return!0}class xt{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this._t=null,this.wt=null,this.startAt,this.endAt}}function Pt(e,t,n,r,i,s,o,a){return new xt(e,t,n,r,i,s,o,a)}function Mt(e){return new xt(e)}function jt(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Lt(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function Ft(e){for(const t of e.filters)if(t.dt())return t.field;return null}function Ut(e){return null!==e.collectionGroup}function Vt(e){const t=b(e);if(null===t._t){t._t=[];const e=Ft(t),n=Lt(t);if(null!==e&&null===n)e.isKeyField()||t._t.push(new At(e)),t._t.push(new At(z.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t._t.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t._t.push(new At(z.keyField(),e))}}}return t._t}function qt(e){const t=b(e);if(!t.wt)if("F"===t.limitType)t.wt=ht(t.path,t.collectionGroup,Vt(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const i of Vt(t)){const t="desc"===i.dir?"asc":"desc";e.push(new At(i.field,t))}const n=t.endAt?new Ot(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Ot(t.startAt.position,t.startAt.inclusive):null;t.wt=ht(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.wt}function Bt(e,t,n){return new xt(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function zt(e,t){return pt(qt(e),qt(t))&&e.limitType===t.limitType}function Kt(e){return`${dt(qt(e))}|lt:${e.limitType}`}function Wt(e){return`Query(target=${ft(qt(e))}; limitType=${e.limitType})`}function $t(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):K.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of e.explicitOrderBy)if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=Rt(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Vt(e),t))&&!(e.endAt&&!function(e,t,n){const r=Rt(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Vt(e),t))}(e,t)}function Gt(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Ht(e){return(t,n)=>{let r=!1;for(const i of Vt(e)){const e=Qt(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function Qt(e,t,n){const r=e.field.isKeyField()?K.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?We(r,i):_()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return _()}}function Yt(e,t){if(e.gt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Fe(t)?"-0":t}}function Xt(e){return{integerValue:""+e}}function Jt(e,t){return Ue(t)?Xt(t):Yt(e,t)}class Zt{constructor(){this._=void 0}}function en(e,t,n){return e instanceof rn?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof sn?on(e,t):e instanceof an?cn(e,t):function(e,t){const n=nn(e,t),r=ln(n)+ln(e.yt);return Ye(n)&&Ye(e.yt)?Xt(r):Yt(e.It,r)}(e,t)}function tn(e,t,n){return e instanceof sn?on(e,t):e instanceof an?cn(e,t):n}function nn(e,t){return e instanceof un?Ye(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class rn extends Zt{}class sn extends Zt{constructor(e){super(),this.elements=e}}function on(e,t){const n=hn(t);for(const r of e.elements)n.some(e=>ze(e,r))||n.push(r);return{arrayValue:{values:n}}}class an extends Zt{constructor(e){super(),this.elements=e}}function cn(e,t){let n=hn(t);for(const r of e.elements)n=n.filter(e=>!ze(e,r));return{arrayValue:{values:n}}}class un extends Zt{constructor(e,t){super(),this.It=e,this.yt=t}}function ln(e){return Ne(e.integerValue||e.doubleValue)}function hn(e){return Xe(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class dn{constructor(e,t){this.field=e,this.transform=t}}function fn(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof sn&&t instanceof sn||e instanceof an&&t instanceof an?j(e.elements,t.elements,ze):e instanceof un&&t instanceof un?ze(e.yt,t.yt):e instanceof rn&&t instanceof rn}(e.transform,t.transform)}class pn{constructor(e,t){this.version=e,this.transformResults=t}}class gn{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new gn}static exists(e){return new gn(void 0,e)}static updateTime(e){return new gn(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function mn(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class yn{}function _n(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new On(e.key,gn.none()):new Tn(e.key,e.data,gn.none());{const n=e.data,r=at.empty();let i=new Ie(z.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new En(e.key,r,new ke(i.toArray()),gn.none())}}function vn(e,t,n){e instanceof Tn?function(e,t,n){const r=e.value.clone(),i=Cn(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof En?function(e,t,n){if(!mn(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Cn(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(kn(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function wn(e,t,n,r){return e instanceof Tn?function(e,t,n,r){if(!mn(e.precondition,t))return n;const i=e.value.clone(),s=Sn(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof En?function(e,t,n,r){if(!mn(e.precondition,t))return n;const i=Sn(e.fieldTransforms,r,t),s=t.data;return s.setAll(kn(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):function(e,t,n){return mn(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function bn(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=nn(r.transform,e||null);null!=i&&(null===n&&(n=at.empty()),n.set(r.field,i))}return n||null}function In(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&j(e,t,(e,t)=>fn(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Tn extends yn{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class En extends yn{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function kn(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function Cn(e,t,n){const r=new Map;v(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,tn(o,a,n[i]))}return r}function Sn(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,en(e,s,t))}return r}class On extends yn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class An extends yn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Nn{constructor(e){this.count=e}}var Rn,Dn;function xn(e){switch(e){default:return _();case I.CANCELLED:case I.UNKNOWN:case I.DEADLINE_EXCEEDED:case I.RESOURCE_EXHAUSTED:case I.INTERNAL:case I.UNAVAILABLE:case I.UNAUTHENTICATED:return!1;case I.INVALID_ARGUMENT:case I.NOT_FOUND:case I.ALREADY_EXISTS:case I.PERMISSION_DENIED:case I.FAILED_PRECONDITION:case I.ABORTED:case I.OUT_OF_RANGE:case I.UNIMPLEMENTED:case I.DATA_LOSS:return!0}}function Pn(e){if(void 0===e)return g("GRPC error has no .code"),I.UNKNOWN;switch(e){case Rn.OK:return I.OK;case Rn.CANCELLED:return I.CANCELLED;case Rn.UNKNOWN:return I.UNKNOWN;case Rn.DEADLINE_EXCEEDED:return I.DEADLINE_EXCEEDED;case Rn.RESOURCE_EXHAUSTED:return I.RESOURCE_EXHAUSTED;case Rn.INTERNAL:return I.INTERNAL;case Rn.UNAVAILABLE:return I.UNAVAILABLE;case Rn.UNAUTHENTICATED:return I.UNAUTHENTICATED;case Rn.INVALID_ARGUMENT:return I.INVALID_ARGUMENT;case Rn.NOT_FOUND:return I.NOT_FOUND;case Rn.ALREADY_EXISTS:return I.ALREADY_EXISTS;case Rn.PERMISSION_DENIED:return I.PERMISSION_DENIED;case Rn.FAILED_PRECONDITION:return I.FAILED_PRECONDITION;case Rn.ABORTED:return I.ABORTED;case Rn.OUT_OF_RANGE:return I.OUT_OF_RANGE;case Rn.UNIMPLEMENTED:return I.UNIMPLEMENTED;case Rn.DATA_LOSS:return I.DATA_LOSS;default:return _()}}(Dn=Rn||(Rn={}))[Dn.OK=0]="OK",Dn[Dn.CANCELLED=1]="CANCELLED",Dn[Dn.UNKNOWN=2]="UNKNOWN",Dn[Dn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Dn[Dn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Dn[Dn.NOT_FOUND=5]="NOT_FOUND",Dn[Dn.ALREADY_EXISTS=6]="ALREADY_EXISTS",Dn[Dn.PERMISSION_DENIED=7]="PERMISSION_DENIED",Dn[Dn.UNAUTHENTICATED=16]="UNAUTHENTICATED",Dn[Dn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Dn[Dn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Dn[Dn.ABORTED=10]="ABORTED",Dn[Dn.OUT_OF_RANGE=11]="OUT_OF_RANGE",Dn[Dn.UNIMPLEMENTED=12]="UNIMPLEMENTED",Dn[Dn.INTERNAL=13]="INTERNAL",Dn[Dn.UNAVAILABLE=14]="UNAVAILABLE",Dn[Dn.DATA_LOSS=15]="DATA_LOSS";class Mn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){ye(this.inner,(t,n)=>{for(const[r,i]of n)e(r,i)})}isEmpty(){return _e(this.inner)}size(){return this.innerSize}}const jn=new ve(K.comparator);function Ln(){return jn}const Fn=new ve(K.comparator);function Un(...e){let t=Fn;for(const n of e)t=t.insert(n.key,n);return t}function Vn(e){let t=Fn;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function qn(){return zn()}function Bn(){return zn()}function zn(){return new Mn(e=>e.toString(),(e,t)=>e.isEqual(t))}const Kn=new ve(K.comparator),Wn=new Ie(K.comparator);function $n(...e){let t=Wn;for(const n of e)t=t.add(n);return t}const Gn=new Ie(M);function Hn(){return Gn}class Qn{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Yn.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Qn(U.min(),r,Hn(),Ln(),$n())}}class Yn{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Yn(n,t,$n(),$n(),$n())}}class Xn{constructor(e,t,n,r){this.Tt=e,this.removedTargetIds=t,this.key=n,this.Et=r}}class Jn{constructor(e,t){this.targetId=e,this.At=t}}class Zn{constructor(e,t,n=Se.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class er{constructor(){this.Rt=0,this.bt=rr(),this.Pt=Se.EMPTY_BYTE_STRING,this.vt=!1,this.Vt=!0}get current(){return this.vt}get resumeToken(){return this.Pt}get St(){return 0!==this.Rt}get Dt(){return this.Vt}Ct(e){e.approximateByteSize()>0&&(this.Vt=!0,this.Pt=e)}xt(){let e=$n(),t=$n(),n=$n();return this.bt.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:_()}}),new Yn(this.Pt,this.vt,e,t,n)}Nt(){this.Vt=!1,this.bt=rr()}kt(e,t){this.Vt=!0,this.bt=this.bt.insert(e,t)}Ot(e){this.Vt=!0,this.bt=this.bt.remove(e)}Mt(){this.Rt+=1}Ft(){this.Rt-=1}$t(){this.Vt=!0,this.vt=!0}}class tr{constructor(e){this.Bt=e,this.Lt=new Map,this.Ut=Ln(),this.qt=nr(),this.Kt=new Ie(M)}Gt(e){for(const t of e.Tt)e.Et&&e.Et.isFoundDocument()?this.Qt(t,e.Et):this.jt(t,e.key,e.Et);for(const t of e.removedTargetIds)this.jt(t,e.key,e.Et)}Wt(e){this.forEachTarget(e,t=>{const n=this.zt(t);switch(e.state){case 0:this.Ht(t)&&n.Ct(e.resumeToken);break;case 1:n.Ft(),n.St||n.Nt(),n.Ct(e.resumeToken);break;case 2:n.Ft(),n.St||this.removeTarget(t);break;case 3:this.Ht(t)&&(n.$t(),n.Ct(e.resumeToken));break;case 4:this.Ht(t)&&(this.Jt(t),n.Ct(e.resumeToken));break;default:_()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Lt.forEach((e,n)=>{this.Ht(n)&&t(n)})}Yt(e){const t=e.targetId,n=e.At.count,r=this.Xt(t);if(r){const e=r.target;if(gt(e))if(0===n){const n=new K(e.path);this.jt(t,n,ut.newNoDocument(n,U.min()))}else v(1===n);else this.Zt(t)!==n&&(this.Jt(t),this.Kt=this.Kt.add(t))}}te(e){const t=new Map;this.Lt.forEach((n,r)=>{const i=this.Xt(r);if(i){if(n.current&&gt(i.target)){const t=new K(i.target.path);null!==this.Ut.get(t)||this.ee(r,t)||this.jt(r,t,ut.newNoDocument(t,e))}n.Dt&&(t.set(r,n.xt()),n.Nt())}});let n=$n();this.qt.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{const t=this.Xt(e);return!t||2===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.Ut.forEach((t,n)=>n.setReadTime(e));const r=new Qn(e,t,this.Kt,this.Ut,n);return this.Ut=Ln(),this.qt=nr(),this.Kt=new Ie(M),r}Qt(e,t){if(!this.Ht(e))return;const n=this.ee(e,t.key)?2:0;this.zt(e).kt(t.key,n),this.Ut=this.Ut.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ne(t.key).add(e))}jt(e,t,n){if(!this.Ht(e))return;const r=this.zt(e);this.ee(e,t)?r.kt(t,1):r.Ot(t),this.qt=this.qt.insert(t,this.ne(t).delete(e)),n&&(this.Ut=this.Ut.insert(t,n))}removeTarget(e){this.Lt.delete(e)}Zt(e){const t=this.zt(e).xt();return this.Bt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Mt(e){this.zt(e).Mt()}zt(e){let t=this.Lt.get(e);return t||(t=new er,this.Lt.set(e,t)),t}ne(e){let t=this.qt.get(e);return t||(t=new Ie(M),this.qt=this.qt.insert(e,t)),t}Ht(e){const t=null!==this.Xt(e);return t||p("WatchChangeAggregator","Detected inactive target",e),t}Xt(e){const t=this.Lt.get(e);return t&&t.St?null:this.Bt.se(e)}Jt(e){this.Lt.set(e,new er),this.Bt.getRemoteKeysForTarget(e).forEach(t=>{this.jt(e,t,null)})}ee(e,t){return this.Bt.getRemoteKeysForTarget(e).has(t)}}function nr(){return new ve(K.comparator)}function rr(){return new ve(K.comparator)}const ir=(()=>{const e={asc:"ASCENDING",desc:"DESCENDING"};return e})(),sr=(()=>{const e={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};return e})();class or{constructor(e,t){this.databaseId=e,this.gt=t}}function ar(e,t){return e.gt?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function cr(e,t){return e.gt?t.toBase64():t.toUint8Array()}function ur(e,t){return ar(e,t.toTimestamp())}function lr(e){return v(!!e),U.fromTimestamp(function(e){const t=Ae(e);return new F(t.seconds,t.nanos)}(e))}function hr(e,t){return function(e){return new q(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function dr(e){const t=q.fromString(e);return v(Fr(t)),t}function fr(e,t){return hr(e.databaseId,t.path)}function pr(e,t){const n=dr(t);if(n.get(1)!==e.databaseId.projectId)throw new T(I.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new T(I.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new K(_r(n))}function gr(e,t){return hr(e.databaseId,t)}function mr(e){const t=dr(e);return 4===t.length?q.emptyPath():_r(t)}function yr(e){return new q(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function _r(e){return v(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function vr(e,t,n){return{name:fr(e,t),fields:n.value.mapValue.fields}}function wr(e,t,n){const r=pr(e,t.name),i=lr(t.updateTime),s=new at({mapValue:{fields:t.fields}}),o=ut.newFoundDocument(r,i,s);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function br(e,t){return"found"in t?function(e,t){v(!!t.found),t.found.name,t.found.updateTime;const n=pr(e,t.found.name),r=lr(t.found.updateTime),i=new at({mapValue:{fields:t.found.fields}});return ut.newFoundDocument(n,r,i)}(e,t):"missing"in t?function(e,t){v(!!t.missing),v(!!t.readTime);const n=pr(e,t.missing),r=lr(t.readTime);return ut.newNoDocument(n,r)}(e,t):_()}function Ir(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:_()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.gt?(v(void 0===t||"string"==typeof t),Se.fromBase64String(t||"")):(v(void 0===t||t instanceof Uint8Array),Se.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?I.UNKNOWN:Pn(e.code);return new T(t,e.message||"")}(o);n=new Zn(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=pr(e,r.document.name),s=lr(r.document.updateTime),o=new at({mapValue:{fields:r.document.fields}}),a=ut.newFoundDocument(i,s,o),c=r.targetIds||[],u=r.removedTargetIds||[];n=new Xn(c,u,a.key,a)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=pr(e,r.document),s=r.readTime?lr(r.readTime):U.min(),o=ut.newNoDocument(i,s),a=r.removedTargetIds||[];n=new Xn([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=pr(e,r.document),s=r.removedTargetIds||[];n=new Xn([],s,i,null)}else{if(!("filter"in t))return _();{t.filter;const e=t.filter;e.targetId;const r=e.count||0,i=new Nn(r),s=e.targetId;n=new Jn(s,i)}}return n}function Tr(e,t){let n;if(t instanceof Tn)n={update:vr(e,t.key,t.value)};else if(t instanceof On)n={delete:fr(e,t.key)};else if(t instanceof En)n={update:vr(e,t.key,t.data),updateMask:Lr(t.fieldMask)};else{if(!(t instanceof An))return _();n={verify:fr(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof rn)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof sn)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof an)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof un)return{fieldPath:t.field.canonicalString(),increment:n.yt};throw _()}(0,e))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:ur(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:_()}(e,t.precondition)),n}function Er(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?gn.updateTime(lr(e.updateTime)):void 0!==e.exists?gn.exists(e.exists):gn.none()}(t.currentDocument):gn.none(),r=t.updateTransforms?t.updateTransforms.map(t=>function(e,t){let n=null;if("setToServerValue"in t)v("REQUEST_TIME"===t.setToServerValue),n=new rn;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new sn(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new an(e)}else"increment"in t?n=new un(e,t.increment):_();const r=z.fromServerFormat(t.fieldPath);return new dn(r,n)}(e,t)):[];if(t.update){t.update.name;const i=pr(e,t.update.name),s=new at({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new ke(t.map(e=>z.fromServerFormat(e)))}(t.updateMask);return new En(i,s,e,n,r)}return new Tn(i,s,n,r)}if(t.delete){const r=pr(e,t.delete);return new On(r,n)}if(t.verify){const r=pr(e,t.verify);return new An(r,n)}return _()}function kr(e,t){return e&&e.length>0?(v(void 0!==t),e.map(e=>function(e,t){let n=e.updateTime?lr(e.updateTime):lr(t);return n.isEqual(U.min())&&(n=lr(t)),new pn(n,e.transformResults||[])}(e,t))):[]}function Cr(e,t){return{documents:[gr(e,t.path)]}}function Sr(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=gr(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=gr(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0===e.length)return;const t=e.map(e=>function(e){if("=="===e.op){if(Ze(e.value))return{unaryFilter:{field:xr(e.field),op:"IS_NAN"}};if(Je(e.value))return{unaryFilter:{field:xr(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Ze(e.value))return{unaryFilter:{field:xr(e.field),op:"IS_NOT_NAN"}};if(Je(e.value))return{unaryFilter:{field:xr(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:xr(e.field),op:Dr(e.op),value:e.value}}}(e));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:xr(e.field),direction:Rr(e.dir)}}(e))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=function(e,t){return e.gt||Le(t)?t:{value:t}}(e,t.limit);var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(a=t.startAt).inclusive,values:a.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function Or(e){let t=mr(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){v(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=Nr(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>function(e){return new At(Pr(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Le(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new Ot(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new Ot(n,t)}(n.endAt)),Pt(t,i,o,s,a,"F",c,u)}function Ar(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return _()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}function Nr(e){return e?void 0!==e.unaryFilter?[jr(e)]:void 0!==e.fieldFilter?[Mr(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>Nr(e)).reduce((e,t)=>e.concat(t)):_():[]}function Rr(e){return ir[e]}function Dr(e){return sr[e]}function xr(e){return{fieldPath:e.canonicalString()}}function Pr(e){return z.fromServerFormat(e.fieldPath)}function Mr(e){return vt.create(Pr(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return _()}}(e.fieldFilter.op),e.fieldFilter.value)}function jr(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Pr(e.unaryFilter.field);return vt.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Pr(e.unaryFilter.field);return vt.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Pr(e.unaryFilter.field);return vt.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Pr(e.unaryFilter.field);return vt.create(i,"!=",{nullValue:"NULL_VALUE"});default:return _()}}function Lr(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Fr(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function Ur(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=qr(t)),t=Vr(e.get(n),t);return qr(t)}function Vr(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const t=e.charAt(i);switch(t){case"\0":n+="";break;case"":n+="";break;default:n+=t}}return n}function qr(e){return e+""}function Br(e){const t=e.length;if(v(t>=2),2===t)return v(""===e.charAt(0)&&""===e.charAt(1)),q.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf("",s);switch((t<0||t>n)&&_(),e.charAt(t+1)){case"":const n=e.substring(s,t);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"":i+=e.substring(s,t),i+="\0";break;case"":i+=e.substring(s,t+1);break;default:_()}s=t+2}return new q(r)}const zr=["userId","batchId"];function Kr(e,t){return[e,Ur(t)]}function Wr(e,t,n){return[e,Ur(t),n]}const $r={},Gr=["prefixPath","collectionGroup","readTime","documentId"],Hr=["prefixPath","collectionGroup","documentId"],Qr=["collectionGroup","readTime","prefixPath","documentId"],Yr=["canonicalId","targetId"],Xr=["targetId","path"],Jr=["path","targetId"],Zr=["collectionId","parent"],ei=["indexId","uid"],ti=["uid","sequenceNumber"],ni=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ri=["indexId","uid","orderedDocumentKey"],ii=["userId","collectionPath","documentId"],si=["userId","collectionPath","largestBatchId"],oi=["userId","collectionGroup","largestBatchId"],ai=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],ci=[...ai,"documentOverlays"],ui=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],li=ui,hi=[...li,"indexConfiguration","indexState","indexEntries"];class di extends te{constructor(e,t){super(),this.ie=e,this.currentSequenceNumber=t}}function fi(e,t){const n=b(e);return se.M(n.ie,t)}class pi{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&vn(t,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=wn(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=wn(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Bn();return this.mutations.forEach(r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=_n(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(U.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),$n())}isEqual(e){return this.batchId===e.batchId&&j(this.mutations,e.mutations,(e,t)=>In(e,t))&&j(this.baseMutations,e.baseMutations,(e,t)=>In(e,t))}}class gi{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){v(e.mutations.length===n.length);let r=Kn;const i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new gi(e,t,n,r)}}class mi{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class yi{constructor(e,t,n,r,i=U.min(),s=U.min(),o=Se.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new yi(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new yi(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new yi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class _i{constructor(e){this.re=e}}function vi(e,t){let n;if(t.document)n=wr(e.re,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=K.fromSegments(t.noDocument.path),r=Ti(t.noDocument.readTime);n=ut.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return _();{const e=K.fromSegments(t.unknownDocument.path),r=Ti(t.unknownDocument.version);n=ut.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new F(e[0],e[1]);return U.fromTimestamp(t)}(t.readTime)),n}function wi(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:bi(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:fr(e,t.key),fields:t.data.value.mapValue.fields,updateTime:ar(e,t.version.toTimestamp())}}(e.re,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Ii(t.version)};else{if(!t.isUnknownDocument())return _();r.unknownDocument={path:n.path.toArray(),version:Ii(t.version)}}return r}function bi(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Ii(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Ti(e){const t=new F(e.seconds,e.nanoseconds);return U.fromTimestamp(t)}function Ei(e,t){const n=(t.baseMutations||[]).map(t=>Er(e.re,t));for(let s=0;s<t.mutations.length-1;++s){const e=t.mutations[s];if(s+1<t.mutations.length&&void 0!==t.mutations[s+1].transform){const n=t.mutations[s+1];e.updateTransforms=n.transform.fieldTransforms,t.mutations.splice(s+1,1),++s}}const r=t.mutations.map(t=>Er(e.re,t)),i=F.fromMillis(t.localWriteTimeMs);return new pi(t.batchId,i,n,r)}function ki(e){const t=Ti(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?Ti(e.lastLimboFreeSnapshotVersion):U.min();let r;var i;return void 0!==e.query.documents?(v(1===(i=e.query).documents.length),r=qt(Mt(mr(i.documents[0])))):r=function(e){return qt(Or(e))}(e.query),new yi(r,e.targetId,0,e.lastListenSequenceNumber,t,n,Se.fromBase64String(e.resumeToken))}function Ci(e,t){const n=Ii(t.snapshotVersion),r=Ii(t.lastLimboFreeSnapshotVersion);let i;i=gt(t.target)?Cr(e.re,t.target):Sr(e.re,t.target);const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:dt(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Si(e){const t=Or({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Bt(t,t.limit,"L"):t}function Oi(e,t){return new mi(t.largestBatchId,Er(e.re,t.overlayMutation))}function Ai(e,t){const n=t.path.lastSegment();return[e,Ur(t.path.popLast()),n]}function Ni(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:Ii(r.readTime),documentKey:Ur(r.documentKey.path),largestBatchId:r.largestBatchId}}class Ri{getBundleMetadata(e,t){return Di(e).get(t).next(e=>{if(e)return{id:(t=e).bundleId,createTime:Ti(t.createTime),version:t.version};var t})}saveBundleMetadata(e,t){return Di(e).put({bundleId:(n=t).id,createTime:Ii(lr(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return xi(e).get(t).next(e=>{if(e)return{name:(t=e).name,query:Si(t.bundledQuery),readTime:Ti(t.readTime)};var t})}saveNamedQuery(e,t){return xi(e).put(function(e){return{name:e.name,readTime:Ii(lr(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function Di(e){return fi(e,"bundles")}function xi(e){return fi(e,"namedQueries")}class Pi{constructor(e,t){this.It=e,this.userId=t}static oe(e,t){const n=t.uid||"";return new Pi(e,n)}getOverlay(e,t){return Mi(e).get(Ai(this.userId,t)).next(e=>e?Oi(this.It,e):null)}getOverlays(e,t){const n=qn();return re.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){const r=[];return n.forEach((n,i)=>{const s=new mi(t,i);r.push(this.ue(e,s))}),re.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach(e=>r.add(Ur(e.getCollectionPath())));const i=[];return r.forEach(t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(Mi(e).Y("collectionPathOverlayIndex",r))}),re.waitFor(i)}getOverlaysForCollection(e,t,n){const r=qn(),i=Ur(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Mi(e).W("collectionPathOverlayIndex",s).next(e=>{for(const t of e){const e=Oi(this.It,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){const i=qn();let s;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Mi(e).Z({index:"collectionGroupOverlayIndex",range:o},(e,t,n)=>{const o=Oi(this.It,t);i.size()<r||o.largestBatchId===s?(i.set(o.getKey(),o),s=o.largestBatchId):n.done()}).next(()=>i)}ue(e,t){return Mi(e).put(function(e,t,n){const[r,i,s]=Ai(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Tr(e.re,n.mutation)}}(this.It,this.userId,t))}}function Mi(e){return fi(e,"documentOverlays")}class ji{constructor(){}ce(e,t){this.ae(e,t),t.he()}ae(e,t){if("nullValue"in e)this.le(t,5);else if("booleanValue"in e)this.le(t,10),t.fe(e.booleanValue?1:0);else if("integerValue"in e)this.le(t,15),t.fe(Ne(e.integerValue));else if("doubleValue"in e){const n=Ne(e.doubleValue);isNaN(n)?this.le(t,13):(this.le(t,15),Fe(n)?t.fe(0):t.fe(n))}else if("timestampValue"in e){const n=e.timestampValue;this.le(t,20),"string"==typeof n?t.de(n):(t.de(""+(n.seconds||"")),t.fe(n.nanos||0))}else if("stringValue"in e)this._e(e.stringValue,t),this.we(t);else if("bytesValue"in e)this.le(t,30),t.me(Re(e.bytesValue)),this.we(t);else if("referenceValue"in e)this.ge(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.le(t,45),t.fe(n.latitude||0),t.fe(n.longitude||0)}else"mapValue"in e?nt(e)?this.le(t,Number.MAX_SAFE_INTEGER):(this.ye(e.mapValue,t),this.we(t)):"arrayValue"in e?(this.pe(e.arrayValue,t),this.we(t)):_()}_e(e,t){this.le(t,25),this.Ie(e,t)}Ie(e,t){t.de(e)}ye(e,t){const n=e.fields||{};this.le(t,55);for(const r of Object.keys(n))this._e(r,t),this.ae(n[r],t)}pe(e,t){const n=e.values||[];this.le(t,50);for(const r of n)this.ae(r,t)}ge(e,t){this.le(t,37),K.fromName(e).path.forEach(e=>{this.le(t,60),this.Ie(e,t)})}le(e,t){e.fe(t)}we(e){e.fe(2)}}function Li(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function Fi(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=Li(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}ji.Te=new ji;class Ui{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ee(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ae(n.value),n=t.next();this.Re()}be(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Pe(n.value),n=t.next();this.ve()}Ve(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ae(e);else if(e<2048)this.Ae(960|e>>>6),this.Ae(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ae(480|e>>>12),this.Ae(128|63&e>>>6),this.Ae(128|63&e);else{const e=t.codePointAt(0);this.Ae(240|e>>>18),this.Ae(128|63&e>>>12),this.Ae(128|63&e>>>6),this.Ae(128|63&e)}}this.Re()}Se(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Pe(e);else if(e<2048)this.Pe(960|e>>>6),this.Pe(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Pe(480|e>>>12),this.Pe(128|63&e>>>6),this.Pe(128|63&e);else{const e=t.codePointAt(0);this.Pe(240|e>>>18),this.Pe(128|63&e>>>12),this.Pe(128|63&e>>>6),this.Pe(128|63&e)}}this.ve()}De(e){const t=this.Ce(e),n=Fi(t);this.xe(1+n),this.buffer[this.position++]=255&n;for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}Ne(e){const t=this.Ce(e),n=Fi(t);this.xe(1+n),this.buffer[this.position++]=~(255&n);for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}ke(){this.Oe(255),this.Oe(255)}Me(){this.Fe(255),this.Fe(255)}reset(){this.position=0}seed(e){this.xe(e.length),this.buffer.set(e,this.position),this.position+=e.length}$e(){return this.buffer.slice(0,this.position)}Ce(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let r=1;r<t.length;++r)t[r]^=n?255:0;return t}Ae(e){const t=255&e;0===t?(this.Oe(0),this.Oe(255)):255===t?(this.Oe(255),this.Oe(0)):this.Oe(t)}Pe(e){const t=255&e;0===t?(this.Fe(0),this.Fe(255)):255===t?(this.Fe(255),this.Fe(0)):this.Fe(e)}Re(){this.Oe(0),this.Oe(1)}ve(){this.Fe(0),this.Fe(1)}Oe(e){this.xe(1),this.buffer[this.position++]=e}Fe(e){this.xe(1),this.buffer[this.position++]=~e}xe(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class Vi{constructor(e){this.Be=e}me(e){this.Be.Ee(e)}de(e){this.Be.Ve(e)}fe(e){this.Be.De(e)}he(){this.Be.ke()}}class qi{constructor(e){this.Be=e}me(e){this.Be.be(e)}de(e){this.Be.Se(e)}fe(e){this.Be.Ne(e)}he(){this.Be.Me()}}class Bi{constructor(){this.Be=new Ui,this.Le=new Vi(this.Be),this.Ue=new qi(this.Be)}seed(e){this.Be.seed(e)}qe(e){return 0===e?this.Le:this.Ue}$e(){return this.Be.$e()}reset(){this.Be.reset()}}class zi{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Ke(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new zi(this.indexId,this.documentKey,this.arrayValue,n)}}function Ki(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=Wi(e.arrayValue,t.arrayValue),0!==n?n:(n=Wi(e.directionalValue,t.directionalValue),0!==n?n:K.comparator(e.documentKey,t.documentKey)))}function Wi(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class $i{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ge=e.orderBy,this.Qe=[];for(const t of e.filters){const e=t;e.dt()?this.je=e:this.Qe.push(e)}}We(e){const t=$(e);if(void 0!==t&&!this.ze(t))return!1;const n=G(e);let r=0,i=0;for(;r<n.length&&this.ze(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.je){const e=n[r];if(!this.He(this.je,e)||!this.Je(this.Ge[i++],e))return!1;++r}for(;r<n.length;++r){const e=n[r];if(i>=this.Ge.length||!this.Je(this.Ge[i++],e))return!1}return!0}ze(e){for(const t of this.Qe)if(this.He(t,e))return!0;return!1}He(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}Je(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}class Gi{constructor(){this.Ye=new Hi}addToCollectionParentIndex(e,t){return this.Ye.add(t),re.resolve()}getCollectionParents(e,t){return re.resolve(this.Ye.getEntries(t))}addFieldIndex(e,t){return re.resolve()}deleteFieldIndex(e,t){return re.resolve()}getDocumentsMatchingTarget(e,t){return re.resolve(null)}getIndexType(e,t){return re.resolve(0)}getFieldIndexes(e,t){return re.resolve([])}getNextCollectionGroupToUpdate(e){return re.resolve(null)}getMinOffset(e,t){return re.resolve(J.min())}getMinOffsetFromCollectionGroup(e,t){return re.resolve(J.min())}updateCollectionGroup(e,t,n){return re.resolve()}updateIndexEntries(e,t){return re.resolve()}}class Hi{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Ie(q.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Ie(q.comparator)).toArray()}}const Qi=new Uint8Array(0);class Yi{constructor(e,t){this.user=e,this.databaseId=t,this.Xe=new Hi,this.Ze=new Mn(e=>dt(e),(e,t)=>pt(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Xe.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.Xe.add(t)});const i={collectionId:n,parent:Ur(r)};return Xi(e).put(i)}return re.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[L(t),""],!1,!0);return Xi(e).W(r).next(e=>{for(const r of e){if(r.collectionId!==t)break;n.push(Br(r.parent))}return n})}addFieldIndex(e,t){const n=Zi(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}(t);delete r.indexId;const i=n.add(r);if(t.indexState){const n=es(e);return i.next(e=>{n.put(Ni(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const n=Zi(e),r=es(e),i=Ji(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const n=Ji(e);let r=!0;const i=new Map;return re.forEach(this.tn(t),t=>this.en(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(r){let e=$n();const r=[];return re.forEach(i,(i,s)=>{var o;p("IndexedDbIndexManager",`Using index ${o=i,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`} to execute ${dt(t)}`);const a=function(e,t){const n=$(t);if(void 0===n)return null;for(const r of mt(e,n.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}(s,i),c=function(e,t){const n=new Map;for(const r of G(t))for(const t of mt(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),u=function(e,t){const n=[];let r=!0;for(const i of G(t)){const t=0===i.kind?yt(e,i.fieldPath,e.startAt):_t(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new Ot(n,r)}(s,i),l=function(e,t){const n=[];let r=!0;for(const i of G(t)){const t=0===i.kind?_t(e,i.fieldPath,e.endAt):yt(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new Ot(n,r)}(s,i),h=this.nn(i,s,u),d=this.nn(i,s,l),f=this.sn(i,s,c),g=this.rn(i.indexId,a,h,u.inclusive,d,l.inclusive,f);return re.forEach(g,i=>n.J(i,t.limit).next(t=>{t.forEach(t=>{const n=K.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}return re.resolve(null)})}tn(e){let t=this.Ze.get(e);return t||(t=[e],this.Ze.set(e,t),t)}rn(e,t,n,r,i,s,o){const a=(null!=t?t.length:1)*Math.max(n.length,i.length),c=a/(null!=t?t.length:1),u=[];for(let l=0;l<a;++l){const a=t?this.on(t[l/c]):Qi,h=this.un(e,a,n[l%c],r),d=this.cn(e,a,i[l%c],s),f=o.map(t=>this.un(e,a,t,!0));u.push(...this.createRange(h,d,f))}return u}un(e,t,n,r){const i=new zi(e,K.empty(),t,n);return r?i:i.Ke()}cn(e,t,n,r){const i=new zi(e,K.empty(),t,n);return r?i.Ke():i}en(e,t){const n=new $i(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(const r of e)n.We(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2;return re.forEach(this.tn(t),t=>this.en(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new Ie(z.comparator),n=!1;for(const r of e.filters){const e=r;e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field))}for(const r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})).next(()=>n)}an(e,t){const n=new Bi;for(const r of G(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const i=n.qe(r.kind);ji.Te.ce(e,i)}return n.$e()}on(e){const t=new Bi;return ji.Te.ce(e,t.qe(0)),t.$e()}hn(e,t){const n=new Bi;return ji.Te.ce(Qe(this.databaseId,t),n.qe(function(e){const t=G(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.$e()}sn(e,t,n){if(null===n)return[];let r=[];r.push(new Bi);let i=0;for(const s of G(e)){const e=n[i++];for(const n of r)if(this.ln(t,s.fieldPath)&&Xe(e))r=this.fn(r,s,e);else{const t=n.qe(s.kind);ji.Te.ce(e,t)}}return this.dn(r)}nn(e,t,n){return this.sn(e,t,n.position)}dn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].$e();return t}fn(e,t,n){const r=[...e],i=[];for(const s of n.arrayValue.values||[])for(const e of r){const n=new Bi;n.seed(e.$e()),ji.Te.ce(s,n.qe(t.kind)),i.push(n)}return i}ln(e,t){return!!e.filters.find(e=>e instanceof vt&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){const n=Zi(e),r=es(e);return(t?n.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.W()).next(e=>{const t=[];return re.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{t.push(function(e,t){const n=t?new Q(t.sequenceNumber,new J(Ti(t.readTime),new K(Br(t.documentKey)),t.largestBatchId)):Q.empty(),r=e.fields.map(([e,t])=>new H(z.fromServerFormat(e),t));return new W(e.indexId,e.collectionGroup,r,n)}(e,n))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:M(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){const r=Zi(e),i=es(e);return this._n(e).next(e=>r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(t=>re.forEach(t,t=>i.put(Ni(t.indexId,this.user,e,n)))))}updateIndexEntries(e,t){const n=new Map;return re.forEach(t,(t,r)=>{const i=n.get(t.collectionGroup);return(i?re.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),re.forEach(i,n=>this.wn(e,t,n).next(t=>{const i=this.mn(r,n);return t.isEqual(i)?re.resolve():this.gn(e,r,n,t,i)}))))})}yn(e,t,n,r){return Ji(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.hn(n,t.key),documentKey:t.key.path.toArray()})}pn(e,t,n,r){return Ji(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.hn(n,t.key),t.key.path.toArray()])}wn(e,t,n){const r=Ji(e);let i=new Ie(Ki);return r.Z({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.hn(n,t)])},(e,r)=>{i=i.add(new zi(n.indexId,t,r.arrayValue,r.directionalValue))}).next(()=>i)}mn(e,t){let n=new Ie(Ki);const r=this.an(t,e);if(null==r)return n;const i=$(t);if(null!=i){const s=e.data.field(i.fieldPath);if(Xe(s))for(const i of s.arrayValue.values||[])n=n.add(new zi(t.indexId,e.key,this.on(i),r))}else n=n.add(new zi(t.indexId,e.key,Qi,r));return n}gn(e,t,n,r,i){p("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const s=[];return function(e,t,n,r,i){const s=e.getIterator(),o=t.getIterator();let a=Ee(s),c=Ee(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const r=n(a,c);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(c),c=Ee(o)):t?(i(a),a=Ee(s)):(a=Ee(s),c=Ee(o))}}(r,i,Ki,r=>{s.push(this.yn(e,t,n,r))},r=>{s.push(this.pn(e,t,n,r))}),re.waitFor(s)}_n(e){let t=1;return es(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>Ki(e,t)).filter((e,t,n)=>!t||0!==Ki(e,n[t-1]));const r=[];r.push(e);for(const s of n){const n=Ki(s,e),i=Ki(s,t);if(0===n)r[0]=e.Ke();else if(n>0&&i<0)r.push(s),r.push(s.Ke());else if(i>0)break}r.push(t);const i=[];for(let s=0;s<r.length;s+=2)i.push(IDBKeyRange.bound([r[s].indexId,this.uid,r[s].arrayValue,r[s].directionalValue,Qi,[]],[r[s+1].indexId,this.uid,r[s+1].arrayValue,r[s+1].directionalValue,Qi,[]]));return i}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(ts)}getMinOffset(e,t){return re.mapArray(this.tn(t),t=>this.en(e,t).next(e=>e||_())).next(ts)}}function Xi(e){return fi(e,"collectionParents")}function Ji(e){return fi(e,"indexEntries")}function Zi(e){return fi(e,"indexConfiguration")}function es(e){return fi(e,"indexState")}function ts(e){v(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const i=e[r].indexState.offset;Z(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new J(t.readTime,t.documentKey,n)}const ns={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class rs{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new rs(e,rs.DEFAULT_COLLECTION_PERCENTILE,rs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function is(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.Z({range:o},(e,t,n)=>(a++,n.delete()));s.push(c.next(()=>{v(1===a)}));const u=[];for(const l of n.mutations){const e=Wr(t,l.key.path,n.batchId);s.push(i.delete(e)),u.push(l.key)}return re.waitFor(s).next(()=>u)}function ss(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw _();t=e.noDocument}return JSON.stringify(t).length}rs.DEFAULT_COLLECTION_PERCENTILE=10,rs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,rs.DEFAULT=new rs(41943040,rs.DEFAULT_COLLECTION_PERCENTILE,rs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),rs.DISABLED=new rs(-1,0,0);class os{constructor(e,t,n,r){this.userId=e,this.It=t,this.indexManager=n,this.referenceDelegate=r,this.In={}}static oe(e,t,n,r){v(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new os(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return cs(e).Z({index:"userMutationsIndex",range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){const i=us(e),s=cs(e);return s.add({}).next(o=>{v("number"==typeof o);const a=new pi(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map(t=>Tr(e.re,t)),i=n.mutations.map(t=>Tr(e.re,t));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.It,this.userId,a),u=[];let l=new Ie((e,t)=>M(e.canonicalString(),t.canonicalString()));for(const e of r){const t=Wr(this.userId,e.key.path,o);l=l.add(e.key.path.popLast()),u.push(s.put(c)),u.push(i.put(t,$r))}return l.forEach(t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.In[o]=a.keys()}),re.waitFor(u).next(()=>a)})}lookupMutationBatch(e,t){return cs(e).get(t).next(e=>e?(v(e.userId===this.userId),Ei(this.It,e)):null)}Tn(e,t){return this.In[t]?re.resolve(this.In[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){const n=e.keys();return this.In[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return cs(e).Z({index:"userMutationsIndex",range:r},(e,t,r)=>{t.userId===this.userId&&(v(t.batchId>=n),i=Ei(this.It,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return cs(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return cs(e).W("userMutationsIndex",t).next(e=>e.map(e=>Ei(this.It,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Kr(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return us(e).Z({range:r},(n,r,s)=>{const[o,a,c]=n,u=Br(a);if(o===this.userId&&t.path.isEqual(u))return cs(e).get(c).next(e=>{if(!e)throw _();v(e.userId===this.userId),i.push(Ei(this.It,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ie(M);const r=[];return t.forEach(t=>{const i=Kr(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=us(e).Z({range:s},(e,r,i)=>{const[s,o,a]=e,c=Br(o);s===this.userId&&t.path.isEqual(c)?n=n.add(a):i.done()});r.push(o)}),re.waitFor(r).next(()=>this.En(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=Kr(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new Ie(M);return us(e).Z({range:s},(e,t,i)=>{const[s,a,c]=e,u=Br(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()}).next(()=>this.En(e,o))}En(e,t){const n=[],r=[];return t.forEach(t=>{r.push(cs(e).get(t).next(e=>{if(null===e)throw _();v(e.userId===this.userId),n.push(Ei(this.It,e))}))}),re.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return is(e.ie,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.An(t.batchId)}),re.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}An(e){delete this.In[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return re.resolve();const n=IDBKeyRange.lowerBound([this.userId]),r=[];return us(e).Z({range:n},(e,t,n)=>{if(e[0]===this.userId){const t=Br(e[1]);r.push(t)}else n.done()}).next(()=>{v(0===r.length)})})}containsKey(e,t){return as(e,this.userId,t)}Rn(e){return ls(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function as(e,t,n){const r=Kr(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return us(e).Z({range:s,X:!0},(e,n,r)=>{const[s,a,c]=e;s===t&&a===i&&(o=!0),r.done()}).next(()=>o)}function cs(e){return fi(e,"mutations")}function us(e){return fi(e,"documentMutations")}function ls(e){return fi(e,"mutationQueues")}class hs{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new hs(0)}static vn(){return new hs(-1)}}class ds{constructor(e,t){this.referenceDelegate=e,this.It=t}allocateTargetId(e){return this.Vn(e).next(t=>{const n=new hs(t.highestTargetId);return t.highestTargetId=n.next(),this.Sn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(e=>U.fromTimestamp(new F(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.Vn(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Sn(e,r)))}addTargetData(e,t){return this.Dn(e,t).next(()=>this.Vn(e).next(n=>(n.targetCount+=1,this.Cn(t,n),this.Sn(e,n))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>fs(e).delete(t.targetId)).next(()=>this.Vn(e)).next(t=>(v(t.targetCount>0),t.targetCount-=1,this.Sn(e,t)))}removeTargets(e,t,n){let r=0;const i=[];return fs(e).Z((s,o)=>{const a=ki(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))}).next(()=>re.waitFor(i)).next(()=>r)}forEachTarget(e,t){return fs(e).Z((e,n)=>{const r=ki(n);t(r)})}Vn(e){return ps(e).get("targetGlobalKey").next(e=>(v(null!==e),e))}Sn(e,t){return ps(e).put("targetGlobalKey",t)}Dn(e,t){return fs(e).put(Ci(this.It,t))}Cn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Vn(e).next(e=>e.targetCount)}getTargetData(e,t){const n=dt(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return fs(e).Z({range:r,index:"queryTargetsIndex"},(e,n,r)=>{const s=ki(n);pt(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){const r=[],i=gs(e);return t.forEach(t=>{const s=Ur(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),re.waitFor(r)}removeMatchingKeys(e,t,n){const r=gs(e);return re.forEach(t,t=>{const i=Ur(t.path);return re.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){const n=gs(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=gs(e);let i=$n();return r.Z({range:n,X:!0},(e,t,n)=>{const r=Br(e[1]),s=new K(r);i=i.add(s)}).next(()=>i)}containsKey(e,t){const n=Ur(t.path),r=IDBKeyRange.bound([n],[L(n)],!1,!0);let i=0;return gs(e).Z({index:"documentTargetsIndex",X:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}se(e,t){return fs(e).get(t).next(e=>e?ki(e):null)}}function fs(e){return fi(e,"targets")}function ps(e){return fi(e,"targetGlobal")}function gs(e){return fi(e,"targetDocuments")}function ms([e,t],[n,r]){const i=M(e,n);return 0===i?M(t,r):i}class ys{constructor(e){this.xn=e,this.buffer=new Ie(ms),this.Nn=0}kn(){return++this.Nn}On(e){const t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();ms(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class _s{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Mn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return null!==this.Mn}Fn(e){p("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Mn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){ce(e)?p("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await ne(e)}await this.Fn(3e5)})}}class vs{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return re.resolve(ge.at);const n=new ys(t);return this.$n.forEachTarget(e,e=>n.On(e.sequenceNumber)).next(()=>this.$n.Ln(e,e=>n.On(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.$n.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(p("LruGarbageCollector","Garbage collection skipped; disabled"),re.resolve(ns)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(p("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ns):this.Un(e,t))}getCacheSize(e){return this.$n.getCacheSize(e)}Un(e,t){let n,r,i,o,a,c,u;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(p("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,o=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(u=Date.now(),d()<=s["a"].DEBUG&&p("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-l}ms\n\tDetermined least recently used ${r} in `+(a-o)+"ms\n"+`\tRemoved ${i} targets in `+(c-a)+"ms\n"+`\tRemoved ${e} documents in `+(u-c)+"ms\n"+`Total Duration: ${u-l}ms`),re.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class ws{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new vs(e,t)}(this,t)}Bn(e){const t=this.qn(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}qn(e){let t=0;return this.Ln(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,t){return this.Kn(e,(e,n)=>t(n))}addReference(e,t,n){return bs(e,n)}removeReference(e,t,n){return bs(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return bs(e,t)}Gn(e,t){return function(e,t){let n=!1;return ls(e).tt(r=>as(e,r,t).next(e=>(e&&(n=!0),re.resolve(!e)))).next(()=>n)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Kn(e,(s,o)=>{if(o<=t){const t=this.Gn(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,U.min()),gs(e).delete([0,Ur(s.path)])))});r.push(t)}}).next(()=>re.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return bs(e,t)}Kn(e,t){const n=gs(e);let r,i=ge.at;return n.Z({index:"documentTargetsIndex"},([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==ge.at&&t(new K(Br(r)),i),i=o,r=s):i=ge.at}).next(()=>{i!==ge.at&&t(new K(Br(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function bs(e,t){return gs(e).put(function(e,t){return{targetId:0,path:Ur(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class Is{constructor(){this.changes=new Mn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ut.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?re.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Ts{constructor(e){this.It=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Ss(e).put(n)}removeEntry(e,t,n){return Ss(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],bi(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.Qn(e,n)))}getEntry(e,t){let n=ut.newInvalidDocument(t);return Ss(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Os(t))},(e,r)=>{n=this.jn(t,r)}).next(()=>n)}Wn(e,t){let n={size:0,document:ut.newInvalidDocument(t)};return Ss(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Os(t))},(e,r)=>{n={document:this.jn(t,r),size:ss(r)}}).next(()=>n)}getEntries(e,t){let n=Ln();return this.zn(e,t,(e,t)=>{const r=this.jn(e,t);n=n.insert(e,r)}).next(()=>n)}Hn(e,t){let n=Ln(),r=new ve(K.comparator);return this.zn(e,t,(e,t)=>{const i=this.jn(e,t);n=n.insert(e,i),r=r.insert(e,ss(t))}).next(()=>({documents:n,Jn:r}))}zn(e,t,n){if(t.isEmpty())return re.resolve();let r=new Ie(Ns);t.forEach(e=>r=r.add(e));const i=IDBKeyRange.bound(Os(r.first()),Os(r.last())),s=r.getIterator();let o=s.getNext();return Ss(e).Z({index:"documentKeyIndex",range:i},(e,t,r)=>{const i=K.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&Ns(o,i)<0;)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.j(Os(o)):r.done()}).next(()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null})}getAllFromCollection(e,t,n){const r=[t.popLast().toArray(),t.lastSegment(),bi(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],i=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ss(e).W(IDBKeyRange.bound(r,i,!0)).next(e=>{let t=Ln();for(const n of e){const e=this.jn(K.fromSegments(n.prefixPath.concat(n.collectionGroup,n.documentId)),n);t=t.insert(e.key,e)}return t})}getAllFromCollectionGroup(e,t,n,r){let i=Ln();const s=As(t,n),o=As(t,J.max());return Ss(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,o,!0)},(e,t,n)=>{const s=this.jn(K.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new ks(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return Cs(e).get("remoteDocumentGlobalKey").next(e=>(v(!!e),e))}Qn(e,t){return Cs(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){const e=vi(this.It,t);if(!e.isNoDocument()||!e.version.isEqual(U.min()))return e}return ut.newInvalidDocument(e)}}function Es(e){return new Ts(e)}class ks extends Is{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new Mn(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){const t=[];let n=0,r=new Ie((e,t)=>M(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{const o=this.Xn.get(i);if(t.push(this.Yn.removeEntry(e,i,o.readTime)),s.isValidDocument()){const a=wi(this.Yn.It,s);r=r.add(i.path.popLast());const c=ss(a);n+=c-o.size,t.push(this.Yn.addEntry(e,i,a))}else if(n-=o.size,this.trackRemovals){const n=wi(this.Yn.It,s.convertToNoDocument(U.min()));t.push(this.Yn.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.Yn.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.Yn.updateMetadata(e,n)),re.waitFor(t)}getFromCache(e,t){return this.Yn.Wn(e,t).next(e=>(this.Xn.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next(({documents:e,Jn:t})=>(t.forEach((t,n)=>{this.Xn.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function Cs(e){return fi(e,"remoteDocumentGlobal")}function Ss(e){return fi(e,"remoteDocumentsV14")}function Os(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function As(e,t){const n=t.documentKey.path.toArray();return[e,bi(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function Ns(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let s=0;s<n.length-2&&s<r.length-2;++s)if(i=M(n[s],r[s]),i)return i;return i=M(n.length,r.length),i||(i=M(n[n.length-2],r[r.length-2]),i||M(n[n.length-1],r[r.length-1]))}class Rs{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Ds{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.getBaseDocument(e,t,n))).next(e=>(null!==n&&wn(n.mutation,e,ke.empty(),F.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,$n()).next(()=>t))}getLocalViewOfDocuments(e,t,n=$n()){const r=qn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=Un();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=qn();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,$n()))}populateOverlays(e,t,n){const r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=Ln();const s=zn(),o=zn();return t.forEach((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof En)?i=i.insert(t.key,t):void 0!==o&&(s.set(t.key,o.mutation.getFieldMask()),wn(o.mutation,t,o.mutation.getFieldMask(),F.now()))}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new Rs(t,null!==(n=s.get(e))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(e,t){const n=zn();let r=new ve((e,t)=>e-t),i=$n();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const i of e)i.keys().forEach(e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||ke.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||$n()).add(e);r=r.insert(i.batchId,a)})}).next(()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=Bn();c.forEach(e=>{if(!i.has(e)){const r=_n(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return re.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n){return function(e){return K.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Ut(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):re.resolve(qn());let o=-1,a=i;return s.next(t=>re.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?re.resolve():this.getBaseDocument(e,t,n).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,a,t,$n())).next(e=>({batchId:o,changes:Vn(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new K(t)).next(e=>{let t=Un();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n){const r=t.collectionGroup;let i=Un();return this.indexManager.getCollectionParents(e,r).next(s=>re.forEach(s,s=>{const o=function(e,t){return new xt(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(r));return this.getDocumentsMatchingCollectionQuery(e,o,n).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,n){let r;return this.remoteDocumentCache.getAllFromCollection(e,t.path,n).next(i=>(r=i,this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId))).next(e=>{e.forEach((e,t)=>{const n=t.getKey();null===r.get(n)&&(r=r.insert(n,ut.newInvalidDocument(n)))});let n=Un();return r.forEach((r,i)=>{const s=e.get(r);void 0!==s&&wn(s.mutation,i,ke.empty(),F.now()),$t(t,i)&&(n=n.insert(r,i))}),n})}getBaseDocument(e,t,n){return null===n||1===n.mutation.type?this.remoteDocumentCache.getEntry(e,t):re.resolve(ut.newInvalidDocument(t))}}class xs{constructor(e){this.It=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return re.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){var n;return this.Zn.set(t.id,{id:(n=t).id,version:n.version,createTime:lr(n.createTime)}),re.resolve()}getNamedQuery(e,t){return re.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,function(e){return{name:e.name,query:Si(e.bundledQuery),readTime:lr(e.readTime)}}(t)),re.resolve()}}class Ps{constructor(){this.overlays=new ve(K.comparator),this.es=new Map}getOverlay(e,t){return re.resolve(this.overlays.get(t))}getOverlays(e,t){const n=qn();return re.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.ue(e,t,r)}),re.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.es.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.es.delete(n)),re.resolve()}getOverlaysForCollection(e,t,n){const r=qn(),i=t.length+1,s=new K(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return re.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new ve((e,t)=>e-t);const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=qn(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=qn(),a=i.getIterator();for(;a.hasNext();)if(a.getNext().value.forEach((e,t)=>o.set(e,t)),o.size()>=r)break;return re.resolve(o)}ue(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.es.get(r.largestBatchId).delete(n.key);this.es.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new mi(t,n));let i=this.es.get(t);void 0===i&&(i=$n(),this.es.set(t,i)),this.es.set(t,i.add(n.key))}}class Ms{constructor(){this.ns=new Ie(js.ss),this.rs=new Ie(js.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){const n=new js(e,t);this.ns=this.ns.add(n),this.rs=this.rs.add(n)}us(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.cs(new js(e,t))}hs(e,t){e.forEach(e=>this.removeReference(e,t))}ls(e){const t=new K(new q([])),n=new js(t,e),r=new js(t,e+1),i=[];return this.rs.forEachInRange([n,r],e=>{this.cs(e),i.push(e.key)}),i}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const t=new K(new q([])),n=new js(t,e),r=new js(t,e+1);let i=$n();return this.rs.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){const t=new js(e,0),n=this.ns.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class js{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return K.comparator(e.key,t.key)||M(e._s,t._s)}static os(e,t){return M(e._s,t._s)||K.comparator(e.key,t.key)}}class Ls{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new Ie(js.ss)}checkEmpty(e){return re.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.ws;this.ws++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new pi(i,t,n,r);this.mutationQueue.push(s);for(const o of r)this.gs=this.gs.add(new js(o.key,i)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return re.resolve(s)}lookupMutationBatch(e,t){return re.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.ps(n),i=r<0?0:r;return re.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return re.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return re.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new js(t,0),r=new js(t,Number.POSITIVE_INFINITY),i=[];return this.gs.forEachInRange([n,r],e=>{const t=this.ys(e._s);i.push(t)}),re.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ie(M);return t.forEach(e=>{const t=new js(e,0),r=new js(e,Number.POSITIVE_INFINITY);this.gs.forEachInRange([t,r],e=>{n=n.add(e._s)})}),re.resolve(this.Is(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;K.isDocumentKey(i)||(i=i.child(""));const s=new js(new K(i),0);let o=new Ie(M);return this.gs.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e._s)),!0)},s),re.resolve(this.Is(o))}Is(e){const t=[];return e.forEach(e=>{const n=this.ys(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){v(0===this.Ts(t.batchId,"removed")),this.mutationQueue.shift();let n=this.gs;return re.forEach(t.mutations,r=>{const i=new js(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.gs=n})}An(e){}containsKey(e,t){const n=new js(t,0),r=this.gs.firstAfterOrEqual(n);return re.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,re.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){const t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Fs{constructor(e){this.Es=e,this.docs=new ve(K.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Es(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return re.resolve(n?n.document.mutableCopy():ut.newInvalidDocument(t))}getEntries(e,t){let n=Ln();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():ut.newInvalidDocument(e))}),re.resolve(n)}getAllFromCollection(e,t,n){let r=Ln();const i=new K(t.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i}}=s.getNext();if(!t.isPrefixOf(e.path))break;e.path.length>t.length+1||Z(X(i),n)<=0||(r=r.insert(i.key,i.mutableCopy()))}return re.resolve(r)}getAllFromCollectionGroup(e,t,n,r){_()}As(e,t){return re.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new Us(this)}getSize(e){return re.resolve(this.size)}}class Us extends Is{constructor(e){super(),this.Yn=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Yn.addEntry(e,r)):this.Yn.removeEntry(n)}),re.waitFor(t)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class Vs{constructor(e){this.persistence=e,this.Rs=new Mn(e=>dt(e),pt),this.lastRemoteSnapshotVersion=U.min(),this.highestTargetId=0,this.bs=0,this.Ps=new Ms,this.targetCount=0,this.vs=hs.Pn()}forEachTarget(e,t){return this.Rs.forEach((e,n)=>t(n)),re.resolve()}getLastRemoteSnapshotVersion(e){return re.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return re.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),re.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.bs&&(this.bs=t),re.resolve()}Dn(e){this.Rs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.vs=new hs(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,re.resolve()}updateTargetData(e,t){return this.Dn(t),re.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,re.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Rs.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Rs.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),re.waitFor(i).next(()=>r)}getTargetCount(e){return re.resolve(this.targetCount)}getTargetData(e,t){const n=this.Rs.get(t)||null;return re.resolve(n)}addMatchingKeys(e,t,n){return this.Ps.us(t,n),re.resolve()}removeMatchingKeys(e,t,n){this.Ps.hs(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),re.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),re.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Ps.ds(t);return re.resolve(n)}containsKey(e,t){return re.resolve(this.Ps.containsKey(t))}}class qs{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new ge(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new Vs(this),this.indexManager=new Gi,this.remoteDocumentCache=function(e){return new Fs(e)}(e=>this.referenceDelegate.xs(e)),this.It=new _i(t),this.Ns=new xs(this.It)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Ps,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Vs[e.toKey()];return n||(n=new Ls(t,this.referenceDelegate),this.Vs[e.toKey()]=n),n}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,n){p("MemoryPersistence","Starting transaction:",e);const r=new Bs(this.Ss.next());return this.referenceDelegate.ks(),n(r).next(e=>this.referenceDelegate.Os(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ms(e,t){return re.or(Object.values(this.Vs).map(n=>()=>n.containsKey(e,t)))}}class Bs extends te{constructor(e){super(),this.currentSequenceNumber=e}}class zs{constructor(e){this.persistence=e,this.Fs=new Ms,this.$s=null}static Bs(e){return new zs(e)}get Ls(){if(this.$s)return this.$s;throw _()}addReference(e,t,n){return this.Fs.addReference(n,t),this.Ls.delete(n.toString()),re.resolve()}removeReference(e,t,n){return this.Fs.removeReference(n,t),this.Ls.add(n.toString()),re.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),re.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach(e=>this.Ls.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Ls.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}ks(){this.$s=new Set}Os(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return re.forEach(this.Ls,n=>{const r=K.fromPath(n);return this.Us(e,r).next(e=>{e||t.removeEntry(r,U.min())})}).next(()=>(this.$s=null,t.apply(e)))}updateLimboDocument(e,t){return this.Us(e,t).next(e=>{e?this.Ls.delete(t.toString()):this.Ls.add(t.toString())})}xs(e){return 0}Us(e,t){return re.or([()=>re.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class Ks{constructor(e){this.It=e}$(e,t,n,r){const i=new ie("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",zr,{unique:!0}),e.createObjectStore("documentMutations")}(e),Ws(e),function(e){e.createObjectStore("remoteDocuments")}(e));let s=re.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),Ws(e)),s=s.next(()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:U.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(i))),n<4&&r>=4&&(0!==n&&(s=s.next(()=>function(e,t){return t.store("mutations").W().next(n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",zr,{unique:!0});const r=t.store("mutations"),i=n.map(e=>r.put(e));return re.waitFor(i)})}(e,i))),s=s.next(()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),n<5&&r>=5&&(s=s.next(()=>this.qs(i))),n<6&&r>=6&&(s=s.next(()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(e),this.Ks(i)))),n<7&&r>=7&&(s=s.next(()=>this.Gs(i))),n<8&&r>=8&&(s=s.next(()=>this.Qs(e,i))),n<9&&r>=9&&(s=s.next(()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)})),n<10&&r>=10&&(s=s.next(()=>this.js(i))),n<11&&r>=11&&(s=s.next(()=>{!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&r>=12&&(s=s.next(()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:ii});t.createIndex("collectionPathOverlayIndex",si,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",oi,{unique:!1})}(e)})),n<13&&r>=13&&(s=s.next(()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:Gr});t.createIndex("documentKeyIndex",Hr),t.createIndex("collectionGroupIndex",Qr)}(e)).next(()=>this.Ws(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&r>=14&&(s=s.next(()=>this.zs(e,i))),n<15&&r>=15&&(s=s.next(()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:ei}).createIndex("sequenceNumberIndex",ti,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:ni}).createIndex("documentKeyIndex",ri,{unique:!1})}(e))),s}Ks(e){let t=0;return e.store("remoteDocuments").Z((e,n)=>{t+=ss(n)}).next(()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}qs(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.W().next(t=>re.forEach(t,t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.W("userMutationsIndex",r).next(n=>re.forEach(n,n=>{v(n.userId===t.userId);const r=Ei(this.It,n);return is(e,t.userId,r).next(()=>{})}))}))}Gs(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(e=>{const r=[];return n.Z((n,i)=>{const s=new q(n),o=function(e){return[0,Ur(e)]}(s);r.push(t.get(o).next(n=>n?re.resolve():(n=>t.put({targetId:0,path:Ur(n),sequenceNumber:e.highestListenSequenceNumber}))(s)))}).next(()=>re.waitFor(r))})}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:Zr});const n=t.store("collectionParents"),r=new Hi,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Ur(r)})}};return t.store("remoteDocuments").Z({X:!0},(e,t)=>{const n=new q(e);return i(n.popLast())}).next(()=>t.store("documentMutations").Z({X:!0},([e,t,n],r)=>{const s=Br(t);return i(s.popLast())}))}js(e){const t=e.store("targets");return t.Z((e,n)=>{const r=ki(n),i=Ci(this.It,r);return t.put(i)})}Ws(e,t){const n=t.store("remoteDocuments"),r=[];return n.Z((e,n)=>{const i=t.store("remoteDocumentsV14"),s=(o=n,o.document?new K(q.fromString(o.document.name).popFirst(5)):o.noDocument?K.fromSegments(o.noDocument.path):o.unknownDocument?K.fromSegments(o.unknownDocument.path):_()).path.toArray();var o;const a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))}).next(()=>re.waitFor(r))}zs(e,t){const n=t.store("mutations"),r=Es(this.It),i=new qs(zs.Bs,this.It.re);return n.W().next(e=>{const n=new Map;return e.forEach(e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:$n();Ei(this.It,e).keys().forEach(e=>r=r.add(e)),n.set(e.userId,r)}),re.forEach(n,(e,n)=>{const s=new u(n),o=Pi.oe(this.It,s),a=i.getIndexManager(s),c=os.oe(s,this.It,a,i.referenceDelegate);return new Ds(r,c,o,a).recalculateAndSaveOverlaysForDocumentKeys(new di(t,ge.at),e).next()})})}}function Ws(e){e.createObjectStore("targetDocuments",{keyPath:Xr}).createIndex("documentTargetsIndex",Jr,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Yr,{unique:!0}),e.createObjectStore("targetGlobal")}const $s="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Gs{constructor(e,t,n,r,i,s,o,a,c,u,l=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Hs=i,this.window=s,this.document=o,this.Js=c,this.Ys=u,this.Xs=l,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=e=>Promise.resolve(),!Gs.C())throw new T(I.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new ws(this,r),this.ii=t+"main",this.It=new _i(a),this.ri=new se(this.ii,this.Xs,new Ks(this.It)),this.Cs=new ds(this.referenceDelegate,this.It),this.remoteDocumentCache=Es(this.It),this.Ns=new Ri,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===u&&g("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new T(I.FAILED_PRECONDITION,$s);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e))}).then(e=>{this.Ss=new ge(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(e){return this.si=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.ri.L(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget(async()=>{this.started&&await this.ui()}))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Qs(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(e=>{e||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(e)).next(t=>this.isPrimary&&!t?this._i(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(ce(e))return p("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return p("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return Hs(e).get("owner").next(e=>re.resolve(this.mi(e)))}gi(e){return Qs(e).delete(this.clientId)}async yi(){if(this.isPrimary&&!this.pi(this.ni,18e5)){this.ni=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const t=fi(e,"clientMetadata");return t.W().next(e=>{const n=this.Ii(e,18e5),r=e.filter(e=>-1===n.indexOf(e));return re.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.oi)for(const t of e)this.oi.removeItem(this.Ti(t.clientId))}}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(e){return this.Ys?re.resolve(!0):Hs(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)){if(this.mi(t)&&this.networkEnabled)return!0;if(!this.mi(t)){if(!t.allowTabSynchronization)throw new T(I.FAILED_PRECONDITION,$s);return!1}}return!(!this.networkEnabled||!this.inForeground)||Qs(e).W().next(e=>void 0===this.Ii(e,5e3).find(e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&p("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.Ds=!1,this.Ai(),this.ei&&(this.ei.cancel(),this.ei=null),this.Ri(),this.bi(),await this.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new di(e,ge.at);return this._i(t).next(()=>this.gi(t))}),this.ri.close(),this.Pi()}Ii(e,t){return e.filter(e=>this.pi(e.updateTimeMs,t)&&!this.Ei(e.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>Qs(e).W().next(e=>this.Ii(e,18e5).map(e=>e.clientId)))}get started(){return this.Ds}getMutationQueue(e,t){return os.oe(e,this.It,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Yi(e,this.It.re.databaseId)}getDocumentOverlayCache(e){return Pi.oe(this.It,e)}getBundleCache(){return this.Ns}runTransaction(e,t,n){p("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=15===(s=this.Xs)?hi:14===s?li:13===s?ui:12===s?ci:11===s?ai:void _();var s;let o;return this.ri.runTransaction(e,r,i,r=>(o=new di(r,this.Ss?this.Ss.next():ge.at),"readwrite-primary"===t?this.fi(o).next(e=>!!e||this.di(o)).next(t=>{if(!t)throw g(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new T(I.FAILED_PRECONDITION,ee);return n(o)}).next(e=>this.wi(o).next(()=>e)):this.Vi(o).next(()=>n(o)))).then(e=>(o.raiseOnCommittedEvent(),e))}Vi(e){return Hs(e).get("owner").next(e=>{if(null!==e&&this.pi(e.leaseTimestampMs,5e3)&&!this.Ei(e.ownerId)&&!this.mi(e)&&!(this.Ys||this.allowTabSynchronization&&e.allowTabSynchronization))throw new T(I.FAILED_PRECONDITION,$s)})}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Hs(e).put("owner",t)}static C(){return se.C()}_i(e){const t=Hs(e);return t.get("owner").next(e=>this.mi(e)?(p("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):re.resolve())}pi(e,t){const n=Date.now();return!(e<n-t)&&(!(e>n)||(g(`Detected an update time that is in the future: ${e} > ${n}`),!1))}ci(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ai(),Object(o["L"])()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{const n=null!==(null===(t=this.oi)||void 0===t?void 0:t.getItem(this.Ti(e)));return p("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return g("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){g("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch(e){}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Hs(e){return fi(e,"owner")}function Qs(e){return fi(e,"clientMetadata")}function Ys(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class Xs{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Si=n,this.Di=r}static Ci(e,t){let n=$n(),r=$n();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new Xs(e,t.fromCache,n,r)}}class Js{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(e,t,n,r){return this.ki(e,t).next(i=>i||this.Oi(e,t,r,n)).next(n=>n||this.Mi(e,t))}ki(e,t){if(jt(t))return re.resolve(null);let n=qt(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=Bt(t,null,"F"),n=qt(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{const i=$n(...r);return this.Ni.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{const s=this.Fi(t,r);return this.$i(t,s,i,n.readTime)?this.ki(e,Bt(t,null,"F")):this.Bi(e,s,t,n)}))})))}Oi(e,t,n,r){return jt(t)||r.isEqual(U.min())?this.Mi(e,t):this.Ni.getDocuments(e,n).next(i=>{const o=this.Fi(t,i);return this.$i(t,o,n,r)?this.Mi(e,t):(d()<=s["a"].DEBUG&&p("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Wt(t)),this.Bi(e,o,t,Y(r,-1)))})}Fi(e,t){let n=new Ie(Ht(e));return t.forEach((t,r)=>{$t(e,r)&&(n=n.add(r))}),n}$i(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Mi(e,t){return d()<=s["a"].DEBUG&&p("QueryEngine","Using full collection scan to execute query:",Wt(t)),this.Ni.getDocumentsMatchingQuery(e,t,J.min())}Bi(e,t,n,r){return this.Ni.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class Zs{constructor(e,t,n,r){this.persistence=e,this.Li=t,this.It=r,this.Ui=new ve(M),this.qi=new Mn(e=>dt(e),pt),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(n)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ds(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ui))}}function eo(e,t,n,r){return new Zs(e,t,n,r)}async function to(e,t){const n=b(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next(i=>(r=i,n.Qi(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const i=[],s=[];let o=$n();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next(e=>({ji:e,removedBatchIds:i,addedBatchIds:s}))})})}function no(e,t){const n=b(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),i=n.Gi.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=re.resolve();return s.forEach(e=>{o=o.next(()=>r.getEntry(t,e)).next(t=>{const s=n.docVersions.get(e);v(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),o.next(()=>e.mutationQueue.removeMutationBatch(t,i))}(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=$n();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))})}function ro(e){const t=b(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Cs.getLastRemoteSnapshotVersion(e))}function io(e,t){const n=b(e),r=t.snapshotVersion;let i=n.Ui;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const s=n.Gi.newChangeBuffer({trackRemovals:!0});i=n.Ui;const o=[];t.targetChanges.forEach((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Cs.removeMatchingKeys(e,s.removedDocuments,a).next(()=>n.Cs.addMatchingKeys(e,s.addedDocuments,a)));let u=c.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(a)?u=u.withResumeToken(Se.EMPTY_BYTE_STRING,U.min()).withLastLimboFreeSnapshotVersion(U.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(c,u,s)&&o.push(n.Cs.updateTargetData(e,u))});let a=Ln(),c=$n();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),o.push(so(e,s,t.documentUpdates).next(e=>{a=e.Wi,c=e.zi})),!r.isEqual(U.min())){const t=n.Cs.getLastRemoteSnapshotVersion(e).next(t=>n.Cs.setTargetsMetadata(e,e.currentSequenceNumber,r));o.push(t)}return re.waitFor(o).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,a,c)).next(()=>a)}).then(e=>(n.Ui=i,e))}function so(e,t,n){let r=$n(),i=$n();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=Ln();return n.forEach((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(U.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):p("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)}),{Wi:r,zi:i}})}function oo(e,t){const n=b(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function ao(e,t){const n=b(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.Cs.getTargetData(e,t).next(i=>i?(r=i,re.resolve(r)):n.Cs.allocateTargetId(e).next(i=>(r=new yi(t,i,0,e.currentSequenceNumber),n.Cs.addTargetData(e,r).next(()=>r))))}).then(e=>{const r=n.Ui.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ui=n.Ui.insert(e.targetId,e),n.qi.set(t,e.targetId)),e})}async function co(e,t,n){const r=b(e),i=r.Ui.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!ce(e))throw e;p("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Ui=r.Ui.remove(t),r.qi.delete(i.target)}function uo(e,t,n){const r=b(e);let i=U.min(),s=$n();return r.persistence.runTransaction("Execute query","readonly",e=>function(e,t,n){const r=b(e),i=r.qi.get(n);return void 0!==i?re.resolve(r.Ui.get(i)):r.Cs.getTargetData(t,n)}(r,e,qt(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Cs.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>r.Li.getDocumentsMatchingQuery(e,t,n?i:U.min(),n?s:$n())).next(e=>(fo(r,Gt(t),e),{documents:e,Hi:s})))}function lo(e,t){const n=b(e),r=b(n.Cs),i=n.Ui.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.se(e,t).next(e=>e?e.target:null))}function ho(e,t){const n=b(e),r=n.Ki.get(t)||U.min();return n.persistence.runTransaction("Get new document changes","readonly",e=>n.Gi.getAllFromCollectionGroup(e,t,Y(r,-1),Number.MAX_SAFE_INTEGER)).then(e=>(fo(n,t,e),e))}function fo(e,t,n){let r=e.Ki.get(t)||U.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Ki.set(t,r)}async function po(e,t,n,r){const i=b(e);let s=$n(),o=Ln();for(const u of n){const e=t.Ji(u.metadata.name);u.document&&(s=s.add(e));const n=t.Yi(u);n.setReadTime(t.Xi(u.metadata.readTime)),o=o.insert(e,n)}const a=i.Gi.newChangeBuffer({trackRemovals:!0}),c=await ao(i,function(e){return qt(Mt(q.fromString("__bundle__/docs/"+e)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",e=>so(e,a,o).next(t=>(a.apply(e),t)).next(t=>i.Cs.removeMatchingKeysForTargetId(e,c.targetId).next(()=>i.Cs.addMatchingKeys(e,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(e,t.Wi,t.zi)).next(()=>t.Wi)))}async function go(e,t,n=$n()){const r=await ao(e,qt(Si(t.bundledQuery))),i=b(e);return i.persistence.runTransaction("Save named query","readwrite",e=>{const s=lr(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.Ns.saveNamedQuery(e,t);const o=r.withResumeToken(Se.EMPTY_BYTE_STRING,s);return i.Ui=i.Ui.insert(o.targetId,o),i.Cs.updateTargetData(e,o).next(()=>i.Cs.removeMatchingKeysForTargetId(e,r.targetId)).next(()=>i.Cs.addMatchingKeys(e,n,r.targetId)).next(()=>i.Ns.saveNamedQuery(e,t))})}function mo(e,t){return`firestore_clients_${e}_${t}`}function yo(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+="_"+t.uid),r}function _o(e,t){return`firestore_targets_${e}_${t}`}class vo{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Zi(e,t,n){const r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new T(r.error.code,r.error.message))),s?new vo(e,t,r.state,i):(g("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class wo{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Zi(e,t){const n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new T(n.error.code,n.error.message))),i?new wo(e,n.state,r):(g("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class bo{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Hn();for(let s=0;r&&s<n.activeTargetIds.length;++s)r=Ue(n.activeTargetIds[s]),i=i.add(n.activeTargetIds[s]);return r?new bo(e,i):(g("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Io{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Io(t.clientId,t.onlineState):(g("SharedClientState","Failed to parse online state: "+e),null)}}class To{constructor(){this.activeTargetIds=Hn()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Eo{constructor(e,t,n,r,i){this.window=e,this.Hs=t,this.persistenceKey=n,this.sr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new ve(M),this.started=!1,this.cr=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ar=mo(this.persistenceKey,this.sr),this.hr=function(e){return"firestore_sequence_number_"+e}(this.persistenceKey),this.ur=this.ur.insert(this.sr,new To),this.lr=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.dr=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this._r=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.wr=function(e){return"firestore_online_state_"+e}(this.persistenceKey),this.mr=function(e){return"firestore_bundle_loaded_v2_"+e}(this.persistenceKey),this.window.addEventListener("storage",this.ir)}static C(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.vi();for(const n of e){if(n===this.sr)continue;const e=this.getItem(mo(this.persistenceKey,n));if(e){const t=bo.Zi(n,e);t&&(this.ur=this.ur.insert(t.clientId,t))}}this.gr();const t=this.storage.getItem(this.wr);if(t){const e=this.yr(t);e&&this.pr(e)}for(const n of this.cr)this.rr(n);this.cr=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.hr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ir(this.ur)}isActiveQueryTarget(e){let t=!1;return this.ur.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Tr(e,"pending")}updateMutationState(e,t,n){this.Tr(e,t,n),this.Er(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(_o(this.persistenceKey,e));if(n){const r=wo.Zi(e,n);r&&(t=r.state)}}return this.Ar.er(e),this.gr(),t}removeLocalQueryTarget(e){this.Ar.nr(e),this.gr()}isLocalQueryTarget(e){return this.Ar.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(_o(this.persistenceKey,e))}updateQueryState(e,t,n){this.Rr(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Er(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.br(e)}notifyBundleLoaded(e){this.Pr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return p("SharedClientState","READ",e,t),t}setItem(e,t){p("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){p("SharedClientState","REMOVE",e),this.storage.removeItem(e)}rr(e){const t=e;if(t.storageArea===this.storage){if(p("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ar)return void g("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Hs.enqueueRetryable(async()=>{if(this.started){if(null!==t.key)if(this.lr.test(t.key)){if(null==t.newValue){const e=this.vr(t.key);return this.Vr(e,null)}{const e=this.Sr(t.key,t.newValue);if(e)return this.Vr(e.clientId,e)}}else if(this.dr.test(t.key)){if(null!==t.newValue){const e=this.Dr(t.key,t.newValue);if(e)return this.Cr(e)}}else if(this._r.test(t.key)){if(null!==t.newValue){const e=this.Nr(t.key,t.newValue);if(e)return this.kr(e)}}else if(t.key===this.wr){if(null!==t.newValue){const e=this.yr(t.newValue);if(e)return this.pr(e)}}else if(t.key===this.hr){const e=function(e){let t=ge.at;if(null!=e)try{const n=JSON.parse(e);v("number"==typeof n),t=n}catch(e){g("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==ge.at&&this.sequenceNumberHandler(e)}else if(t.key===this.mr){const e=this.Or(t.newValue);await Promise.all(e.map(e=>this.syncEngine.Mr(e)))}}else this.cr.push(t)})}}get Ar(){return this.ur.get(this.sr)}gr(){this.setItem(this.ar,this.Ar.tr())}Tr(e,t,n){const r=new vo(this.currentUser,e,t,n),i=yo(this.persistenceKey,this.currentUser,e);this.setItem(i,r.tr())}Er(e){const t=yo(this.persistenceKey,this.currentUser,e);this.removeItem(t)}br(e){const t={clientId:this.sr,onlineState:e};this.storage.setItem(this.wr,JSON.stringify(t))}Rr(e,t,n){const r=_o(this.persistenceKey,e),i=new wo(e,t,n);this.setItem(r,i.tr())}Pr(e){const t=JSON.stringify(Array.from(e));this.setItem(this.mr,t)}vr(e){const t=this.lr.exec(e);return t?t[1]:null}Sr(e,t){const n=this.vr(e);return bo.Zi(n,t)}Dr(e,t){const n=this.dr.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return vo.Zi(new u(i),r,t)}Nr(e,t){const n=this._r.exec(e),r=Number(n[1]);return wo.Zi(r,t)}yr(e){return Io.Zi(e)}Or(e){return JSON.parse(e)}async Cr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Fr(e.batchId,e.state,e.error);p("SharedClientState","Ignoring mutation for non-active user "+e.user.uid)}kr(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}Vr(e,t){const n=t?this.ur.insert(e,t):this.ur.remove(e),r=this.Ir(this.ur),i=this.Ir(n),s=[],o=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||o.push(e)}),this.syncEngine.Br(s,o).then(()=>{this.ur=n})}pr(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ir(e){let t=Hn();return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}class ko{constructor(){this.Lr=new To,this.Ur={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Lr.er(e),this.Ur[e]||"not-current"}updateQueryState(e,t,n){this.Ur[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.Ur[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new To,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Co{qr(e){}shutdown(){}}class So{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}qr(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){p("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){p("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Oo={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Ao{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class No extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.oo=t+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,t,n,r,i){const s=this.ho(e,t);p("RestConnection","Sending: ",s,n);const o={};return this.lo(o,r,i),this.fo(e,s,o,n).then(e=>(p("RestConnection","Received: ",e),e),t=>{throw m("RestConnection",e+" failed with error: ",t,"url: ",s,"request:",n),t})}_o(e,t,n,r,i,s){return this.ao(e,t,n,r,i)}lo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+l,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}ho(e,t){const n=Oo[e];return`${this.oo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,n,r){return new Promise((i,s)=>{const o=new a["g"];o.setWithCredentials(!0),o.listenOnce(a["c"].COMPLETE,()=>{try{switch(o.getLastErrorCode()){case a["a"].NO_ERROR:const t=o.getResponseJson();p("Connection","XHR received:",JSON.stringify(t)),i(t);break;case a["a"].TIMEOUT:p("Connection",'RPC "'+e+'" timed out'),s(new T(I.DEADLINE_EXCEEDED,"Request time out"));break;case a["a"].HTTP_ERROR:const n=o.getStatus();if(p("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const e=o.getResponseJson().error;if(e&&e.status&&e.message){const t=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(I).indexOf(t)>=0?t:I.UNKNOWN}(e.status);s(new T(t,e.message))}else s(new T(I.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new T(I.UNAVAILABLE,"Connection failed."));break;default:_()}}finally{p("Connection",'RPC "'+e+'" completed.')}});const c=JSON.stringify(r);o.send(t,"POST",c,n,15)})}wo(e,t,n){const r=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=Object(a["h"])(),s=Object(a["i"])(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new a["d"]({})),this.lo(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;const c=r.join("");p("Connection","Creating WebChannel: "+c,o);const u=i.createWebChannel(c,o);let l=!1,h=!1;const d=new Ao({Hr:e=>{h?p("Connection","Not sending because WebChannel is closed:",e):(l||(p("Connection","Opening WebChannel transport."),u.open(),l=!0),p("Connection","WebChannel sending:",e),u.send(e))},Jr:()=>u.close()}),f=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return f(u,a["f"].EventType.OPEN,()=>{h||p("Connection","WebChannel transport opened.")}),f(u,a["f"].EventType.CLOSE,()=>{h||(h=!0,p("Connection","WebChannel transport closed"),d.io())}),f(u,a["f"].EventType.ERROR,e=>{h||(h=!0,m("Connection","WebChannel transport errored:",e),d.io(new T(I.UNAVAILABLE,"The operation could not be completed")))}),f(u,a["f"].EventType.MESSAGE,e=>{var t;if(!h){const n=e.data[0];v(!!n);const r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){p("Connection","WebChannel received error:",i);const e=i.status;let t=function(e){const t=Rn[e];if(void 0!==t)return Pn(t)}(e),n=i.message;void 0===t&&(t=I.INTERNAL,n="Unknown error status: "+e+" with message "+i.message),h=!0,d.io(new T(t,n)),u.close()}else p("Connection","WebChannel received:",n),d.ro(n)}}),f(s,a["b"].STAT_EVENT,e=>{e.stat===a["e"].PROXY?p("Connection","Detected buffering proxy"):e.stat===a["e"].NOPROXY&&p("Connection","Detected no buffering proxy")}),setTimeout(()=>{d.so()},0),d}}function Ro(){return"undefined"!=typeof window?window:null}function Do(){return"undefined"!=typeof document?document:null}function xo(e){return new or(e,!0)}class Po{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Hs=e,this.timerId=t,this.mo=n,this.yo=r,this.po=i,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const t=Math.floor(this.Io+this.bo()),n=Math.max(0,Date.now()-this.Eo),r=Math.max(0,t-n);r>0&&p("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,r,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class Mo{constructor(e,t,n,r,i,s,o,a){this.Hs=e,this.vo=n,this.Vo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new Po(e,t)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}async stop(){this.No()&&await this.close(0)}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.$o()))}Bo(e){this.Lo(),this.stream.send(e)}async $o(){if(this.ko())return this.close(0)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}Uo(){this.Co&&(this.Co.cancel(),this.Co=null)}async close(e,t){this.Lo(),this.Uo(),this.xo.cancel(),this.So++,4!==e?this.xo.reset():t&&t.code===I.RESOURCE_EXHAUSTED?(g(t.toString()),g("Using maximum backoff delay to prevent overloading the backend."),this.xo.Ao()):t&&t.code===I.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.qo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zr(t)}qo(){}auth(){this.state=1;const e=this.Ko(this.So),t=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.So===t&&this.Go(e,n)},t=>{e(()=>{const e=new T(I.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Qo(e)})})}Go(e,t){const n=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr(()=>{n(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(e=>{n(()=>this.Qo(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}Oo(){this.state=5,this.xo.Ro(async()=>{this.state=0,this.start()})}Qo(e){return p("PersistentStream","close with error: "+e),this.stream=null,this.close(4,e)}Ko(e){return t=>{this.Hs.enqueueAndForget(()=>this.So===e?t():(p("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class jo extends Mo{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.It=i}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();const t=Ir(this.It,e),n=function(e){if(!("targetChange"in e))return U.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?U.min():t.readTime?lr(t.readTime):U.min()}(e);return this.listener.Wo(t,n)}zo(e){const t={};t.database=yr(this.It),t.addTarget=function(e,t){let n;const r=t.target;return n=gt(r)?{documents:Cr(e,r)}:{query:Sr(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=cr(e,t.resumeToken):t.snapshotVersion.compareTo(U.min())>0&&(n.readTime=ar(e,t.snapshotVersion.toTimestamp())),n}(this.It,e);const n=Ar(this.It,e);n&&(t.labels=n),this.Bo(t)}Ho(e){const t={};t.database=yr(this.It),t.removeTarget=e,this.Bo(t)}}class Lo extends Mo{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.It=i,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}qo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){if(v(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();const t=kr(e.writeResults,e.commitTime),n=lr(e.commitTime);return this.listener.Zo(n,t)}return v(!e.writeResults||0===e.writeResults.length),this.Jo=!0,this.listener.tu()}eu(){const e={};e.database=yr(this.It),this.Bo(e)}Xo(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>Tr(this.It,e))};this.Bo(t)}}class Fo extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.It=r,this.nu=!1}su(){if(this.nu)throw new T(I.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,t,n){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.connection.ao(e,t,n,r,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===I.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new T(I.UNKNOWN,e.toString())})}_o(e,t,n,r){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection._o(e,t,n,i,s,r)).catch(e=>{throw"FirebaseError"===e.name?(e.code===I.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new T(I.UNKNOWN,e.toString())})}terminate(){this.nu=!0}}class Uo{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au("Connection failed 1 times. Most recent error: "+e.toString()),this.cu("Offline")))}set(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(g(t),this.ou=!1):p("OnlineStateTracker",t)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class Vo{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=i,this.mu.qr(e=>{n.enqueueAndForget(async()=>{Qo(this)&&(p("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=b(e);t._u.add(4),await Bo(t),t.gu.set("Unknown"),t._u.delete(4),await qo(t)}(this))})}),this.gu=new Uo(n,r)}}async function qo(e){if(Qo(e))for(const t of e.wu)await t(!0)}async function Bo(e){for(const t of e.wu)await t(!1)}function zo(e,t){const n=b(e);n.du.has(t.targetId)||(n.du.set(t.targetId,t),Ho(n)?Go(n):fa(n).ko()&&Wo(n,t))}function Ko(e,t){const n=b(e),r=fa(n);n.du.delete(t),r.ko()&&$o(n,t),0===n.du.size&&(r.ko()?r.Fo():Qo(n)&&n.gu.set("Unknown"))}function Wo(e,t){e.yu.Mt(t.targetId),fa(e).zo(t)}function $o(e,t){e.yu.Mt(t),fa(e).Ho(t)}function Go(e){e.yu=new tr({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),se:t=>e.du.get(t)||null}),fa(e).start(),e.gu.uu()}function Ho(e){return Qo(e)&&!fa(e).No()&&e.du.size>0}function Qo(e){return 0===b(e)._u.size}function Yo(e){e.yu=void 0}async function Xo(e){e.du.forEach((t,n)=>{Wo(e,t)})}async function Jo(e,t){Yo(e),Ho(e)?(e.gu.hu(t),Go(e)):e.gu.set("Unknown")}async function Zo(e,t,n){if(e.gu.set("Online"),t instanceof Zn&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.du.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.du.delete(r),e.yu.removeTarget(r))}(e,t)}catch(n){p("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await ea(e,n)}else if(t instanceof Xn?e.yu.Gt(t):t instanceof Jn?e.yu.Yt(t):e.yu.Wt(t),!n.isEqual(U.min()))try{const t=await ro(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.yu.te(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.du.get(r);i&&e.du.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach(t=>{const n=e.du.get(t);if(!n)return;e.du.set(t,n.withResumeToken(Se.EMPTY_BYTE_STRING,n.snapshotVersion)),$o(e,t);const r=new yi(n.target,t,1,n.sequenceNumber);Wo(e,r)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){p("RemoteStore","Failed to raise snapshot:",t),await ea(e,t)}}async function ea(e,t,n){if(!ce(t))throw t;e._u.add(1),await Bo(e),e.gu.set("Offline"),n||(n=()=>ro(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{p("RemoteStore","Retrying IndexedDB access"),await n(),e._u.delete(1),await qo(e)})}function ta(e,t){return t().catch(n=>ea(e,n,t))}async function na(e){const t=b(e),n=pa(t);let r=t.fu.length>0?t.fu[t.fu.length-1].batchId:-1;for(;ra(t);)try{const e=await oo(t.localStore,r);if(null===e){0===t.fu.length&&n.Fo();break}r=e.batchId,ia(t,e)}catch(e){await ea(t,e)}sa(t)&&oa(t)}function ra(e){return Qo(e)&&e.fu.length<10}function ia(e,t){e.fu.push(t);const n=pa(e);n.ko()&&n.Yo&&n.Xo(t.mutations)}function sa(e){return Qo(e)&&!pa(e).No()&&e.fu.length>0}function oa(e){pa(e).start()}async function aa(e){pa(e).eu()}async function ca(e){const t=pa(e);for(const n of e.fu)t.Xo(n.mutations)}async function ua(e,t,n){const r=e.fu.shift(),i=gi.from(r,t,n);await ta(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await na(e)}async function la(e,t){t&&pa(e).Yo&&await async function(e,t){if(n=t.code,xn(n)&&n!==I.ABORTED){const n=e.fu.shift();pa(e).Mo(),await ta(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await na(e)}var n}(e,t),sa(e)&&oa(e)}async function ha(e,t){const n=b(e);n.asyncQueue.verifyOperationInProgress(),p("RemoteStore","RemoteStore received new credentials");const r=Qo(n);n._u.add(3),await Bo(n),r&&n.gu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n._u.delete(3),await qo(n)}async function da(e,t){const n=b(e);t?(n._u.delete(2),await qo(n)):t||(n._u.add(2),await Bo(n),n.gu.set("Unknown"))}function fa(e){return e.pu||(e.pu=function(e,t,n){const r=b(e);return r.su(),new jo(t,r.connection,r.authCredentials,r.appCheckCredentials,r.It,n)}(e.datastore,e.asyncQueue,{Yr:Xo.bind(null,e),Zr:Jo.bind(null,e),Wo:Zo.bind(null,e)}),e.wu.push(async t=>{t?(e.pu.Mo(),Ho(e)?Go(e):e.gu.set("Unknown")):(await e.pu.stop(),Yo(e))})),e.pu}function pa(e){return e.Iu||(e.Iu=function(e,t,n){const r=b(e);return r.su(),new Lo(t,r.connection,r.authCredentials,r.appCheckCredentials,r.It,n)}(e.datastore,e.asyncQueue,{Yr:aa.bind(null,e),Zr:la.bind(null,e),tu:ca.bind(null,e),Zo:ua.bind(null,e)}),e.wu.push(async t=>{t?(e.Iu.Mo(),await na(e)):(await e.Iu.stop(),e.fu.length>0&&(p("RemoteStore",`Stopping write stream with ${e.fu.length} pending writes`),e.fu=[]))})),e.Iu}class ga{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new E,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new ga(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new T(I.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ma(e,t){if(g("AsyncQueue",`${t}: ${e}`),ce(e))return new T(I.UNAVAILABLE,`${t}: ${e}`);throw e}class ya{constructor(e){this.comparator=e?(t,n)=>e(t,n)||K.comparator(t.key,n.key):(e,t)=>K.comparator(e.key,t.key),this.keyedMap=Un(),this.sortedSet=new ve(this.comparator)}static emptySet(e){return new ya(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ya))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new ya;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class _a{constructor(){this.Tu=new ve(K.comparator)}track(e){const t=e.doc.key,n=this.Tu.get(t);n?0!==e.type&&3===n.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==n.type?this.Tu=this.Tu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Tu=this.Tu.remove(t):1===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):_():this.Tu=this.Tu.insert(t,e)}Eu(){const e=[];return this.Tu.inorderTraversal((t,n)=>{e.push(n)}),e}}class va{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new va(e,t,ya.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&zt(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class wa{constructor(){this.Au=void 0,this.listeners=[]}}class ba{constructor(){this.queries=new Mn(e=>Kt(e),zt),this.onlineState="Unknown",this.Ru=new Set}}async function Ia(e,t){const n=b(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new wa),i)try{s.Au=await n.onListen(r)}catch(e){const n=ma(e,`Initialization of query '${Wt(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.bu(n.onlineState),s.Au&&t.Pu(s.Au)&&Ca(n)}async function Ta(e,t){const n=b(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function Ea(e,t){const n=b(e);let r=!1;for(const i of t){const e=i.query,t=n.queries.get(e);if(t){for(const e of t.listeners)e.Pu(i)&&(r=!0);t.Au=i}}r&&Ca(n)}function ka(e,t,n){const r=b(e),i=r.queries.get(t);if(i)for(const s of i.listeners)s.onError(n);r.queries.delete(t)}function Ca(e){e.Ru.forEach(e=>{e.next()})}class Sa{constructor(e,t,n){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=n||{}}Pu(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new va(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.Nu||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Du(e){if(e.docChanges.length>0)return!0;const t=this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}xu(e){e=va.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}class Oa{constructor(e,t){this.ku=e,this.byteLength=t}Ou(){return"metadata"in this.ku}}class Aa{constructor(e){this.It=e}Ji(e){return pr(this.It,e)}Yi(e){return e.metadata.exists?wr(this.It,e.document,!1):ut.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}Xi(e){return lr(e)}}class Na{constructor(e,t,n){this.Mu=e,this.localStore=t,this.It=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Ra(e)}Fu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ku.namedQuery)this.queries.push(e.ku.namedQuery);else if(e.ku.documentMetadata){this.documents.push({metadata:e.ku.documentMetadata}),e.ku.documentMetadata.exists||++t;const n=q.fromString(e.ku.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.ku.document&&(this.documents[this.documents.length-1].document=e.ku.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}$u(e){const t=new Map,n=new Aa(this.It);for(const r of e)if(r.metadata.queries){const e=n.Ji(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||$n()).add(e);t.set(n,r)}}return t}async complete(){const e=await po(this.localStore,new Aa(this.It),this.documents,this.Mu.id),t=this.$u(this.documents);for(const n of this.queries)await go(this.localStore,n,t.get(n.name));return this.progress.taskState="Success",{progress:this.progress,Bu:this.collectionGroups,Lu:e}}}function Ra(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class Da{constructor(e){this.key=e}}class xa{constructor(e){this.key=e}}class Pa{constructor(e,t){this.query=e,this.Uu=t,this.qu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=$n(),this.mutatedKeys=$n(),this.Gu=Ht(e),this.Qu=new ya(this.Gu)}get ju(){return this.Uu}Wu(e,t){const n=t?t.zu:new _a,r=t?t.Qu:this.Qu;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{const u=r.get(e),l=$t(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.Hu(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.Gu(l,a)>0||c&&this.Gu(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Qu:s,zu:n,$i:o,mutatedKeys:i}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const i=e.zu.Eu();i.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return _()}};return n(e)-n(t)}(e.type,t.type)||this.Gu(e.doc,t.doc)),this.Ju(n);const s=t?this.Yu():[],o=0===this.Ku.size&&this.current?1:0,a=o!==this.qu;return this.qu=o,0!==i.length||a?{snapshot:new va(this.query,e.Qu,r,i,e.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),Xu:s}:{Xu:s}}bu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new _a,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.Uu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(e=>this.Uu=this.Uu.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Uu=this.Uu.delete(e)),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=$n(),this.Qu.forEach(e=>{this.Zu(e.key)&&(this.Ku=this.Ku.add(e.key))});const t=[];return e.forEach(e=>{this.Ku.has(e)||t.push(new xa(e))}),this.Ku.forEach(n=>{e.has(n)||t.push(new Da(n))}),t}tc(e){this.Uu=e.Hi,this.Ku=$n();const t=this.Wu(e.documents);return this.applyChanges(t,!0)}ec(){return va.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.qu,this.hasCachedResults)}}class Ma{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class ja{constructor(e){this.key=e,this.nc=!1}}class La{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.sc={},this.ic=new Mn(e=>Kt(e),zt),this.rc=new Map,this.oc=new Set,this.uc=new ve(K.comparator),this.cc=new Map,this.ac=new Ms,this.hc={},this.lc=new Map,this.fc=hs.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}async function Fa(e,t){const n=fc(e);let r,i;const s=n.ic.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.ec();else{const e=await ao(n.localStore,qt(t));n.isPrimaryClient&&zo(n.remoteStore,e);const s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await Ua(n,t,r,"current"===s,e.resumeToken)}return i}async function Ua(e,t,n,r,i){e._c=(t,n,r)=>async function(e,t,n,r){let i=t.view.Wu(n);i.$i&&(i=await uo(e.localStore,t.query,!1).then(({documents:e})=>t.view.Wu(e,i)));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return Ja(e,t.targetId,o.Xu),o.snapshot}(e,t,n,r);const s=await uo(e.localStore,t,!0),o=new Pa(t,s.Hi),a=o.Wu(s.documents),c=Yn.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,c);Ja(e,n,u.Xu);const l=new Ma(t,n,o);return e.ic.set(t,l),e.rc.has(n)?e.rc.get(n).push(t):e.rc.set(n,[t]),u.snapshot}async function Va(e,t){const n=b(e),r=n.ic.get(t),i=n.rc.get(r.targetId);if(i.length>1)return n.rc.set(r.targetId,i.filter(e=>!zt(e,t))),void n.ic.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await co(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),Ko(n.remoteStore,r.targetId),Ya(n,r.targetId)}).catch(ne)):(Ya(n,r.targetId),await co(n.localStore,r.targetId,!0))}async function qa(e,t,n){const r=pc(e);try{const e=await function(e,t){const n=b(e),r=F.now(),i=t.reduce((e,t)=>e.add(t.key),$n());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let a=Ln(),c=$n();return n.Gi.getEntries(e,i).next(e=>{a=e,a.forEach((e,t)=>{t.isValidDocument()||(c=c.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,a)).next(i=>{s=i;const o=[];for(const e of t){const t=bn(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new En(e.key,t,ct(t.value.mapValue),gn.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)}).next(t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)})}).then(()=>({batchId:o.batchId,changes:Vn(s)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.hc[e.currentUser.toKey()];r||(r=new ve(M)),r=r.insert(t,n),e.hc[e.currentUser.toKey()]=r}(r,e.batchId,n),await tc(r,e.changes),await na(r.remoteStore)}catch(e){const t=ma(e,"Failed to persist write");n.reject(t)}}async function Ba(e,t){const n=b(e);try{const e=await io(n.localStore,t);t.targetChanges.forEach((e,t)=>{const r=n.cc.get(t);r&&(v(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.nc=!0:e.modifiedDocuments.size>0?v(r.nc):e.removedDocuments.size>0&&(v(r.nc),r.nc=!1))}),await tc(n,e,t)}catch(e){await ne(e)}}function za(e,t,n){const r=b(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.ic.forEach((n,r)=>{const i=r.view.bu(t);i.snapshot&&e.push(i.snapshot)}),function(e,t){const n=b(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(const i of n.listeners)i.bu(t)&&(r=!0)}),r&&Ca(n)}(r.eventManager,t),e.length&&r.sc.Wo(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Ka(e,t,n){const r=b(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.cc.get(t),s=i&&i.key;if(s){let e=new ve(K.comparator);e=e.insert(s,ut.newNoDocument(s,U.min()));const n=$n().add(s),i=new Qn(U.min(),new Map,new Ie(M),e,n);await Ba(r,i),r.uc=r.uc.remove(s),r.cc.delete(t),ec(r)}else await co(r.localStore,t,!1).then(()=>Ya(r,t,n)).catch(ne)}async function Wa(e,t){const n=b(e),r=t.batch.batchId;try{const e=await no(n.localStore,t);Qa(n,r,null),Ha(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await tc(n,e)}catch(e){await ne(e)}}async function $a(e,t,n){const r=b(e);try{const e=await function(e,t){const n=b(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(v(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))})}(r.localStore,t);Qa(r,t,n),Ha(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await tc(r,e)}catch(n){await ne(n)}}async function Ga(e,t){const n=b(e);Qo(n.remoteStore)||p("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=b(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}(n.localStore);if(-1===e)return void t.resolve();const r=n.lc.get(e)||[];r.push(t),n.lc.set(e,r)}catch(e){const n=ma(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}function Ha(e,t){(e.lc.get(t)||[]).forEach(e=>{e.resolve()}),e.lc.delete(t)}function Qa(e,t,n){const r=b(e);let i=r.hc[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.hc[r.currentUser.toKey()]=i}}function Ya(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.rc.get(t))e.ic.delete(r),n&&e.sc.wc(r,n);e.rc.delete(t),e.isPrimaryClient&&e.ac.ls(t).forEach(t=>{e.ac.containsKey(t)||Xa(e,t)})}function Xa(e,t){e.oc.delete(t.path.canonicalString());const n=e.uc.get(t);null!==n&&(Ko(e.remoteStore,n),e.uc=e.uc.remove(t),e.cc.delete(n),ec(e))}function Ja(e,t,n){for(const r of n)r instanceof Da?(e.ac.addReference(r.key,t),Za(e,r)):r instanceof xa?(p("SyncEngine","Document no longer in limbo: "+r.key),e.ac.removeReference(r.key,t),e.ac.containsKey(r.key)||Xa(e,r.key)):_()}function Za(e,t){const n=t.key,r=n.path.canonicalString();e.uc.get(n)||e.oc.has(r)||(p("SyncEngine","New document in limbo: "+n),e.oc.add(r),ec(e))}function ec(e){for(;e.oc.size>0&&e.uc.size<e.maxConcurrentLimboResolutions;){const t=e.oc.values().next().value;e.oc.delete(t);const n=new K(q.fromString(t)),r=e.fc.next();e.cc.set(r,new ja(n)),e.uc=e.uc.insert(n,r),zo(e.remoteStore,new yi(qt(Mt(n.path)),r,2,ge.at))}}async function tc(e,t,n){const r=b(e),i=[],s=[],o=[];r.ic.isEmpty()||(r.ic.forEach((e,a)=>{o.push(r._c(a,t,n).then(e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);const t=Xs.Ci(a.targetId,e);s.push(t)}}))}),await Promise.all(o),r.sc.Wo(i),await async function(e,t){const n=b(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>re.forEach(t,t=>re.forEach(t.Si,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>re.forEach(t.Di,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(e){if(!ce(e))throw e;p("LocalStore","Failed to update sequence numbers: "+e)}for(const r of t){const e=r.targetId;if(!r.fromCache){const t=n.Ui.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.Ui=n.Ui.insert(e,i)}}}(r.localStore,s))}async function nc(e,t){const n=b(e);if(!n.currentUser.isEqual(t)){p("SyncEngine","User change. New user:",t.toKey());const e=await to(n.localStore,t);n.currentUser=t,function(e,t){e.lc.forEach(e=>{e.forEach(e=>{e.reject(new T(I.CANCELLED,t))})}),e.lc.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await tc(n,e.ji)}}function rc(e,t){const n=b(e),r=n.cc.get(t);if(r&&r.nc)return $n().add(r.key);{let e=$n();const r=n.rc.get(t);if(!r)return e;for(const t of r){const r=n.ic.get(t);e=e.unionWith(r.view.ju)}return e}}async function ic(e,t){const n=b(e),r=await uo(n.localStore,t.query,!0),i=t.view.tc(r);return n.isPrimaryClient&&Ja(n,t.targetId,i.Xu),i}async function sc(e,t){const n=b(e);return ho(n.localStore,t).then(e=>tc(n,e))}async function oc(e,t,n,r){const i=b(e),s=await function(e,t){const n=b(e),r=b(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",e=>r.Tn(e,t).next(t=>t?n.localDocuments.getDocuments(e,t):re.resolve(null)))}(i.localStore,t);null!==s?("pending"===n?await na(i.remoteStore):"acknowledged"===n||"rejected"===n?(Qa(i,t,r||null),Ha(i,t),function(e,t){b(b(e).mutationQueue).An(t)}(i.localStore,t)):_(),await tc(i,s)):p("SyncEngine","Cannot apply mutation batch with id: "+t)}async function ac(e,t){const n=b(e);if(fc(n),pc(n),!0===t&&!0!==n.dc){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await cc(n,e.toArray());n.dc=!0,await da(n.remoteStore,!0);for(const r of t)zo(n.remoteStore,r)}else if(!1===t&&!1!==n.dc){const e=[];let t=Promise.resolve();n.rc.forEach((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then(()=>(Ya(n,i),co(n.localStore,i,!0))),Ko(n.remoteStore,i)}),await t,await cc(n,e),function(e){const t=b(e);t.cc.forEach((e,n)=>{Ko(t.remoteStore,n)}),t.ac.fs(),t.cc=new Map,t.uc=new ve(K.comparator)}(n),n.dc=!1,await da(n.remoteStore,!1)}}async function cc(e,t,n){const r=b(e),i=[],s=[];for(const o of t){let e;const t=r.rc.get(o);if(t&&0!==t.length){e=await ao(r.localStore,qt(t[0]));for(const e of t){const t=r.ic.get(e),n=await ic(r,t);n.snapshot&&s.push(n.snapshot)}}else{const t=await lo(r.localStore,o);e=await ao(r.localStore,t),await Ua(r,uc(t),o,!1,e.resumeToken)}i.push(e)}return r.sc.Wo(s),i}function uc(e){return Pt(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function lc(e){const t=b(e);return b(b(t.localStore).persistence).vi()}async function hc(e,t,n,r){const i=b(e);if(i.dc)return void p("SyncEngine","Ignoring unexpected query state notification.");const s=i.rc.get(t);if(s&&s.length>0)switch(n){case"current":case"not-current":{const e=await ho(i.localStore,Gt(s[0])),r=Qn.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,Se.EMPTY_BYTE_STRING);await tc(i,e,r);break}case"rejected":await co(i.localStore,t,!0),Ya(i,t,r);break;default:_()}}async function dc(e,t,n){const r=fc(e);if(r.dc){for(const e of t){if(r.rc.has(e)){p("SyncEngine","Adding an already active target "+e);continue}const t=await lo(r.localStore,e),n=await ao(r.localStore,t);await Ua(r,uc(t),n.targetId,!1,n.resumeToken),zo(r.remoteStore,n)}for(const e of n)r.rc.has(e)&&await co(r.localStore,e,!1).then(()=>{Ko(r.remoteStore,e),Ya(r,e)}).catch(ne)}}function fc(e){const t=b(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Ba.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=rc.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Ka.bind(null,t),t.sc.Wo=Ea.bind(null,t.eventManager),t.sc.wc=ka.bind(null,t.eventManager),t}function pc(e){const t=b(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Wa.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=$a.bind(null,t),t}function gc(e,t,n){const r=b(e);(async function(e,t,n){try{const r=await t.getMetadata();if(await function(e,t){const n=b(e),r=lr(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Ns.getBundleMetadata(e,t.id)).then(e=>!!e&&e.createTime.compareTo(r)>=0)}(e.localStore,r))return await t.close(),n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r)),Promise.resolve(new Set);n._updateProgress(Ra(r));const i=new Na(r,e.localStore,t.It);let s=await t.mc();for(;s;){const e=await i.Fu(s);e&&n._updateProgress(e),s=await t.mc()}const o=await i.complete();return await tc(e,o.Lu,void 0),await function(e,t){const n=b(e);return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Ns.saveBundleMetadata(e,t))}(e.localStore,r),n._completeWith(o.progress),Promise.resolve(o.Bu)}catch(e){return m("SyncEngine","Loading bundle failed with "+e),n._failWith(e),Promise.resolve(new Set)}})(r,t,n).then(e=>{r.sharedClientState.notifyBundleLoaded(e)})}class mc{constructor(){this.synchronizeTabs=!1}async initialize(e){this.It=xo(e.databaseInfo.databaseId),this.sharedClientState=this.gc(e),this.persistence=this.yc(e),await this.persistence.start(),this.localStore=this.Ic(e),this.gcScheduler=this.Tc(e,this.localStore),this.indexBackfillerScheduler=this.Ec(e,this.localStore)}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return eo(this.persistence,new Js,e.initialUser,this.It)}yc(e){return new qs(zs.Bs,this.It)}gc(e){return new ko}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class yc extends mc{constructor(e,t,n){super(),this.Ac=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ac.initialize(this,e),await pc(this.Ac.syncEngine),await na(this.Ac.remoteStore),await this.persistence.li(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}Ic(e){return eo(this.persistence,new Js,e.initialUser,this.It)}Tc(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new _s(n,e.asyncQueue,t)}Ec(e,t){const n=new pe(t,this.persistence);return new fe(e.asyncQueue,n)}yc(e){const t=Ys(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?rs.withCacheSize(this.cacheSizeBytes):rs.DEFAULT;return new Gs(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Ro(),Do(),this.It,this.sharedClientState,!!this.forceOwnership)}gc(e){return new ko}}class _c extends yc{constructor(e,t){super(e,t,!1),this.Ac=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ac.syncEngine;this.sharedClientState instanceof Eo&&(this.sharedClientState.syncEngine={Fr:oc.bind(null,t),$r:hc.bind(null,t),Br:dc.bind(null,t),vi:lc.bind(null,t),Mr:sc.bind(null,t)},await this.sharedClientState.start()),await this.persistence.li(async e=>{await ac(this.Ac.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}gc(e){const t=Ro();if(!Eo.C(t))throw new T(I.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Ys(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Eo(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class vc{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>za(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=nc.bind(null,this.syncEngine),await da(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new ba}createDatastore(e){const t=xo(e.databaseInfo.databaseId),n=(r=e.databaseInfo,new No(r));var r;return function(e,t,n,r){return new Fo(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>za(this.syncEngine,e,0),s=So.C()?new So:new Co,new Vo(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new La(e,t,n,r,i,s);return o&&(a.dc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=b(e);p("RemoteStore","RemoteStore shutting down."),t._u.add(5),await Bo(t),t.mu.shutdown(),t.gu.set("Unknown")}(this.remoteStore)}}function wc(e,t,n){if(!n)throw new T(I.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function bc(e,t,n,r){if(!0===t&&!0===r)throw new T(I.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Ic(e){if(!K.isDocumentKey(e))throw new T(I.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Tc(e){if(K.isDocumentKey(e))throw new T(I.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Ec(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":_()}function kc(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new T(I.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Ec(e);throw new T(I.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function Cc(e,t){if(t<=0)throw new T(I.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}const Sc=new Map;class Oc{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new T(I.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new T(I.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,bc("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ac{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Oc({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new T(I.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new T(I.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Oc(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new C;switch(e.type){case"gapi":const t=e.client;return new N(t,e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new T(I.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Sc.get(e);t&&(p("ComponentProvider","Removing Datastore"),Sc.delete(e),t.terminate())}(this),Promise.resolve()}}function Nc(e,t,n,r={}){var i;const s=(e=kc(e,Ac))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==t&&m("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},s),{host:`${t}:${n}`,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=u.MOCK_USER;else{t=Object(o["n"])(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new T(I.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new u(s)}e._authCredentials=new S(new k(t,n))}}class Rc{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new xc(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Rc(this.firestore,e,this._key)}}class Dc{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Dc(this.firestore,e,this._query)}}class xc extends Dc{constructor(e,t,n){super(e,t,Mt(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Rc(this.firestore,null,new K(e))}withConverter(e){return new xc(this.firestore,e,this._path)}}function Pc(e,t,...n){if(e=Object(o["z"])(e),wc("collection","path",t),e instanceof Ac){const r=q.fromString(t,...n);return Tc(r),new xc(e,null,r)}{if(!(e instanceof Rc||e instanceof xc))throw new T(I.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(q.fromString(t,...n));return Tc(r),new xc(e.firestore,null,r)}}function Mc(e,t){if(e=kc(e,Ac),wc("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new T(I.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Dc(e,null,function(e){return new xt(q.emptyPath(),e)}(t))}function jc(e,t,...n){if(e=Object(o["z"])(e),1===arguments.length&&(t=P.R()),wc("doc","path",t),e instanceof Ac){const r=q.fromString(t,...n);return Ic(r),new Rc(e,null,new K(r))}{if(!(e instanceof Rc||e instanceof xc))throw new T(I.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(q.fromString(t,...n));return Ic(r),new Rc(e.firestore,e instanceof xc?e.converter:null,new K(r))}}function Lc(e,t){return e=Object(o["z"])(e),t=Object(o["z"])(t),(e instanceof Rc||e instanceof xc)&&(t instanceof Rc||t instanceof xc)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function Fc(e,t){return e=Object(o["z"])(e),t=Object(o["z"])(t),e instanceof Dc&&t instanceof Dc&&e.firestore===t.firestore&&zt(e._query,t._query)&&e.converter===t.converter}function Uc(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class Vc{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):g("Uncaught Error in snapshot listener:",e)}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class qc{constructor(e,t){this.Pc=e,this.It=t,this.metadata=new E,this.buffer=new Uint8Array,this.vc=new TextDecoder("utf-8"),this.Vc().then(e=>{e&&e.Ou()?this.metadata.resolve(e.ku.metadata):this.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==e?void 0:e.ku)))},e=>this.metadata.reject(e))}close(){return this.Pc.cancel()}async getMetadata(){return this.metadata.promise}async mc(){return await this.getMetadata(),this.Vc()}async Vc(){const e=await this.Sc();if(null===e)return null;const t=this.vc.decode(e),n=Number(t);isNaN(n)&&this.Dc(`length string (${t}) is not valid number`);const r=await this.Cc(n);return new Oa(JSON.parse(r),e.length+n)}xc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async Sc(){for(;this.xc()<0;)if(await this.Nc())break;if(0===this.buffer.length)return null;const e=this.xc();e<0&&this.Dc("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Cc(e){for(;this.buffer.length<e;)await this.Nc()&&this.Dc("Reached the end of bundle when more is expected.");const t=this.vc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Dc(e){throw this.Pc.cancel(),new Error("Invalid bundle format: "+e)}async Nc(){const e=await this.Pc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class Bc{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new T(I.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const n=b(e),r=yr(n.It)+"/documents",i={documents:t.map(e=>fr(n.It,e))},s=await n._o("BatchGetDocuments",r,i,t.length),o=new Map;s.forEach(e=>{const t=br(n.It,e);o.set(t.key.toString(),t)});const a=[];return t.forEach(e=>{const t=o.get(e.toString());v(!!t),a.push(t)}),a}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new On(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{const n=K.fromPath(t);this.mutations.push(new An(n,this.precondition(n)))}),await async function(e,t){const n=b(e),r=yr(n.It)+"/documents",i={writes:t.map(e=>Tr(n.It,e))};await n.ao("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw _();t=U.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new T(I.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(U.min())?gn.exists(!1):gn.updateTime(t):gn.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(U.min()))throw new T(I.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return gn.updateTime(t)}return gn.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class zc{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.kc=n.maxAttempts,this.xo=new Po(this.asyncQueue,"transaction_retry")}run(){this.kc-=1,this.Oc()}Oc(){this.xo.Ro(async()=>{const e=new Bc(this.datastore),t=this.Mc(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Fc(e)}))}).catch(e=>{this.Fc(e)})})}Mc(e){try{const t=this.updateFunction(e);return!Le(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Fc(e){this.kc>0&&this.$c(e)?(this.kc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Oc(),Promise.resolve()))):this.deferred.reject(e)}$c(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||!xn(t)}return!1}}class Kc{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=u.UNAUTHENTICATED,this.clientId=P.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{p("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(p("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new T(I.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new E;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=ma(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function Wc(e,t){e.asyncQueue.verifyOperationInProgress(),p("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await to(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t}async function $c(e,t){e.asyncQueue.verifyOperationInProgress();const n=await Gc(e);p("FirestoreClient","Initializing OnlineComponentProvider");const r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener(e=>ha(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>ha(t.remoteStore,n)),e.onlineComponents=t}async function Gc(e){return e.offlineComponents||(p("FirestoreClient","Using default OfflineComponentProvider"),await Wc(e,new mc)),e.offlineComponents}async function Hc(e){return e.onlineComponents||(p("FirestoreClient","Using default OnlineComponentProvider"),await $c(e,new vc)),e.onlineComponents}function Qc(e){return Gc(e).then(e=>e.persistence)}function Yc(e){return Gc(e).then(e=>e.localStore)}function Xc(e){return Hc(e).then(e=>e.remoteStore)}function Jc(e){return Hc(e).then(e=>e.syncEngine)}function Zc(e){return Hc(e).then(e=>e.datastore)}async function eu(e){const t=await Hc(e),n=t.eventManager;return n.onListen=Fa.bind(null,t.syncEngine),n.onUnlisten=Va.bind(null,t.syncEngine),n}function tu(e){return e.asyncQueue.enqueue(async()=>{const t=await Qc(e),n=await Xc(e);return t.setNetworkEnabled(!0),function(e){const t=b(e);return t._u.delete(0),qo(t)}(n)})}function nu(e){return e.asyncQueue.enqueue(async()=>{const t=await Qc(e),n=await Xc(e);return t.setNetworkEnabled(!1),async function(e){const t=b(e);t._u.add(0),await Bo(t),t.gu.set("Offline")}(n)})}function ru(e,t){const n=new E;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await function(e,t){const n=b(e);return n.persistence.runTransaction("read document","readonly",e=>n.localDocuments.getDocument(e,t))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new T(I.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=ma(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await Yc(e),t,n)),n.promise}function iu(e,t,n={}){const r=new E;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,i){const s=new Vc({next:s=>{t.enqueueAndForget(()=>Ta(e,o));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new T(I.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new T(I.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new Sa(Mt(n.path),s,{includeMetadataChanges:!0,Nu:!0});return Ia(e,o)}(await eu(e),e.asyncQueue,t,n,r)),r.promise}function su(e,t){const n=new E;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await uo(e,t,!0),i=new Pa(t,r.Hi),s=i.Wu(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){const r=ma(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await Yc(e),t,n)),n.promise}function ou(e,t,n={}){const r=new E;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,i){const s=new Vc({next:n=>{t.enqueueAndForget(()=>Ta(e,o)),n.fromCache&&"server"===r.source?i.reject(new T(I.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new Sa(n,s,{includeMetadataChanges:!0,Nu:!0});return Ia(e,o)}(await eu(e),e.asyncQueue,t,n,r)),r.promise}function au(e,t){const n=new Vc(t);return e.asyncQueue.enqueueAndForget(async()=>function(e,t){b(e).Ru.add(t),t.next()}(await eu(e),n)),()=>{n.bc(),e.asyncQueue.enqueueAndForget(async()=>function(e,t){b(e).Ru.delete(t)}(await eu(e),n))}}function cu(e,t,n,r){const i=function(e,t){let n;return n="string"==typeof e?(new TextEncoder).encode(e):e,function(e,t){return new qc(e,t)}(function(e,t){if(e instanceof Uint8Array)return Uc(e,t);if(e instanceof ArrayBuffer)return Uc(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,xo(t));e.asyncQueue.enqueueAndForget(async()=>{gc(await Jc(e),i,r)})}function uu(e,t){return e.asyncQueue.enqueue(async()=>function(e,t){const n=b(e);return n.persistence.runTransaction("Get named query","readonly",e=>n.Ns.getNamedQuery(e,t))}(await Yc(e),t))}class lu{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.Uc=!1,this.qc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new Po(this,"async_queue_retry"),this.Wc=()=>{const e=Do();e&&p("AsyncQueue","Visibility state changed to "+e.visibilityState),this.xo.Po()};const e=Do();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.Uc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.Uc){this.Uc=!0,this.Qc=e||!1;const t=Do();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.Uc)return new Promise(()=>{});const t=new E;return this.Hc(()=>this.Uc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}async Jc(){if(0!==this.Lc.length){try{await this.Lc[0](),this.Lc.shift(),this.xo.reset()}catch(e){if(!ce(e))throw e;p("AsyncQueue","Operation failed with retryable error: "+e)}this.Lc.length>0&&this.xo.Ro(()=>this.Jc())}}Hc(e){const t=this.Bc.then(()=>(this.Gc=!0,e().catch(e=>{this.Kc=e,this.Gc=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw g("INTERNAL UNHANDLED ERROR: ",t),e}).then(e=>(this.Gc=!1,e))));return this.Bc=t,t}enqueueAfterDelay(e,t,n){this.zc(),this.jc.indexOf(e)>-1&&(t=0);const r=ga.createAndSchedule(this,e,t,n,e=>this.Yc(e));return this.qc.push(r),r}zc(){this.Kc&&_()}verifyOperationInProgress(){}async Xc(){let e;do{e=this.Bc,await e}while(e!==this.Bc)}Zc(e){for(const t of this.qc)if(t.timerId===e)return!0;return!1}ta(e){return this.Xc().then(()=>{this.qc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.qc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){const t=this.qc.indexOf(e);this.qc.splice(t,1)}}function hu(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return!0;return!1}(e,["next","error","complete"])}class du{constructor(){this._progressObserver={},this._taskCompletionResolver=new E,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}const fu=-1;class pu extends Ac{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new lu,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||mu(this),this._firestoreClient.terminate()}}function gu(e){return e._firestoreClient||mu(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function mu(e){var t;const n=e._freezeSettings(),r=function(e,t,n,r){return new Me(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new Kc(e._authCredentials,e._appCheckCredentials,e._queue,r)}function yu(e,t){Cu(e=kc(e,pu));const n=gu(e),r=e._freezeSettings(),i=new vc;return vu(n,i,new yc(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}function _u(e){Cu(e=kc(e,pu));const t=gu(e),n=e._freezeSettings(),r=new vc;return vu(t,r,new _c(r,n.cacheSizeBytes))}function vu(e,t,n){const r=new E;return e.asyncQueue.enqueue(async()=>{try{await Wc(e,n),await $c(e,t),r.resolve()}catch(e){const n=e;if(!function(e){return"FirebaseError"===e.name?e.code===I.FAILED_PRECONDITION||e.code===I.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||(22===e.code||20===e.code||11===e.code)}(n))throw n;m("Error enabling offline persistence. Falling back to persistence disabled: "+n),r.reject(n)}}).then(()=>r.promise)}function wu(e){if(e._initialized&&!e._terminated)throw new T(I.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new E;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!se.C())return Promise.resolve();const t=e+"main";await se.delete(t)}(Ys(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}function bu(e){return function(e){const t=new E;return e.asyncQueue.enqueueAndForget(async()=>Ga(await Jc(e),t)),t.promise}(gu(e=kc(e,pu)))}function Iu(e){return tu(gu(e=kc(e,pu)))}function Tu(e){return nu(gu(e=kc(e,pu)))}function Eu(e,t){const n=gu(e=kc(e,pu)),r=new du;return cu(n,e._databaseId,t,r),r}function ku(e,t){return uu(gu(e=kc(e,pu)),t).then(t=>t?new Dc(e,null,t.query):null)}function Cu(e){if(e._initialized||e._terminated)throw new T(I.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Su{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Su(Se.fromBase64String(e))}catch(e){throw new T(I.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Su(Se.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Ou{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new T(I.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new z(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Au{constructor(e){this._methodName=e}}class Nu{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new T(I.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new T(I.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return M(this._lat,e._lat)||M(this._long,e._long)}}const Ru=/^__.*__$/;class Du{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new En(e,this.data,this.fieldMask,t,this.fieldTransforms):new Tn(e,this.data,t,this.fieldTransforms)}}class xu{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new En(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Pu(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw _()}}class Mu{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.It=n,this.ignoreUndefinedProperties=r,void 0===i&&this.na(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new Mu(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.It,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ia({path:n,oa:!1});return r.ua(e),r}ca(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ia({path:n,oa:!1});return r.na(),r}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return tl(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(Pu(this.sa)&&Ru.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class ju{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.It=n||xo(e)}da(e,t,n,r=!1){return new Mu({sa:e,methodName:t,fa:n,path:z.emptyPath(),oa:!1,la:r},this.databaseId,this.It,this.ignoreUndefinedProperties)}}function Lu(e){const t=e._freezeSettings(),n=xo(e._databaseId);return new ju(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Fu(e,t,n,r,i,s={}){const o=e.da(s.merge||s.mergeFields?2:0,t,n,i);Xu("Data must be an object, but it was:",o,r);const a=Qu(r,o);let c,u;if(s.merge)c=new ke(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=Ju(t,r,n);if(!o.contains(i))throw new T(I.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);nl(e,i)||e.push(i)}c=new ke(e),u=o.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,u=o.fieldTransforms;return new Du(new at(a),c,u)}class Uu extends Au{_toFieldTransform(e){if(2!==e.sa)throw 1===e.sa?e.ha(this._methodName+"() can only appear at the top level of your update data"):e.ha(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Uu}}function Vu(e,t,n){return new Mu({sa:3,fa:t.settings.fa,methodName:e._methodName,oa:n},t.databaseId,t.It,t.ignoreUndefinedProperties)}class qu extends Au{_toFieldTransform(e){return new dn(e.path,new rn)}isEqual(e){return e instanceof qu}}class Bu extends Au{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=Vu(this,e,!0),n=this._a.map(e=>Hu(e,t)),r=new sn(n);return new dn(e.path,r)}isEqual(e){return this===e}}class zu extends Au{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=Vu(this,e,!0),n=this._a.map(e=>Hu(e,t)),r=new an(n);return new dn(e.path,r)}isEqual(e){return this===e}}class Ku extends Au{constructor(e,t){super(e),this.wa=t}_toFieldTransform(e){const t=new un(e.It,Jt(e.It,this.wa));return new dn(e.path,t)}isEqual(e){return this===e}}function Wu(e,t,n,r){const i=e.da(1,t,n);Xu("Data must be an object, but it was:",i,r);const s=[],a=at.empty();ye(r,(e,r)=>{const c=el(t,e,n);r=Object(o["z"])(r);const u=i.ca(c);if(r instanceof Uu)s.push(c);else{const e=Hu(r,u);null!=e&&(s.push(c),a.set(c,e))}});const c=new ke(s);return new xu(a,c,i.fieldTransforms)}function $u(e,t,n,r,i,s){const a=e.da(1,t,n),c=[Ju(t,r,n)],u=[i];if(s.length%2!=0)throw new T(I.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let o=0;o<s.length;o+=2)c.push(Ju(t,s[o])),u.push(s[o+1]);const l=[],h=at.empty();for(let f=c.length-1;f>=0;--f)if(!nl(l,c[f])){const e=c[f];let t=u[f];t=Object(o["z"])(t);const n=a.ca(e);if(t instanceof Uu)l.push(e);else{const r=Hu(t,n);null!=r&&(l.push(e),h.set(e,r))}}const d=new ke(l);return new xu(h,d,a.fieldTransforms)}function Gu(e,t,n,r=!1){return Hu(n,e.da(r?4:3,t))}function Hu(e,t){if(Yu(e=Object(o["z"])(e)))return Xu("Unsupported field value:",t,e),Qu(e,t);if(e instanceof Au)return function(e,t){if(!Pu(t.sa))throw t.ha(e._methodName+"() can only be used with update() and set()");if(!t.path)throw t.ha(e._methodName+"() is not currently supported inside arrays");const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.oa&&4!==t.sa)throw t.ha("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Hu(i,t.aa(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=Object(o["z"])(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Jt(t.It,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=F.fromDate(e);return{timestampValue:ar(t.It,n)}}if(e instanceof F){const n=new F(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:ar(t.It,n)}}if(e instanceof Nu)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Su)return{bytesValue:cr(t.It,e._byteString)};if(e instanceof Rc){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.ha(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:hr(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.ha("Unsupported field value: "+Ec(e))}(e,t)}function Qu(e,t){const n={};return _e(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ye(e,(e,r)=>{const i=Hu(r,t.ra(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function Yu(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof F||e instanceof Nu||e instanceof Su||e instanceof Rc||e instanceof Au)}function Xu(e,t,n){if(!Yu(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Ec(n);throw"an object"===r?t.ha(e+" a custom object"):t.ha(e+" "+r)}}function Ju(e,t,n){if((t=Object(o["z"])(t))instanceof Ou)return t._internalPath;if("string"==typeof t)return el(e,t);throw tl("Field path arguments must be of type string or ",e,!1,void 0,n)}const Zu=new RegExp("[~\\*/\\[\\]]");function el(e,t,n){if(t.search(Zu)>=0)throw tl(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Ou(...t.split("."))._internalPath}catch(r){throw tl(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function tl(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=" in field "+r),o&&(c+=" in document "+i),c+=")"),new T(I.INVALID_ARGUMENT,a+e+c)}function nl(e,t){return e.some(e=>e.isEqual(t))}class rl{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Rc(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new il(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(sl("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class il extends rl{data(){return super.data()}}function sl(e,t){return"string"==typeof t?el(e,t):t instanceof Ou?t._internalPath:t._delegate._internalPath}function ol(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new T(I.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class al{}function cl(e,...t){for(const n of t)e=n._apply(e);return e}class ul extends al{constructor(e,t,n){super(),this.ma=e,this.ga=t,this.ya=n,this.type="where"}_apply(e){const t=Lu(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new T(I.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){El(o,s);const t=[];for(const n of o)t.push(Tl(r,e,n));a={arrayValue:{values:t}}}else a=Tl(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||El(o,s),a=Gu(n,t,o,"in"===s||"not-in"===s);const c=vt.create(i,s,a);return function(e,t){if(t.dt()){const n=Ft(e);if(null!==n&&!n.isEqual(t.field))throw new T(I.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${t.field.toString()}'`);const r=Lt(e);null!==r&&kl(e,t.field,r)}const n=function(e,t){for(const n of e.filters)if(t.indexOf(n.op)>=0)return n.op;return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new T(I.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new T(I.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}(e,c),c}(e._query,"where",t,e.firestore._databaseId,this.ma,this.ga,this.ya);return new Dc(e.firestore,e.converter,function(e,t){const n=e.filters.concat([t]);return new xt(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}function ll(e,t,n){const r=t,i=sl("where",e);return new ul(i,r,n)}class hl extends al{constructor(e,t){super(),this.ma=e,this.pa=t,this.type="orderBy"}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new T(I.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new T(I.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new At(t,n);return function(e,t){if(null===Lt(e)){const n=Ft(e);null!==n&&kl(e,n,t.field)}}(e,r),r}(e._query,this.ma,this.pa);return new Dc(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new xt(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function dl(e,t="asc"){const n=t,r=sl("orderBy",e);return new hl(r,n)}class fl extends al{constructor(e,t,n){super(),this.type=e,this.Ia=t,this.Ta=n}_apply(e){return new Dc(e.firestore,e.converter,Bt(e._query,this.Ia,this.Ta))}}function pl(e){return Cc("limit",e),new fl("limit",e,"F")}function gl(e){return Cc("limitToLast",e),new fl("limitToLast",e,"L")}class ml extends al{constructor(e,t,n){super(),this.type=e,this.Ea=t,this.Aa=n}_apply(e){const t=Il(e,this.type,this.Ea,this.Aa);return new Dc(e.firestore,e.converter,function(e,t){return new xt(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}function yl(...e){return new ml("startAt",e,!0)}function _l(...e){return new ml("startAfter",e,!1)}class vl extends al{constructor(e,t,n){super(),this.type=e,this.Ea=t,this.Aa=n}_apply(e){const t=Il(e,this.type,this.Ea,this.Aa);return new Dc(e.firestore,e.converter,function(e,t){return new xt(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function wl(...e){return new vl("endBefore",e,!1)}function bl(...e){return new vl("endAt",e,!0)}function Il(e,t,n,r){if(n[0]=Object(o["z"])(n[0]),n[0]instanceof rl)return function(e,t,n,r,i){if(!r)throw new T(I.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const o of Vt(e))if(o.field.isKeyField())s.push(Qe(t,r.key));else{const e=r.data.field(o.field);if(De(e))throw new T(I.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=o.field.canonicalString();throw new T(I.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new Ot(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=Lu(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new T(I.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let c=0;c<i.length;c++){const s=i[c];if(o[c].field.isKeyField()){if("string"!=typeof s)throw new T(I.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof s}`);if(!Ut(e)&&-1!==s.indexOf("/"))throw new T(I.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${s}' contains a slash.`);const n=e.path.child(q.fromString(s));if(!K.isDocumentKey(n))throw new T(I.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new K(n);a.push(Qe(t,i))}else{const e=Gu(n,r,s);a.push(e)}}return new Ot(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function Tl(e,t,n){if("string"==typeof(n=Object(o["z"])(n))){if(""===n)throw new T(I.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ut(t)&&-1!==n.indexOf("/"))throw new T(I.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(q.fromString(n));if(!K.isDocumentKey(r))throw new T(I.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Qe(e,new K(r))}if(n instanceof Rc)return Qe(e,n._key);throw new T(I.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ec(n)}.`)}function El(e,t){if(!Array.isArray(e)||0===e.length)throw new T(I.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(e.length>10)throw new T(I.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function kl(e,t,n){if(!n.isEqual(t))throw new T(I.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class Cl{convertValue(e,t="none"){switch(Be(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ne(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Re(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw _()}}convertObject(e,t){const n={};return ye(e.fields,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertGeoPoint(e){return new Nu(Ne(e.latitude),Ne(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=xe(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Pe(e));default:return null}}convertTimestamp(e){const t=Ae(e);return new F(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=q.fromString(e);v(Fr(n));const r=new je(n.get(1),n.get(3)),i=new K(n.popFirst(5));return r.isEqual(t)||g(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Sl(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class Ol extends Cl{constructor(e){super(),this.firestore=e}convertBytes(e){return new Su(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Rc(this.firestore,null,t)}}class Al{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Nl extends rl{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Rl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(sl("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Rl extends Nl{data(e={}){return super.data(e)}}class Dl{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Al(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Rl(this._firestore,this._userDataWriter,n.key,n,new Al(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new T(I.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const r=new Rl(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Al(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new Rl(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Al(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:xl(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function xl(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return _()}}function Pl(e,t){return e instanceof Nl&&t instanceof Nl?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Dl&&t instanceof Dl&&e._firestore===t._firestore&&Fc(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function Ml(e){e=kc(e,Rc);const t=kc(e.firestore,pu);return iu(gu(t),e._key).then(n=>Ql(t,e,n))}class jl extends Cl{constructor(e){super(),this.firestore=e}convertBytes(e){return new Su(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Rc(this.firestore,null,t)}}function Ll(e){e=kc(e,Rc);const t=kc(e.firestore,pu),n=gu(t),r=new jl(t);return ru(n,e._key).then(n=>new Nl(t,r,e._key,n,new Al(null!==n&&n.hasLocalMutations,!0),e.converter))}function Fl(e){e=kc(e,Rc);const t=kc(e.firestore,pu);return iu(gu(t),e._key,{source:"server"}).then(n=>Ql(t,e,n))}function Ul(e){e=kc(e,Dc);const t=kc(e.firestore,pu),n=gu(t),r=new jl(t);return ol(e._query),ou(n,e._query).then(n=>new Dl(t,r,e,n))}function Vl(e){e=kc(e,Dc);const t=kc(e.firestore,pu),n=gu(t),r=new jl(t);return su(n,e._query).then(n=>new Dl(t,r,e,n))}function ql(e){e=kc(e,Dc);const t=kc(e.firestore,pu),n=gu(t),r=new jl(t);return ou(n,e._query,{source:"server"}).then(n=>new Dl(t,r,e,n))}function Bl(e,t,n){e=kc(e,Rc);const r=kc(e.firestore,pu),i=Sl(e.converter,t,n);return Hl(r,[Fu(Lu(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,gn.none())])}function zl(e,t,n,...r){e=kc(e,Rc);const i=kc(e.firestore,pu),s=Lu(i);let a;return a="string"==typeof(t=Object(o["z"])(t))||t instanceof Ou?$u(s,"updateDoc",e._key,t,n,r):Wu(s,"updateDoc",e._key,t),Hl(i,[a.toMutation(e._key,gn.exists(!0))])}function Kl(e){return Hl(kc(e.firestore,pu),[new On(e._key,gn.none())])}function Wl(e,t){const n=kc(e.firestore,pu),r=jc(e),i=Sl(e.converter,t);return Hl(n,[Fu(Lu(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,gn.exists(!1))]).then(()=>r)}function $l(e,...t){var n,r,i;e=Object(o["z"])(e);let s={includeMetadataChanges:!1},a=0;"object"!=typeof t[a]||hu(t[a])||(s=t[a],a++);const c={includeMetadataChanges:s.includeMetadataChanges};if(hu(t[a])){const e=t[a];t[a]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[a+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[a+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let u,l,h;if(e instanceof Rc)l=kc(e.firestore,pu),h=Mt(e._key.path),u={next:n=>{t[a]&&t[a](Ql(l,e,n))},error:t[a+1],complete:t[a+2]};else{const n=kc(e,Dc);l=kc(n.firestore,pu),h=n._query;const r=new jl(l);u={next:e=>{t[a]&&t[a](new Dl(l,r,n,e))},error:t[a+1],complete:t[a+2]},ol(e._query)}return function(e,t,n,r){const i=new Vc(r),s=new Sa(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>Ia(await eu(e),s)),()=>{i.bc(),e.asyncQueue.enqueueAndForget(async()=>Ta(await eu(e),s))}}(gu(l),h,c,u)}function Gl(e,t){return au(gu(e=kc(e,pu)),hu(t)?t:{next:t})}function Hl(e,t){return function(e,t){const n=new E;return e.asyncQueue.enqueueAndForget(async()=>qa(await Jc(e),t,n)),n.promise}(gu(e),t)}function Ql(e,t,n){const r=n.docs.get(t._key),i=new jl(e);return new Nl(e,i,t._key,r,new Al(n.hasPendingWrites,n.fromCache),t.converter)}const Yl={maxAttempts:5};class Xl{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Lu(e)}set(e,t,n){this._verifyNotCommitted();const r=Jl(e,this._firestore),i=Sl(r.converter,t,n),s=Fu(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,gn.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const i=Jl(e,this._firestore);let s;return s="string"==typeof(t=Object(o["z"])(t))||t instanceof Ou?$u(this._dataReader,"WriteBatch.update",i._key,t,n,r):Wu(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,gn.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Jl(e,this._firestore);return this._mutations=this._mutations.concat(new On(t._key,gn.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new T(I.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Jl(e,t){if((e=Object(o["z"])(e)).firestore!==t)throw new T(I.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class Zl extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Lu(e)}get(e){const t=Jl(e,this._firestore),n=new Ol(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return _();const r=e[0];if(r.isFoundDocument())return new rl(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new rl(this._firestore,n,t._key,null,t.converter);throw _()})}set(e,t,n){const r=Jl(e,this._firestore),i=Sl(r.converter,t,n),s=Fu(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){const i=Jl(e,this._firestore);let s;return s="string"==typeof(t=Object(o["z"])(t))||t instanceof Ou?$u(this._dataReader,"Transaction.update",i._key,t,n,r):Wu(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,s),this}delete(e){const t=Jl(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Jl(e,this._firestore),n=new jl(this._firestore);return super.get(e).then(e=>new Nl(this._firestore,n,t._key,e._document,new Al(!1,!1),t.converter))}}function eh(e,t,n){e=kc(e,pu);const r=Object.assign(Object.assign({},Yl),n);return function(e){if(e.maxAttempts<1)throw new T(I.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){const r=new E;return e.asyncQueue.enqueueAndForget(async()=>{const i=await Zc(e);new zc(e.asyncQueue,i,n,t,r).run()}),r.promise}(gu(e),n=>t(new Zl(e,n)),r)}function th(){return new Uu("deleteField")}function nh(){return new qu("serverTimestamp")}function rh(...e){return new Bu("arrayUnion",e)}function ih(...e){return new zu("arrayRemove",e)}function sh(e){return new Ku("increment",e)}!function(e,t=!0){!function(e){l=e}(r["SDK_VERSION"]),Object(r["_registerComponent"])(new i["a"]("firestore",(e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new pu(new O(e.getProvider("auth-internal")),new D(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new T(I.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new je(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),Object(r["registerVersion"])(c,"3.7.2",e),Object(r["registerVersion"])(c,"3.7.2","esm2017")}()}).call(this,n("4362"))},"1d25":function(e,t,n){"use strict";n.d(t,"a",(function(){return I})),n.d(t,"b",(function(){return b}));const r=(e,t)=>t.some(t=>e instanceof t);let i,s;function o(){return i||(i=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function a(){return s||(s=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const c=new WeakMap,u=new WeakMap,l=new WeakMap,h=new WeakMap,d=new WeakMap;function f(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(v(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&c.set(t,e)}).catch(()=>{}),d.set(t,e),t}function p(e){if(u.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});u.set(e,t)}let g={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return u.get(e);if("objectStoreNames"===t)return e.objectStoreNames||l.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return v(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function m(e){g=e(g)}function y(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?a().includes(e)?function(...t){return e.apply(w(this),t),v(c.get(this))}:function(...t){return v(e.apply(w(this),t))}:function(t,...n){const r=e.call(w(this),t,...n);return l.set(r,t.sort?t.sort():[t]),v(r)}}function _(e){return"function"===typeof e?y(e):(e instanceof IDBTransaction&&p(e),r(e,o())?new Proxy(e,g):e)}function v(e){if(e instanceof IDBRequest)return f(e);if(h.has(e))return h.get(e);const t=_(e);return t!==e&&(h.set(e,t),d.set(t,e)),t}const w=e=>d.get(e);function b(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=v(o);return r&&o.addEventListener("upgradeneeded",e=>{r(v(o.result),e.oldVersion,e.newVersion,v(o.transaction))}),n&&o.addEventListener("blocked",()=>n()),a.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",()=>i())}).catch(()=>{}),a}function I(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",()=>t()),v(n).then(()=>{})}const T=["get","getKey","getAll","getAllKeys","count"],E=["put","add","delete","clear"],k=new Map;function C(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(k.get(t))return k.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=E.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!T.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return k.set(t,s),s}m(e=>({...e,get:(t,n,r)=>C(t,n)||e.get(t,n,r),has:(t,n)=>!!C(t,n)||e.has(t,n)}))},"1f5a":function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return Ue})),n.d(t,"c",(function(){return lt})),n.d(t,"d",(function(){return pt})),n.d(t,"e",(function(){return mt})),n.d(t,"f",(function(){return gt})),n.d(t,"g",(function(){return et})),n.d(t,"h",(function(){return ft})),n.d(t,"i",(function(){return xr})),n.d(t,"j",(function(){return Hi})),n.d(t,"k",(function(){return c})),n.d(t,"l",(function(){return kr})),n.d(t,"m",(function(){return _t})),n.d(t,"n",(function(){return wt})),n.d(t,"o",(function(){return bt})),n.d(t,"p",(function(){return I})),n.d(t,"q",(function(){return De})),n.d(t,"r",(function(){return y})),n.d(t,"s",(function(){return jn})),n.d(t,"t",(function(){return C})),n.d(t,"u",(function(){return ai})),n.d(t,"v",(function(){return Xr})),n.d(t,"w",(function(){return fe})),n.d(t,"y",(function(){return Kt})),n.d(t,"z",(function(){return Rn})),n.d(t,"A",(function(){return Wi})),n.d(t,"B",(function(){return xn})),n.d(t,"C",(function(){return Wt})),n.d(t,"D",(function(){return zt})),n.d(t,"E",(function(){return Pe})),n.d(t,"G",(function(){return Gt})),n.d(t,"H",(function(){return d})),n.d(t,"I",(function(){return Zt})),n.d(t,"J",(function(){return gn})),n.d(t,"K",(function(){return _n})),n.d(t,"L",(function(){return oi})),n.d(t,"M",(function(){return de})),n.d(t,"N",(function(){return ir})),n.d(t,"O",(function(){return Yt})),n.d(t,"P",(function(){return Mt})),n.d(t,"Q",(function(){return Ar})),n.d(t,"R",(function(){return zr})),n.d(t,"S",(function(){return ii})),n.d(t,"T",(function(){return En})),n.d(t,"U",(function(){return jt})),n.d(t,"V",(function(){return Nr})),n.d(t,"W",(function(){return Br})),n.d(t,"X",(function(){return ni})),n.d(t,"Y",(function(){return en})),n.d(t,"Z",(function(){return Bt})),n.d(t,"ab",(function(){return Qt})),n.d(t,"bb",(function(){return kt})),n.d(t,"cb",(function(){return Pt})),n.d(t,"db",(function(){return Ft})),n.d(t,"eb",(function(){return Ht})),n.d(t,"fb",(function(){return Xt})),n.d(t,"gb",(function(){return Or})),n.d(t,"hb",(function(){return qr})),n.d(t,"ib",(function(){return ei})),n.d(t,"jb",(function(){return At})),n.d(t,"kb",(function(){return sn})),n.d(t,"lb",(function(){return on})),n.d(t,"mb",(function(){return Dr})),n.d(t,"nb",(function(){return rn})),n.d(t,"ob",(function(){return tn})),n.d(t,"pb",(function(){return $t})),n.d(t,"x",(function(){return Cs})),n.d(t,"F",(function(){return Es}));var r=n("1fd5"),i=n("589b"),s=n("e691");function o(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create;Object.create;var a=n("22e5");const c={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},u={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function l(){return{["admin-restricted-operation"]:"This operation is restricted to administrators only.",["argument-error"]:"",["app-not-authorized"]:"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.",["app-not-installed"]:"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.",["captcha-check-failed"]:"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.",["code-expired"]:"The SMS code has expired. Please re-send the verification code to try again.",["cordova-not-ready"]:"Cordova framework is not ready.",["cors-unsupported"]:"This browser is not supported.",["credential-already-in-use"]:"This credential is already associated with a different user account.",["custom-token-mismatch"]:"The custom token corresponds to a different audience.",["requires-recent-login"]:"This operation is sensitive and requires recent authentication. Log in again before retrying this request.",["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.",["dynamic-link-not-activated"]:"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.",["email-change-needs-verification"]:"Multi-factor users must always have a verified email.",["email-already-in-use"]:"The email address is already in use by another account.",["emulator-config-failed"]:'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',["expired-action-code"]:"The action code has expired.",["cancelled-popup-request"]:"This operation has been cancelled due to another conflicting popup being opened.",["internal-error"]:"An internal AuthError has occurred.",["invalid-app-credential"]:"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.",["invalid-app-id"]:"The mobile app identifier is not registed for the current project.",["invalid-user-token"]:"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.",["invalid-auth-event"]:"An internal AuthError has occurred.",["invalid-verification-code"]:"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.",["invalid-continue-uri"]:"The continue URL provided in the request is invalid.",["invalid-cordova-configuration"]:"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.",["invalid-custom-token"]:"The custom token format is incorrect. Please check the documentation.",["invalid-dynamic-link-domain"]:"The provided dynamic link domain is not configured or authorized for the current project.",["invalid-email"]:"The email address is badly formatted.",["invalid-emulator-scheme"]:"Emulator URL must start with a valid scheme (http:// or https://).",["invalid-api-key"]:"Your API key is invalid, please check you have copied it correctly.",["invalid-cert-hash"]:"The SHA-1 certificate hash provided is invalid.",["invalid-credential"]:"The supplied auth credential is malformed or has expired.",["invalid-message-payload"]:"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.",["invalid-multi-factor-session"]:"The request does not contain a valid proof of first factor successful sign-in.",["invalid-oauth-provider"]:"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.",["invalid-oauth-client-id"]:"The OAuth client ID provided is either invalid or does not match the specified API key.",["unauthorized-domain"]:"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.",["invalid-action-code"]:"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.",["wrong-password"]:"The password is invalid or the user does not have a password.",["invalid-persistence-type"]:"The specified persistence type is invalid. It can only be local, session or none.",["invalid-phone-number"]:"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].",["invalid-provider-id"]:"The specified provider ID is invalid.",["invalid-recipient-email"]:"The email corresponding to this action failed to send as the provided recipient email address is invalid.",["invalid-sender"]:"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.",["invalid-verification-id"]:"The verification ID used to create the phone auth credential is invalid.",["invalid-tenant-id"]:"The Auth instance's tenant ID is invalid.",["login-blocked"]:"Login blocked by user-provided method: {$originalMessage}",["missing-android-pkg-name"]:"An Android Package Name must be provided if the Android App is required to be installed.",["auth-domain-config-required"]:"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.",["missing-app-credential"]:"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.",["missing-verification-code"]:"The phone auth credential was created with an empty SMS verification code.",["missing-continue-uri"]:"A continue URL must be provided in the request.",["missing-iframe-start"]:"An internal AuthError has occurred.",["missing-ios-bundle-id"]:"An iOS Bundle ID must be provided if an App Store ID is provided.",["missing-or-invalid-nonce"]:"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.",["missing-multi-factor-info"]:"No second factor identifier is provided.",["missing-multi-factor-session"]:"The request is missing proof of first factor successful sign-in.",["missing-phone-number"]:"To send verification codes, provide a phone number for the recipient.",["missing-verification-id"]:"The phone auth credential was created with an empty verification ID.",["app-deleted"]:"This instance of FirebaseApp has been deleted.",["multi-factor-info-not-found"]:"The user does not have a second factor matching the identifier provided.",["multi-factor-auth-required"]:"Proof of ownership of a second factor is required to complete sign-in.",["account-exists-with-different-credential"]:"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.",["network-request-failed"]:"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.",["no-auth-event"]:"An internal AuthError has occurred.",["no-such-provider"]:"User was not linked to an account with the given provider.",["null-user"]:"A null user object was provided as the argument for an operation which requires a non-null user object.",["operation-not-allowed"]:"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.",["operation-not-supported-in-this-environment"]:'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',["popup-blocked"]:"Unable to establish a connection with the popup. It may have been blocked by the browser.",["popup-closed-by-user"]:"The popup has been closed by the user before finalizing the operation.",["provider-already-linked"]:"User can only be linked to one identity for the given provider.",["quota-exceeded"]:"The project's quota for this operation has been exceeded.",["redirect-cancelled-by-user"]:"The redirect operation has been cancelled by the user before finalizing.",["redirect-operation-pending"]:"A redirect sign-in operation is already pending.",["rejected-credential"]:"The request contains malformed or mismatching credentials.",["second-factor-already-in-use"]:"The second factor is already enrolled on this account.",["maximum-second-factor-count-exceeded"]:"The maximum allowed number of second factors on a user has been exceeded.",["tenant-id-mismatch"]:"The provided tenant ID does not match the Auth instance's tenant ID",["timeout"]:"The operation has timed out.",["user-token-expired"]:"The user's credential is no longer valid. The user must sign in again.",["too-many-requests"]:"We have blocked all requests from this device due to unusual activity. Try again later.",["unauthorized-continue-uri"]:"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.",["unsupported-first-factor"]:"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.",["unsupported-persistence-type"]:"The current environment does not support the specified persistence type.",["unsupported-tenant-operation"]:"This operation is not supported in a multi-tenant context.",["unverified-email"]:"The operation requires a verified email.",["user-cancelled"]:"The user did not grant your application the permissions it requested.",["user-not-found"]:"There is no user record corresponding to this identifier. The user may have been deleted.",["user-disabled"]:"The user account has been disabled by an administrator.",["user-mismatch"]:"The supplied credentials do not correspond to the previously signed in user.",["user-signed-out"]:"",["weak-password"]:"The password must be 6 characters long or more.",["web-storage-unsupported"]:"This browser is not supported or 3rd party cookies and data may be disabled.",["already-initialized"]:"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}}function h(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const d=l,f=h,p=new r["b"]("auth","Firebase",h()),g=new s["b"]("@firebase/auth");function m(e,...t){g.logLevel<=s["a"].ERROR&&g.error(`Auth (${i["SDK_VERSION"]}): ${e}`,...t)}function y(e,...t){throw b(e,...t)}function _(e,...t){return b(e,...t)}function v(e,t,n){const i=Object.assign(Object.assign({},f()),{[t]:n}),s=new r["b"]("auth","Firebase",i);return s.create(t,{appName:e.name})}function w(e,t,n){const r=n;if(!(t instanceof r))throw r.name!==t.constructor.name&&y(e,"argument-error"),v(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function b(e,...t){if("string"!==typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return p.create(e,...t)}function I(e,t,...n){if(!e)throw b(t,...n)}function T(e){const t="INTERNAL ASSERTION FAILED: "+e;throw m(t),new Error(t)}function E(e,t){e||T(t)}const k=new Map;function C(e){E(e instanceof Function,"Expected a class definition");let t=k.get(e);return t?(E(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,k.set(e,t),t)}function S(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(C);(null===t||void 0===t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null===t||void 0===t?void 0:t.popupRedirectResolver)}function O(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function A(){return"http:"===N()||"https:"===N()}function N(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function R(){return!("undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(A()||Object(r["D"])()||"connection"in navigator))||navigator.onLine}function D(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}class x{constructor(e,t){this.shortDelay=e,this.longDelay=t,E(t>e,"Short delay should be less than long delay!"),this.isMobile=Object(r["H"])()||Object(r["K"])()}get(){return R()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function P(e,t){E(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class M{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:void T("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:void T("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:void T("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const j={["CREDENTIAL_MISMATCH"]:"custom-token-mismatch",["MISSING_CUSTOM_TOKEN"]:"internal-error",["INVALID_IDENTIFIER"]:"invalid-email",["MISSING_CONTINUE_URI"]:"internal-error",["INVALID_PASSWORD"]:"wrong-password",["MISSING_PASSWORD"]:"internal-error",["EMAIL_EXISTS"]:"email-already-in-use",["PASSWORD_LOGIN_DISABLED"]:"operation-not-allowed",["INVALID_IDP_RESPONSE"]:"invalid-credential",["INVALID_PENDING_TOKEN"]:"invalid-credential",["FEDERATED_USER_ID_ALREADY_LINKED"]:"credential-already-in-use",["MISSING_REQ_TYPE"]:"internal-error",["EMAIL_NOT_FOUND"]:"user-not-found",["RESET_PASSWORD_EXCEED_LIMIT"]:"too-many-requests",["EXPIRED_OOB_CODE"]:"expired-action-code",["INVALID_OOB_CODE"]:"invalid-action-code",["MISSING_OOB_CODE"]:"internal-error",["CREDENTIAL_TOO_OLD_LOGIN_AGAIN"]:"requires-recent-login",["INVALID_ID_TOKEN"]:"invalid-user-token",["TOKEN_EXPIRED"]:"user-token-expired",["USER_NOT_FOUND"]:"user-token-expired",["TOO_MANY_ATTEMPTS_TRY_LATER"]:"too-many-requests",["INVALID_CODE"]:"invalid-verification-code",["INVALID_SESSION_INFO"]:"invalid-verification-id",["INVALID_TEMPORARY_PROOF"]:"invalid-credential",["MISSING_SESSION_INFO"]:"missing-verification-id",["SESSION_EXPIRED"]:"code-expired",["MISSING_ANDROID_PACKAGE_NAME"]:"missing-android-pkg-name",["UNAUTHORIZED_DOMAIN"]:"unauthorized-continue-uri",["INVALID_OAUTH_CLIENT_ID"]:"invalid-oauth-client-id",["ADMIN_ONLY_OPERATION"]:"admin-restricted-operation",["INVALID_MFA_PENDING_CREDENTIAL"]:"invalid-multi-factor-session",["MFA_ENROLLMENT_NOT_FOUND"]:"multi-factor-info-not-found",["MISSING_MFA_ENROLLMENT_ID"]:"missing-multi-factor-info",["MISSING_MFA_PENDING_CREDENTIAL"]:"missing-multi-factor-session",["SECOND_FACTOR_EXISTS"]:"second-factor-already-in-use",["SECOND_FACTOR_LIMIT_EXCEEDED"]:"maximum-second-factor-count-exceeded",["BLOCKING_FUNCTION_ERROR_RESPONSE"]:"internal-error"},L=new x(3e4,6e4);function F(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function U(e,t,n,i,s={}){return V(e,s,async()=>{let s={},o={};i&&("GET"===t?o=i:s={body:JSON.stringify(i)});const a=Object(r["Q"])(Object.assign({key:e.config.apiKey},o)).slice(1),c=await e._getAdditionalHeaders();return c["Content-Type"]="application/json",e.languageCode&&(c["X-Firebase-Locale"]=e.languageCode),M.fetch()(B(e,e.config.apiHost,n,a),Object.assign({method:t,headers:c,referrerPolicy:"no-referrer"},s))})}async function V(e,t,n){e._canInitEmulator=!1;const i=Object.assign(Object.assign({},j),t);try{const t=new z(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await r.json();if("needConfirmation"in s)throw K(e,"account-exists-with-different-credential",s);if(r.ok&&!("errorMessage"in s))return s;{const t=r.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw K(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw K(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw K(e,"user-disabled",s);const a=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw v(e,a,o);y(e,a)}}catch(s){if(s instanceof r["c"])throw s;y(e,"network-request-failed")}}async function q(e,t,n,r,i={}){const s=await U(e,t,n,r,i);return"mfaPendingCredential"in s&&y(e,"multi-factor-auth-required",{_serverResponse:s}),s}function B(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?P(e.config,i):`${e.config.apiScheme}://${i}`}class z{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(_(this.auth,"network-request-failed")),L.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function K(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=_(e,t,r);return i.customData._tokenResponse=n,i}async function W(e,t){return U(e,"POST","/v1/accounts:delete",t)}async function $(e,t){return U(e,"POST","/v1/accounts:update",t)}async function G(e,t){return U(e,"POST","/v1/accounts:lookup",t)}function H(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}async function Q(e,t=!1){const n=Object(r["z"])(e),i=await n.getIdToken(t),s=X(i);I(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const o="object"===typeof s.firebase?s.firebase:void 0,a=null===o||void 0===o?void 0:o["sign_in_provider"];return{claims:s,token:i,authTime:H(Y(s.auth_time)),issuedAtTime:H(Y(s.iat)),expirationTime:H(Y(s.exp)),signInProvider:a||null,signInSecondFactor:(null===o||void 0===o?void 0:o["sign_in_second_factor"])||null}}function Y(e){return 1e3*Number(e)}function X(e){var t;const[n,i,s]=e.split(".");if(void 0===n||void 0===i||void 0===s)return m("JWT malformed, contained fewer than 3 sections"),null;try{const e=Object(r["i"])(i);return e?JSON.parse(e):(m("Failed to decode base64 JWT payload"),null)}catch(o){return m("Caught error parsing JWT payload as JSON",null===(t=o)||void 0===t?void 0:t.toString()),null}}function J(e){const t=X(e);return I(t,"internal-error"),I("undefined"!==typeof t.exp,"internal-error"),I("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function Z(e,t,n=!1){if(n)return t;try{return await t}catch(i){throw i instanceof r["c"]&&ee(i)&&e.auth.currentUser===e&&await e.auth.signOut(),i}}function ee({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}class te{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0,n=e-Date.now()-3e5;return Math.max(0,n)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){var e;try{await this.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===(null===(e=t)||void 0===e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class ne{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=H(this.lastLoginAt),this.creationTime=H(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function re(e){var t;const n=e.auth,r=await e.getIdToken(),i=await Z(e,G(n,{idToken:r}));I(null===i||void 0===i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?oe(s.providerUserInfo):[],a=se(e.providerData,o),c=e.isAnonymous,u=!(e.email&&s.passwordHash)&&!(null===a||void 0===a?void 0:a.length),l=!!c&&u,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new ne(s.createdAt,s.lastLoginAt),isAnonymous:l};Object.assign(e,h)}async function ie(e){const t=Object(r["z"])(e);await re(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function se(e,t){const n=e.filter(e=>!t.some(t=>t.providerId===e.providerId));return[...n,...t]}function oe(e){return e.map(e=>{var{providerId:t}=e,n=o(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}async function ae(e,t){const n=await V(e,{},async()=>{const n=Object(r["Q"])({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:s}=e.config,o=B(e,i,"/v1/token","key="+s),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",M.fetch()(o,{method:"POST",headers:a,body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}class ce{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){I(e.idToken,"internal-error"),I("undefined"!==typeof e.idToken,"internal-error"),I("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):J(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return I(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await ae(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new ce;return n&&(I("string"===typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(I("string"===typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(I("number"===typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ce,this.toJSON())}_performRefresh(){return T("not implemented")}}function ue(e,t){I("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class le{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=o(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new te(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new ne(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Z(this,this.stsTokenManager.getToken(this.auth,e));return I(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Q(this,e)}reload(){return ie(this)}_assign(e){this!==e&&(I(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new le(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){I(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await re(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await Z(this,W(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:_,emailVerified:v,isAnonymous:w,providerData:b,stsTokenManager:T}=t;I(_&&T,e,"internal-error");const E=ce.fromJSON(this.name,T);I("string"===typeof _,e,"internal-error"),ue(l,e.name),ue(h,e.name),I("boolean"===typeof v,e,"internal-error"),I("boolean"===typeof w,e,"internal-error"),ue(d,e.name),ue(f,e.name),ue(p,e.name),ue(g,e.name),ue(m,e.name),ue(y,e.name);const k=new le({uid:_,auth:e,email:h,emailVerified:v,displayName:l,isAnonymous:w,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:E,createdAt:m,lastLoginAt:y});return b&&Array.isArray(b)&&(k.providerData=b.map(e=>Object.assign({},e))),g&&(k._redirectEventId=g),k}static async _fromIdTokenResponse(e,t,n=!1){const r=new ce;r.updateFromServerResponse(t);const i=new le({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await re(i),i}}class he{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}he.type="NONE";const de=he;function fe(e,t,n){return`firebase:${e}:${t}:${n}`}class pe{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=fe(this.userKey,r.apiKey,i),this.fullPersistenceKey=fe("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?le._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new pe(C(de),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||C(de);const s=fe(n,e.config.apiKey,e.name);let o=null;for(const u of t)try{const t=await u._get(s);if(t){const n=le._fromJSON(e,t);u!==i&&(o=n),i=u;break}}catch(c){}const a=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(c){}})),new pe(i,e,n)):new pe(i,e,n)}}function ge(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ve(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(me(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(be(t))return"Blackberry";if(Ie(t))return"Webos";if(ye(t))return"Safari";if((t.includes("chrome/")||_e(t))&&!t.includes("edge/"))return"Chrome";if(we(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function me(e=Object(r["A"])()){return/firefox\//i.test(e)}function ye(e=Object(r["A"])()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function _e(e=Object(r["A"])()){return/crios\//i.test(e)}function ve(e=Object(r["A"])()){return/iemobile/i.test(e)}function we(e=Object(r["A"])()){return/android/i.test(e)}function be(e=Object(r["A"])()){return/blackberry/i.test(e)}function Ie(e=Object(r["A"])()){return/webos/i.test(e)}function Te(e=Object(r["A"])()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Ee(e=Object(r["A"])()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}function ke(e=Object(r["A"])()){var t;return Te(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}function Ce(){return Object(r["F"])()&&10===document.documentMode}function Se(e=Object(r["A"])()){return Te(e)||we(e)||Ie(e)||be(e)||/windows phone/i.test(e)||ve(e)}function Oe(){try{return!(!window||window===window.top)}catch(e){return!1}}function Ae(e,t=[]){let n;switch(e){case"Browser":n=ge(Object(r["A"])());break;case"Worker":n=`${ge(Object(r["A"])())}-${e}`;break;default:n=e}const s=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${i["SDK_VERSION"]}/${s}`}class Ne{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,r)=>{try{const r=e(t);n(r)}catch(i){r(i)}});n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){var t;if(this.auth.currentUser===e)return;const n=[];try{for(const t of this.queue)await t(e),t.onAbort&&n.push(t.onAbort)}catch(r){n.reverse();for(const e of n)try{e()}catch(i){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===(t=r)||void 0===t?void 0:t.message})}}}class Re{constructor(e,t,n){this.app=e,this.heartbeatServiceProvider=t,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new xe(this),this.idTokenSubscription=new xe(this),this.beforeStateQueue=new Ne(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=p,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=C(t)),this._initializationPromise=this.queue(async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await pe.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(i){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null===r||void 0===r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null===o||void 0===o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(s){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return I(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){var t;try{await re(e)}catch(n){if("auth/network-request-failed"!==(null===(t=n)||void 0===t?void 0:t.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=D()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?Object(r["z"])(e):null;return t&&I(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&I(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(C(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new r["b"]("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&C(e)||this._popupRedirectResolver;I(t,this,"argument-error"),this.redirectPersistenceManager=await pe.create(this,[C(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"===typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return I(s,this,"internal-error"),s.then(()=>i(this.currentUser)),"function"===typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return I(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ae(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={["X-Client-Version"]:this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());return n&&(t["X-Firebase-Client"]=n),t}}function De(e){return Object(r["z"])(e)}class xe{constructor(e){this.auth=e,this.observer=null,this.addObserver=Object(r["o"])(e=>this.observer=e)}get next(){return I(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Pe(e,t,n){const r=De(e);I(r._canInitEmulator,r,"emulator-config-failed"),I(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null===n||void 0===n?void 0:n.disableWarnings),s=Me(t),{host:o,port:a}=je(t),c=null===a?"":":"+a;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||Fe()}function Me(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function je(e){const t=Me(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:Le(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Le(t)}}}function Le(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}function Fe(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}class Ue{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return T("not implemented")}_getIdTokenResponse(e){return T("not implemented")}_linkToIdToken(e,t){return T("not implemented")}_getReauthenticationResolver(e){return T("not implemented")}}async function Ve(e,t){return U(e,"POST","/v1/accounts:resetPassword",F(e,t))}async function qe(e,t){return U(e,"POST","/v1/accounts:update",t)}async function Be(e,t){return U(e,"POST","/v1/accounts:update",F(e,t))}async function ze(e,t){return q(e,"POST","/v1/accounts:signInWithPassword",F(e,t))}async function Ke(e,t){return U(e,"POST","/v1/accounts:sendOobCode",F(e,t))}async function We(e,t){return Ke(e,t)}async function $e(e,t){return Ke(e,t)}async function Ge(e,t){return Ke(e,t)}async function He(e,t){return Ke(e,t)}async function Qe(e,t){return q(e,"POST","/v1/accounts:signInWithEmailLink",F(e,t))}async function Ye(e,t){return q(e,"POST","/v1/accounts:signInWithEmailLink",F(e,t))}class Xe extends Ue{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Xe(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Xe(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if((null===t||void 0===t?void 0:t.email)&&(null===t||void 0===t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return ze(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return Qe(e,{email:this._email,oobCode:this._password});default:y(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return qe(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return Ye(e,{idToken:t,email:this._email,oobCode:this._password});default:y(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Je(e,t){return q(e,"POST","/v1/accounts:signInWithIdp",F(e,t))}const Ze="http://localhost";class et extends Ue{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new et(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):y("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=o(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new et(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){const t=this.buildRequest();return Je(e,t)}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Je(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Je(e,t)}buildRequest(){const e={requestUri:Ze,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t["id_token"]=this.idToken),this.accessToken&&(t["access_token"]=this.accessToken),this.secret&&(t["oauth_token_secret"]=this.secret),t["providerId"]=this.providerId,this.nonce&&!this.pendingToken&&(t["nonce"]=this.nonce),e.postBody=Object(r["Q"])(t)}return e}}async function tt(e,t){return U(e,"POST","/v1/accounts:sendVerificationCode",F(e,t))}async function nt(e,t){return q(e,"POST","/v1/accounts:signInWithPhoneNumber",F(e,t))}async function rt(e,t){const n=await q(e,"POST","/v1/accounts:signInWithPhoneNumber",F(e,t));if(n.temporaryProof)throw K(e,"account-exists-with-different-credential",n);return n}const it={["USER_NOT_FOUND"]:"user-not-found"};async function st(e,t){const n=Object.assign(Object.assign({},t),{operation:"REAUTH"});return q(e,"POST","/v1/accounts:signInWithPhoneNumber",F(e,n),it)}class ot extends Ue{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ot({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ot({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return nt(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return rt(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return st(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new ot({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}function at(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function ct(e){const t=Object(r["R"])(Object(r["t"])(e))["link"],n=t?Object(r["R"])(Object(r["t"])(t))["deep_link_id"]:null,i=Object(r["R"])(Object(r["t"])(e))["deep_link_id"],s=i?Object(r["R"])(Object(r["t"])(i))["link"]:null;return s||i||n||t||e}class ut{constructor(e){var t,n,i,s,o,a;const c=Object(r["R"])(Object(r["t"])(e)),u=null!==(t=c["apiKey"])&&void 0!==t?t:null,l=null!==(n=c["oobCode"])&&void 0!==n?n:null,h=at(null!==(i=c["mode"])&&void 0!==i?i:null);I(u&&l&&h,"argument-error"),this.apiKey=u,this.operation=h,this.code=l,this.continueUrl=null!==(s=c["continueUrl"])&&void 0!==s?s:null,this.languageCode=null!==(o=c["languageCode"])&&void 0!==o?o:null,this.tenantId=null!==(a=c["tenantId"])&&void 0!==a?a:null}static parseLink(e){const t=ct(e);try{return new ut(t)}catch(n){return null}}}class lt{constructor(){this.providerId=lt.PROVIDER_ID}static credential(e,t){return Xe._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=ut.parseLink(t);return I(n,"argument-error"),Xe._fromEmailAndCode(e,n.code,n.tenantId)}}lt.PROVIDER_ID="password",lt.EMAIL_PASSWORD_SIGN_IN_METHOD="password",lt.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class ht{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class dt extends ht{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ft extends dt{static credentialFromJSON(e){const t="string"===typeof e?JSON.parse(e):e;return I("providerId"in t&&"signInMethod"in t,"argument-error"),et._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return I(e.idToken||e.accessToken,"argument-error"),et._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return ft.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return ft.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:o}=e;if(!n&&!r&&!t&&!i)return null;if(!o)return null;try{return new ft(o)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(a){return null}}}class pt extends dt{constructor(){super("facebook.com")}static credential(e){return et._fromParams({providerId:pt.PROVIDER_ID,signInMethod:pt.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return pt.credentialFromTaggedObject(e)}static credentialFromError(e){return pt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return pt.credential(e.oauthAccessToken)}catch(t){return null}}}pt.FACEBOOK_SIGN_IN_METHOD="facebook.com",pt.PROVIDER_ID="facebook.com";class gt extends dt{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return et._fromParams({providerId:gt.PROVIDER_ID,signInMethod:gt.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return gt.credentialFromTaggedObject(e)}static credentialFromError(e){return gt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return gt.credential(t,n)}catch(r){return null}}}gt.GOOGLE_SIGN_IN_METHOD="google.com",gt.PROVIDER_ID="google.com";class mt extends dt{constructor(){super("github.com")}static credential(e){return et._fromParams({providerId:mt.PROVIDER_ID,signInMethod:mt.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return mt.credentialFromTaggedObject(e)}static credentialFromError(e){return mt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return mt.credential(e.oauthAccessToken)}catch(t){return null}}}mt.GITHUB_SIGN_IN_METHOD="github.com",mt.PROVIDER_ID="github.com";const yt="http://localhost";class _t extends Ue{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Je(e,t)}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Je(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Je(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,pendingToken:i}=t;return n&&r&&i&&n===r?new _t(n,i):null}static _create(e,t){return new _t(e,t)}buildRequest(){return{requestUri:yt,returnSecureToken:!0,pendingToken:this.pendingToken}}}const vt="saml.";class wt extends ht{constructor(e){I(e.startsWith(vt),"argument-error"),super(e)}static credentialFromResult(e){return wt.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return wt.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=_t.fromJSON(e);return I(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return _t._create(n,t)}catch(r){return null}}}class bt extends dt{constructor(){super("twitter.com")}static credential(e,t){return et._fromParams({providerId:bt.PROVIDER_ID,signInMethod:bt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return bt.credentialFromTaggedObject(e)}static credentialFromError(e){return bt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return bt.credential(t,n)}catch(r){return null}}}async function It(e,t){return q(e,"POST","/v1/accounts:signUp",F(e,t))}bt.TWITTER_SIGN_IN_METHOD="twitter.com",bt.PROVIDER_ID="twitter.com";class Tt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await le._fromIdTokenResponse(e,n,r),s=Et(n),o=new Tt({user:i,providerId:s,_tokenResponse:n,operationType:t});return o}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Et(n);return new Tt({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Et(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}async function kt(e){var t;const n=De(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new Tt({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await It(n,{returnSecureToken:!0}),i=await Tt._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(i.user),i}class Ct extends r["c"]{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Ct.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Ct(e,t,n,r)}}function St(e,t,n,r){const i="reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e);return i.catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw Ct._fromErrorAndOperation(e,n,t,r);throw n})}function Ot(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function At(e,t){const n=Object(r["z"])(e);await Rt(!0,n,t);const{providerUserInfo:i}=await $(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),s=Ot(i||[]);return n.providerData=n.providerData.filter(e=>s.has(e.providerId)),s.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function Nt(e,t,n=!1){const r=await Z(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Tt._forOperation(e,"link",r)}async function Rt(e,t,n){await re(t);const r=Ot(t.providerData),i=!1===e?"provider-already-linked":"no-such-provider";I(r.has(n)===e,t.auth,i)}async function Dt(e,t,n=!1){var r;const{auth:i}=e,s="reauthenticate";try{const r=await Z(e,St(i,s,t,e),n);I(r.idToken,i,"internal-error");const o=X(r.idToken);I(o,i,"internal-error");const{sub:a}=o;return I(e.uid===a,i,"user-mismatch"),Tt._forOperation(e,s,r)}catch(o){throw"auth/user-not-found"===(null===(r=o)||void 0===r?void 0:r.code)&&y(i,"user-mismatch"),o}}async function xt(e,t,n=!1){const r="signIn",i=await St(e,r,t),s=await Tt._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function Pt(e,t){return xt(De(e),t)}async function Mt(e,t){const n=Object(r["z"])(e);return await Rt(!1,n,t.providerId),Nt(n,t)}async function jt(e,t){return Dt(Object(r["z"])(e),t)}async function Lt(e,t){return q(e,"POST","/v1/accounts:signInWithCustomToken",F(e,t))}async function Ft(e,t){const n=De(e),r=await Lt(n,{token:t,returnSecureToken:!0}),i=await Tt._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(i.user),i}class Ut{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Vt._fromServerResponse(e,t):y(e,"internal-error")}}class Vt extends Ut{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Vt(t)}}function qt(e,t,n){var r;I((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),I("undefined"===typeof n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(I(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(I(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function Bt(e,t,n){const i=Object(r["z"])(e),s={requestType:"PASSWORD_RESET",email:t};n&&qt(i,s,n),await $e(i,s)}async function zt(e,t,n){await Ve(Object(r["z"])(e),{oobCode:t,newPassword:n})}async function Kt(e,t){await Be(Object(r["z"])(e),{oobCode:t})}async function Wt(e,t){const n=Object(r["z"])(e),i=await Ve(n,{oobCode:t}),s=i.requestType;switch(I(s,n,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":I(i.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":I(i.mfaInfo,n,"internal-error");default:I(i.email,n,"internal-error")}let o=null;return i.mfaInfo&&(o=Ut._fromServerResponse(De(n),i.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===i.requestType?i.newEmail:i.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===i.requestType?i.email:i.newEmail)||null,multiFactorInfo:o},operation:s}}async function $t(e,t){const{data:n}=await Wt(Object(r["z"])(e),t);return n.email}async function Gt(e,t,n){const r=De(e),i=await It(r,{returnSecureToken:!0,email:t,password:n}),s=await Tt._fromIdTokenResponse(r,"signIn",i);return await r._updateCurrentUser(s.user),s}function Ht(e,t,n){return Pt(Object(r["z"])(e),lt.credential(t,n))}async function Qt(e,t,n){const i=Object(r["z"])(e),s={requestType:"EMAIL_SIGNIN",email:t};I(n.handleCodeInApp,i,"argument-error"),n&&qt(i,s,n),await Ge(i,s)}function Yt(e,t){const n=ut.parseLink(t);return"EMAIL_SIGNIN"===(null===n||void 0===n?void 0:n.operation)}async function Xt(e,t,n){const i=Object(r["z"])(e),s=lt.credentialWithLink(t,n||O());return I(s._tenantId===(i.tenantId||null),i,"tenant-id-mismatch"),Pt(i,s)}async function Jt(e,t){return U(e,"POST","/v1/accounts:createAuthUri",F(e,t))}async function Zt(e,t){const n=A()?O():"http://localhost",i={identifier:t,continueUri:n},{signinMethods:s}=await Jt(Object(r["z"])(e),i);return s||[]}async function en(e,t){const n=Object(r["z"])(e),i=await e.getIdToken(),s={requestType:"VERIFY_EMAIL",idToken:i};t&&qt(n.auth,s,t);const{email:o}=await We(n.auth,s);o!==e.email&&await e.reload()}async function tn(e,t,n){const i=Object(r["z"])(e),s=await e.getIdToken(),o={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:s,newEmail:t};n&&qt(i.auth,o,n);const{email:a}=await He(i.auth,o);a!==e.email&&await e.reload()}async function nn(e,t){return U(e,"POST","/v1/accounts:update",t)}async function rn(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const i=Object(r["z"])(e),s=await i.getIdToken(),o={idToken:s,displayName:t,photoUrl:n,returnSecureToken:!0},a=await Z(i,nn(i.auth,o));i.displayName=a.displayName||null,i.photoURL=a.photoUrl||null;const c=i.providerData.find(({providerId:e})=>"password"===e);c&&(c.displayName=i.displayName,c.photoURL=i.photoURL),await i._updateTokensIfNecessary(a)}function sn(e,t){return an(Object(r["z"])(e),t,null)}function on(e,t){return an(Object(r["z"])(e),null,t)}async function an(e,t,n){const{auth:r}=e,i=await e.getIdToken(),s={idToken:i,returnSecureToken:!0};t&&(s.email=t),n&&(s.password=n);const o=await Z(e,qe(r,s));await e._updateTokensIfNecessary(o,!0)}function cn(e){var t,n;if(!e)return null;const{providerId:r}=e,i=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},s=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!r&&(null===e||void 0===e?void 0:e.idToken)){const r=null===(n=null===(t=X(e.idToken))||void 0===t?void 0:t.firebase)||void 0===n?void 0:n["sign_in_provider"];if(r){const e="anonymous"!==r&&"custom"!==r?r:null;return new un(s,e)}}if(!r)return null;switch(r){case"facebook.com":return new hn(s,i);case"github.com":return new dn(s,i);case"google.com":return new fn(s,i);case"twitter.com":return new pn(s,i,e.screenName||null);case"custom":case"anonymous":return new un(s,null);default:return new un(s,r,i)}}class un{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class ln extends un{constructor(e,t,n,r){super(e,t,n),this.username=r}}class hn extends un{constructor(e,t){super(e,"facebook.com",t)}}class dn extends ln{constructor(e,t){super(e,"github.com",t,"string"===typeof(null===t||void 0===t?void 0:t.login)?null===t||void 0===t?void 0:t.login:null)}}class fn extends un{constructor(e,t){super(e,"google.com",t)}}class pn extends ln{constructor(e,t,n){super(e,"twitter.com",t,n)}}function gn(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:cn(n)}class mn{constructor(e,t,n){this.type=e,this.credential=t,this.auth=n}static _fromIdtoken(e,t){return new mn("enroll",e,t)}static _fromMfaPendingCredential(e){return new mn("signin",e)}toJSON(){const e="enroll"===this.type?"idToken":"pendingCredential";return{multiFactorSession:{[e]:this.credential}}}static fromJSON(e){var t,n;if(null===e||void 0===e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return mn._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return mn._fromIdtoken(e.multiFactorSession.idToken)}return null}}class yn{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=De(e),r=t.customData._serverResponse,i=(r.mfaInfo||[]).map(e=>Ut._fromServerResponse(n,e));I(r.mfaPendingCredential,n,"internal-error");const s=mn._fromMfaPendingCredential(r.mfaPendingCredential);return new yn(s,i,async e=>{const i=await e._process(n,s);delete r.mfaInfo,delete r.mfaPendingCredential;const o=Object.assign(Object.assign({},r),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":const e=await Tt._fromIdTokenResponse(n,t.operationType,o);return await n._updateCurrentUser(e.user),e;case"reauthenticate":return I(t.user,n,"internal-error"),Tt._forOperation(t.user,t.operationType,o);default:y(n,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function _n(e,t){var n;const i=Object(r["z"])(e),s=t;return I(t.customData.operationType,i,"argument-error"),I(null===(n=s.customData._serverResponse)||void 0===n?void 0:n.mfaPendingCredential,i,"argument-error"),yn._fromError(i,s)}function vn(e,t){return U(e,"POST","/v2/accounts/mfaEnrollment:start",F(e,t))}function wn(e,t){return U(e,"POST","/v2/accounts/mfaEnrollment:finalize",F(e,t))}function bn(e,t){return U(e,"POST","/v2/accounts/mfaEnrollment:withdraw",F(e,t))}class In{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(t=>Ut._fromServerResponse(e.auth,t)))})}static _fromUser(e){return new In(e)}async getSession(){return mn._fromIdtoken(await this.user.getIdToken(),this.user.auth)}async enroll(e,t){const n=e,r=await this.getSession(),i=await Z(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){var t;const n="string"===typeof e?e:e.uid,r=await this.user.getIdToken(),i=await Z(this.user,bn(this.user.auth,{idToken:r,mfaEnrollmentId:n}));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==n),await this.user._updateTokensIfNecessary(i);try{await this.user.reload()}catch(s){if("auth/user-token-expired"!==(null===(t=s)||void 0===t?void 0:t.code))throw s}}}const Tn=new WeakMap;function En(e){const t=Object(r["z"])(e);return Tn.has(t)||Tn.set(t,In._fromUser(t)),Tn.get(t)}const kn="__sak";class Cn{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(kn,"1"),this.storage.removeItem(kn),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}function Sn(){const e=Object(r["A"])();return ye(e)||Te(e)}const On=1e3,An=10;class Nn extends Cn{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=Sn()&&Oe(),this.fallbackToPolling=Se(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);Ce()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,An):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},On)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Nn.type="LOCAL";const Rn=Nn;class Dn extends Cn{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Dn.type="SESSION";const xn=Dn;function Pn(e){return Promise.all(e.map(async e=>{try{const t=await e;return{fulfilled:!0,value:t}}catch(t){return{fulfilled:!1,reason:t}}}))}class Mn{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new Mn(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null===s||void 0===s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map(async e=>e(t.origin,i)),a=await Pn(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function jn(e="",t=10){let n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}Mn.receivers=[];class Ln{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise((o,a)=>{const c=jn("",20);r.port1.start();const u=setTimeout(()=>{a(new Error("unsupported_event"))},n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"));break}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])}).finally(()=>{s&&this.removeMessageHandler(s)})}}function Fn(){return window}function Un(e){Fn().location.href=e}function Vn(){return"undefined"!==typeof Fn()["WorkerGlobalScope"]&&"function"===typeof Fn()["importScripts"]}async function qn(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{const e=await navigator.serviceWorker.ready;return e.active}catch(e){return null}}function Bn(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}function zn(){return Vn()?self:null}const Kn="firebaseLocalStorageDb",Wn=1,$n="firebaseLocalStorage",Gn="fbase_key";class Hn{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Qn(e,t){return e.transaction([$n],t?"readwrite":"readonly").objectStore($n)}function Yn(){const e=indexedDB.deleteDatabase(Kn);return new Hn(e).toPromise()}function Xn(){const e=indexedDB.open(Kn,Wn);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore($n,{keyPath:Gn})}catch(r){n(r)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains($n)?t(n):(n.close(),await Yn(),t(await Xn()))})})}async function Jn(e,t,n){const r=Qn(e,!0).put({[Gn]:t,value:n});return new Hn(r).toPromise()}async function Zn(e,t){const n=Qn(e,!1).get(t),r=await new Hn(n).toPromise();return void 0===r?null:r.value}function er(e,t){const n=Qn(e,!0).delete(t);return new Hn(n).toPromise()}const tr=800,nr=3;class rr{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Xn()),this.db}async _withRetries(e){let t=0;while(1)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>nr)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Vn()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Mn._getInstance(zn()),this.receiver._subscribe("keyChanged",async(e,t)=>{const n=await this._poll();return{keyProcessed:n.includes(t.key)}}),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await qn(),!this.activeServiceWorker)return;this.sender=new Ln(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&Bn()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Xn();return await Jn(e,kn,"1"),await er(e,kn),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>Jn(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>Zn(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>er(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=Qn(e,!1).getAll();return new Hn(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),tr)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}rr.type="LOCAL";const ir=rr;function sr(e,t){return U(e,"POST","/v2/accounts/mfaSignIn:start",F(e,t))}function or(e,t){return U(e,"POST","/v2/accounts/mfaSignIn:finalize",F(e,t))}async function ar(e){return(await U(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}function cr(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}function ur(e){return new Promise((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=_("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",cr().appendChild(r)})}function lr(e){return`__${e}${Math.floor(1e6*Math.random())}`}const hr=500,dr=6e4,fr=1e12;class pr{constructor(e){this.auth=e,this.counter=fr,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new gr(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||fr;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;const n=e||fr;return(null===(t=this._widgets.get(n))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;const n=e||fr;return null===(t=this._widgets.get(n))||void 0===t||t.execute(),""}}class gr{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"===typeof e?document.getElementById(e):e;I(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=mr(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(n){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(n){}this.isVisible&&this.execute()},dr)},hr))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function mr(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<e;r++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}const yr=lr("rcb"),_r=new x(3e4,6e4),vr="https://www.google.com/recaptcha/api.js?";class wr{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(e=Fn().grecaptcha)||void 0===e?void 0:e.render)}load(e,t=""){return I(br(t),e,"argument-error"),this.shouldResolveImmediately(t)?Promise.resolve(Fn().grecaptcha):new Promise((n,i)=>{const s=Fn().setTimeout(()=>{i(_(e,"network-request-failed"))},_r.get());Fn()[yr]=()=>{Fn().clearTimeout(s),delete Fn()[yr];const r=Fn().grecaptcha;if(!r)return void i(_(e,"internal-error"));const o=r.render;r.render=(e,t)=>{const n=o(e,t);return this.counter++,n},this.hostLanguage=t,n(r)};const o=`${vr}?${Object(r["Q"])({onload:yr,render:"explicit",hl:t})}`;ur(o).catch(()=>{clearTimeout(s),i(_(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(null===(t=Fn().grecaptcha)||void 0===t?void 0:t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function br(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}class Ir{async load(e){return new pr(e)}clearedOneInstance(){}}const Tr="recaptcha",Er={theme:"light",type:"image"};class kr{constructor(e,t=Object.assign({},Er),n){this.parameters=t,this.type=Tr,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=De(n),this.isInvisible="invisible"===this.parameters.size,I("undefined"!==typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"===typeof e?document.getElementById(e):e;I(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Ir:new wr,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),n=t.getResponse(e);return n||new Promise(n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){I(!this.parameters.sitekey,this.auth,"argument-error"),I(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),I("undefined"!==typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"===typeof e)e(t);else if("string"===typeof e){const n=Fn()[e];"function"===typeof n&&n(t)}}}assertNotDestroyed(){I(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){I(A()&&!Vn(),this.auth,"internal-error"),await Cr(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await ar(this.auth);I(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return I(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function Cr(){let e=null;return new Promise(t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()}).catch(t=>{throw e&&window.removeEventListener("load",e),t})}class Sr{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=ot._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function Or(e,t,n){const i=De(e),s=await Rr(i,t,Object(r["z"])(n));return new Sr(s,e=>Pt(i,e))}async function Ar(e,t,n){const i=Object(r["z"])(e);await Rt(!1,i,"phone");const s=await Rr(i.auth,t,Object(r["z"])(n));return new Sr(s,e=>Mt(i,e))}async function Nr(e,t,n){const i=Object(r["z"])(e),s=await Rr(i.auth,t,Object(r["z"])(n));return new Sr(s,e=>jt(i,e))}async function Rr(e,t,n){var r;const i=await n.verify();try{let s;if(I("string"===typeof i,e,"argument-error"),I(n.type===Tr,e,"argument-error"),s="string"===typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){I("enroll"===t.type,e,"internal-error");const n=await vn(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{I("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;I(n,e,"missing-multi-factor-info");const o=await sr(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await tt(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}async function Dr(e,t){await Nt(Object(r["z"])(e),t)}class xr{constructor(e){this.providerId=xr.PROVIDER_ID,this.auth=De(e)}verifyPhoneNumber(e,t){return Rr(this.auth,e,Object(r["z"])(t))}static credential(e,t){return ot._fromVerification(e,t)}static credentialFromResult(e){const t=e;return xr.credentialFromTaggedObject(t)}static credentialFromError(e){return xr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?ot._fromTokenResponse(t,n):null}}function Pr(e,t){return t?C(t):(I(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}xr.PROVIDER_ID="phone",xr.PHONE_SIGN_IN_METHOD="phone";class Mr extends Ue{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Je(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Je(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Je(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function jr(e){return xt(e.auth,new Mr(e),e.bypassAuthState)}function Lr(e){const{auth:t,user:n}=e;return I(n,t,"internal-error"),Dt(n,new Mr(e),e.bypassAuthState)}async function Fr(e){const{auth:t,user:n}=e;return I(n,t,"internal-error"),Nt(n,new Mr(e),e.bypassAuthState)}class Ur{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return jr;case"linkViaPopup":case"linkViaRedirect":return Fr;case"reauthViaPopup":case"reauthViaRedirect":return Lr;default:y(this.auth,"internal-error")}}resolve(e){E(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){E(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Vr=new x(2e3,1e4);async function qr(e,t,n){const r=De(e);w(e,t,ht);const i=Pr(r,n),s=new Kr(r,"signInViaPopup",t,i);return s.executeNotNull()}async function Br(e,t,n){const i=Object(r["z"])(e);w(i.auth,t,ht);const s=Pr(i.auth,n),o=new Kr(i.auth,"reauthViaPopup",t,s,i);return o.executeNotNull()}async function zr(e,t,n){const i=Object(r["z"])(e);w(i.auth,t,ht);const s=Pr(i.auth,n),o=new Kr(i.auth,"linkViaPopup",t,s,i);return o.executeNotNull()}class Kr extends Ur{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Kr.currentPopupAction&&Kr.currentPopupAction.cancel(),Kr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return I(e,this.auth,"internal-error"),e}async onExecution(){E(1===this.filter.length,"Popup operations only handle one event");const e=jn();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(_(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(_(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Kr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(_(this.auth,"popup-closed-by-user"))},2e3):this.pollId=window.setTimeout(e,Vr.get())};e()}}Kr.currentPopupAction=null;const Wr="pendingRedirect",$r=new Map;class Gr extends Ur{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=$r.get(this.auth._key());if(!e){try{const t=await Hr(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}$r.set(this.auth._key(),e)}return this.bypassAuthState||$r.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function Hr(e,t){const n=Zr(t),r=Jr(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}async function Qr(e,t){return Jr(e)._set(Zr(t),"true")}function Yr(){$r.clear()}function Xr(e,t){$r.set(e._key(),t)}function Jr(e){return C(e._redirectPersistence)}function Zr(e){return fe(Wr,e.config.apiKey,e.name)}function ei(e,t,n){return ti(e,t,n)}async function ti(e,t,n){const r=De(e);w(e,t,ht);const i=Pr(r,n);return await Qr(i,r),i._openRedirect(r,t,"signInViaRedirect")}function ni(e,t,n){return ri(e,t,n)}async function ri(e,t,n){const i=Object(r["z"])(e);w(i.auth,t,ht);const s=Pr(i.auth,n);await Qr(s,i.auth);const o=await ci(i);return s._openRedirect(i.auth,t,"reauthViaRedirect",o)}function ii(e,t,n){return si(e,t,n)}async function si(e,t,n){const i=Object(r["z"])(e);w(i.auth,t,ht);const s=Pr(i.auth,n);await Rt(!1,i,t.providerId),await Qr(s,i.auth);const o=await ci(i);return s._openRedirect(i.auth,t,"linkViaRedirect",o)}async function oi(e,t){return await De(e)._initializationPromise,ai(e,t,!1)}async function ai(e,t,n=!1){const r=De(e),i=Pr(r,t),s=new Gr(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}async function ci(e){const t=jn(e.uid+":::");return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}const ui=6e5;class li{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!fi(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!di(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(_(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=ui&&this.cachedEventUids.clear(),this.cachedEventUids.has(hi(e))}saveEventToCache(e){this.cachedEventUids.add(hi(e)),this.lastProcessedEventTime=Date.now()}}function hi(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function di({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null===t||void 0===t?void 0:t.code)}function fi(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return di(e);default:return!1}}async function pi(e,t={}){return U(e,"GET","/v1/projects",t)}const gi=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,mi=/^https?/;async function yi(e){if(e.config.emulator)return;const{authorizedDomains:t}=await pi(e);for(const r of t)try{if(_i(r))return}catch(n){}y(e,"unauthorized-domain")}function _i(e){const t=O(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!mi.test(n))return!1;if(gi.test(e))return r===e;const i=e.replace(/\./g,"\\."),s=new RegExp("^(.+\\."+i+"|"+i+")$","i");return s.test(r)}const vi=new x(3e4,6e4);function wi(){const e=Fn().___jsl;if(null===e||void 0===e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function bi(e){return new Promise((t,n)=>{var r,i,s;function o(){wi(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{wi(),n(_(e,"network-request-failed"))},timeout:vi.get()})}if(null===(i=null===(r=Fn().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=Fn().gapi)||void 0===s?void 0:s.load)){const t=lr("iframefcb");return Fn()[t]=()=>{gapi.load?o():n(_(e,"network-request-failed"))},ur("https://apis.google.com/js/api.js?onload="+t).catch(e=>n(e))}o()}}).catch(e=>{throw Ii=null,e})}let Ii=null;function Ti(e){return Ii=Ii||bi(e),Ii}const Ei=new x(5e3,15e3),ki="__/auth/iframe",Ci="emulator/auth/iframe",Si={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Oi=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Ai(e){const t=e.config;I(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?P(t,Ci):`https://${e.config.authDomain}/${ki}`,s={apiKey:t.apiKey,appName:e.name,v:i["SDK_VERSION"]},o=Oi.get(e.config.apiHost);o&&(s.eid=o);const a=e._getFrameworks();return a.length&&(s.fw=a.join(",")),`${n}?${Object(r["Q"])(s).slice(1)}`}async function Ni(e){const t=await Ti(e),n=Fn().gapi;return I(n,e,"internal-error"),t.open({where:document.body,url:Ai(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Si,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=_(e,"network-request-failed"),s=Fn().setTimeout(()=>{r(i)},Ei.get());function o(){Fn().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{r(i)})}))}const Ri={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Di=500,xi=600,Pi="_blank",Mi="http://localhost";class ji{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Li(e,t,n,i=Di,s=xi){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-i)/2,0).toString();let c="";const u=Object.assign(Object.assign({},Ri),{width:i.toString(),height:s.toString(),top:o,left:a}),l=Object(r["A"])().toLowerCase();n&&(c=_e(l)?Pi:n),me(l)&&(t=t||Mi,u.scrollbars="yes");const h=Object.entries(u).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(ke(l)&&"_self"!==c)return Fi(t||"",c),new ji(null);const d=window.open(t||"",c,h);I(d,e,"popup-blocked");try{d.focus()}catch(f){}return new ji(d)}function Fi(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}const Ui="__/auth/handler",Vi="emulator/auth/handler";function qi(e,t,n,s,o,a){I(e.config.authDomain,e,"auth-domain-config-required"),I(e.config.apiKey,e,"invalid-api-key");const c={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:s,v:i["SDK_VERSION"],eventId:o};if(t instanceof ht){t.setDefaultLanguage(e.languageCode),c.providerId=t.providerId||"",Object(r["E"])(t.getCustomParameters())||(c.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(a||{}))c[e]=t}if(t instanceof dt){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(c.scopes=e.join(","))}e.tenantId&&(c.tid=e.tenantId);const u=c;for(const r of Object.keys(u))void 0===u[r]&&delete u[r];return`${Bi(e)}?${Object(r["Q"])(u).slice(1)}`}function Bi({config:e}){return e.emulator?P(e,Vi):`https://${e.authDomain}/${Ui}`}const zi="webStorageSupport";class Ki{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=xn,this._completeRedirectFn=ai,this._overrideRedirectResult=Xr}async _openPopup(e,t,n,r){var i;E(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()");const s=qi(e,t,n,O(),r);return Li(e,s,jn())}async _openRedirect(e,t,n,r){return await this._originValidation(e),Un(qi(e,t,n,O(),r)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(E(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await Ni(e),n=new li(e);return t.register("authEvent",t=>{I(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");const r=n.onEvent(t.authEvent);return{status:r?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){const n=this.iframes[e._key()];n.send(zi,{type:zi},n=>{var r;const i=null===(r=null===n||void 0===n?void 0:n[0])||void 0===r?void 0:r[zi];void 0!==i&&t(!!i),y(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=yi(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Se()||ye()||Te()}}const Wi=Ki;class $i{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return T("unexpected MultiFactorSessionType")}}}class Gi extends $i{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Gi(e)}_finalizeEnroll(e,t,n){return wn(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return or(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class Hi{constructor(){}static assertion(e){return Gi._fromCredential(e)}}Hi.FACTOR_ID="phone";var Qi="@firebase/auth",Yi="0.20.11";class Xi{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;const t=await this.auth.currentUser.getIdToken(e);return{accessToken:t}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{var n;e((null===(n=t)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){I(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Ji(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function Zi(e){Object(i["_registerComponent"])(new a["a"]("auth",(t,{options:n})=>{const r=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),{apiKey:s,authDomain:o}=r.options;return((t,r)=>{I(s&&!s.includes(":"),"invalid-api-key",{appName:t.name}),I(!(null===o||void 0===o?void 0:o.includes(":")),"argument-error",{appName:t.name});const i={apiKey:s,authDomain:o,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ae(e)},a=new Re(t,r,i);return S(a,n),a})(r,i)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{const r=e.getProvider("auth-internal");r.initialize()})),Object(i["_registerComponent"])(new a["a"]("auth-internal",e=>{const t=De(e.getProvider("auth").getImmediate());return(e=>new Xi(e))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Object(i["registerVersion"])(Qi,Yi,Ji(e)),Object(i["registerVersion"])(Qi,Yi,"esm2017")}const es=300;Object(r["x"])("authIdTokenMaxAge");function ts(){return window}Zi("Browser");const ns=2e3;async function rs(e,t,n){var r;const{BuildInfo:i}=ts();E(t.sessionId,"AuthEvent did not contain a session ID");const s=await cs(t.sessionId),o={};return Te()?o["ibi"]=i.packageName:we()?o["apn"]=i.packageName:y(e,"operation-not-supported-in-this-environment"),i.displayName&&(o["appDisplayName"]=i.displayName),o["sessionId"]=s,qi(e,n,t.type,void 0,null!==(r=t.eventId)&&void 0!==r?r:void 0,o)}async function is(e){const{BuildInfo:t}=ts(),n={};Te()?n.iosBundleId=t.packageName:we()?n.androidPackageName=t.packageName:y(e,"operation-not-supported-in-this-environment"),await pi(e,n)}function ss(e){const{cordova:t}=ts();return new Promise(n=>{t.plugins.browsertab.isAvailable(r=>{let i=null;r?t.plugins.browsertab.openUrl(e):i=t.InAppBrowser.open(e,Ee()?"_blank":"_system","location=yes"),n(i)})})}async function os(e,t,n){const{cordova:r}=ts();let i=()=>{};try{await new Promise((s,o)=>{let a=null;function c(){var e;s();const t=null===(e=r.plugins.browsertab)||void 0===e?void 0:e.close;"function"===typeof t&&t(),"function"===typeof(null===n||void 0===n?void 0:n.close)&&n.close()}function u(){a||(a=window.setTimeout(()=>{o(_(e,"redirect-cancelled-by-user"))},ns))}function l(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&u()}t.addPassiveListener(c),document.addEventListener("resume",u,!1),we()&&document.addEventListener("visibilitychange",l,!1),i=()=>{t.removePassiveListener(c),document.removeEventListener("resume",u,!1),document.removeEventListener("visibilitychange",l,!1),a&&window.clearTimeout(a)}})}finally{i()}}function as(e){var t,n,r,i,s,o,a,c,u,l;const h=ts();I("function"===typeof(null===(t=null===h||void 0===h?void 0:h.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),I("undefined"!==typeof(null===(n=null===h||void 0===h?void 0:h.BuildInfo)||void 0===n?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),I("function"===typeof(null===(s=null===(i=null===(r=null===h||void 0===h?void 0:h.cordova)||void 0===r?void 0:r.plugins)||void 0===i?void 0:i.browsertab)||void 0===s?void 0:s.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),I("function"===typeof(null===(c=null===(a=null===(o=null===h||void 0===h?void 0:h.cordova)||void 0===o?void 0:o.plugins)||void 0===a?void 0:a.browsertab)||void 0===c?void 0:c.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),I("function"===typeof(null===(l=null===(u=null===h||void 0===h?void 0:h.cordova)||void 0===u?void 0:u.InAppBrowser)||void 0===l?void 0:l.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}async function cs(e){const t=us(e),n=await crypto.subtle.digest("SHA-256",t),r=Array.from(new Uint8Array(n));return r.map(e=>e.toString(16).padStart(2,"0")).join("")}function us(e){if(E(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!==typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}const ls=20;class hs extends li{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach(t=>t(e)),super.onEvent(e)}async initialized(){await this.initPromise}}function ds(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:ms(),postBody:null,tenantId:e.tenantId,error:_(e,"no-auth-event")}}function fs(e,t){return ys()._set(_s(e),t)}async function ps(e){const t=await ys()._get(_s(e));return t&&await ys()._remove(_s(e)),t}function gs(e,t){var n,r;const i=ws(t);if(i.includes("/__/auth/callback")){const t=bs(i),s=t["firebaseError"]?vs(decodeURIComponent(t["firebaseError"])):null,o=null===(r=null===(n=null===s||void 0===s?void 0:s["code"])||void 0===n?void 0:n.split("auth/"))||void 0===r?void 0:r[1],a=o?_(o):null;return a?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:i,postBody:null}}return null}function ms(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<ls;n++){const n=Math.floor(Math.random()*t.length);e.push(t.charAt(n))}return e.join("")}function ys(){return C(Rn)}function _s(e){return fe("authEvent",e.config.apiKey,e.name)}function vs(e){try{return JSON.parse(e)}catch(t){return null}}function ws(e){const t=bs(e),n=t["link"]?decodeURIComponent(t["link"]):void 0,r=bs(n)["link"],i=t["deep_link_id"]?decodeURIComponent(t["deep_link_id"]):void 0,s=bs(i)["link"];return s||i||r||n||e}function bs(e){if(!(null===e||void 0===e?void 0:e.includes("?")))return{};const[t,...n]=e.split("?");return Object(r["R"])(n.join("?"))}const Is=500;class Ts{constructor(){this._redirectPersistence=xn,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=ai,this._overrideRedirectResult=Xr}async _initialize(e){const t=e._key();let n=this.eventManagers.get(t);return n||(n=new hs(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){y(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){as(e);const i=await this._initialize(e);await i.initialized(),i.resetRedirect(),Yr(),await this._originValidation(e);const s=ds(e,n,r);await fs(e,s);const o=await rs(e,s,t),a=await ss(o);return os(e,i,a)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=is(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:n,handleOpenURL:r,BuildInfo:i}=ts(),s=setTimeout(async()=>{await ps(e),t.onEvent(ks())},Is),o=async n=>{clearTimeout(s);const r=await ps(e);let i=null;r&&(null===n||void 0===n?void 0:n["url"])&&(i=gs(r,n["url"])),t.onEvent(i||ks())};"undefined"!==typeof n&&"function"===typeof n.subscribe&&n.subscribe(null,o);const a=r,c=i.packageName.toLowerCase()+"://";ts().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&o({url:e}),"function"===typeof a)try{a(e)}catch(t){console.error(t)}}}}const Es=Ts;function ks(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:_("no-auth-event")}}function Cs(e,t){De(e)._logFramework(t)}},"1fd5":function(e,t,n){"use strict";(function(e,r){n.d(t,"a",(function(){return L})),n.d(t,"b",(function(){return q})),n.d(t,"c",(function(){return V})),n.d(t,"d",(function(){return se})),n.d(t,"e",(function(){return S})),n.d(t,"f",(function(){return s})),n.d(t,"g",(function(){return o})),n.d(t,"h",(function(){return u})),n.d(t,"i",(function(){return d})),n.d(t,"j",(function(){return l})),n.d(t,"k",(function(){return h})),n.d(t,"l",(function(){return be})),n.d(t,"m",(function(){return Y})),n.d(t,"n",(function(){return F})),n.d(t,"o",(function(){return oe})),n.d(t,"p",(function(){return f})),n.d(t,"q",(function(){return ee})),n.d(t,"r",(function(){return p})),n.d(t,"s",(function(){return he})),n.d(t,"t",(function(){return ie})),n.d(t,"u",(function(){return M})),n.d(t,"v",(function(){return x})),n.d(t,"w",(function(){return P})),n.d(t,"x",(function(){return j})),n.d(t,"y",(function(){return O})),n.d(t,"z",(function(){return Ie})),n.d(t,"A",(function(){return m})),n.d(t,"B",(function(){return Q})),n.d(t,"C",(function(){return v})),n.d(t,"D",(function(){return w})),n.d(t,"E",(function(){return J})),n.d(t,"F",(function(){return I})),n.d(t,"G",(function(){return k})),n.d(t,"H",(function(){return y})),n.d(t,"I",(function(){return _})),n.d(t,"J",(function(){return T})),n.d(t,"K",(function(){return b})),n.d(t,"L",(function(){return E})),n.d(t,"M",(function(){return H})),n.d(t,"N",(function(){return G})),n.d(t,"O",(function(){return K})),n.d(t,"P",(function(){return Z})),n.d(t,"Q",(function(){return ne})),n.d(t,"R",(function(){return re})),n.d(t,"S",(function(){return X})),n.d(t,"T",(function(){return ge})),n.d(t,"U",(function(){return pe})),n.d(t,"V",(function(){return W})),n.d(t,"W",(function(){return me})),n.d(t,"X",(function(){return le})),n.d(t,"Y",(function(){return de})),n.d(t,"Z",(function(){return fe})),n.d(t,"ab",(function(){return C}));const i={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},s=function(e,t){if(!e)throw o(t)},o=function(e){return new Error("Firebase Database ("+i.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},a=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},c=function(e){const t=[];let n=0,r=0;while(n<e.length){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=e[n++],o=e[n++],a=e[n++],c=((7&i)<<18|(63&s)<<12|(63&o)<<6|63&a)-65536;t[r++]=String.fromCharCode(55296+(c>>10)),t[r++]=String.fromCharCode(56320+(1023&c))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")},u={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],s=i+1<e.length,o=s?e[i+1]:0,a=i+2<e.length,c=a?e[i+2]:0,u=t>>2,l=(3&t)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(a(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):c(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],s=i<e.length,o=s?n[e.charAt(i)]:0;++i;const a=i<e.length,c=a?n[e.charAt(i)]:64;++i;const u=i<e.length,l=u?n[e.charAt(i)]:64;if(++i,null==t||null==o||null==c||null==l)throw Error();const h=t<<2|o>>4;if(r.push(h),64!==c){const e=o<<4&240|c>>2;if(r.push(e),64!==l){const e=c<<6&192|l;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},l=function(e){const t=a(e);return u.encodeByteArray(t,!0)},h=function(e){return l(e).replace(/\./g,"")},d=function(e){try{return u.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function f(e){return p(void 0,e)}function p(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:const n=t;return new Date(n.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&g(n)&&(e[n]=p(e[n],t[n]));return e}function g(e){return"__proto__"!==e}function m(){return"undefined"!==typeof navigator&&"string"===typeof navigator["userAgent"]?navigator["userAgent"]:""}function y(){return"undefined"!==typeof window&&!!(window["cordova"]||window["phonegap"]||window["PhoneGap"])&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(m())}function _(){try{return"[object process]"===Object.prototype.toString.call(e.process)}catch(t){return!1}}function v(){return"object"===typeof self&&self.self===self}function w(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}function b(){return"object"===typeof navigator&&"ReactNative"===navigator["product"]}function I(){const e=m();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function T(){return!0===i.NODE_CLIENT||!0===i.NODE_ADMIN}function E(){return!_()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function k(){return"object"===typeof indexedDB}function C(){return new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}})}function S(){return!("undefined"===typeof navigator||!navigator.cookieEnabled)}function O(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof e)return e;throw new Error("Unable to locate global object.")}const A=()=>O().__FIREBASE_DEFAULTS__,N=()=>{if("undefined"===typeof r)return;const e=Object({NODE_ENV:"production",VUE_APP_I18N_FALLBACK_LOCALE:"en-US",VUE_APP_I18N_LOCALE:"en-US",BASE_URL:"/"}).__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0},R=()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&d(e[1]);return t&&JSON.parse(t)},D=()=>{try{return A()||N()||R()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: "+e)}},x=e=>{var t,n;return null===(n=null===(t=D())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},P=e=>{const t=x(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},M=()=>{var e;return null===(e=D())||void 0===e?void 0:e.config},j=e=>{var t;return null===(t=D())||void 0===t?void 0:t["_"+e]};class L{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function F(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:"https://securetoken.google.com/"+r,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e),a="";return[h(JSON.stringify(n)),h(JSON.stringify(o)),a].join(".")}const U="FirebaseError";class V extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=U,Object.setPrototypeOf(this,V.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,q.prototype.create)}}class q{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?B(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`,a=new V(r,o,n);return a}}function B(e,t){return e.replace(z,(e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`})}const z=/\{\$([^}]+)}/g;function K(e){return JSON.parse(e)}function W(e){return JSON.stringify(e)}const $=function(e){let t={},n={},r={},i="";try{const s=e.split(".");t=K(d(s[0])||""),n=K(d(s[1])||""),i=s[2],r=n["d"]||{},delete n["d"]}catch(s){}return{header:t,claims:n,data:r,signature:i}},G=function(e){const t=$(e).claims;return"object"===typeof t&&t.hasOwnProperty("iat")?t["iat"]:null},H=function(e){const t=$(e),n=t.claims;return!!n&&"object"===typeof n&&n.hasOwnProperty("iat")},Q=function(e){const t=$(e).claims;return"object"===typeof t&&!0===t["admin"]};function Y(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function X(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function J(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Z(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function ee(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(te(n)&&te(s)){if(!ee(n,s))return!1}else if(n!==s)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function te(e){return null!==e&&"object"===typeof e}function ne(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function re(e){const t={},n=e.replace(/^\?/,"").split("&");return n.forEach(e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function ie(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class se{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"===typeof e)for(let l=0;l<16;l++)n[l]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let l=0;l<16;l++)n[l]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let l=16;l<80;l++){const e=n[l-3]^n[l-8]^n[l-14]^n[l-16];n[l]=4294967295&(e<<1|e>>>31)}let r,i,s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],u=this.chain_[4];for(let l=0;l<80;l++){l<40?l<20?(r=c^o&(a^c),i=1518500249):(r=o^a^c,i=1859775393):l<60?(r=o&a|c&(o|a),i=2400959708):(r=o^a^c,i=3395469782);const e=(s<<5|s>>>27)+r+u+i+n[l]&4294967295;u=c,c=a,a=4294967295&(o<<30|o>>>2),o=s,s=e}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+u&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let r=0;const i=this.buf_;let s=this.inbuf_;while(r<t){if(0===s)while(r<=n)this.compress_(e,r),r+=this.blockSize;if("string"===typeof e){while(r<t)if(i[s]=e.charCodeAt(r),++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}else while(r<t)if(i[s]=e[r],++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let r=0;r<5;r++)for(let t=24;t>=0;t-=8)e[n]=this.chain_[r]>>t&255,++n;return e}}function oe(e,t){const n=new ae(e,t);return n.subscribe.bind(n)}class ae{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=ce(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=ue),void 0===r.error&&(r.error=ue),void 0===r.complete&&(r.complete=ue);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!==typeof console&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ce(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}function ue(){}const le=function(e,t,n,r){let i;if(r<t?i="at least "+t:r>n&&(i=0===n?"none":"no more than "+n),i){const t=e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".";throw new Error(t)}};function he(e,t){return`${e} failed: ${t} argument `}function de(e,t,n,r){if((!r||n)&&"function"!==typeof n)throw new Error(he(e,t)+"must be a valid function.")}function fe(e,t,n,r){if((!r||n)&&("object"!==typeof n||null===n))throw new Error(he(e,t)+"must be a valid context object.")}const pe=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){const t=i-55296;r++,s(r<e.length,"Surrogate pair missing trail surrogate.");const n=e.charCodeAt(r)-56320;i=65536+(t<<10)+n}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},ge=function(e){let t=0;for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t},me=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})},ye=1e3,_e=2,ve=144e5,we=.5;function be(e,t=ye,n=_e){const r=t*Math.pow(n,e),i=Math.round(we*r*(Math.random()-.5)*2);return Math.min(ve,r+i)}function Ie(e){return e&&e._delegate?e._delegate:e}}).call(this,n("c8ba"),n("4362"))},"22e5":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return o}));var r=n("1fd5");class i{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const s="[DEFAULT]";class o{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new r["a"];if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(c(e))try{this.getOrInitializeService({instanceIdentifier:s})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});n.resolve(e)}catch(t){}}}}clearInstance(e=s){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=s){return this.instances.has(e)}getOptions(e=s){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,s]of this.instancesDeferred.entries()){const e=this.normalizeInstanceIdentifier(i);n===e&&s.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(r){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:a(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(r){}return n||null}normalizeInstanceIdentifier(e=s){return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function a(e){return e===s?void 0:e}function c(e){return"EAGER"===e.instantiationMode}class u{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){const t=this.getProvider(e.name);t.isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new o(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},"51b0":function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return da})),n.d(t,"b",(function(){return fa})),n.d(t,"c",(function(){return Fn})),n.d(t,"d",(function(){return ya})),n.d(t,"e",(function(){return dc})),n.d(t,"f",(function(){return l})),n.d(t,"g",(function(){return ho})),n.d(t,"h",(function(){return po})),n.d(t,"i",(function(){return ba})),n.d(t,"j",(function(){return vc})),n.d(t,"k",(function(){return Ic})),n.d(t,"l",(function(){return Va})),n.d(t,"m",(function(){return Ba})),n.d(t,"n",(function(){return oc})),n.d(t,"o",(function(){return _c})),n.d(t,"p",(function(){return yc})),n.d(t,"q",(function(){return Oa})),n.d(t,"r",(function(){return wc})),n.d(t,"s",(function(){return bc})),n.d(t,"t",(function(){return Cc})),n.d(t,"u",(function(){return Ha})),n.d(t,"v",(function(){return Ya})),n.d(t,"w",(function(){return La})),n.d(t,"x",(function(){return xa})),n.d(t,"y",(function(){return Pa})),n.d(t,"z",(function(){return Ma})),n.d(t,"A",(function(){return ja})),n.d(t,"B",(function(){return Da})),n.d(t,"C",(function(){return Ja})),n.d(t,"D",(function(){return ec})),n.d(t,"E",(function(){return nc})),n.d(t,"F",(function(){return ic})),n.d(t,"G",(function(){return Ia})),n.d(t,"H",(function(){return ac})),n.d(t,"I",(function(){return va})),n.d(t,"J",(function(){return wa})),n.d(t,"K",(function(){return Ta})),n.d(t,"L",(function(){return Oc})),n.d(t,"M",(function(){return kc})),n.d(t,"N",(function(){return Ea})),n.d(t,"O",(function(){return ka})),n.d(t,"P",(function(){return Ca})),n.d(t,"Q",(function(){return $a})),n.d(t,"R",(function(){return Ka})),n.d(t,"S",(function(){return Sa}));var r=n("589b"),i=n("22e5"),s=n("1fd5"),o=n("e691");const a="@firebase/database",c="0.13.10";let u="";function l(e){u=e}class h{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Object(s["V"])(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Object(s["O"])(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class d{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return Object(s["m"])(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const f=function(e){try{if("undefined"!==typeof window&&"undefined"!==typeof window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new h(t)}}catch(t){}return new d},p=f("localStorage"),g=f("sessionStorage"),m=new o["b"]("@firebase/database"),y=function(){let e=1;return function(){return e++}}(),_=function(e){const t=Object(s["U"])(e),n=new s["d"];n.update(t);const r=n.digest();return s["h"].encodeByteArray(r)},v=function(...e){let t="";for(let n=0;n<e.length;n++){const r=e[n];Array.isArray(r)||r&&"object"===typeof r&&"number"===typeof r.length?t+=v.apply(null,r):t+="object"===typeof r?Object(s["V"])(r):r,t+=" "}return t};let w=null,b=!0;const I=function(e,t){Object(s["f"])(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(m.logLevel=o["a"].VERBOSE,w=m.log.bind(m),t&&g.set("logging_enabled",!0)):"function"===typeof e?w=e:(w=null,g.remove("logging_enabled"))},T=function(...e){if(!0===b&&(b=!1,null===w&&!0===g.get("logging_enabled")&&I(!0)),w){const t=v.apply(null,e);w(t)}},E=function(e){return function(...t){T(e,...t)}},k=function(...e){const t="FIREBASE INTERNAL ERROR: "+v(...e);m.error(t)},C=function(...e){const t="FIREBASE FATAL ERROR: "+v(...e);throw m.error(t),new Error(t)},S=function(...e){const t="FIREBASE WARNING: "+v(...e);m.warn(t)},O=function(){"undefined"!==typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&S("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},A=function(e){return"number"===typeof e&&(e!==e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},N=function(e){if(Object(s["J"])()||"complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},R="[MIN_NAME]",D="[MAX_NAME]",x=function(e,t){if(e===t)return 0;if(e===R||t===D)return-1;if(t===R||e===D)return 1;{const n=$(e),r=$(t);return null!==n?null!==r?n-r===0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1}},P=function(e,t){return e===t?0:e<t?-1:1},M=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Object(s["V"])(t))},j=function(e){if("object"!==typeof e||null===e)return Object(s["V"])(e);const t=[];for(const r in e)t.push(r);t.sort();let n="{";for(let r=0;r<t.length;r++)0!==r&&(n+=","),n+=Object(s["V"])(t[r]),n+=":",n+=j(e[t[r]]);return n+="}",n},L=function(e,t){const n=e.length;if(n<=t)return[e];const r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function F(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const U=function(e){Object(s["f"])(!A(e),"Invalid JSON number");const t=11,n=52,r=(1<<t-1)-1;let i,o,a,c,u;0===e?(o=0,a=0,i=1/e===-1/0?1:0):(i=e<0,e=Math.abs(e),e>=Math.pow(2,1-r)?(c=Math.min(Math.floor(Math.log(e)/Math.LN2),r),o=c+r,a=Math.round(e*Math.pow(2,n-c)-Math.pow(2,n))):(o=0,a=Math.round(e/Math.pow(2,1-r-n))));const l=[];for(u=n;u;u-=1)l.push(a%2?1:0),a=Math.floor(a/2);for(u=t;u;u-=1)l.push(o%2?1:0),o=Math.floor(o/2);l.push(i?1:0),l.reverse();const h=l.join("");let d="";for(u=0;u<64;u+=8){let e=parseInt(h.substr(u,8),2).toString(16);1===e.length&&(e="0"+e),d+=e}return d.toLowerCase()},V=function(){return!("object"!==typeof window||!window["chrome"]||!window["chrome"]["extension"]||/^chrome/.test(window.location.href))},q=function(){return"object"===typeof Windows&&"object"===typeof Windows.UI};function B(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}const z=new RegExp("^-?(0*)\\d{1,10}$"),K=-2147483648,W=2147483647,$=function(e){if(z.test(e)){const t=Number(e);if(t>=K&&t<=W)return t}return null},G=function(e){try{e()}catch(t){setTimeout(()=>{const e=t.stack||"";throw S("Exception was thrown by user callback.",e),t},Math.floor(0))}},H=function(){const e="object"===typeof window&&window["navigator"]&&window["navigator"]["userAgent"]||"";return e.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Q=function(e,t){const n=setTimeout(e,t);return"number"===typeof n&&"undefined"!==typeof Deno&&Deno["unrefTimer"]?Deno.unrefTimer(n):"object"===typeof n&&n["unref"]&&n["unref"](),n};class Y{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null===t||void 0===t?void 0:t.getImmediate({optional:!0}),this.appCheck||null===t||void 0===t||t.get().then(e=>this.appCheck=e)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){S(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class X{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(T("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',S(e)}}class J{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}J.OWNER="owner";const Z="5",ee="v",te="s",ne="r",re="f",ie=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,se="ls",oe="p",ae="ac",ce="websocket",ue="long_polling";class le{constructor(e,t,n,r,i=!1,s="",o=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=p.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&p.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns="+this.namespace:"";return`${e}${this.host}/${t}`}}function he(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams}function de(e,t,n){let r;if(Object(s["f"])("string"===typeof t,"typeof type must == string"),Object(s["f"])("object"===typeof n,"typeof params must == object"),t===ce)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==ue)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}he(e)&&(n["ns"]=e.namespace);const i=[];return F(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class fe{constructor(){this.counters_={}}incrementCounter(e,t=1){Object(s["m"])(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Object(s["p"])(this.counters_)}}const pe={},ge={};function me(e){const t=e.toString();return pe[t]||(pe[t]=new fe),pe[t]}function ye(e,t){const n=e.toString();return ge[n]||(ge[n]=t()),ge[n]}class _e{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){this.pendingResponses[e]=t;while(this.pendingResponses[this.currentResponseNum]){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&G(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const ve="start",we="close",be="pLPCommand",Ie="pRTLPCB",Te="id",Ee="pw",ke="ser",Ce="cb",Se="seg",Oe="ts",Ae="d",Ne="dframe",Re=1870,De=30,xe=Re-De,Pe=25e3,Me=3e4;class je{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=E(e),this.stats_=me(t),this.urlFn=e=>(this.appCheckToken&&(e[ae]=this.appCheckToken),de(t,ue,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new _e(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Me)),N(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Le((...e)=>{const[t,n,r,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===ve)this.id=n,this.password=r;else{if(t!==we)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);const e={};e[ve]="t",e[ke]=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e[Ce]=this.scriptTagHolder.uniqueCallbackIdentifier),e[ee]=Z,this.transportSessionId&&(e[te]=this.transportSessionId),this.lastSessionId&&(e[se]=this.lastSessionId),this.applicationId&&(e[oe]=this.applicationId),this.appCheckToken&&(e[ae]=this.appCheckToken),"undefined"!==typeof location&&location.hostname&&ie.test(location.hostname)&&(e[ne]=re);const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){je.forceAllow_=!0}static forceDisallow(){je.forceDisallow_=!0}static isAvailable(){return!Object(s["J"])()&&(!!je.forceAllow_||!je.forceDisallow_&&"undefined"!==typeof document&&null!=document.createElement&&!V()&&!q())}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Object(s["V"])(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=Object(s["j"])(t),r=L(n,xe);for(let i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Object(s["J"])())return;this.myDisconnFrame=document.createElement("iframe");const n={};n[Ne]="t",n[Te]=e,n[Ee]=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Object(s["V"])(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Le{constructor(e,t,n,r){if(this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,Object(s["J"])())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=y(),window[be+this.uniqueCallbackIdentifier]=e,window[Ie+this.uniqueCallbackIdentifier]=t,this.myIFrame=Le.createIFrame_();let n="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)){const e=document.domain;n='<script>document.domain="'+e+'";<\/script>'}const r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(i){T("frame writing exception"),i.stack&&T(i.stack),T(i)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{const t=e.contentWindow.document;t||T("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){this.myID=e,this.myPW=t,this.alive=!0;while(this.newRequest_());}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[Te]=this.myID,e[Ee]=this.myPW,e[ke]=this.currentSerial;let t=this.urlFn(e),n="",r=0;while(this.pendingSegs.length>0){const e=this.pendingSegs[0];if(!(e.d.length+De+n.length<=Re))break;{const e=this.pendingSegs.shift();n=n+"&"+Se+r+"="+e.seg+"&"+Oe+r+"="+e.ts+"&"+Ae+r+"="+e.d,r++}}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(Pe)),i=()=>{clearTimeout(r),n()};this.addTag(e,i)}addTag(e,t){Object(s["J"])()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{T("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(n){}},Math.floor(1))}}const Fe=16384,Ue=45e3;let Ve=null;"undefined"!==typeof MozWebSocket?Ve=MozWebSocket:"undefined"!==typeof WebSocket&&(Ve=WebSocket);class qe{constructor(e,t,n,r,i,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=E(this.connId),this.stats_=me(t),this.connURL=qe.connectionURL_(t,s,o,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){const o={};return o[ee]=Z,!Object(s["J"])()&&"undefined"!==typeof location&&location.hostname&&ie.test(location.hostname)&&(o[ne]=re),t&&(o[te]=t),n&&(o[se]=n),r&&(o[ae]=r),i&&(o[oe]=i),de(e,ce,o)}open(t,n){this.onDisconnect=n,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,p.set("previous_websocket_failure",!0);try{let t;if(Object(s["J"])()){const n=this.nodeAdmin?"AdminNode":"Node";t={headers:{"User-Agent":`Firebase/${Z}/${u}/${e.platform}/${n}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(t.headers["Authorization"]="Bearer "+this.authToken),this.appCheckToken&&(t.headers["X-Firebase-AppCheck"]=this.appCheckToken);const r=Object({NODE_ENV:"production",VUE_APP_I18N_FALLBACK_LOCALE:"en-US",VUE_APP_I18N_LOCALE:"en-US",BASE_URL:"/"}),i=0===this.connURL.indexOf("wss://")?r["HTTPS_PROXY"]||r["https_proxy"]:r["HTTP_PROXY"]||r["http_proxy"];i&&(t["proxy"]={origin:i})}this.mySock=new Ve(this.connURL,[],t)}catch(r){this.log_("Error instantiating WebSocket.");const e=r.message||r.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){qe.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!==typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==Ve&&!qe.forceDisallow_}static previouslyFailed(){return p.isInMemoryStorage||!0===p.get("previous_websocket_failure")}markConnectionHealthy(){p.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=Object(s["O"])(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Object(s["f"])(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e["data"];if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=Object(s["V"])(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=L(t,Fe);n.length>1&&this.sendString_(String(n.length));for(let r=0;r<n.length;r++)this.sendString_(n[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Ue))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}qe.responsesRequiredToBeHealthy=2,qe.healthyTimeout=3e4;class Be{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[je,qe]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=qe&&qe["isAvailable"]();let n=t&&!qe.previouslyFailed();if(e.webSocketOnly&&(t||S("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[qe];else{const e=this.transports_=[];for(const t of Be.ALL_TRANSPORTS)t&&t["isAvailable"]()&&e.push(t);Be.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Be.globalTransportInitialized_=!1;const ze=6e4,Ke=5e3,We=10240,$e=102400,Ge="t",He="d",Qe="s",Ye="r",Xe="e",Je="o",Ze="a",et="n",tt="p",nt="h";class rt{constructor(e,t,n,r,i,s,o,a,c,u){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=E("c:"+this.id+":"),this.transportManager_=new Be(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e["responsesRequiredToBeHealthy"]||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));const r=e["healthyTimeout"]||0;r>0&&(this.healthyTimeout_=Q(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>$e?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>We?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Ge in e){const t=e[Ge];t===Ze?this.upgradeIfSecondaryHealthy_():t===Ye?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):t===Je&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=M("t",e),n=M("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:tt,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Ze,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:et,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=M("t",e),n=M("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=M(Ge,e);if(He in e){const n=e[He];if(t===nt)this.onHandshake_(n);else if(t===et){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===Qe?this.onConnectionShutdown_(n):t===Ye?this.onReset_(n):t===Xe?k("Server Error: "+n):t===Je?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):k("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Z!==n&&S("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e["responsesRequiredToBeHealthy"]||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),Q(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(ze))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Q(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Ke))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:tt,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(p.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class it{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class st{constructor(e){this.allowedEvents_=e,this.listeners_={},Object(s["f"])(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}validateEventType_(e){Object(s["f"])(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class ot extends st{constructor(){super(["online"]),this.online_=!0,"undefined"===typeof window||"undefined"===typeof window.addEventListener||Object(s["H"])()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new ot}getInitialEvent(e){return Object(s["f"])("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const at=32,ct=768;class ut{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function lt(){return new ut("")}function ht(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function dt(e){return e.pieces_.length-e.pieceNum_}function ft(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new ut(e.pieces_,t)}function pt(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function gt(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}function mt(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function yt(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new ut(t,0)}function _t(e,t){const n=[];for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof ut)for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new ut(n,0)}function vt(e){return e.pieceNum_>=e.pieces_.length}function wt(e,t){const n=ht(e),r=ht(t);if(null===n)return t;if(n===r)return wt(ft(e),ft(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function bt(e,t){const n=mt(e,0),r=mt(t,0);for(let i=0;i<n.length&&i<r.length;i++){const e=x(n[i],r[i]);if(0!==e)return e}return n.length===r.length?0:n.length<r.length?-1:1}function It(e,t){if(dt(e)!==dt(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function Tt(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(dt(e)>dt(t))return!1;while(n<e.pieces_.length){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class Et{constructor(e,t){this.errorPrefix_=t,this.parts_=mt(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=Object(s["T"])(this.parts_[n]);St(this)}}function kt(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=Object(s["T"])(t),St(e)}function Ct(e){const t=e.parts_.pop();e.byteLength_-=Object(s["T"])(t),e.parts_.length>0&&(e.byteLength_-=1)}function St(e){if(e.byteLength_>ct)throw new Error(e.errorPrefix_+"has a key path longer than "+ct+" bytes ("+e.byteLength_+").");if(e.parts_.length>at)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+at+") or object contains a cycle "+Ot(e))}function Ot(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class At extends st{constructor(){let e,t;super(["visible"]),"undefined"!==typeof document&&"undefined"!==typeof document.addEventListener&&("undefined"!==typeof document["hidden"]?(t="visibilitychange",e="hidden"):"undefined"!==typeof document["mozHidden"]?(t="mozvisibilitychange",e="mozHidden"):"undefined"!==typeof document["msHidden"]?(t="msvisibilitychange",e="msHidden"):"undefined"!==typeof document["webkitHidden"]&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}static getInstance(){return new At}getInitialEvent(e){return Object(s["f"])("visible"===e,"Unknown event type: "+e),[this.visible_]}}const Nt=1e3,Rt=3e5,Dt=3e4,xt=1.3,Pt=3e4,Mt="server_kill",jt=3;class Lt extends it{constructor(e,t,n,r,i,o,a,c){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=Lt.nextPersistentConnectionId_++,this.log_=E("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Nt,this.maxReconnectDelay_=Rt,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!Object(s["J"])())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");At.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&ot.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(Object(s["V"])(i)),Object(s["f"])(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const t=new s["a"],n={p:e._path.toString(),q:e._queryObject},r={action:"g",request:n,onComplete:e=>{const n=e["d"];"ok"===e["s"]?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,r){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),Object(s["f"])(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Object(s["f"])(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){const t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);const i={p:n},s="q";e.tag&&(i["q"]=t._queryObject,i["t"]=e.tag),i["h"]=e.hashFn(),this.sendRequest(s,i,i=>{const s=i["d"],o=i["s"];Lt.warnOnListenWarnings_(s,t);const a=this.listens.get(n)&&this.listens.get(n).get(r);a===e&&(this.log_("listen response",i),"ok"!==o&&this.removeListen_(n,r),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"===typeof e&&Object(s["m"])(e,"w")){const n=Object(s["S"])(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();S(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at `+n+" to your security rules for better performance.")}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){const t=e&&40===e.length;(t||Object(s["B"])(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Dt)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=Object(s["M"])(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n["noauth"]=!0:"object"===typeof this.authOverride_&&(n["authvar"]=this.authOverride_),this.sendRequest(t,n,t=>{const n=t["s"],r=t["d"]||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e["s"],n=e["d"]||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),Object(s["f"])(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");const i=this.removeListen_(n,r);i&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e},s="n";r&&(i["q"]=n,i["t"]=r),this.sendRequest(s,i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){const i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e["s"],e["d"])},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s["h"]=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n["s"],n["d"])})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{const t=e["s"];if("ok"!==t){const t=e["d"];this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Object(s["V"])(e));const t=e["r"],n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e["b"]))}else{if("error"in e)throw"A server-side error has occurred: "+e["error"];"a"in e&&this.onDataPush_(e["a"],e["b"])}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t["p"],t["d"],!1,t["t"]):"m"===e?this.onDataUpdate_(t["p"],t["d"],!0,t["t"]):"c"===e?this.onListenRevoked_(t["p"],t["q"]):"ac"===e?this.onAuthRevoked_(t["s"],t["d"]):"apc"===e?this.onAppCheckRevoked_(t["s"],t["d"]):"sd"===e?this.onSecurityDebugPacket_(t):k("Unrecognized action received from server: "+Object(s["V"])(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Object(s["f"])(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Nt,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Nt,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){const e=(new Date).getTime()-this.lastConnectionEstablishedTime_;e>Pt&&(this.reconnectDelay_=Nt),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*xt)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+Lt.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,n())},u=function(e){Object(s["f"])(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(e)};this.realtime_={close:c,sendRequest:u};const l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[s,c]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);o?T("getToken() completed but was canceled"):(T("getToken() completed. Creating connection."),this.authToken_=s&&s.accessToken,this.appCheckToken_=c&&c.token,a=new rt(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,e=>{S(e+" ("+this.repoInfo_.toString()+")"),this.interrupt(Mt)},i))}catch(k){this.log_("Failed to get token: "+k),o||(this.repoInfo_.nodeAdmin&&S(k),c())}}}interrupt(e){T("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){T("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Object(s["E"])(this.interruptReasons_)&&(this.reconnectDelay_=Nt,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>j(e)).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const n=new ut(e).toString();let r;if(this.listens.has(n)){const e=this.listens.get(n);r=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){T("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=jt&&(this.reconnectDelay_=Dt,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){T("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=jt&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e["msg"].replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);while(this.onDisconnectRequestQueue_.length){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";Object(s["J"])()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+u.replace(/\./g,"-")]=1,Object(s["H"])()?e["framework.cordova"]=1:Object(s["K"])()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=ot.getInstance().currentlyOnline();return Object(s["E"])(this.interruptReasons_)&&e}}Lt.nextPersistentConnectionId_=0,Lt.nextConnectionId_=0;class Ft{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Ft(e,t)}}class Ut{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new Ft(R,e),r=new Ft(R,t);return 0!==this.compare(n,r)}minPost(){return Ft.MIN}}let Vt;class qt extends Ut{static get __EMPTY_NODE(){return Vt}static set __EMPTY_NODE(e){Vt=e}compare(e,t){return x(e.name,t.name)}isDefinedOn(e){throw Object(s["g"])("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Ft.MIN}maxPost(){return new Ft(D,Vt)}makePost(e,t){return Object(s["f"])("string"===typeof e,"KeyIndex indexValue must always be a string."),new Ft(e,Vt)}toString(){return".key"}}const Bt=new qt;class zt{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;while(!e.isEmpty())if(e=e,s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_){t=t.left;while(!t.isEmpty())this.nodeStack_.push(t),t=t.right}else{t=t.right;while(!t.isEmpty())this.nodeStack_.push(t),t=t.left}return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Kt{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Kt.RED,this.left=null!=r?r:$t.EMPTY_NODE,this.right=null!=i?i:$t.EMPTY_NODE}copy(e,t,n,r,i){return new Kt(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return $t.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return $t.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Kt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Kt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Kt.RED=!0,Kt.BLACK=!1;class Wt{copy(e,t,n,r,i){return this}insert(e,t,n){return new Kt(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class $t{constructor(e,t=$t.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new $t(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Kt.BLACK,null,null))}remove(e){return new $t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Kt.BLACK,null,null))}get(e){let t,n=this.root_;while(!n.isEmpty()){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;while(!n.isEmpty()){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return r?r.key:null;n=n.left;while(!n.right.isEmpty())n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new zt(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new zt(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new zt(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new zt(this.root_,null,this.comparator_,!0,e)}}function Gt(e,t){return x(e.name,t.name)}function Ht(e,t){return x(e,t)}let Qt;function Yt(e){Qt=e}$t.EMPTY_NODE=new Wt;const Xt=function(e){return"number"===typeof e?"number:"+U(e):"string:"+e},Jt=function(e){if(e.isLeafNode()){const t=e.val();Object(s["f"])("string"===typeof t||"number"===typeof t||"object"===typeof t&&Object(s["m"])(t,".sv"),"Priority must be a string or number.")}else Object(s["f"])(e===Qt||e.isEmpty(),"priority of unexpected type.");Object(s["f"])(e===Qt||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Zt,en,tn;class nn{constructor(e,t=nn.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Object(s["f"])(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Jt(this.priorityNode_)}static set __childrenNodeConstructor(e){Zt=e}static get __childrenNodeConstructor(){return Zt}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new nn(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:nn.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return vt(e)?this:".priority"===ht(e)?this.priorityNode_:nn.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:nn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=ht(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(Object(s["f"])(".priority"!==n||1===dt(e),".priority must be the last token in a path"),this.updateImmediateChild(n,nn.__childrenNodeConstructor.EMPTY_NODE.updateChild(ft(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Xt(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?U(this.value_):this.value_,this.lazyHash_=_(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===nn.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof nn.__childrenNodeConstructor?-1:(Object(s["f"])(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,r=nn.VALUE_TYPE_ORDER.indexOf(t),i=nn.VALUE_TYPE_ORDER.indexOf(n);return Object(s["f"])(r>=0,"Unknown leaf type: "+t),Object(s["f"])(i>=0,"Unknown leaf type: "+n),r===i?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}function rn(e){en=e}function sn(e){tn=e}nn.VALUE_TYPE_ORDER=["object","boolean","number","string"];class on extends Ut{compare(e,t){const n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?x(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Ft.MIN}maxPost(){return new Ft(D,new nn("[PRIORITY-POST]",tn))}makePost(e,t){const n=en(e);return new Ft(t,new nn("[PRIORITY-POST]",n))}toString(){return".priority"}}const an=new on,cn=Math.log(2);class un{constructor(e){const t=e=>parseInt(Math.log(e)/cn,10),n=e=>parseInt(Array(e+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const r=n(this.count);this.bits_=e+1&r}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const ln=function(e,t,n,r){e.sort(t);const i=function(t,r){const s=r-t;let o,a;if(0===s)return null;if(1===s)return o=e[t],a=n?n(o):o,new Kt(a,o.node,Kt.BLACK,null,null);{const c=parseInt(s/2,10)+t,u=i(t,c),l=i(c+1,r);return o=e[c],a=n?n(o):o,new Kt(a,o.node,Kt.BLACK,u,l)}},s=function(t){let r=null,s=null,o=e.length;const a=function(t,r){const s=o-t,a=o;o-=t;const u=i(s+1,a),l=e[s],h=n?n(l):l;c(new Kt(h,l.node,r,null,u))},c=function(e){r?(r.left=e,r=e):(s=e,r=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),r=Math.pow(2,t.count-(e+1));n?a(r,Kt.BLACK):(a(r,Kt.BLACK),a(r,Kt.RED))}return s},o=new un(e.length),a=s(o);return new $t(r||t,a)};let hn;const dn={};class fn{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return Object(s["f"])(dn&&an,"ChildrenNode.ts has not been loaded"),hn=hn||new fn({".priority":dn},{".priority":an}),hn}get(e){const t=Object(s["S"])(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof $t?t:null}hasIndex(e){return Object(s["m"])(this.indexSet_,e.toString())}addIndex(e,t){Object(s["f"])(e!==Bt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(Ft.Wrap);let o,a=i.getNext();while(a)r=r||e.isDefinedOn(a.node),n.push(a),a=i.getNext();o=r?ln(n,e.getCompare()):dn;const c=e.toString(),u=Object.assign({},this.indexSet_);u[c]=e;const l=Object.assign({},this.indexes_);return l[c]=o,new fn(l,u)}addToIndexes(e,t){const n=Object(s["P"])(this.indexes_,(n,r)=>{const i=Object(s["S"])(this.indexSet_,r);if(Object(s["f"])(i,"Missing index implementation for "+r),n===dn){if(i.isDefinedOn(e.node)){const n=[],r=t.getIterator(Ft.Wrap);let s=r.getNext();while(s)s.name!==e.name&&n.push(s),s=r.getNext();return n.push(e),ln(n,i.getCompare())}return dn}{const r=t.get(e.name);let i=n;return r&&(i=i.remove(new Ft(e.name,r))),i.insert(e,e.node)}});return new fn(n,this.indexSet_)}removeFromIndexes(e,t){const n=Object(s["P"])(this.indexes_,n=>{if(n===dn)return n;{const r=t.get(e.name);return r?n.remove(new Ft(e.name,r)):n}});return new fn(n,this.indexSet_)}}let pn;class gn{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Jt(this.priorityNode_),this.children_.isEmpty()&&Object(s["f"])(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return pn||(pn=new gn(new $t(Ht),null,fn.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||pn}updatePriority(e){return this.children_.isEmpty()?this:new gn(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?pn:t}}getChild(e){const t=ht(e);return null===t?this:this.getImmediateChild(t).getChild(ft(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(Object(s["f"])(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new Ft(e,t);let r,i;t.isEmpty()?(r=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(n,this.children_));const s=r.isEmpty()?pn:this.priorityNode_;return new gn(r,s,i)}}updateChild(e,t){const n=ht(e);if(null===n)return t;{Object(s["f"])(".priority"!==ht(e)||1===dt(e),".priority must be the last token in a path");const r=this.getImmediateChild(n).updateChild(ft(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,r=0,i=!0;if(this.forEachChild(an,(s,o)=>{t[s]=o.val(e),n++,i&&gn.INTEGER_REGEXP_.test(s)?r=Math.max(r,Number(s)):i=!1}),!e&&i&&r<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+Xt(this.getPriority().val())+":"),this.forEachChild(an,(t,n)=>{const r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":_(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){const n=r.getPredecessorKey(new Ft(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Ft(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Ft(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{const n=this.children_.getIteratorFrom(e.name,Ft.Wrap);let r=n.peek();while(null!=r&&t.compare(r,e)<0)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{const n=this.children_.getReverseIteratorFrom(e.name,Ft.Wrap);let r=n.peek();while(null!=r&&t.compare(r,e)>0)n.getNext(),r=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===yn?-1:0}withIndex(e){if(e===Bt||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new gn(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Bt||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(an),n=t.getIterator(an);let r=e.getNext(),i=n.getNext();while(r&&i){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=e.getNext(),i=n.getNext()}return null===r&&null===i}return!1}return!1}}resolveIndex_(e){return e===Bt?null:this.indexMap_.get(e.toString())}}gn.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class mn extends gn{constructor(){super(new $t(Ht),gn.EMPTY_NODE,fn.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return gn.EMPTY_NODE}isEmpty(){return!1}}const yn=new mn;Object.defineProperties(Ft,{MIN:{value:new Ft(R,gn.EMPTY_NODE)},MAX:{value:new Ft(D,yn)}}),qt.__EMPTY_NODE=gn.EMPTY_NODE,nn.__childrenNodeConstructor=gn,Yt(yn),sn(yn);const _n=!0;function vn(e,t=null){if(null===e)return gn.EMPTY_NODE;if("object"===typeof e&&".priority"in e&&(t=e[".priority"]),Object(s["f"])(null===t||"string"===typeof t||"number"===typeof t||"object"===typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"===typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!==typeof e||".sv"in e){const n=e;return new nn(n,vn(t))}if(e instanceof Array||!_n){let n=gn.EMPTY_NODE;return F(e,(t,r)=>{if(Object(s["m"])(e,t)&&"."!==t.substring(0,1)){const e=vn(r);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}}),n.updatePriority(vn(t))}{const n=[];let r=!1;const i=e;if(F(i,(e,t)=>{if("."!==e.substring(0,1)){const i=vn(t);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new Ft(e,i)))}}),0===n.length)return gn.EMPTY_NODE;const s=ln(n,Gt,e=>e.name,Ht);if(r){const e=ln(n,an.getCompare());return new gn(s,vn(t),new fn({".priority":e},{".priority":an}))}return new gn(s,vn(t),fn.Default)}}rn(vn);class wn extends Ut{constructor(e){super(),this.indexPath_=e,Object(s["f"])(!vt(e)&&".priority"!==ht(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?x(e.name,t.name):i}makePost(e,t){const n=vn(e),r=gn.EMPTY_NODE.updateChild(this.indexPath_,n);return new Ft(t,r)}maxPost(){const e=gn.EMPTY_NODE.updateChild(this.indexPath_,yn);return new Ft(D,e)}toString(){return mt(this.indexPath_,0).join("/")}}class bn extends Ut{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?x(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Ft.MIN}maxPost(){return Ft.MAX}makePost(e,t){const n=vn(e);return new Ft(t,n)}toString(){return".value"}}const In=new bn,Tn="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",En="-",kn="z",Cn=786,Sn=function(){let e=0;const t=[];return function(n){const r=n===e;let i;e=n;const o=new Array(8);for(i=7;i>=0;i--)o[i]=Tn.charAt(n%64),n=Math.floor(n/64);Object(s["f"])(0===n,"Cannot push at time == 0");let a=o.join("");if(r){for(i=11;i>=0&&63===t[i];i--)t[i]=0;t[i]++}else for(i=0;i<12;i++)t[i]=Math.floor(64*Math.random());for(i=0;i<12;i++)a+=Tn.charAt(t[i]);return Object(s["f"])(20===a.length,"nextPushId: Length should be 20."),a}}(),On=function(e){if(e===""+W)return En;const t=$(e);if(null!=t)return""+(t+1);const n=new Array(e.length);for(let o=0;o<n.length;o++)n[o]=e.charAt(o);if(n.length<Cn)return n.push(En),n.join("");let r=n.length-1;while(r>=0&&n[r]===kn)r--;if(-1===r)return D;const i=n[r],s=Tn.charAt(Tn.indexOf(i)+1);return n[r]=s,n.slice(0,r+1).join("")},An=function(e){if(e===""+K)return R;const t=$(e);if(null!=t)return""+(t-1);const n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e.charAt(r);return n[n.length-1]===En?1===n.length?""+W:(delete n[n.length-1],n.join("")):(n[n.length-1]=Tn.charAt(Tn.indexOf(n[n.length-1])-1),n.join("")+kn.repeat(Cn-n.length))};function Nn(e){return{type:"value",snapshotNode:e}}function Rn(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Dn(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function xn(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}function Pn(e,t){return{type:"child_moved",snapshotNode:t,childName:e}}class Mn{constructor(e){this.index_=e}updateChild(e,t,n,r,i,o){Object(s["f"])(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(Dn(t,a)):Object(s["f"])(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Rn(t,n)):o.trackChildChange(xn(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(an,(e,r)=>{t.hasChild(e)||n.trackChildChange(Dn(e,r))}),t.isLeafNode()||t.forEachChild(an,(t,r)=>{if(e.hasChild(t)){const i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(xn(t,r,i))}else n.trackChildChange(Rn(t,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?gn.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class jn{constructor(e){this.indexedFilter_=new Mn(e.getIndex()),this.index_=e.getIndex(),this.startPost_=jn.getStartPost_(e),this.endPost_=jn.getEndPost_(e)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0}updateChild(e,t,n,r,i,s){return this.matches(new Ft(t,n))||(n=gn.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=gn.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(gn.EMPTY_NODE);const i=this;return t.forEachChild(an,(e,t)=>{i.matches(new Ft(e,t))||(r=r.updateImmediateChild(e,gn.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class Ln{constructor(e){this.rangedFilter_=new jn(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}updateChild(e,t,n,r,i,s){return this.rangedFilter_.matches(new Ft(t,n))||(n=gn.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=gn.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;r=gn.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;while(e.hasNext()&&n<this.limit_){const t=e.getNext();let i;if(i=this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),t)<=0:this.index_.compare(t,this.rangedFilter_.getEndPost())<=0,!i)break;r=r.updateImmediateChild(t.name,t.node),n++}}else{let e,n,i,s;if(r=t.withIndex(this.index_),r=r.updatePriority(gn.EMPTY_NODE),this.reverse_){s=r.getReverseIterator(this.index_),e=this.rangedFilter_.getEndPost(),n=this.rangedFilter_.getStartPost();const t=this.index_.getCompare();i=(e,n)=>t(n,e)}else s=r.getIterator(this.index_),e=this.rangedFilter_.getStartPost(),n=this.rangedFilter_.getEndPost(),i=this.index_.getCompare();let o=0,a=!1;while(s.hasNext()){const t=s.getNext();!a&&i(e,t)<=0&&(a=!0);const c=a&&o<this.limit_&&i(t,n)<=0;c?o++:r=r.updateImmediateChild(t.name,gn.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let o;if(this.reverse_){const e=this.index_.getCompare();o=(t,n)=>e(n,t)}else o=this.index_.getCompare();const a=e;Object(s["f"])(a.numChildren()===this.limit_,"");const c=new Ft(t,n),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),l=this.rangedFilter_.matches(c);if(a.hasChild(t)){const e=a.getImmediateChild(t);let s=r.getChildAfterChild(this.index_,u,this.reverse_);while(null!=s&&(s.name===t||a.hasChild(s.name)))s=r.getChildAfterChild(this.index_,s,this.reverse_);const h=null==s?1:o(s,c),d=l&&!n.isEmpty()&&h>=0;if(d)return null!=i&&i.trackChildChange(xn(t,n,e)),a.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(Dn(t,e));const n=a.updateImmediateChild(t,gn.EMPTY_NODE),r=null!=s&&this.rangedFilter_.matches(s);return r?(null!=i&&i.trackChildChange(Rn(s.name,s.node)),n.updateImmediateChild(s.name,s.node)):n}}return n.isEmpty()?e:l&&o(u,c)>=0?(null!=i&&(i.trackChildChange(Dn(u.name,u.node)),i.trackChildChange(Rn(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(u.name,gn.EMPTY_NODE)):e}}class Fn{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=an}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return Object(s["f"])(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Object(s["f"])(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:R}hasEnd(){return this.endSet_}getIndexEndValue(){return Object(s["f"])(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Object(s["f"])(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:D}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return Object(s["f"])(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===an}copy(){const e=new Fn;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Un(e){return e.loadsAllData()?new Mn(e.getIndex()):e.hasLimit()?new Ln(e):new jn(e)}function Vn(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}function qn(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}function Bn(e,t,n){const r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function zn(e,t,n){let r;if(e.index_===Bt)"string"===typeof t&&(t=On(t)),r=Bn(e,t,n);else{let i;i=null==n?D:On(n),r=Bn(e,t,i)}return r.startAfterSet_=!0,r}function Kn(e,t,n){const r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function Wn(e,t,n){let r,i;return e.index_===Bt?("string"===typeof t&&(t=An(t)),i=Kn(e,t,n)):(r=null==n?R:An(n),i=Kn(e,t,r)),i.endBeforeSet_=!0,i}function $n(e,t){const n=e.copy();return n.index_=t,n}function Gn(e){const t={};if(e.isDefault())return t;let n;return e.index_===an?n="$priority":e.index_===In?n="$value":e.index_===Bt?n="$key":(Object(s["f"])(e.index_ instanceof wn,"Unrecognized index type!"),n=e.index_.toString()),t["orderBy"]=Object(s["V"])(n),e.startSet_&&(t["startAt"]=Object(s["V"])(e.indexStartValue_),e.startNameSet_&&(t["startAt"]+=","+Object(s["V"])(e.indexStartName_))),e.endSet_&&(t["endAt"]=Object(s["V"])(e.indexEndValue_),e.endNameSet_&&(t["endAt"]+=","+Object(s["V"])(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?t["limitToFirst"]=e.limit_:t["limitToLast"]=e.limit_),t}function Hn(e){const t={};if(e.startSet_&&(t["sp"]=e.indexStartValue_,e.startNameSet_&&(t["sn"]=e.indexStartName_)),e.endSet_&&(t["ep"]=e.indexEndValue_,e.endNameSet_&&(t["en"]=e.indexEndName_)),e.limitSet_){t["l"]=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t["vf"]=n}return e.index_!==an&&(t["i"]=e.index_.toString()),t}class Qn extends it{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=E("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(Object(s["f"])(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,r){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=Qn.getListenId_(e,n),a={};this.listens_[o]=a;const c=Gn(e._queryParams);this.restRequest_(i+".json",c,(e,t)=>{let c=t;if(404===e&&(c=null,e=null),null===e&&this.onDataUpdate_(i,c,!1,n),Object(s["S"])(this.listens_,o)===a){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",r(t,null)}})}unlisten(e,t){const n=Qn.getListenId_(e,t);delete this.listens_[n]}get(e){const t=Gn(e._queryParams),n=e._path.toString(),r=new s["a"];return this.restRequest_(n+".json",t,(e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(new Error(i))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t["format"]="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(t["auth"]=r.accessToken),i&&i.token&&(t["ac"]=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Object(s["Q"])(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(n&&4===a.readyState){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let t=null;if(a.status>=200&&a.status<300){try{t=Object(s["O"])(a.responseText)}catch(e){S("Failed to parse JSON response for "+o+": "+a.responseText)}n(null,t)}else 401!==a.status&&404!==a.status&&S("Got unsuccessful REST response for "+o+" Status: "+a.status),n(a.status);n=null}},a.open("GET",o,!0),a.send()})}}class Yn{constructor(){this.rootNode_=gn.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Xn(){return{value:null,children:new Map}}function Jn(e,t,n){if(vt(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const r=ht(t);e.children.has(r)||e.children.set(r,Xn());const i=e.children.get(r);t=ft(t),Jn(i,t,n)}}function Zn(e,t){if(vt(t))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;{const n=e.value;return e.value=null,n.forEachChild(an,(t,n)=>{Jn(e,new ut(t),n)}),Zn(e,t)}}if(e.children.size>0){const n=ht(t);if(t=ft(t),e.children.has(n)){const r=Zn(e.children.get(n),t);r&&e.children.delete(n)}return 0===e.children.size}return!0}function er(e,t,n){null!==e.value?n(t,e.value):tr(e,(e,r)=>{const i=new ut(t.toString()+"/"+e);er(r,i,n)})}function tr(e,t){e.children.forEach((e,n)=>{t(n,e)})}class nr{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&F(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}const rr=1e4,ir=3e4,sr=3e5;class or{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new nr(e);const n=rr+(ir-rr)*Math.random();Q(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;F(e,(e,r)=>{r>0&&Object(s["m"])(this.statsToReport_,e)&&(t[e]=r,n=!0)}),n&&this.server_.reportStats(t),Q(this.reportStats_.bind(this),Math.floor(2*Math.random()*sr))}}var ar;function cr(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function ur(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function lr(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(function(e){e[e["OVERWRITE"]=0]="OVERWRITE",e[e["MERGE"]=1]="MERGE",e[e["ACK_USER_WRITE"]=2]="ACK_USER_WRITE",e[e["LISTEN_COMPLETE"]=3]="LISTEN_COMPLETE"})(ar||(ar={}));class hr{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=ar.ACK_USER_WRITE,this.source=cr()}operationForChild(e){if(vt(this.path)){if(null!=this.affectedTree.value)return Object(s["f"])(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new ut(e));return new hr(lt(),t,this.revert)}}return Object(s["f"])(ht(this.path)===e,"operationForChild called for unrelated child."),new hr(ft(this.path),this.affectedTree,this.revert)}}class dr{constructor(e,t){this.source=e,this.path=t,this.type=ar.LISTEN_COMPLETE}operationForChild(e){return vt(this.path)?new dr(this.source,lt()):new dr(this.source,ft(this.path))}}class fr{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=ar.OVERWRITE}operationForChild(e){return vt(this.path)?new fr(this.source,lt(),this.snap.getImmediateChild(e)):new fr(this.source,ft(this.path),this.snap)}}class pr{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=ar.MERGE}operationForChild(e){if(vt(this.path)){const t=this.children.subtree(new ut(e));return t.isEmpty()?null:t.value?new fr(this.source,lt(),t.value):new pr(this.source,lt(),t)}return Object(s["f"])(ht(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new pr(this.source,ft(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class gr{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(vt(e))return this.isFullyInitialized()&&!this.filtered_;const t=ht(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class mr{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function yr(e,t,n,r){const i=[],s=[];return t.forEach(t=>{"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push(Pn(t.childName,t.snapshotNode))}),_r(e,i,"child_removed",t,r,n),_r(e,i,"child_added",t,r,n),_r(e,i,"child_moved",s,r,n),_r(e,i,"child_changed",t,r,n),_r(e,i,"value",t,r,n),i}function _r(e,t,n,r,i,s){const o=r.filter(e=>e.type===n);o.sort((t,n)=>wr(e,t,n)),o.forEach(n=>{const r=vr(e,n,s);i.forEach(i=>{i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))})})}function vr(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}function wr(e,t,n){if(null==t.childName||null==n.childName)throw Object(s["g"])("Should only compare child_ events.");const r=new Ft(t.childName,t.snapshotNode),i=new Ft(n.childName,n.snapshotNode);return e.index_.compare(r,i)}function br(e,t){return{eventCache:e,serverCache:t}}function Ir(e,t,n,r){return br(new gr(t,n,r),e.serverCache)}function Tr(e,t,n,r){return br(e.eventCache,new gr(t,n,r))}function Er(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function kr(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Cr;const Sr=()=>(Cr||(Cr=new $t(P)),Cr);class Or{constructor(e,t=Sr()){this.value=e,this.children=t}static fromObject(e){let t=new Or(null);return F(e,(e,n)=>{t=t.set(new ut(e),n)}),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:lt(),value:this.value};if(vt(e))return null;{const n=ht(e),r=this.children.get(n);if(null!==r){const i=r.findRootMostMatchingPathAndValue(ft(e),t);if(null!=i){const e=_t(new ut(n),i.path);return{path:e,value:i.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(vt(e))return this;{const t=ht(e),n=this.children.get(t);return null!==n?n.subtree(ft(e)):new Or(null)}}set(e,t){if(vt(e))return new Or(t,this.children);{const n=ht(e),r=this.children.get(n)||new Or(null),i=r.set(ft(e),t),s=this.children.insert(n,i);return new Or(this.value,s)}}remove(e){if(vt(e))return this.children.isEmpty()?new Or(null):new Or(null,this.children);{const t=ht(e),n=this.children.get(t);if(n){const r=n.remove(ft(e));let i;return i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty()?new Or(null):new Or(this.value,i)}return this}}get(e){if(vt(e))return this.value;{const t=ht(e),n=this.children.get(t);return n?n.get(ft(e)):null}}setTree(e,t){if(vt(e))return t;{const n=ht(e),r=this.children.get(n)||new Or(null),i=r.setTree(ft(e),t);let s;return s=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new Or(this.value,s)}}fold(e){return this.fold_(lt(),e)}fold_(e,t){const n={};return this.children.inorderTraversal((r,i)=>{n[r]=i.fold_(_t(e,r),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,lt(),t)}findOnPath_(e,t,n){const r=!!this.value&&n(t,this.value);if(r)return r;if(vt(e))return null;{const r=ht(e),i=this.children.get(r);return i?i.findOnPath_(ft(e),_t(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,lt(),t)}foreachOnPath_(e,t,n){if(vt(e))return this;{this.value&&n(t,this.value);const r=ht(e),i=this.children.get(r);return i?i.foreachOnPath_(ft(e),_t(t,r),n):new Or(null)}}foreach(e){this.foreach_(lt(),e)}foreach_(e,t){this.children.inorderTraversal((n,r)=>{r.foreach_(_t(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class Ar{constructor(e){this.writeTree_=e}static empty(){return new Ar(new Or(null))}}function Nr(e,t,n){if(vt(t))return new Ar(new Or(n));{const r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){const i=r.path;let s=r.value;const o=wt(i,t);return s=s.updateChild(o,n),new Ar(e.writeTree_.set(i,s))}{const r=new Or(n),i=e.writeTree_.setTree(t,r);return new Ar(i)}}}function Rr(e,t,n){let r=e;return F(n,(e,n)=>{r=Nr(r,_t(t,e),n)}),r}function Dr(e,t){if(vt(t))return Ar.empty();{const n=e.writeTree_.setTree(t,new Or(null));return new Ar(n)}}function xr(e,t){return null!=Pr(e,t)}function Pr(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(wt(n.path,t)):null}function Mr(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(an,(e,n)=>{t.push(new Ft(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new Ft(e,n.value))}),t}function jr(e,t){if(vt(t))return e;{const n=Pr(e,t);return new Ar(null!=n?new Or(n):e.writeTree_.subtree(t))}}function Lr(e){return e.writeTree_.isEmpty()}function Fr(e,t){return Ur(lt(),e.writeTree_,t)}function Ur(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal((t,i)=>{".priority"===t?(Object(s["f"])(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=Ur(_t(e,t),i,n)}),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(_t(e,".priority"),r)),n}}function Vr(e,t){return ui(t,e)}function qr(e,t,n,r,i){Object(s["f"])(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:i}),i&&(e.visibleWrites=Nr(e.visibleWrites,t,n)),e.lastWriteId=r}function Br(e,t,n,r){Object(s["f"])(r>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:t,children:n,writeId:r,visible:!0}),e.visibleWrites=Rr(e.visibleWrites,t,n),e.lastWriteId=r}function zr(e,t){for(let n=0;n<e.allWrites.length;n++){const r=e.allWrites[n];if(r.writeId===t)return r}return null}function Kr(e,t){const n=e.allWrites.findIndex(e=>e.writeId===t);Object(s["f"])(n>=0,"removeWrite called with nonexistent writeId.");const r=e.allWrites[n];e.allWrites.splice(n,1);let i=r.visible,o=!1,a=e.allWrites.length-1;while(i&&a>=0){const t=e.allWrites[a];t.visible&&(a>=n&&Wr(t,r.path)?i=!1:Tt(r.path,t.path)&&(o=!0)),a--}if(i){if(o)return $r(e),!0;if(r.snap)e.visibleWrites=Dr(e.visibleWrites,r.path);else{const t=r.children;F(t,t=>{e.visibleWrites=Dr(e.visibleWrites,_t(r.path,t))})}return!0}return!1}function Wr(e,t){if(e.snap)return Tt(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&Tt(_t(e.path,n),t))return!0;return!1}function $r(e){e.visibleWrites=Hr(e.allWrites,Gr,lt()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}function Gr(e){return e.visible}function Hr(e,t,n){let r=Ar.empty();for(let i=0;i<e.length;++i){const o=e[i];if(t(o)){const e=o.path;let t;if(o.snap)Tt(n,e)?(t=wt(n,e),r=Nr(r,t,o.snap)):Tt(e,n)&&(t=wt(e,n),r=Nr(r,lt(),o.snap.getChild(t)));else{if(!o.children)throw Object(s["g"])("WriteRecord should have .snap or .children");if(Tt(n,e))t=wt(n,e),r=Rr(r,t,o.children);else if(Tt(e,n))if(t=wt(e,n),vt(t))r=Rr(r,lt(),o.children);else{const e=Object(s["S"])(o.children,ht(t));if(e){const n=e.getChild(ft(t));r=Nr(r,lt(),n)}}}}}return r}function Qr(e,t,n,r,i){if(r||i){const s=jr(e.visibleWrites,t);if(!i&&Lr(s))return n;if(i||null!=n||xr(s,lt())){const s=function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(Tt(e.path,t)||Tt(t,e.path))},o=Hr(e.allWrites,s,t),a=n||gn.EMPTY_NODE;return Fr(o,a)}return null}{const r=Pr(e.visibleWrites,t);if(null!=r)return r;{const r=jr(e.visibleWrites,t);if(Lr(r))return n;if(null!=n||xr(r,lt())){const e=n||gn.EMPTY_NODE;return Fr(r,e)}return null}}}function Yr(e,t,n){let r=gn.EMPTY_NODE;const i=Pr(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(an,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(n){const i=jr(e.visibleWrites,t);return n.forEachChild(an,(e,t)=>{const n=Fr(jr(i,new ut(e)),t);r=r.updateImmediateChild(e,n)}),Mr(i).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}{const n=jr(e.visibleWrites,t);return Mr(n).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}}function Xr(e,t,n,r,i){Object(s["f"])(r||i,"Either existingEventSnap or existingServerSnap must exist");const o=_t(t,n);if(xr(e.visibleWrites,o))return null;{const t=jr(e.visibleWrites,o);return Lr(t)?i.getChild(n):Fr(t,i.getChild(n))}}function Jr(e,t,n,r){const i=_t(t,n),s=Pr(e.visibleWrites,i);if(null!=s)return s;if(r.isCompleteForChild(n)){const t=jr(e.visibleWrites,i);return Fr(t,r.getNode().getImmediateChild(n))}return null}function Zr(e,t){return Pr(e.visibleWrites,t)}function ei(e,t,n,r,i,s,o){let a;const c=jr(e.visibleWrites,t),u=Pr(c,lt());if(null!=u)a=u;else{if(null==n)return[];a=Fr(c,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let c=n.getNext();while(c&&e.length<i)0!==t(c,r)&&e.push(c),c=n.getNext();return e}}function ti(){return{visibleWrites:Ar.empty(),allWrites:[],lastWriteId:-1}}function ni(e,t,n,r){return Qr(e.writeTree,e.treePath,t,n,r)}function ri(e,t){return Yr(e.writeTree,e.treePath,t)}function ii(e,t,n,r){return Xr(e.writeTree,e.treePath,t,n,r)}function si(e,t){return Zr(e.writeTree,_t(e.treePath,t))}function oi(e,t,n,r,i,s){return ei(e.writeTree,e.treePath,t,n,r,i,s)}function ai(e,t,n){return Jr(e.writeTree,e.treePath,t,n)}function ci(e,t){return ui(_t(e.treePath,t),e.writeTree)}function ui(e,t){return{treePath:e,writeTree:t}}class li{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;Object(s["f"])("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),Object(s["f"])(".priority"!==n,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(n);if(r){const i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,xn(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,Dn(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,Rn(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw Object(s["g"])("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,xn(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}class hi{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}}const di=new hi;class fi{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new gr(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return ai(this.writes_,e,t)}}getChildAfterChild(e,t,n){const r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:kr(this.viewCache_),i=oi(this.writes_,r,t,1,n,e);return 0===i.length?null:i[0]}}function pi(e){return{filter:e}}function gi(e,t){Object(s["f"])(t.eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),Object(s["f"])(t.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed")}function mi(e,t,n,r,i){const o=new li;let a,c;if(n.type===ar.OVERWRITE){const u=n;u.source.fromUser?a=wi(e,t,u.path,u.snap,r,i,o):(Object(s["f"])(u.source.fromServer,"Unknown source."),c=u.source.tagged||t.serverCache.isFiltered()&&!vt(u.path),a=vi(e,t,u.path,u.snap,r,i,c,o))}else if(n.type===ar.MERGE){const u=n;u.source.fromUser?a=Ii(e,t,u.path,u.children,r,i,o):(Object(s["f"])(u.source.fromServer,"Unknown source."),c=u.source.tagged||t.serverCache.isFiltered(),a=Ei(e,t,u.path,u.children,r,i,c,o))}else if(n.type===ar.ACK_USER_WRITE){const s=n;a=s.revert?Si(e,t,s.path,r,i,o):ki(e,t,s.path,s.affectedTree,r,i,o)}else{if(n.type!==ar.LISTEN_COMPLETE)throw Object(s["g"])("Unknown operation type: "+n.type);a=Ci(e,t,n.path,r,o)}const u=o.getChanges();return yi(t,a,u),{viewCache:a,changes:u}}function yi(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=Er(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(Nn(Er(t)))}}function _i(e,t,n,r,i,o){const a=t.eventCache;if(null!=si(r,n))return t;{let c,u;if(vt(n))if(Object(s["f"])(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=kr(t),i=n instanceof gn?n:gn.EMPTY_NODE,s=ri(r,i);c=e.filter.updateFullNode(t.eventCache.getNode(),s,o)}else{const n=ni(r,kr(t));c=e.filter.updateFullNode(t.eventCache.getNode(),n,o)}else{const l=ht(n);if(".priority"===l){Object(s["f"])(1===dt(n),"Can't have a priority with additional path components");const i=a.getNode();u=t.serverCache.getNode();const o=ii(r,n,i,u);c=null!=o?e.filter.updatePriority(i,o):a.getNode()}else{const s=ft(n);let h;if(a.isCompleteForChild(l)){u=t.serverCache.getNode();const e=ii(r,n,a.getNode(),u);h=null!=e?a.getNode().getImmediateChild(l).updateChild(s,e):a.getNode().getImmediateChild(l)}else h=ai(r,l,t.serverCache);c=null!=h?e.filter.updateChild(a.getNode(),l,h,s,i,o):a.getNode()}}return Ir(t,c,a.isFullyInitialized()||vt(n),e.filter.filtersNodes())}}function vi(e,t,n,r,i,s,o,a){const c=t.serverCache;let u;const l=o?e.filter:e.filter.getIndexedFilter();if(vt(n))u=l.updateFullNode(c.getNode(),r,null);else if(l.filtersNodes()&&!c.isFiltered()){const e=c.getNode().updateChild(n,r);u=l.updateFullNode(c.getNode(),e,null)}else{const e=ht(n);if(!c.isCompleteForPath(n)&&dt(n)>1)return t;const i=ft(n),s=c.getNode().getImmediateChild(e),o=s.updateChild(i,r);u=".priority"===e?l.updatePriority(c.getNode(),o):l.updateChild(c.getNode(),e,o,i,di,null)}const h=Tr(t,u,c.isFullyInitialized()||vt(n),l.filtersNodes()),d=new fi(i,h,s);return _i(e,h,n,i,d,a)}function wi(e,t,n,r,i,s,o){const a=t.eventCache;let c,u;const l=new fi(i,t,s);if(vt(n))u=e.filter.updateFullNode(t.eventCache.getNode(),r,o),c=Ir(t,u,!0,e.filter.filtersNodes());else{const i=ht(n);if(".priority"===i)u=e.filter.updatePriority(t.eventCache.getNode(),r),c=Ir(t,u,a.isFullyInitialized(),a.isFiltered());else{const s=ft(n),u=a.getNode().getImmediateChild(i);let h;if(vt(s))h=r;else{const e=l.getCompleteChild(i);h=null!=e?".priority"===pt(s)&&e.getChild(yt(s)).isEmpty()?e:e.updateChild(s,r):gn.EMPTY_NODE}if(u.equals(h))c=t;else{const n=e.filter.updateChild(a.getNode(),i,h,s,l,o);c=Ir(t,n,a.isFullyInitialized(),e.filter.filtersNodes())}}}return c}function bi(e,t){return e.eventCache.isCompleteForChild(t)}function Ii(e,t,n,r,i,s,o){let a=t;return r.foreach((r,c)=>{const u=_t(n,r);bi(t,ht(u))&&(a=wi(e,a,u,c,i,s,o))}),r.foreach((r,c)=>{const u=_t(n,r);bi(t,ht(u))||(a=wi(e,a,u,c,i,s,o))}),a}function Ti(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function Ei(e,t,n,r,i,s,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let c,u=t;c=vt(n)?r:new Or(null).setTree(n,r);const l=t.serverCache.getNode();return c.children.inorderTraversal((n,r)=>{if(l.hasChild(n)){const c=t.serverCache.getNode().getImmediateChild(n),l=Ti(e,c,r);u=vi(e,u,new ut(n),l,i,s,o,a)}}),c.children.inorderTraversal((n,r)=>{const c=!t.serverCache.isCompleteForChild(n)&&null===r.value;if(!l.hasChild(n)&&!c){const c=t.serverCache.getNode().getImmediateChild(n),l=Ti(e,c,r);u=vi(e,u,new ut(n),l,i,s,o,a)}}),u}function ki(e,t,n,r,i,s,o){if(null!=si(i,n))return t;const a=t.serverCache.isFiltered(),c=t.serverCache;if(null!=r.value){if(vt(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return vi(e,t,n,c.getNode().getChild(n),i,s,a,o);if(vt(n)){let r=new Or(null);return c.getNode().forEachChild(Bt,(e,t)=>{r=r.set(new ut(e),t)}),Ei(e,t,n,r,i,s,a,o)}return t}{let u=new Or(null);return r.foreach((e,t)=>{const r=_t(n,e);c.isCompleteForPath(r)&&(u=u.set(e,c.getNode().getChild(r)))}),Ei(e,t,n,u,i,s,a,o)}}function Ci(e,t,n,r,i){const s=t.serverCache,o=Tr(t,s.getNode(),s.isFullyInitialized()||vt(n),s.isFiltered());return _i(e,o,n,r,di,i)}function Si(e,t,n,r,i,o){let a;if(null!=si(r,n))return t;{const c=new fi(r,t,i),u=t.eventCache.getNode();let l;if(vt(n)||".priority"===ht(n)){let n;if(t.serverCache.isFullyInitialized())n=ni(r,kr(t));else{const e=t.serverCache.getNode();Object(s["f"])(e instanceof gn,"serverChildren would be complete if leaf node"),n=ri(r,e)}n=n,l=e.filter.updateFullNode(u,n,o)}else{const i=ht(n);let s=ai(r,i,t.serverCache);null==s&&t.serverCache.isCompleteForChild(i)&&(s=u.getImmediateChild(i)),l=null!=s?e.filter.updateChild(u,i,s,ft(n),c,o):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(u,i,gn.EMPTY_NODE,ft(n),c,o):u,l.isEmpty()&&t.serverCache.isFullyInitialized()&&(a=ni(r,kr(t)),a.isLeafNode()&&(l=e.filter.updateFullNode(l,a,o)))}return a=t.serverCache.isFullyInitialized()||null!=si(r,lt()),Ir(t,l,a,e.filter.filtersNodes())}}class Oi{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new Mn(n.getIndex()),i=Un(n);this.processor_=pi(i);const s=t.serverCache,o=t.eventCache,a=r.updateFullNode(gn.EMPTY_NODE,s.getNode(),null),c=i.updateFullNode(gn.EMPTY_NODE,o.getNode(),null),u=new gr(a,s.isFullyInitialized(),r.filtersNodes()),l=new gr(c,o.isFullyInitialized(),i.filtersNodes());this.viewCache_=br(l,u),this.eventGenerator_=new mr(this.query_)}get query(){return this.query_}}function Ai(e){return e.viewCache_.serverCache.getNode()}function Ni(e){return Er(e.viewCache_)}function Ri(e,t){const n=kr(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!vt(t)&&!n.getImmediateChild(ht(t)).isEmpty())?n.getChild(t):null}function Di(e){return 0===e.eventRegistrations_.length}function xi(e,t){e.eventRegistrations_.push(t)}function Pi(e,t,n){const r=[];if(n){Object(s["f"])(null==t,"A cancel should cancel all event registrations.");const i=e.query._path;e.eventRegistrations_.forEach(e=>{const t=e.createCancelEvent(n,i);t&&r.push(t)})}if(t){let n=[];for(let r=0;r<e.eventRegistrations_.length;++r){const i=e.eventRegistrations_[r];if(i.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(r+1));break}}else n.push(i)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return r}function Mi(e,t,n,r){t.type===ar.MERGE&&null!==t.source.queryId&&(Object(s["f"])(kr(e.viewCache_),"We should always have a full cache before handling merges"),Object(s["f"])(Er(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,o=mi(e.processor_,i,t,n,r);return gi(e.processor_,o.viewCache),Object(s["f"])(o.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=o.viewCache,Li(e,o.changes,o.viewCache.eventCache.getNode(),null)}function ji(e,t){const n=e.viewCache_.eventCache,r=[];if(!n.getNode().isLeafNode()){const e=n.getNode();e.forEachChild(an,(e,t)=>{r.push(Rn(e,t))})}return n.isFullyInitialized()&&r.push(Nn(n.getNode())),Li(e,r,n.getNode(),t)}function Li(e,t,n,r){const i=r?[r]:e.eventRegistrations_;return yr(e.eventGenerator_,t,n,i)}let Fi,Ui;class Vi{constructor(){this.views=new Map}}function qi(e){Object(s["f"])(!Fi,"__referenceConstructor has already been defined"),Fi=e}function Bi(){return Object(s["f"])(Fi,"Reference.ts has not been loaded"),Fi}function zi(e){return 0===e.views.size}function Ki(e,t,n,r){const i=t.source.queryId;if(null!==i){const o=e.views.get(i);return Object(s["f"])(null!=o,"SyncTree gave us an op for an invalid query."),Mi(o,t,n,r)}{let i=[];for(const s of e.views.values())i=i.concat(Mi(s,t,n,r));return i}}function Wi(e,t,n,r,i){const s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=ni(n,i?r:null),s=!1;e?s=!0:r instanceof gn?(e=ri(n,r),s=!1):(e=gn.EMPTY_NODE,s=!1);const o=br(new gr(e,s,!1),new gr(r,i,!1));return new Oi(t,o)}return o}function $i(e,t,n,r,i,s){const o=Wi(e,t,r,i,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),xi(o,n),ji(o,n)}function Gi(e,t,n,r){const i=t._queryIdentifier,s=[];let o=[];const a=Ji(e);if("default"===i)for(const[c,u]of e.views.entries())o=o.concat(Pi(u,n,r)),Di(u)&&(e.views.delete(c),u.query._queryParams.loadsAllData()||s.push(u.query));else{const t=e.views.get(i);t&&(o=o.concat(Pi(t,n,r)),Di(t)&&(e.views.delete(i),t.query._queryParams.loadsAllData()||s.push(t.query)))}return a&&!Ji(e)&&s.push(new(Bi())(t._repo,t._path)),{removed:s,events:o}}function Hi(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function Qi(e,t){let n=null;for(const r of e.views.values())n=n||Ri(r,t);return n}function Yi(e,t){const n=t._queryParams;if(n.loadsAllData())return Zi(e);{const n=t._queryIdentifier;return e.views.get(n)}}function Xi(e,t){return null!=Yi(e,t)}function Ji(e){return null!=Zi(e)}function Zi(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}function es(e){Object(s["f"])(!Ui,"__referenceConstructor has already been defined"),Ui=e}function ts(){return Object(s["f"])(Ui,"Reference.ts has not been loaded"),Ui}let ns=1;class rs{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Or(null),this.pendingWriteTree_=ti(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function is(e,t,n,r,i){return qr(e.pendingWriteTree_,t,n,r,i),i?ys(e,new fr(cr(),t,n)):[]}function ss(e,t,n,r){Br(e.pendingWriteTree_,t,n,r);const i=Or.fromObject(n);return ys(e,new pr(cr(),t,i))}function os(e,t,n=!1){const r=zr(e.pendingWriteTree_,t),i=Kr(e.pendingWriteTree_,t);if(i){let t=new Or(null);return null!=r.snap?t=t.set(lt(),!0):F(r.children,e=>{t=t.set(new ut(e),!0)}),ys(e,new hr(r.path,t,n))}return[]}function as(e,t,n){return ys(e,new fr(ur(),t,n))}function cs(e,t,n){const r=Or.fromObject(n);return ys(e,new pr(ur(),t,r))}function us(e,t){return ys(e,new dr(ur(),t))}function ls(e,t,n){const r=Ts(e,n);if(r){const n=Es(r),i=n.path,s=n.queryId,o=wt(i,t),a=new dr(lr(s),o);return ks(e,i,a)}return[]}function hs(e,t,n,r,i=!1){const s=t._path,o=e.syncPointTree_.get(s);let a=[];if(o&&("default"===t._queryIdentifier||Xi(o,t))){const c=Gi(o,t,n,r);zi(o)&&(e.syncPointTree_=e.syncPointTree_.remove(s));const u=c.removed;if(a=c.events,!i){const n=-1!==u.findIndex(e=>e._queryParams.loadsAllData()),i=e.syncPointTree_.findOnPath(s,(e,t)=>Ji(t));if(n&&!i){const t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){const n=Cs(t);for(let t=0;t<n.length;++t){const r=n[t],i=r.query,s=ws(e,r);e.listenProvider_.startListening(Ss(i),bs(e,i),s.hashFn,s.onComplete)}}}if(!i&&u.length>0&&!r)if(n){const n=null;e.listenProvider_.stopListening(Ss(t),n)}else u.forEach(t=>{const n=e.queryToTagMap.get(Is(t));e.listenProvider_.stopListening(Ss(t),n)})}Os(e,u)}return a}function ds(e,t,n,r){const i=Ts(e,r);if(null!=i){const r=Es(i),s=r.path,o=r.queryId,a=wt(s,t),c=new fr(lr(o),a,n);return ks(e,s,c)}return[]}function fs(e,t,n,r){const i=Ts(e,r);if(i){const r=Es(i),s=r.path,o=r.queryId,a=wt(s,t),c=Or.fromObject(n),u=new pr(lr(o),a,c);return ks(e,s,u)}return[]}function ps(e,t,n,r=!1){const i=t._path;let o=null,a=!1;e.syncPointTree_.foreachOnPath(i,(e,t)=>{const n=wt(e,i);o=o||Qi(t,n),a=a||Ji(t)});let c,u=e.syncPointTree_.get(i);if(u?(a=a||Ji(u),o=o||Qi(u,lt())):(u=new Vi,e.syncPointTree_=e.syncPointTree_.set(i,u)),null!=o)c=!0;else{c=!1,o=gn.EMPTY_NODE;const t=e.syncPointTree_.subtree(i);t.foreachChild((e,t)=>{const n=Qi(t,lt());n&&(o=o.updateImmediateChild(e,n))})}const l=Xi(u,t);if(!l&&!t._queryParams.loadsAllData()){const n=Is(t);Object(s["f"])(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");const r=As();e.queryToTagMap.set(n,r),e.tagToQueryMap.set(r,n)}const h=Vr(e.pendingWriteTree_,i);let d=$i(u,t,n,h,o,c);if(!l&&!a&&!r){const n=Yi(u,t);d=d.concat(Ns(e,t,n))}return d}function gs(e,t,n){const r=!0,i=e.pendingWriteTree_,s=e.syncPointTree_.findOnPath(t,(e,n)=>{const r=wt(e,t),i=Qi(n,r);if(i)return i});return Qr(i,t,s,n,r)}function ms(e,t){const n=t._path;let r=null;e.syncPointTree_.foreachOnPath(n,(e,t)=>{const i=wt(e,n);r=r||Qi(t,i)});let i=e.syncPointTree_.get(n);i?r=r||Qi(i,lt()):(i=new Vi,e.syncPointTree_=e.syncPointTree_.set(n,i));const s=null!=r,o=s?new gr(r,!0,!1):null,a=Vr(e.pendingWriteTree_,t._path),c=Wi(i,t,a,s?o.getNode():gn.EMPTY_NODE,s);return Ni(c)}function ys(e,t){return _s(t,e.syncPointTree_,null,Vr(e.pendingWriteTree_,lt()))}function _s(e,t,n,r){if(vt(e.path))return vs(e,t,n,r);{const i=t.get(lt());null==n&&null!=i&&(n=Qi(i,lt()));let s=[];const o=ht(e.path),a=e.operationForChild(o),c=t.children.get(o);if(c&&a){const e=n?n.getImmediateChild(o):null,t=ci(r,o);s=s.concat(_s(a,c,e,t))}return i&&(s=s.concat(Ki(i,e,r,n))),s}}function vs(e,t,n,r){const i=t.get(lt());null==n&&null!=i&&(n=Qi(i,lt()));let s=[];return t.children.inorderTraversal((t,i)=>{const o=n?n.getImmediateChild(t):null,a=ci(r,t),c=e.operationForChild(t);c&&(s=s.concat(vs(c,i,o,a)))}),i&&(s=s.concat(Ki(i,e,r,n))),s}function ws(e,t){const n=t.query,r=bs(e,n);return{hashFn:()=>{const e=Ai(t)||gn.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return r?ls(e,n._path,r):us(e,n._path);{const r=B(t,n);return hs(e,n,null,r)}}}}function bs(e,t){const n=Is(t);return e.queryToTagMap.get(n)}function Is(e){return e._path.toString()+"$"+e._queryIdentifier}function Ts(e,t){return e.tagToQueryMap.get(t)}function Es(e){const t=e.indexOf("$");return Object(s["f"])(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new ut(e.substr(0,t))}}function ks(e,t,n){const r=e.syncPointTree_.get(t);Object(s["f"])(r,"Missing sync point for query tag that we're tracking");const i=Vr(e.pendingWriteTree_,t);return Ki(r,n,i,null)}function Cs(e){return e.fold((e,t,n)=>{if(t&&Ji(t)){const e=Zi(t);return[e]}{let e=[];return t&&(e=Hi(t)),F(n,(t,n)=>{e=e.concat(n)}),e}})}function Ss(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(ts())(e._repo,e._path):e}function Os(e,t){for(let n=0;n<t.length;++n){const r=t[n];if(!r._queryParams.loadsAllData()){const t=Is(r),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}function As(){return ns++}function Ns(e,t,n){const r=t._path,i=bs(e,t),o=ws(e,n),a=e.listenProvider_.startListening(Ss(t),i,o.hashFn,o.onComplete),c=e.syncPointTree_.subtree(r);if(i)Object(s["f"])(!Ji(c.value),"If we're adding a query, it shouldn't be shadowed");else{const t=c.fold((e,t,n)=>{if(!vt(e)&&t&&Ji(t))return[Zi(t).query];{let e=[];return t&&(e=e.concat(Hi(t).map(e=>e.query))),F(n,(t,n)=>{e=e.concat(n)}),e}});for(let n=0;n<t.length;++n){const r=t[n];e.listenProvider_.stopListening(Ss(r),bs(e,r))}}return a}class Rs{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Rs(t)}node(){return this.node_}}class Ds{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=_t(this.path_,e);return new Ds(this.syncTree_,t)}node(){return gs(this.syncTree_,this.path_)}}const xs=function(e){return e=e||{},e["timestamp"]=e["timestamp"]||(new Date).getTime(),e},Ps=function(e,t,n){return e&&"object"===typeof e?(Object(s["f"])(".sv"in e,"Unexpected leaf node or priority contents"),"string"===typeof e[".sv"]?Ms(e[".sv"],t,n):"object"===typeof e[".sv"]?js(e[".sv"],t):void Object(s["f"])(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},Ms=function(e,t,n){switch(e){case"timestamp":return n["timestamp"];default:Object(s["f"])(!1,"Unexpected server value: "+e)}},js=function(e,t,n){e.hasOwnProperty("increment")||Object(s["f"])(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const r=e["increment"];"number"!==typeof r&&Object(s["f"])(!1,"Unexpected increment value: "+r);const i=t.node();if(Object(s["f"])(null!==i&&"undefined"!==typeof i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const o=i,a=o.getValue();return"number"!==typeof a?r:a+r},Ls=function(e,t,n,r){return Us(t,new Ds(n,e),r)},Fs=function(e,t,n){return Us(e,new Rs(t),n)};function Us(e,t,n){const r=e.getPriority().val(),i=Ps(r,t.getImmediateChild(".priority"),n);let s;if(e.isLeafNode()){const r=e,s=Ps(r.getValue(),t,n);return s!==r.getValue()||i!==r.getPriority().val()?new nn(s,vn(i)):e}{const r=e;return s=r,i!==r.getPriority().val()&&(s=s.updatePriority(new nn(i))),r.forEachChild(an,(e,r)=>{const i=Us(r,t.getImmediateChild(e),n);i!==r&&(s=s.updateImmediateChild(e,i))}),s}}class Vs{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function qs(e,t){let n=t instanceof ut?t:new ut(t),r=e,i=ht(n);while(null!==i){const e=Object(s["S"])(r.node.children,i)||{children:{},childCount:0};r=new Vs(i,r,e),n=ft(n),i=ht(n)}return r}function Bs(e){return e.node.value}function zs(e,t){e.node.value=t,Ys(e)}function Ks(e){return e.node.childCount>0}function Ws(e){return void 0===Bs(e)&&!Ks(e)}function $s(e,t){F(e.node.children,(n,r)=>{t(new Vs(n,e,r))})}function Gs(e,t,n,r){n&&!r&&t(e),$s(e,e=>{Gs(e,t,!0,r)}),n&&r&&t(e)}function Hs(e,t,n){let r=n?e:e.parent;while(null!==r){if(t(r))return!0;r=r.parent}return!1}function Qs(e){return new ut(null===e.parent?e.name:Qs(e.parent)+"/"+e.name)}function Ys(e){null!==e.parent&&Xs(e.parent,e.name,e)}function Xs(e,t,n){const r=Ws(n),i=Object(s["m"])(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,Ys(e)):r||i||(e.node.children[t]=n.node,e.node.childCount++,Ys(e))}const Js=/[\[\].#$\/\u0000-\u001F\u007F]/,Zs=/[\[\].#$\u0000-\u001F\u007F]/,eo=10485760,to=function(e){return"string"===typeof e&&0!==e.length&&!Js.test(e)},no=function(e){return"string"===typeof e&&0!==e.length&&!Zs.test(e)},ro=function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),no(e)},io=function(e){return null===e||"string"===typeof e||"number"===typeof e&&!A(e)||e&&"object"===typeof e&&Object(s["m"])(e,".sv")},so=function(e,t,n,r){r&&void 0===t||oo(Object(s["s"])(e,"value"),t,n)},oo=function(e,t,n){const r=n instanceof ut?new Et(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+Ot(r));if("function"===typeof t)throw new Error(e+"contains a function "+Ot(r)+" with contents = "+t.toString());if(A(t))throw new Error(e+"contains "+t.toString()+" "+Ot(r));if("string"===typeof t&&t.length>eo/3&&Object(s["T"])(t)>eo)throw new Error(e+"contains a string greater than "+eo+" utf8 bytes "+Ot(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"===typeof t){let n=!1,i=!1;if(F(t,(t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!to(t)))throw new Error(e+" contains an invalid key ("+t+") "+Ot(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');kt(r,t),oo(e,s,r),Ct(r)}),n&&i)throw new Error(e+' contains ".value" child '+Ot(r)+" in addition to actual children.")}},ao=function(e,t){let n,r;for(n=0;n<t.length;n++){r=t[n];const i=mt(r);for(let t=0;t<i.length;t++)if(".priority"===i[t]&&t===i.length-1);else if(!to(i[t]))throw new Error(e+"contains an invalid key ("+i[t]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(bt);let i=null;for(n=0;n<t.length;n++){if(r=t[n],null!==i&&Tt(i,r))throw new Error(e+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},co=function(e,t,n,r){if(r&&void 0===t)return;const i=Object(s["s"])(e,"values");if(!t||"object"!==typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const o=[];F(t,(e,t)=>{const r=new ut(e);if(oo(i,t,_t(n,r)),".priority"===pt(r)&&!io(t))throw new Error(i+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");o.push(r)}),ao(i,o)},uo=function(e,t,n){if(!n||void 0!==t){if(A(t))throw new Error(Object(s["s"])(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!io(t))throw new Error(Object(s["s"])(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},lo=function(e,t,n,r){if((!r||void 0!==n)&&!to(n))throw new Error(Object(s["s"])(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},ho=function(e,t,n,r){if((!r||void 0!==n)&&!no(n))throw new Error(Object(s["s"])(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},fo=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),ho(e,t,n,r)},po=function(e,t){if(".info"===ht(t))throw new Error(e+" failed = Can't modify data under /.info/")},go=function(e,t){const n=t.path.toString();if("string"!==typeof t.repoInfo.host||0===t.repoInfo.host.length||!to(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!ro(n))throw new Error(Object(s["s"])(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class mo{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function yo(e,t){let n=null;for(let r=0;r<t.length;r++){const i=t[r],s=i.getPath();null===n||It(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(i)}n&&e.eventLists_.push(n)}function _o(e,t,n){yo(e,n),wo(e,e=>It(e,t))}function vo(e,t,n){yo(e,n),wo(e,e=>Tt(e,t)||Tt(t,e))}function wo(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){const i=e.eventLists_[r];if(i){const s=i.path;t(s)?(bo(e.eventLists_[r]),e.eventLists_[r]=null):n=!1}}n&&(e.eventLists_=[]),e.recursionDepth_--}function bo(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const r=n.getEventRunner();w&&T("event: "+n.toString()),G(r)}}}const Io="repo_interrupt",To=25;class Eo{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new mo,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Xn(),this.transactionQueueTree_=new Vs,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function ko(e,t,n){if(e.stats_=me(e.repoInfo_),e.forceRestClient_||H())e.server_=new Qn(e.repoInfo_,(t,n,r,i)=>{Oo(e,t,n,r,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>Ao(e,!0),0);else{if("undefined"!==typeof n&&null!==n){if("object"!==typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Object(s["V"])(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}e.persistentConnection_=new Lt(e.repoInfo_,t,(t,n,r,i)=>{Oo(e,t,n,r,i)},t=>{Ao(e,t)},t=>{No(e,t)},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=ye(e.repoInfo_,()=>new or(e.stats_,e.server_)),e.infoData_=new Yn,e.infoSyncTree_=new rs({startListening:(t,n,r,i)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=as(e.infoSyncTree_,t._path,o),setTimeout(()=>{i("ok")},0)),s},stopListening:()=>{}}),Ro(e,"connected",!1),e.serverSyncTree_=new rs({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,(n,r)=>{const s=i(n,r);vo(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function Co(e){const t=e.infoData_.getNode(new ut(".info/serverTimeOffset")),n=t.val()||0;return(new Date).getTime()+n}function So(e){return xs({timestamp:Co(e)})}function Oo(e,t,n,r,i){e.dataUpdateCount++;const o=new ut(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let a=[];if(i)if(r){const t=Object(s["P"])(n,e=>vn(e));a=fs(e.serverSyncTree_,o,t,i)}else{const t=vn(n);a=ds(e.serverSyncTree_,o,t,i)}else if(r){const t=Object(s["P"])(n,e=>vn(e));a=cs(e.serverSyncTree_,o,t)}else{const t=vn(n);a=as(e.serverSyncTree_,o,t)}let c=o;a.length>0&&(c=Xo(e,o)),vo(e.eventQueue_,c,a)}function Ao(e,t){Ro(e,"connected",t),!1===t&&jo(e)}function No(e,t){F(t,(t,n)=>{Ro(e,t,n)})}function Ro(e,t,n){const r=new ut("/.info/"+t),i=vn(n);e.infoData_.updateSnapshot(r,i);const s=as(e.infoSyncTree_,r,i);vo(e.eventQueue_,r,s)}function Do(e){return e.nextWriteId_++}function xo(e,t,n){const r=ms(e.serverSyncTree_,t);return null!=r?Promise.resolve(r):e.server_.get(t).then(r=>{const i=vn(r).withIndex(t._queryParams.getIndex());let s;if(ps(e.serverSyncTree_,t,n,!0),t._queryParams.loadsAllData())s=as(e.serverSyncTree_,t._path,i);else{const n=bs(e.serverSyncTree_,t);s=ds(e.serverSyncTree_,t._path,i,n)}return vo(e.eventQueue_,t._path,s),hs(e.serverSyncTree_,t,n,null,!0),i},n=>(Wo(e,"get for query "+Object(s["V"])(t)+" failed: "+n),Promise.reject(new Error(n))))}function Po(e,t,n,r,i){Wo(e,"set",{path:t.toString(),value:n,priority:r});const s=So(e),o=vn(n,r),a=gs(e.serverSyncTree_,t),c=Fs(o,a,s),u=Do(e),l=is(e.serverSyncTree_,t,c,u,!0);yo(e.eventQueue_,l),e.server_.put(t.toString(),o.val(!0),(n,r)=>{const s="ok"===n;s||S("set at "+t+" failed: "+n);const o=os(e.serverSyncTree_,u,!s);vo(e.eventQueue_,t,o),$o(e,i,n,r)});const h=ra(e,t);Xo(e,h),vo(e.eventQueue_,h,[])}function Mo(e,t,n,r){Wo(e,"update",{path:t.toString(),value:n});let i=!0;const s=So(e),o={};if(F(n,(n,r)=>{i=!1,o[n]=Ls(_t(t,n),vn(r),e.serverSyncTree_,s)}),i)T("update() called with empty data.  Don't do anything."),$o(e,r,"ok",void 0);else{const i=Do(e),s=ss(e.serverSyncTree_,t,o,i);yo(e.eventQueue_,s),e.server_.merge(t.toString(),n,(n,s)=>{const o="ok"===n;o||S("update at "+t+" failed: "+n);const a=os(e.serverSyncTree_,i,!o),c=a.length>0?Xo(e,t):t;vo(e.eventQueue_,c,a),$o(e,r,n,s)}),F(n,n=>{const r=ra(e,_t(t,n));Xo(e,r)}),vo(e.eventQueue_,t,[])}}function jo(e){Wo(e,"onDisconnectEvents");const t=So(e),n=Xn();er(e.onDisconnect_,lt(),(r,i)=>{const s=Ls(r,i,e.serverSyncTree_,t);Jn(n,r,s)});let r=[];er(n,lt(),(t,n)=>{r=r.concat(as(e.serverSyncTree_,t,n));const i=ra(e,t);Xo(e,i)}),e.onDisconnect_=Xn(),vo(e.eventQueue_,lt(),r)}function Lo(e,t,n){e.server_.onDisconnectCancel(t.toString(),(r,i)=>{"ok"===r&&Zn(e.onDisconnect_,t),$o(e,n,r,i)})}function Fo(e,t,n,r){const i=vn(n);e.server_.onDisconnectPut(t.toString(),i.val(!0),(n,s)=>{"ok"===n&&Jn(e.onDisconnect_,t,i),$o(e,r,n,s)})}function Uo(e,t,n,r,i){const s=vn(n,r);e.server_.onDisconnectPut(t.toString(),s.val(!0),(n,r)=>{"ok"===n&&Jn(e.onDisconnect_,t,s),$o(e,i,n,r)})}function Vo(e,t,n,r){if(Object(s["E"])(n))return T("onDisconnect().update() called with empty data.  Don't do anything."),void $o(e,r,"ok",void 0);e.server_.onDisconnectMerge(t.toString(),n,(i,s)=>{"ok"===i&&F(n,(n,r)=>{const i=vn(r);Jn(e.onDisconnect_,_t(t,n),i)}),$o(e,r,i,s)})}function qo(e,t,n){let r;r=".info"===ht(t._path)?ps(e.infoSyncTree_,t,n):ps(e.serverSyncTree_,t,n),_o(e.eventQueue_,t._path,r)}function Bo(e,t,n){let r;r=".info"===ht(t._path)?hs(e.infoSyncTree_,t,n):hs(e.serverSyncTree_,t,n),_o(e.eventQueue_,t._path,r)}function zo(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Io)}function Ko(e){e.persistentConnection_&&e.persistentConnection_.resume(Io)}function Wo(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),T(n,...t)}function $o(e,t,n,r){t&&G(()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let i=e;r&&(i+=": "+r);const s=new Error(i);s.code=e,t(s)}})}function Go(e,t,n,r,i,o){Wo(e,"transaction on "+t);const a={path:t,update:n,onComplete:r,status:null,order:y(),applyLocally:o,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},c=Ho(e,t,void 0);a.currentInputSnapshot=c;const u=a.update(c.val());if(void 0===u)a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete&&a.onComplete(null,!1,a.currentInputSnapshot);else{oo("transaction failed: Data returned ",u,a.path),a.status=0;const n=qs(e.transactionQueueTree_,t),r=Bs(n)||[];let i;if(r.push(a),zs(n,r),"object"===typeof u&&null!==u&&Object(s["m"])(u,".priority"))i=Object(s["S"])(u,".priority"),Object(s["f"])(io(i),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else{const n=gs(e.serverSyncTree_,t)||gn.EMPTY_NODE;i=n.getPriority().val()}const o=So(e),l=vn(u,i),h=Fs(l,c,o);a.currentOutputSnapshotRaw=l,a.currentOutputSnapshotResolved=h,a.currentWriteId=Do(e);const d=is(e.serverSyncTree_,t,h,a.currentWriteId,a.applyLocally);vo(e.eventQueue_,t,d),Qo(e,e.transactionQueueTree_)}}function Ho(e,t,n){return gs(e.serverSyncTree_,t,n)||gn.EMPTY_NODE}function Qo(e,t=e.transactionQueueTree_){if(t||na(e,t),Bs(t)){const n=ea(e,t);Object(s["f"])(n.length>0,"Sending zero length transaction queue");const r=n.every(e=>0===e.status);r&&Yo(e,Qs(t),n)}else Ks(t)&&$s(t,t=>{Qo(e,t)})}function Yo(e,t,n){const r=n.map(e=>e.currentWriteId),i=Ho(e,t,r);let o=i;const a=i.hash();for(let l=0;l<n.length;l++){const e=n[l];Object(s["f"])(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const r=wt(t,e.path);o=o.updateChild(r,e.currentOutputSnapshotRaw)}const c=o.val(!0),u=t;e.server_.put(u.toString(),c,r=>{Wo(e,"transaction put response",{path:u.toString(),status:r});let i=[];if("ok"===r){const r=[];for(let t=0;t<n.length;t++)n[t].status=2,i=i.concat(os(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&r.push(()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)),n[t].unwatcher();na(e,qs(e.transactionQueueTree_,t)),Qo(e,e.transactionQueueTree_),vo(e.eventQueue_,t,i);for(let e=0;e<r.length;e++)G(r[e])}else{if("datastale"===r)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{S("transaction at "+u.toString()+" failed: "+r);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=r}Xo(e,t)}},a)}function Xo(e,t){const n=Zo(e,t),r=Qs(n),i=ea(e,n);return Jo(e,i,r),r}function Jo(e,t,n){if(0===t.length)return;const r=[];let i=[];const o=t.filter(e=>0===e.status),a=o.map(e=>e.currentWriteId);for(let c=0;c<t.length;c++){const o=t[c],u=wt(n,o.path);let l,h=!1;if(Object(s["f"])(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),4===o.status)h=!0,l=o.abortReason,i=i.concat(os(e.serverSyncTree_,o.currentWriteId,!0));else if(0===o.status)if(o.retryCount>=To)h=!0,l="maxretry",i=i.concat(os(e.serverSyncTree_,o.currentWriteId,!0));else{const n=Ho(e,o.path,a);o.currentInputSnapshot=n;const r=t[c].update(n.val());if(void 0!==r){oo("transaction failed: Data returned ",r,o.path);let t=vn(r);const c="object"===typeof r&&null!=r&&Object(s["m"])(r,".priority");c||(t=t.updatePriority(n.getPriority()));const u=o.currentWriteId,l=So(e),h=Fs(t,n,l);o.currentOutputSnapshotRaw=t,o.currentOutputSnapshotResolved=h,o.currentWriteId=Do(e),a.splice(a.indexOf(u),1),i=i.concat(is(e.serverSyncTree_,o.path,h,o.currentWriteId,o.applyLocally)),i=i.concat(os(e.serverSyncTree_,u,!0))}else h=!0,l="nodata",i=i.concat(os(e.serverSyncTree_,o.currentWriteId,!0))}vo(e.eventQueue_,n,i),i=[],h&&(t[c].status=2,function(e){setTimeout(e,Math.floor(0))}(t[c].unwatcher),t[c].onComplete&&("nodata"===l?r.push(()=>t[c].onComplete(null,!1,t[c].currentInputSnapshot)):r.push(()=>t[c].onComplete(new Error(l),!1,null))))}na(e,e.transactionQueueTree_);for(let s=0;s<r.length;s++)G(r[s]);Qo(e,e.transactionQueueTree_)}function Zo(e,t){let n,r=e.transactionQueueTree_;n=ht(t);while(null!==n&&void 0===Bs(r))r=qs(r,n),t=ft(t),n=ht(t);return r}function ea(e,t){const n=[];return ta(e,t,n),n.sort((e,t)=>e.order-t.order),n}function ta(e,t,n){const r=Bs(t);if(r)for(let i=0;i<r.length;i++)n.push(r[i]);$s(t,t=>{ta(e,t,n)})}function na(e,t){const n=Bs(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,zs(t,n.length>0?n:void 0)}$s(t,t=>{na(e,t)})}function ra(e,t){const n=Qs(Zo(e,t)),r=qs(e.transactionQueueTree_,t);return Hs(r,t=>{ia(e,t)}),ia(e,r),Gs(r,t=>{ia(e,t)}),n}function ia(e,t){const n=Bs(t);if(n){const r=[];let i=[],o=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(Object(s["f"])(o===t-1,"All SENT items should be at beginning of queue."),o=t,n[t].status=3,n[t].abortReason="set"):(Object(s["f"])(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),i=i.concat(os(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===o?zs(t,void 0):n.length=o+1,vo(e.eventQueue_,Qs(t),i);for(let e=0;e<r.length;e++)G(r[e])}}function sa(e){let t="";const n=e.split("/");for(let i=0;i<n.length;i++)if(n[i].length>0){let e=n[i];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(r){}t+="/"+e}return t}function oa(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):S(`Invalid query segment '${n}' in query '${e}'`)}return t}const aa=function(e,t){const n=ca(e),r=n.namespace;"firebase.com"===n.domain&&C(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||C("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||O();const i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new le(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new ut(n.pathString)}},ca=function(e){let t="",n="",r="",i="",s="",o=!0,a="https",c=443;if("string"===typeof e){let u=e.indexOf("//");u>=0&&(a=e.substring(0,u-1),e=e.substring(u+2));let l=e.indexOf("/");-1===l&&(l=e.length);let h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(l,h)),l<h&&(i=sa(e.substring(l,h)));const d=oa(e.substring(Math.min(e.length,h)));u=t.indexOf(":"),u>=0?(o="https"===a||"wss"===a,c=parseInt(t.substring(u+1),10)):u=t.length;const f=t.slice(0,u);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{const e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=r}"ns"in d&&(s=d["ns"])}return{host:t,port:c,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};class ua{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Object(s["V"])(this.snapshot.exportVal())}}class la{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class ha{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return Object(s["f"])(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class da{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new s["a"];return Lo(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){po("OnDisconnect.remove",this._path);const e=new s["a"];return Fo(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){po("OnDisconnect.set",this._path),so("OnDisconnect.set",e,this._path,!1);const t=new s["a"];return Fo(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){po("OnDisconnect.setWithPriority",this._path),so("OnDisconnect.setWithPriority",e,this._path,!1),uo("OnDisconnect.setWithPriority",t,!1);const n=new s["a"];return Uo(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){po("OnDisconnect.update",this._path),co("OnDisconnect.update",e,this._path,!1);const t=new s["a"];return Vo(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class fa{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return vt(this._path)?null:pt(this._path)}get ref(){return new ya(this._repo,this._path)}get _queryIdentifier(){const e=Hn(this._queryParams),t=j(e);return"{}"===t?"default":t}get _queryObject(){return Hn(this._queryParams)}isEqual(e){if(e=Object(s["z"])(e),!(e instanceof fa))return!1;const t=this._repo===e._repo,n=It(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+gt(this._path)}}function pa(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function ga(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===Bt){const r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){const n=e.getIndexStartName();if(n!==R)throw new Error(r);if("string"!==typeof t)throw new Error(i)}if(e.hasEnd()){const t=e.getIndexEndName();if(t!==D)throw new Error(r);if("string"!==typeof n)throw new Error(i)}}else if(e.getIndex()===an){if(null!=t&&!io(t)||null!=n&&!io(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Object(s["f"])(e.getIndex()instanceof wn||e.getIndex()===In,"unknown index type."),null!=t&&"object"===typeof t||null!=n&&"object"===typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function ma(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class ya extends fa{constructor(e,t){super(e,t,new Fn,!1)}get parent(){const e=yt(this._path);return null===e?null:new ya(this._repo,e)}get root(){let e=this;while(null!==e.parent)e=e.parent;return e}}class _a{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new ut(e),n=ba(this.ref,e);return new _a(this._node.getChild(t),n,an)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;const t=this._node;return!!t.forEachChild(this._index,(t,n)=>e(new _a(n,ba(this.ref,t),an)))}hasChild(e){const t=new ut(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function va(e,t){return e=Object(s["z"])(e),e._checkNotDeleted("ref"),void 0!==t?ba(e._root,t):e._root}function wa(e,t){e=Object(s["z"])(e),e._checkNotDeleted("refFromURL");const n=aa(t,e._repo.repoInfo_.nodeAdmin);go("refFromURL",n);const r=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||r.host===e._repo.repoInfo_.host||C("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+e._repo.repoInfo_.host+")"),va(e,n.path.toString())}function ba(e,t){return e=Object(s["z"])(e),null===ht(e._path)?fo("child","path",t,!1):ho("child","path",t,!1),new ya(e._repo,_t(e._path,t))}function Ia(e,t){e=Object(s["z"])(e),po("push",e._path),so("push",t,e._path,!0);const n=Co(e._repo),r=Sn(n),i=ba(e,r),o=ba(e,r);let a;return a=null!=t?Ea(o,t).then(()=>o):Promise.resolve(o),i.then=a.then.bind(a),i.catch=a.then.bind(a,void 0),i}function Ta(e){return po("remove",e._path),Ea(e,null)}function Ea(e,t){e=Object(s["z"])(e),po("set",e._path),so("set",t,e._path,!1);const n=new s["a"];return Po(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}function ka(e,t){e=Object(s["z"])(e),po("setPriority",e._path),uo("setPriority",t,!1);const n=new s["a"];return Po(e._repo,_t(e._path,".priority"),t,null,n.wrapCallback(()=>{})),n.promise}function Ca(e,t,n){if(po("setWithPriority",e._path),so("setWithPriority",t,e._path,!1),uo("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";const r=new s["a"];return Po(e._repo,e._path,t,n,r.wrapCallback(()=>{})),r.promise}function Sa(e,t){co("update",t,e._path,!1);const n=new s["a"];return Mo(e._repo,e._path,t,n.wrapCallback(()=>{})),n.promise}function Oa(e){e=Object(s["z"])(e);const t=new ha(()=>{}),n=new Aa(t);return xo(e._repo,e,n).then(t=>new _a(t,new ya(e._repo,e._path),e._queryParams.getIndex()))}class Aa{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new ua("value",this,new _a(e.snapshotNode,new ya(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new la(this,e,t):null}matches(e){return e instanceof Aa&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class Na{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new la(this,e,t):null}createEvent(e,t){Object(s["f"])(null!=e.childName,"Child events should have a childName.");const n=ba(new ya(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new ua(e.type,this,new _a(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Na&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function Ra(e,t,n,r,i){let s;if("object"===typeof r&&(s=void 0,i=r),"function"===typeof r&&(s=r),i&&i.onlyOnce){const t=n,r=(n,r)=>{Bo(e._repo,e,a),t(n,r)};r.userCallback=n.userCallback,r.context=n.context,n=r}const o=new ha(n,s||void 0),a="value"===t?new Aa(o):new Na(t,o);return qo(e._repo,e,a),()=>Bo(e._repo,e,a)}function Da(e,t,n,r){return Ra(e,"value",t,n,r)}function xa(e,t,n,r){return Ra(e,"child_added",t,n,r)}function Pa(e,t,n,r){return Ra(e,"child_changed",t,n,r)}function Ma(e,t,n,r){return Ra(e,"child_moved",t,n,r)}function ja(e,t,n,r){return Ra(e,"child_removed",t,n,r)}function La(e,t,n){let r=null;const i=n?new ha(n):null;"value"===t?r=new Aa(i):t&&(r=new Na(t,i)),Bo(e._repo,e,r)}class Fa{}class Ua extends Fa{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){so("endAt",this._value,e._path,!0);const t=Kn(e._queryParams,this._value,this._key);if(ma(t),ga(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new fa(e._repo,e._path,t,e._orderByCalled)}}function Va(e,t){return lo("endAt","key",t,!0),new Ua(e,t)}class qa extends Fa{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){so("endBefore",this._value,e._path,!1);const t=Wn(e._queryParams,this._value,this._key);if(ma(t),ga(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new fa(e._repo,e._path,t,e._orderByCalled)}}function Ba(e,t){return lo("endBefore","key",t,!0),new qa(e,t)}class za extends Fa{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){so("startAt",this._value,e._path,!0);const t=Bn(e._queryParams,this._value,this._key);if(ma(t),ga(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new fa(e._repo,e._path,t,e._orderByCalled)}}function Ka(e=null,t){return lo("startAt","key",t,!0),new za(e,t)}class Wa extends Fa{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){so("startAfter",this._value,e._path,!1);const t=zn(e._queryParams,this._value,this._key);if(ma(t),ga(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new fa(e._repo,e._path,t,e._orderByCalled)}}function $a(e,t){return lo("startAfter","key",t,!0),new Wa(e,t)}class Ga extends Fa{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new fa(e._repo,e._path,Vn(e._queryParams,this._limit),e._orderByCalled)}}function Ha(e){if("number"!==typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Ga(e)}class Qa extends Fa{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new fa(e._repo,e._path,qn(e._queryParams,this._limit),e._orderByCalled)}}function Ya(e){if("number"!==typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Qa(e)}class Xa extends Fa{constructor(e){super(),this._path=e}_apply(e){pa(e,"orderByChild");const t=new ut(this._path);if(vt(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const n=new wn(t),r=$n(e._queryParams,n);return ga(r),new fa(e._repo,e._path,r,!0)}}function Ja(e){if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return ho("orderByChild","path",e,!1),new Xa(e)}class Za extends Fa{_apply(e){pa(e,"orderByKey");const t=$n(e._queryParams,Bt);return ga(t),new fa(e._repo,e._path,t,!0)}}function ec(){return new Za}class tc extends Fa{_apply(e){pa(e,"orderByPriority");const t=$n(e._queryParams,an);return ga(t),new fa(e._repo,e._path,t,!0)}}function nc(){return new tc}class rc extends Fa{_apply(e){pa(e,"orderByValue");const t=$n(e._queryParams,In);return ga(t),new fa(e._repo,e._path,t,!0)}}function ic(){return new rc}class sc extends Fa{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(so("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Ua(this._value,this._key)._apply(new za(this._value,this._key)._apply(e))}}function oc(e,t){return lo("equalTo","key",t,!0),new sc(e,t)}function ac(e,...t){let n=Object(s["z"])(e);for(const r of t)n=r._apply(n);return n}qi(ya),es(ya);const cc="FIREBASE_DATABASE_EMULATOR_HOST",uc={};let lc=!1;function hc(e,t,n,r){e.repoInfo_=new le(`${t}:${n}`,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams),r&&(e.authTokenProvider_=r)}function dc(t,n,r,i,s){let o=i||t.options.databaseURL;void 0===o&&(t.options.projectId||C("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),T("Using default host for project ",t.options.projectId),o=t.options.projectId+"-default-rtdb.firebaseio.com");let a,c=aa(o,s),u=c.repoInfo,l=void 0;"undefined"!==typeof e&&Object({NODE_ENV:"production",VUE_APP_I18N_FALLBACK_LOCALE:"en-US",VUE_APP_I18N_LOCALE:"en-US",BASE_URL:"/"})&&(l=Object({NODE_ENV:"production",VUE_APP_I18N_FALLBACK_LOCALE:"en-US",VUE_APP_I18N_LOCALE:"en-US",BASE_URL:"/"})[cc]),l?(a=!0,o=`http://${l}?ns=${u.namespace}`,c=aa(o,s),u=c.repoInfo):a=!c.repoInfo.secure;const h=s&&a?new J(J.OWNER):new X(t.name,t.options,n);go("Invalid Firebase Database URL",c),vt(c.path)||C("Database URL must point to the root of a Firebase Database (not including a child path).");const d=pc(u,t,h,new Y(t.name,r));return new gc(d,t)}function fc(e,t){const n=uc[t];n&&n[e.key]===e||C(`Database ${t}(${e.repoInfo_}) has already been deleted.`),zo(e),delete n[e.key]}function pc(e,t,n,r){let i=uc[t.name];i||(i={},uc[t.name]=i);let s=i[e.toURLString()];return s&&C("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new Eo(e,lc,n,r),i[e.toURLString()]=s,s}class gc{constructor(e,t){this._repoInternal=e,this.app=t,this["type"]="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(ko(this._repoInternal,this.app.options.appId,this.app.options["databaseAuthVariableOverride"]),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ya(this._repo,lt())),this._rootInternal}_delete(){return null!==this._rootInternal&&(fc(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&C("Cannot call "+e+" on a deleted database.")}}function mc(){Be.IS_TRANSPORT_INITIALIZED&&S("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function yc(){mc(),je.forceDisallow()}function _c(){mc(),qe.forceDisallow(),je.forceAllow()}function vc(e,t,n,r={}){e=Object(s["z"])(e),e._checkNotDeleted("useEmulator"),e._instanceStarted&&C("Cannot call useEmulator() after instance has already been initialized.");const i=e._repoInternal;let o=void 0;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&C('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new J(J.OWNER);else if(r.mockUserToken){const t="string"===typeof r.mockUserToken?r.mockUserToken:Object(s["n"])(r.mockUserToken,e.app.options.projectId);o=new J(t)}hc(i,t,n,o)}function wc(e){e=Object(s["z"])(e),e._checkNotDeleted("goOffline"),zo(e._repo)}function bc(e){e=Object(s["z"])(e),e._checkNotDeleted("goOnline"),Ko(e._repo)}function Ic(e,t){I(e,t)}function Tc(e){l(r["SDK_VERSION"]),Object(r["_registerComponent"])(new i["a"]("database",(e,{instanceIdentifier:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return dc(n,r,i,t)},"PUBLIC").setMultipleInstances(!0)),Object(r["registerVersion"])(a,c,e),Object(r["registerVersion"])(a,c,"esm2017")}const Ec={".sv":"timestamp"};function kc(){return Ec}function Cc(e){return{".sv":{increment:e}}}class Sc{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function Oc(e,t,n){var r;if(e=Object(s["z"])(e),po("Reference.transaction",e._path),".length"===e.key||".keys"===e.key)throw"Reference.transaction failed: "+e.key+" is a read-only object.";const i=null===(r=null===n||void 0===n?void 0:n.applyLocally)||void 0===r||r,o=new s["a"],a=(t,n,r)=>{let i=null;t?o.reject(t):(i=new _a(r,new ya(e._repo,e._path),an),o.resolve(new Sc(n,i)))},c=Da(e,()=>{});return Go(e._repo,e._path,t,a,c,i),o.promise}Lt.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Lt.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};Tc()}).call(this,n("4362"))},"589b":function(e,t,n){"use strict";n.r(t),n.d(t,"SDK_VERSION",(function(){return Y})),n.d(t,"_DEFAULT_ENTRY_NAME",(function(){return L})),n.d(t,"_addComponent",(function(){return q})),n.d(t,"_addOrOverwriteComponent",(function(){return B})),n.d(t,"_apps",(function(){return U})),n.d(t,"_clearComponents",(function(){return $})),n.d(t,"_components",(function(){return V})),n.d(t,"_getProvider",(function(){return K})),n.d(t,"_registerComponent",(function(){return z})),n.d(t,"_removeServiceInstance",(function(){return W})),n.d(t,"deleteApp",(function(){return ee})),n.d(t,"getApp",(function(){return J})),n.d(t,"getApps",(function(){return Z})),n.d(t,"initializeApp",(function(){return X})),n.d(t,"onLog",(function(){return ne})),n.d(t,"registerVersion",(function(){return te})),n.d(t,"setLogLevel",(function(){return re}));var r=n("22e5"),i=n("e691"),s=n("1fd5");n.d(t,"FirebaseError",(function(){return s["c"]}));var o=n("1d25");class a{constructor(e){this.container=e}getPlatformInfoString(){const e=this.container.getProviders();return e.map(e=>{if(c(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}function c(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}const u="@firebase/app",l="0.8.3",h=new i["b"]("@firebase/app"),d="@firebase/app-compat",f="@firebase/analytics-compat",p="@firebase/analytics",g="@firebase/app-check-compat",m="@firebase/app-check",y="@firebase/auth",_="@firebase/auth-compat",v="@firebase/database",w="@firebase/database-compat",b="@firebase/functions",I="@firebase/functions-compat",T="@firebase/installations",E="@firebase/installations-compat",k="@firebase/messaging",C="@firebase/messaging-compat",S="@firebase/performance",O="@firebase/performance-compat",A="@firebase/remote-config",N="@firebase/remote-config-compat",R="@firebase/storage",D="@firebase/storage-compat",x="@firebase/firestore",P="@firebase/firestore-compat",M="firebase",j="9.13.0",L="[DEFAULT]",F={[u]:"fire-core",[d]:"fire-core-compat",[p]:"fire-analytics",[f]:"fire-analytics-compat",[m]:"fire-app-check",[g]:"fire-app-check-compat",[y]:"fire-auth",[_]:"fire-auth-compat",[v]:"fire-rtdb",[w]:"fire-rtdb-compat",[b]:"fire-fn",[I]:"fire-fn-compat",[T]:"fire-iid",[E]:"fire-iid-compat",[k]:"fire-fcm",[C]:"fire-fcm-compat",[S]:"fire-perf",[O]:"fire-perf-compat",[A]:"fire-rc",[N]:"fire-rc-compat",[R]:"fire-gcs",[D]:"fire-gcs-compat",[x]:"fire-fst",[P]:"fire-fst-compat","fire-js":"fire-js",[M]:"fire-js-all"},U=new Map,V=new Map;function q(e,t){try{e.container.addComponent(t)}catch(n){h.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function B(e,t){e.container.addOrOverwriteComponent(t)}function z(e){const t=e.name;if(V.has(t))return h.debug(`There were multiple attempts to register component ${t}.`),!1;V.set(t,e);for(const n of U.values())q(n,e);return!0}function K(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function W(e,t,n=L){K(e,t).clearInstance(n)}function $(){V.clear()}const G={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},H=new s["b"]("app","Firebase",G);class Q{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r["a"]("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw H.create("app-deleted",{appName:this._name})}}const Y=j;function X(e,t={}){let n=e;if("object"!==typeof t){const e=t;t={name:e}}const i=Object.assign({name:L,automaticDataCollectionEnabled:!1},t),o=i.name;if("string"!==typeof o||!o)throw H.create("bad-app-name",{appName:String(o)});if(n||(n=Object(s["u"])()),!n)throw H.create("no-options");const a=U.get(o);if(a){if(Object(s["q"])(n,a.options)&&Object(s["q"])(i,a.config))return a;throw H.create("duplicate-app",{appName:o})}const c=new r["b"](o);for(const r of V.values())c.addComponent(r);const u=new Q(n,i,c);return U.set(o,u),u}function J(e=L){const t=U.get(e);if(!t&&e===L)return X();if(!t)throw H.create("no-app",{appName:e});return t}function Z(){return Array.from(U.values())}async function ee(e){const t=e.name;U.has(t)&&(U.delete(t),await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function te(e,t,n){var i;let s=null!==(i=F[e])&&void 0!==i?i:e;n&&(s+="-"+n);const o=s.match(/\s|\//),a=t.match(/\s|\//);if(o||a){const e=[`Unable to register library "${s}" with version "${t}":`];return o&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void h.warn(e.join(" "))}z(new r["a"](s+"-version",()=>({library:s,version:t}),"VERSION"))}function ne(e,t){if(null!==e&&"function"!==typeof e)throw H.create("invalid-log-argument");Object(i["d"])(e,t)}function re(e){Object(i["c"])(e)}const ie="firebase-heartbeat-database",se=1,oe="firebase-heartbeat-store";let ae=null;function ce(){return ae||(ae=Object(o["b"])(ie,se,{upgrade:(e,t)=>{switch(t){case 0:e.createObjectStore(oe)}}}).catch(e=>{throw H.create("idb-open",{originalErrorMessage:e.message})})),ae}async function ue(e){var t;try{const t=await ce();return t.transaction(oe).objectStore(oe).get(he(e))}catch(n){if(n instanceof s["c"])h.warn(n.message);else{const e=H.create("idb-get",{originalErrorMessage:null===(t=n)||void 0===t?void 0:t.message});h.warn(e.message)}}}async function le(e,t){var n;try{const n=await ce(),r=n.transaction(oe,"readwrite"),i=r.objectStore(oe);return await i.put(t,he(e)),r.done}catch(r){if(r instanceof s["c"])h.warn(r.message);else{const e=H.create("idb-set",{originalErrorMessage:null===(n=r)||void 0===n?void 0:n.message});h.warn(e.message)}}}function he(e){return`${e.name}!${e.options.appId}`}const de=1024,fe=2592e6;class pe{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new ye(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate(),t=e.getPlatformInfoString(),n=ge();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==n&&!this._heartbeatsCache.heartbeats.some(e=>e.date===n))return this._heartbeatsCache.heartbeats.push({date:n,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{const t=new Date(e.date).valueOf(),n=Date.now();return n-t<=fe}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=ge(),{heartbeatsToSend:t,unsentEntries:n}=me(this._heartbeatsCache.heartbeats),r=Object(s["k"])(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function ge(){const e=new Date;return e.toISOString().substring(0,10)}function me(e,t=de){const n=[];let r=e.slice();for(const i of e){const e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),_e(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),_e(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class ye{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Object(s["G"])()&&Object(s["ab"])().then(()=>!0).catch(()=>!1)}async read(){const e=await this._canUseIndexedDBPromise;if(e){const e=await ue(this.app);return e||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;const n=await this._canUseIndexedDBPromise;if(n){const n=await this.read();return le(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;const n=await this._canUseIndexedDBPromise;if(n){const n=await this.read();return le(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function _e(e){return Object(s["k"])(JSON.stringify({version:2,heartbeats:e})).length}function ve(e){z(new r["a"]("platform-logger",e=>new a(e),"PRIVATE")),z(new r["a"]("heartbeat",e=>new pe(e),"PRIVATE")),te(u,l,e),te(u,l,"esm2017"),te("fire-js","")}ve("")},5994:function(e,t,n){"use strict";(function(e){var t=n("7ded"),r=n("1f5a"),i=n("22e5"),s=n("1fd5"),o="@firebase/auth-compat",a="0.2.24";const c=1e3;function u(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function l(){return"http:"===u()||"https:"===u()}function h(e=Object(s["A"])()){return!("file:"!==u()&&"ionic:"!==u()&&"capacitor:"!==u()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function d(){return Object(s["K"])()||Object(s["I"])()}function f(){return Object(s["F"])()&&11===(null===document||void 0===document?void 0:document.documentMode)}function p(e=Object(s["A"])()){return/Edge\/\d+/.test(e)}function g(e=Object(s["A"])()){return f()||p(e)}function m(){try{const e=self.localStorage,t=r["s"]();if(e)return e["setItem"](t,"1"),e["removeItem"](t),!g()||Object(s["G"])()}catch(e){return y()&&Object(s["G"])()}return!1}function y(){return"undefined"!==typeof e&&"WorkerGlobalScope"in e&&"importScripts"in e}function _(){return(l()||Object(s["D"])()||h())&&!d()&&m()&&!y()}function v(){return h()&&"undefined"!==typeof document}async function w(){return!!v()&&new Promise(e=>{const t=setTimeout(()=>{e(!1)},c);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})}function b(){return"undefined"!==typeof window?window:null}const I={LOCAL:"local",NONE:"none",SESSION:"session"},T=r["p"],E="persistence";function k(e,t){T(Object.values(I).includes(t),e,"invalid-persistence-type"),Object(s["K"])()?T(t!==I.SESSION,e,"unsupported-persistence-type"):Object(s["I"])()?T(t===I.NONE,e,"unsupported-persistence-type"):y()?T(t===I.NONE||t===I.LOCAL&&Object(s["G"])(),e,"unsupported-persistence-type"):T(t===I.NONE||m(),e,"unsupported-persistence-type")}async function C(e){await e._initializationPromise;const t=O(),n=r["w"](E,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function S(e,t){const n=O();if(!n)return[];const i=r["w"](E,e,t),s=n.getItem(i);switch(s){case I.NONE:return[r["M"]];case I.LOCAL:return[r["N"],r["B"]];case I.SESSION:return[r["B"]];default:return[]}}function O(){var e;try{return(null===(e=b())||void 0===e?void 0:e.sessionStorage)||null}catch(t){return null}}const A=r["p"];class N{constructor(){this.browserResolver=r["t"](r["A"]),this.cordovaResolver=r["t"](r["F"]),this.underlyingResolver=null,this._redirectPersistence=r["B"],this._completeRedirectFn=r["u"],this._overrideRedirectResult=r["v"]}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return v()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return A(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await w();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function R(e){return e.unwrap()}function D(e){return e.wrapped()}function x(e){return M(e)}function P(e,t){var n,i;const s=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===(null===(i=t)||void 0===i?void 0:i.code)){const n=t;n.resolver=new F(e,r["K"](e,t))}else if(s){const e=M(t),n=t;e&&(n.credential=e,n.tenantId=s.tenantId||void 0,n.email=s.email||void 0,n.phoneNumber=s.phoneNumber||void 0)}}function M(e){const{_tokenResponse:t}=e instanceof s["c"]?e.customData:e;if(!t)return null;if(!(e instanceof s["c"])&&"temporaryProof"in t&&"phoneNumber"in t)return r["i"].credentialFromResult(e);const n=t.providerId;if(!n||n===r["k"].PASSWORD)return null;let i;switch(n){case r["k"].GOOGLE:i=r["f"];break;case r["k"].FACEBOOK:i=r["d"];break;case r["k"].GITHUB:i=r["e"];break;case r["k"].TWITTER:i=r["o"];break;default:const{oauthIdToken:e,oauthAccessToken:s,oauthTokenSecret:o,pendingToken:a,nonce:c}=t;return s||o||e||a?a?n.startsWith("saml.")?r["m"]._create(n,a):r["g"]._fromParams({providerId:n,signInMethod:n,pendingToken:a,idToken:e,accessToken:s}):new r["h"](n).credential({idToken:e,accessToken:s,rawNonce:c}):null}return e instanceof s["c"]?i.credentialFromError(e):i.credentialFromResult(e)}function j(e,t){return t.catch(t=>{throw t instanceof s["c"]&&P(e,t),t}).then(e=>{const t=e.operationType,n=e.user;return{operationType:t,credential:x(e),additionalUserInfo:r["J"](e),user:U.getOrCreate(n)}})}async function L(e,t){const n=await t;return{verificationId:n.verificationId,confirm:t=>j(e,n.confirm(t))}}class F{constructor(e,t){this.resolver=t,this.auth=D(e)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return j(R(this.auth),this.resolver.resolveSignIn(e))}}class U{constructor(e){this._delegate=e,this.multiFactor=r["T"](e)}static getOrCreate(e){return U.USER_MAP.has(e)||U.USER_MAP.set(e,new U(e)),U.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return j(this.auth,r["P"](this._delegate,e))}async linkWithPhoneNumber(e,t){return L(this.auth,r["Q"](this._delegate,e,t))}async linkWithPopup(e){return j(this.auth,r["R"](this._delegate,e,N))}async linkWithRedirect(e){return await C(r["q"](this.auth)),r["S"](this._delegate,e,N)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return j(this.auth,r["U"](this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return L(this.auth,r["V"](this._delegate,e,t))}reauthenticateWithPopup(e){return j(this.auth,r["W"](this._delegate,e,N))}async reauthenticateWithRedirect(e){return await C(r["q"](this.auth)),r["X"](this._delegate,e,N)}sendEmailVerification(e){return r["Y"](this._delegate,e)}async unlink(e){return await r["jb"](this._delegate,e),this}updateEmail(e){return r["kb"](this._delegate,e)}updatePassword(e){return r["lb"](this._delegate,e)}updatePhoneNumber(e){return r["mb"](this._delegate,e)}updateProfile(e){return r["nb"](this._delegate,e)}verifyBeforeUpdateEmail(e,t){return r["ob"](this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}U.USER_MAP=new WeakMap;const V=r["p"];class q{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:n}=e.options;V(n,"invalid-api-key",{appName:e.name}),V(n,"invalid-api-key",{appName:e.name});const i="undefined"!==typeof window?N:void 0;this._delegate=t.initialize({options:{persistence:z(n,e.name),popupRedirectResolver:i}}),this._delegate._updateErrorMap(r["H"]),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?U.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){r["E"](this._delegate,e,t)}applyActionCode(e){return r["y"](this._delegate,e)}checkActionCode(e){return r["C"](this._delegate,e)}confirmPasswordReset(e,t){return r["D"](this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return j(this._delegate,r["G"](this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return r["I"](this._delegate,e)}isSignInWithEmailLink(e){return r["O"](this._delegate,e)}async getRedirectResult(){V(_(),this._delegate,"operation-not-supported-in-this-environment");const e=await r["L"](this._delegate,N);return e?j(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){r["x"](this._delegate,e)}onAuthStateChanged(e,t,n){const{next:r,error:i,complete:s}=B(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){const{next:r,error:i,complete:s}=B(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return r["ab"](this._delegate,e,t)}sendPasswordResetEmail(e,t){return r["Z"](this._delegate,e,t||void 0)}async setPersistence(e){let t;switch(k(this._delegate,e),e){case I.SESSION:t=r["B"];break;case I.LOCAL:const e=await r["t"](r["N"])._isAvailable();t=e?r["N"]:r["z"];break;case I.NONE:t=r["M"];break;default:return r["r"]("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return j(this._delegate,r["bb"](this._delegate))}signInWithCredential(e){return j(this._delegate,r["cb"](this._delegate,e))}signInWithCustomToken(e){return j(this._delegate,r["db"](this._delegate,e))}signInWithEmailAndPassword(e,t){return j(this._delegate,r["eb"](this._delegate,e,t))}signInWithEmailLink(e,t){return j(this._delegate,r["fb"](this._delegate,e,t))}signInWithPhoneNumber(e,t){return L(this._delegate,r["gb"](this._delegate,e,t))}async signInWithPopup(e){return V(_(),this._delegate,"operation-not-supported-in-this-environment"),j(this._delegate,r["hb"](this._delegate,e,N))}async signInWithRedirect(e){return V(_(),this._delegate,"operation-not-supported-in-this-environment"),await C(this._delegate),r["ib"](this._delegate,e,N)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return r["pb"](this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function B(e,t,n){let r=e;"function"!==typeof e&&({next:r,error:t,complete:n}=e);const i=r,s=e=>i(e&&U.getOrCreate(e));return{next:s,error:t,complete:n}}function z(e,t){const n=S(e,t);if("undefined"===typeof self||n.includes(r["N"])||n.push(r["N"]),"undefined"!==typeof window)for(const i of[r["z"],r["B"]])n.includes(i)||n.push(i);return n.includes(r["M"])||n.push(r["M"]),n}q.Persistence=I;class K{constructor(){this.providerId="phone",this._delegate=new r["i"](R(t["a"].auth()))}static credential(e,t){return r["i"].credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}K.PHONE_SIGN_IN_METHOD=r["i"].PHONE_SIGN_IN_METHOD,K.PROVIDER_ID=r["i"].PROVIDER_ID;const W=r["p"];class ${constructor(e,n,i=t["a"].app()){var s;W(null===(s=i.options)||void 0===s?void 0:s.apiKey,"invalid-api-key",{appName:i.name}),this._delegate=new r["l"](e,n,i.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}const G="auth-compat";function H(e){e.INTERNAL.registerComponent(new i["a"](G,e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new q(t,n)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:r["a"].EMAIL_SIGNIN,PASSWORD_RESET:r["a"].PASSWORD_RESET,RECOVER_EMAIL:r["a"].RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:r["a"].REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:r["a"].VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:r["a"].VERIFY_EMAIL}},EmailAuthProvider:r["c"],FacebookAuthProvider:r["d"],GithubAuthProvider:r["e"],GoogleAuthProvider:r["f"],OAuthProvider:r["h"],SAMLAuthProvider:r["n"],PhoneAuthProvider:K,PhoneMultiFactorGenerator:r["j"],RecaptchaVerifier:$,TwitterAuthProvider:r["o"],Auth:q,AuthCredential:r["b"],Error:s["c"]}).setInstantiationMode("LAZY").setMultipleInstances(!1)),e.registerVersion(o,a)}H(t["a"])}).call(this,n("c8ba"))},"7ded":function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var r=n("1fd5"),i=n("22e5"),s=n("589b"),o=n("e691");class a{constructor(e,t){this._delegate=e,this.firebase=t,Object(s["_addComponent"])(e,new i["a"]("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),Object(s["deleteApp"])(this._delegate)))}_getService(e,t=s["_DEFAULT_ENTRY_NAME"]){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=s["_DEFAULT_ENTRY_NAME"]){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){Object(s["_addComponent"])(this._delegate,e)}_addOrOverwriteComponent(e){Object(s["_addOrOverwriteComponent"])(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const c={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance."},u=new r["b"]("app-compat","Firebase",c);function l(e){const t={},n={__esModule:!0,initializeApp:a,app:o,registerVersion:s["registerVersion"],setLogLevel:s["setLogLevel"],onLog:s["onLog"],apps:null,SDK_VERSION:s["SDK_VERSION"],INTERNAL:{registerComponent:l,removeApp:i,useAsService:h,modularAPIs:s}};function i(e){delete t[e]}function o(e){if(e=e||s["_DEFAULT_ENTRY_NAME"],!Object(r["m"])(t,e))throw u.create("no-app",{appName:e});return t[e]}function a(i,o={}){const a=s["initializeApp"](i,o);if(Object(r["m"])(t,a.name))return t[a.name];const c=new e(a,n);return t[a.name]=c,c}function c(){return Object.keys(t).map(e=>t[e])}function l(t){const i=t.name,a=i.replace("-compat","");if(s["_registerComponent"](t)&&"PUBLIC"===t.type){const s=(e=o())=>{if("function"!==typeof e[a])throw u.create("invalid-app-argument",{appName:i});return e[a]()};void 0!==t.serviceProps&&Object(r["r"])(s,t.serviceProps),n[a]=s,e.prototype[a]=function(...e){const n=this._getService.bind(this,i);return n.apply(this,t.multipleInstances?e:[])}}return"PUBLIC"===t.type?n[a]:null}function h(e,t){if("serverAuth"===t)return null;const n=t;return n}return n["default"]=n,Object.defineProperty(n,"apps",{get:c}),o["App"]=e,n}function h(){const e=l(a);function t(t){Object(r["r"])(e,t)}return e.INTERNAL=Object.assign(Object.assign({},e.INTERNAL),{createFirebaseNamespace:h,extendNamespace:t,createSubscribe:r["o"],ErrorFactory:r["b"],deepExtend:r["r"]}),e}const d=h(),f=new o["b"]("@firebase/app-compat"),p="@firebase/app-compat",g="0.1.38";function m(e){Object(s["registerVersion"])(p,g,e)}if(Object(r["C"])()&&void 0!==self.firebase){f.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&f.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const y=d;m()},"8f6b":function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return mr})),n.d(t,"b",(function(){return _r})),n.d(t,"c",(function(){return yr})),n.d(t,"d",(function(){return wr})),n.d(t,"e",(function(){return vr})),n.d(t,"f",(function(){return br})),n.d(t,"g",(function(){return Ir})),n.d(t,"h",(function(){return pr})),n.d(t,"i",(function(){return gr}));var r,i="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof e?e:"undefined"!==typeof self?self:{},s={},o=o||{},a=i||self;function c(){}function u(e){var t=typeof e;return t="object"!=t?t:e?Array.isArray(e)?"array":t:"null","array"==t||"object"==t&&"number"==typeof e.length}function l(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function h(e){return Object.prototype.hasOwnProperty.call(e,d)&&e[d]||(e[d]=++f)}var d="closure_uid_"+(1e9*Math.random()>>>0),f=0;function p(e,t,n){return e.call.apply(e.bind,arguments)}function g(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function m(e,t,n){return m=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?p:g,m.apply(null,arguments)}function y(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function _(e,t){function n(){}n.prototype=t.prototype,e.X=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Wb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function v(){this.s=this.s,this.o=this.o}var w=0;v.prototype.s=!1,v.prototype.na=function(){this.s||(this.s=!0,this.M(),0==w)||h(this)},v.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const b=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"===typeof e)return"string"!==typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function I(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function T(e,t){for(let n=1;n<arguments.length;n++){const t=arguments[n];if(u(t)){const n=e.length||0,r=t.length||0;e.length=n+r;for(let i=0;i<r;i++)e[n+i]=t[i]}else e.push(t)}}function E(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}E.prototype.h=function(){this.defaultPrevented=!0};var k=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{a.addEventListener("test",c,t),a.removeEventListener("test",c,t)}catch(n){}return e}();function C(e){return/^[\s\xa0]*$/.test(e)}var S=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function O(e,t){return e<t?-1:e>t?1:0}function A(){var e=a.navigator;return e&&(e=e.userAgent)?e:""}function N(e){return-1!=A().indexOf(e)}function R(e){return R[" "](e),e}function D(e){var t=W;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9)}R[" "]=c;var x,P=N("Opera"),M=N("Trident")||N("MSIE"),j=N("Edge"),L=j||M,F=N("Gecko")&&!(-1!=A().toLowerCase().indexOf("webkit")&&!N("Edge"))&&!(N("Trident")||N("MSIE"))&&!N("Edge"),U=-1!=A().toLowerCase().indexOf("webkit")&&!N("Edge");function V(){var e=a.document;return e?e.documentMode:void 0}e:{var q="",B=function(){var e=A();return F?/rv:([^\);]+)(\)|;)/.exec(e):j?/Edge\/([\d\.]+)/.exec(e):M?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):U?/WebKit\/(\S+)/.exec(e):P?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(B&&(q=B?B[1]:""),M){var z=V();if(null!=z&&z>parseFloat(q)){x=String(z);break e}}x=q}var K,W={};function $(){return D((function(){let e=0;const t=S(String(x)).split("."),n=S("9").split("."),r=Math.max(t.length,n.length);for(let o=0;0==e&&o<r;o++){var i=t[o]||"",s=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;e=O(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||O(0==i[2].length,0==s[2].length)||O(i[2],s[2]),i=i[3],s=s[3]}while(0==e)}return 0<=e}))}if(a.document&&M){var G=V();K=G||(parseInt(x,10)||void 0)}else K=void 0;var H=K;function Q(e,t){if(E.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(F){e:{try{R(t.nodeName);var i=!0;break e}catch(s){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:Y[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&Q.X.h.call(this)}}_(Q,E);var Y={2:"touch",3:"pen",4:"mouse"};Q.prototype.h=function(){Q.X.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var X="closure_listenable_"+(1e6*Math.random()|0),J=0;function Z(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++J,this.ba=this.ea=!1}function ee(e){e.ba=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function te(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function ne(e){const t={};for(const n in e)t[n]=e[n];return t}const re="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ie(e,t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)e[n]=r[n];for(let t=0;t<re.length;t++)n=re[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function se(e){this.src=e,this.g={},this.h=0}function oe(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=b(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(ee(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function ae(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ba&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}se.prototype.add=function(e,t,n,r,i){var s=e.toString();e=this.g[s],e||(e=this.g[s]=[],this.h++);var o=ae(e,t,r,i);return-1<o?(t=e[o],n||(t.ea=!1)):(t=new Z(t,this.src,s,!!r,i),t.ea=n,e.push(t)),t};var ce="closure_lm_"+(1e6*Math.random()|0),ue={};function le(e,t,n,r,i){if(r&&r.once)return fe(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)le(e,t[s],n,r,i);return null}return n=we(n),e&&e[X]?e.N(t,n,l(r)?!!r.capture:!!r,i):he(e,t,n,!1,r,i)}function he(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=l(i)?!!i.capture:!!i,a=_e(e);if(a||(e[ce]=a=new se(e)),n=a.add(t,n,r,o,s),n.proxy)return n;if(r=de(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)k||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(me(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function de(){function e(n){return t.call(e.src,e.listener,n)}const t=ye;return e}function fe(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)fe(e,t[s],n,r,i);return null}return n=we(n),e&&e[X]?e.O(t,n,l(r)?!!r.capture:!!r,i):he(e,t,n,!0,r,i)}function pe(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)pe(e,t[s],n,r,i);else r=l(r)?!!r.capture:!!r,n=we(n),e&&e[X]?(e=e.i,t=String(t).toString(),t in e.g&&(s=e.g[t],n=ae(s,n,r,i),-1<n&&(ee(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--)))):e&&(e=_e(e))&&(t=e.g[t.toString()],e=-1,t&&(e=ae(t,n,r,i)),(n=-1<e?t[e]:null)&&ge(n))}function ge(e){if("number"!==typeof e&&e&&!e.ba){var t=e.src;if(t&&t[X])oe(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(me(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=_e(t))?(oe(n,e),0==n.h&&(n.src=null,t[ce]=null)):ee(e)}}}function me(e){return e in ue?ue[e]:ue[e]="on"+e}function ye(e,t){if(e.ba)e=!0;else{t=new Q(t,this);var n=e.listener,r=e.ha||e.src;e.ea&&ge(e),e=n.call(r,t)}return e}function _e(e){return e=e[ce],e instanceof se?e:null}var ve="__closure_events_fn_"+(1e9*Math.random()>>>0);function we(e){return"function"===typeof e?e:(e[ve]||(e[ve]=function(t){return e.handleEvent(t)}),e[ve])}function be(){v.call(this),this.i=new se(this),this.P=this,this.I=null}function Ie(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"===typeof t)t=new E(t,e);else if(t instanceof E)t.target=t.target||e;else{var i=t;t=new E(r,e),ie(t,i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=Te(o,r,!0,t)&&i}if(o=t.g=e,i=Te(o,r,!0,t)&&i,i=Te(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)o=t.g=n[s],i=Te(o,r,!1,t)&&i}function Te(e,t,n,r){if(t=e.i.g[String(t)],!t)return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.ba&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.ea&&oe(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}_(be,v),be.prototype[X]=!0,be.prototype.removeEventListener=function(e,t,n,r){pe(this,e,t,n,r)},be.prototype.M=function(){if(be.X.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)ee(n[r]);delete t.g[e],t.h--}}this.I=null},be.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},be.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Ee=a.JSON.stringify;function ke(){var e=Pe;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}class Ce{constructor(){this.h=this.g=null}add(e,t){const n=Oe.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}var Se,Oe=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Ae,e=>e.reset());class Ae{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Ne(e){a.setTimeout(()=>{throw e},0)}function Re(e,t){Se||De(),xe||(Se(),xe=!0),Pe.add(e,t)}function De(){var e=a.Promise.resolve(void 0);Se=function(){e.then(Me)}}var xe=!1,Pe=new Ce;function Me(){for(var e;e=ke();){try{e.h.call(e.g)}catch(n){Ne(n)}var t=Oe;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}xe=!1}function je(e,t){be.call(this),this.h=e||1,this.g=t||a,this.j=m(this.lb,this),this.l=Date.now()}function Le(e){e.ca=!1,e.R&&(e.g.clearTimeout(e.R),e.R=null)}function Fe(e,t,n){if("function"===typeof e)n&&(e=m(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=m(e.handleEvent,e)}return 2147483647<Number(t)?-1:a.setTimeout(e,t||0)}function Ue(e){e.g=Fe(()=>{e.g=null,e.i&&(e.i=!1,Ue(e))},e.j);const t=e.h;e.h=null,e.m.apply(null,t)}_(je,be),r=je.prototype,r.ca=!1,r.R=null,r.lb=function(){if(this.ca){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-e):(this.R&&(this.g.clearTimeout(this.R),this.R=null),Ie(this,"tick"),this.ca&&(Le(this),this.start()))}},r.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.M=function(){je.X.M.call(this),Le(this),delete this.g};class Ve extends v{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Ue(this)}M(){super.M(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function qe(e){v.call(this),this.h=e,this.g={}}_(qe,v);var Be=[];function ze(e,t,n,r){Array.isArray(n)||(n&&(Be[0]=n.toString()),n=Be);for(var i=0;i<n.length;i++){var s=le(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Ke(e){te(e.g,(function(e,t){this.g.hasOwnProperty(t)&&ge(e)}),e),e.g={}}function We(){this.g=!0}function $e(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}function Ge(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}function He(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+Ye(e,n)+(r?" "+r:"")}))}function Qe(e,t){e.info((function(){return"TIMEOUT: "+t}))}function Ye(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Ee(n)}catch(a){return t}}qe.prototype.M=function(){qe.X.M.call(this),Ke(this)},qe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},We.prototype.Aa=function(){this.g=!1},We.prototype.info=function(){};var Xe={},Je=null;function Ze(){return Je=Je||new be}function et(e){E.call(this,Xe.Pa,e)}function tt(e){const t=Ze();Ie(t,new et(t))}function nt(e,t){E.call(this,Xe.STAT_EVENT,e),this.stat=t}function rt(e){const t=Ze();Ie(t,new nt(t,e))}function it(e,t){E.call(this,Xe.Qa,e),this.size=t}function st(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return a.setTimeout((function(){e()}),t)}Xe.Pa="serverreachability",_(et,E),Xe.STAT_EVENT="statevent",_(nt,E),Xe.Qa="timingevent",_(it,E);var ot={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},at={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function ct(){}function ut(e){return e.h||(e.h=e.i())}function lt(){}ct.prototype.h=null;var ht,dt={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function ft(){E.call(this,"d")}function pt(){E.call(this,"c")}function gt(){}function mt(e,t,n,r){this.l=e,this.j=t,this.m=n,this.U=r||1,this.S=new qe(this),this.O=_t,e=L?125:void 0,this.T=new je(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new yt}function yt(){this.i=null,this.g="",this.h=!1}_(ft,E),_(pt,E),_(gt,ct),gt.prototype.g=function(){return new XMLHttpRequest},gt.prototype.i=function(){return{}},ht=new gt;var _t=45e3,vt={},wt={};function bt(e,t,n){e.K=1,e.v=zt(Ft(t)),e.s=n,e.P=!0,It(e,null)}function It(e,t){e.F=Date.now(),Ct(e),e.A=Ft(e.v);var n=e.A,r=e.U;Array.isArray(r)||(r=[String(r)]),nn(n.i,"t",r),e.C=0,n=e.l.H,e.h=new yt,e.g=ar(e.l,n?t:null,!e.s),0<e.N&&(e.L=new Ve(m(e.La,e,e.g),e.N)),ze(e.S,e.g,"readystatechange",e.ib),t=e.H?ne(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.da(e.A,e.u,e.s,t)):(e.u="GET",e.g.da(e.A,e.u,null,t)),tt(),$e(e.j,e.u,e.A,e.m,e.U,e.s)}function Tt(e){return!!e.g&&("GET"==e.u&&2!=e.K&&e.l.Da)}function Et(e,t,n){let r,i=!0;for(;!e.I&&e.C<n.length;){if(r=kt(e,n),r==wt){4==t&&(e.o=4,rt(14),i=!1),He(e.j,e.m,null,"[Incomplete Response]");break}if(r==vt){e.o=4,rt(15),He(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}He(e.j,e.m,r,null),Rt(e,r)}Tt(e)&&r!=wt&&r!=vt&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,rt(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.$&&(e.$=!0,t=e.l,t.g==e&&t.$&&!t.K&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Zn(t),t.K=!0,rt(11))):(He(e.j,e.m,n,"[Invalid Chunked Response]"),Nt(e),At(e))}function kt(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?wt:(n=Number(t.substring(n,r)),isNaN(n)?vt:(r+=1,r+n>t.length?wt:(t=t.substr(r,n),e.C=r+n,t)))}function Ct(e){e.V=Date.now()+e.O,St(e,e.O)}function St(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=st(m(e.gb,e),t)}function Ot(e){e.B&&(a.clearTimeout(e.B),e.B=null)}function At(e){0==e.l.G||e.I||nr(e.l,e)}function Nt(e){Ot(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Le(e.T),Ke(e.S),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Rt(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||hn(n.h,e)))if(!e.J&&hn(n.h,e)&&3==n.G){try{var r=n.Fa.g.parse(t)}catch(u){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;tr(n),Kn(n)}Jn(n),rt(18)}}else n.Ba=i[1],0<n.Ba-n.T&&37500>i[2]&&n.L&&0==n.A&&!n.v&&(n.v=st(m(n.cb,n),6e3));if(1>=ln(n.h)&&n.ja){try{n.ja()}catch(u){}n.ja=void 0}}else ir(n,11)}else if((e.J||n.g==e)&&tr(n),!C(t))for(i=n.Fa.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.T=u[0],u=u[1],2==n.G)if("c"==u[0]){n.I=u[1],n.ka=u[2];const t=u[3];null!=t&&(n.ma=t,n.j.info("VER="+n.ma));const i=u[4];null!=i&&(n.Ca=i,n.j.info("SVER="+n.Ca));const l=u[5];null!=l&&"number"===typeof l&&0<l&&(r=1.5*l,n.J=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(dn(s,s.h),s.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.za=e,Bt(r.F,r.D,e))}}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-e.F,n.j.info("Handshake RTT: "+n.P+"ms")),r=n;var o=e;if(r.sa=or(r,r.H?r.ka:null,r.V),o.J){fn(r.h,o);var a=o,c=r.J;c&&a.setTimeout(c),a.B&&(Ot(a),Ct(a)),r.g=o}else Xn(r);0<n.i.length&&$n(n)}else"stop"!=u[0]&&"close"!=u[0]||ir(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?ir(n,7):zn(n):"noop"!=u[0]&&n.l&&n.l.wa(u),n.A=0)}tt(4)}catch(u){}}function Dt(e){if(e.W&&"function"==typeof e.W)return e.W();if("undefined"!==typeof Map&&e instanceof Map||"undefined"!==typeof Set&&e instanceof Set)return Array.from(e.values());if("string"===typeof e)return e.split("");if(u(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}function xt(e){if(e.oa&&"function"==typeof e.oa)return e.oa();if(!e.W||"function"!=typeof e.W){if("undefined"!==typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!==typeof Set&&e instanceof Set)){if(u(e)||"string"===typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}function Pt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(u(e)||"string"===typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=xt(e),r=Dt(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}r=mt.prototype,r.setTimeout=function(e){this.O=e},r.ib=function(e){e=e.target;const t=this.L;t&&3==Ln(e)?t.l():this.La(e)},r.La=function(e){try{if(e==this.g)e:{const h=Ln(this.g);var t=this.g.Ea();const d=this.g.aa();if(!(3>h)&&(3!=h||L||this.g&&(this.h.h||this.g.fa()||Fn(this.g)))){this.I||4!=h||7==t||tt(8==t||0>=d?3:2),Ot(this);var n=this.g.aa();this.Y=n;t:if(Tt(this)){var r=Fn(this.g);e="";var i=r.length,s=4==Ln(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){Nt(this),At(this);var o="";break t}this.h.i=new a.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==n,Ge(this.j,this.u,this.A,this.m,this.U,h,n),this.i){if(this.Z&&!this.J){t:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(c)){var l=c;break t}}l=null}if(!(n=l)){this.i=!1,this.o=3,rt(12),Nt(this),At(this);break e}He(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Rt(this,n)}this.P?(Et(this,h,o),L&&this.i&&3==h&&(ze(this.S,this.T,"tick",this.hb),this.T.start())):(He(this.j,this.m,o,null),Rt(this,o)),4==h&&Nt(this),this.i&&!this.I&&(4==h?nr(this.l,this):(this.i=!1,Ct(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,rt(12)):(this.o=0,rt(13)),Nt(this),At(this)}}}catch(h){}},r.hb=function(){if(this.g){var e=Ln(this.g),t=this.g.fa();this.C<t.length&&(Ot(this),Et(this,e,t),this.i&&4!=e&&Ct(this))}},r.cancel=function(){this.I=!0,Nt(this)},r.gb=function(){this.B=null;const e=Date.now();0<=e-this.V?(Qe(this.j,this.A),2!=this.K&&(tt(),rt(17)),Nt(this),this.o=2,At(this)):St(this,this.V-e)};var Mt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function jt(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function Lt(e,t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof Lt){this.h=void 0!==t?t:e.h,Ut(this,e.j),this.s=e.s,this.g=e.g,Vt(this,e.m),this.l=e.l,t=e.i;var n=new Jt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),qt(this,n),this.o=e.o}else e&&(n=String(e).match(Mt))?(this.h=!!t,Ut(this,n[1]||"",!0),this.s=Kt(n[2]||""),this.g=Kt(n[3]||"",!0),Vt(this,n[4]),this.l=Kt(n[5]||"",!0),qt(this,n[6]||"",!0),this.o=Kt(n[7]||"")):(this.h=!!t,this.i=new Jt(null,this.h))}function Ft(e){return new Lt(e)}function Ut(e,t,n){e.j=n?Kt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Vt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function qt(e,t,n){t instanceof Jt?(e.i=t,sn(e.i,e.h)):(n||(t=Wt(t,Yt)),e.i=new Jt(t,e.h))}function Bt(e,t,n){e.i.set(t,n)}function zt(e){return Bt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Kt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Wt(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,$t),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function $t(e){return e=e.charCodeAt(0),"%"+(e>>4&15).toString(16)+(15&e).toString(16)}Lt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Wt(t,Gt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(Wt(t,Gt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,null!=n&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Wt(n,"/"==n.charAt(0)?Qt:Ht,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Wt(n,Xt)),e.join("")};var Gt=/[#\/\?@]/g,Ht=/[#\?:]/g,Qt=/[#\?]/g,Yt=/[#\?@]/g,Xt=/#/g;function Jt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Zt(e){e.g||(e.g=new Map,e.h=0,e.i&&jt(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function en(e,t){Zt(e),t=rn(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tn(e,t){return Zt(e),t=rn(e,t),e.g.has(t)}function nn(e,t,n){en(e,t),0<n.length&&(e.i=null,e.g.set(rn(e,t),I(n)),e.h+=n.length)}function rn(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function sn(e,t){t&&!e.j&&(Zt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(en(this,t),nn(this,n,e))}),e)),e.j=t}r=Jt.prototype,r.add=function(e,t){Zt(this),this.i=null,e=rn(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},r.forEach=function(e,t){Zt(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},r.oa=function(){Zt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},r.W=function(e){Zt(this);let t=[];if("string"===typeof e)tn(this,e)&&(t=t.concat(this.g.get(rn(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},r.set=function(e,t){return Zt(this),this.i=null,e=rn(this,e),tn(this,e)&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},r.get=function(e,t){return e?(e=this.W(e),0<e.length?String(e[0]):t):t},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.W(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")};var on=class{constructor(e,t){this.h=e,this.g=t}};function an(e){this.l=e||cn,a.PerformanceNavigationTiming?(e=a.performance.getEntriesByType("navigation"),e=0<e.length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol)):e=!!(a.g&&a.g.Ga&&a.g.Ga()&&a.g.Ga().$b),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var cn=10;function un(e){return!!e.h||!!e.g&&e.g.size>=e.j}function ln(e){return e.h?1:e.g?e.g.size:0}function hn(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function dn(e,t){e.g?e.g.add(t):e.h=t}function fn(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function pn(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return I(e.i)}function gn(){}function mn(){this.g=new gn}function yn(e,t,n){const r=n||"";try{Pt(e,(function(e,n){let i=e;l(e)&&(i=Ee(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function _n(e,t){const n=new We;if(a.Image){const r=new Image;r.onload=y(vn,n,r,"TestLoadImage: loaded",!0,t),r.onerror=y(vn,n,r,"TestLoadImage: error",!1,t),r.onabort=y(vn,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=y(vn,n,r,"TestLoadImage: timeout",!1,t),a.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}function vn(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(s){}}function wn(e){this.l=e.ac||null,this.j=e.jb||!1}function bn(e,t){be.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=In,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}an.prototype.cancel=function(){if(this.i=pn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},gn.prototype.stringify=function(e){return a.JSON.stringify(e,void 0)},gn.prototype.parse=function(e){return a.JSON.parse(e,void 0)},_(wn,ct),wn.prototype.g=function(){return new bn(this.l,this.j)},wn.prototype.i=function(e){return function(){return e}}({}),_(bn,be);var In=0;function Tn(e){e.j.read().then(e.Ta.bind(e)).catch(e.ga.bind(e))}function En(e){e.readyState=4,e.l=null,e.j=null,e.A=null,kn(e)}function kn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}r=bn.prototype,r.open=function(e,t){if(this.readyState!=In)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,kn(this)},r.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||a).fetch(new Request(this.B,t)).then(this.Wa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,En(this)),this.readyState=In},r.Wa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,kn(this)),this.g&&(this.readyState=3,kn(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if("undefined"!==typeof a.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Tn(this)}else e.text().then(this.Va.bind(this),this.ga.bind(this))},r.Ta=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?En(this):kn(this),3==this.readyState&&Tn(this)}},r.Va=function(e){this.g&&(this.response=this.responseText=e,En(this))},r.Ua=function(e){this.g&&(this.response=e,En(this))},r.ga=function(){this.g&&En(this)},r.setRequestHeader=function(e,t){this.v.append(e,t)},r.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(bn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Cn=a.JSON.parse;function Sn(e){be.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=On,this.K=this.L=!1}_(Sn,be);var On="",An=/^https?$/i,Nn=["POST","PUT"];function Rn(e){return M&&$()&&"number"===typeof e.timeout&&void 0!==e.ontimeout}function Dn(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,xn(e),Mn(e)}function xn(e){e.D||(e.D=!0,Ie(e,"complete"),Ie(e,"error"))}function Pn(e){if(e.h&&"undefined"!=typeof o&&(!e.C[1]||4!=Ln(e)||2!=e.aa()))if(e.v&&4==Ln(e))Fe(e.Ha,0,e);else if(Ie(e,"readystatechange"),4==Ln(e)){e.h=!1;try{const o=e.aa();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===o){var i=String(e.H).match(Mt)[1]||null;if(!i&&a.self&&a.self.location){var s=a.self.location.protocol;i=s.substr(0,s.length-1)}r=!An.test(i?i.toLowerCase():"")}n=r}if(n)Ie(e,"complete"),Ie(e,"success");else{e.m=6;try{var c=2<Ln(e)?e.g.statusText:""}catch(u){c=""}e.j=c+" ["+e.aa()+"]",xn(e)}}finally{Mn(e)}}}function Mn(e,t){if(e.g){jn(e);const r=e.g,i=e.C[0]?c:null;e.g=null,e.C=null,t||Ie(e,"ready");try{r.onreadystatechange=i}catch(n){}}}function jn(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(a.clearTimeout(e.A),e.A=null)}function Ln(e){return e.g?e.g.readyState:0}function Fn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case On:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Un(e){let t="";return te(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Vn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Un(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):Bt(e,t,n))}function qn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Bn(e){this.Ca=0,this.i=[],this.j=new We,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=qn("failFast",!1,e),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=qn("baseRetryDelayMs",5e3,e),this.bb=qn("retryDelaySeedMs",1e4,e),this.$a=qn("forwardChannelMaxRetries",2,e),this.ta=qn("forwardChannelRequestTimeoutMs",2e4,e),this.ra=e&&e.xmlHttpFactory||void 0,this.Da=e&&e.Zb||!1,this.J=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.I="",this.h=new an(e&&e.concurrentRequestLimit),this.Fa=new mn,this.O=e&&e.fastHandshake||!1,this.N=e&&e.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=e&&e.Xb||!1,e&&e.Aa&&this.j.Aa(),e&&e.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&e&&e.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function zn(e){if(Wn(e),3==e.G){var t=e.U++,n=Ft(e.F);Bt(n,"SID",e.I),Bt(n,"RID",t),Bt(n,"TYPE","terminate"),Qn(e,n),t=new mt(e,e.j,t,void 0),t.K=2,t.v=zt(Ft(n)),n=!1,a.navigator&&a.navigator.sendBeacon&&(n=a.navigator.sendBeacon(t.v.toString(),"")),!n&&a.Image&&((new Image).src=t.v,n=!0),n||(t.g=ar(t.l,null),t.g.da(t.v)),t.F=Date.now(),Ct(t)}sr(e)}function Kn(e){e.g&&(Zn(e),e.g.cancel(),e.g=null)}function Wn(e){Kn(e),e.u&&(a.clearTimeout(e.u),e.u=null),tr(e),e.h.cancel(),e.m&&("number"===typeof e.m&&a.clearTimeout(e.m),e.m=null)}function $n(e){un(e.h)||e.m||(e.m=!0,Re(e.Ja,e),e.C=0)}function Gn(e,t){return!(ln(e.h)>=e.h.j-(e.m?1:0))&&(e.m?(e.i=t.D.concat(e.i),!0):!(1==e.G||2==e.G||e.C>=(e.Za?0:e.$a))&&(e.m=st(m(e.Ja,e,t),rr(e,e.C)),e.C++,!0))}function Hn(e,t){var n;n=t?t.m:e.U++;const r=Ft(e.F);Bt(r,"SID",e.I),Bt(r,"RID",n),Bt(r,"AID",e.T),Qn(e,r),e.o&&e.s&&Vn(r,e.o,e.s),n=new mt(e,e.j,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.i=t.D.concat(e.i)),t=Yn(e,n,1e3),n.setTimeout(Math.round(.5*e.ta)+Math.round(.5*e.ta*Math.random())),dn(e.h,n),bt(n,r,t)}function Qn(e,t){e.ia&&te(e.ia,(function(e,n){Bt(t,n,e)})),e.l&&Pt({},(function(e,n){Bt(t,n,e)}))}function Yn(e,t,n){n=Math.min(e.i.length,n);var r=e.l?m(e.l.Ra,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let o=!0;for(let a=0;a<n;a++){let n=i[a].h;const c=i[a].g;if(n-=t,0>n)t=Math.max(0,i[a].h-100),o=!1;else try{yn(c,e,"req"+n+"_")}catch(s){r&&r(c)}}if(o){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function Xn(e){e.g||e.u||(e.Z=1,Re(e.Ia,e),e.A=0)}function Jn(e){return!(e.g||e.u||3<=e.A)&&(e.Z++,e.u=st(m(e.Ia,e),rr(e,e.A)),e.A++,!0)}function Zn(e){null!=e.B&&(a.clearTimeout(e.B),e.B=null)}function er(e){e.g=new mt(e,e.j,"rpc",e.Z),null===e.o&&(e.g.H=e.s),e.g.N=0;var t=Ft(e.sa);Bt(t,"RID","rpc"),Bt(t,"SID",e.I),Bt(t,"CI",e.L?"0":"1"),Bt(t,"AID",e.T),Bt(t,"TYPE","xmlhttp"),Qn(e,t),e.o&&e.s&&Vn(t,e.o,e.s),e.J&&e.g.setTimeout(e.J);var n=e.g;e=e.ka,n.K=1,n.v=zt(Ft(t)),n.s=null,n.P=!0,It(n,e)}function tr(e){null!=e.v&&(a.clearTimeout(e.v),e.v=null)}function nr(e,t){var n=null;if(e.g==t){tr(e),Zn(e),e.g=null;var r=2}else{if(!hn(e.h,t))return;n=t.D,fn(e.h,t),r=1}if(0!=e.G)if(e.pa=t.Y,t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;r=Ze(),Ie(r,new it(r,n)),$n(e)}else Xn(e);else if(i=t.o,3==i||0==i&&0<e.pa||!(1==r&&Gn(e,t)||2==r&&Jn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:ir(e,5);break;case 4:ir(e,10);break;case 3:ir(e,6);break;default:ir(e,2)}}function rr(e,t){let n=e.Xa+Math.floor(Math.random()*e.bb);return e.l||(n*=2),n*t}function ir(e,t){if(e.j.info("Error code "+t),2==t){var n=null;e.l&&(n=null);var r=m(e.kb,e);n||(n=new Lt("//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||Ut(n,"https"),zt(n)),_n(n.toString(),r)}else rt(2);e.G=0,e.l&&e.l.va(t),sr(e),Wn(e)}function sr(e){if(e.G=0,e.la=[],e.l){const t=pn(e.h);0==t.length&&0==e.i.length||(T(e.la,t),T(e.la,e.i),e.h.i.length=0,I(e.i),e.i.length=0),e.l.ua()}}function or(e,t,n){var r=n instanceof Lt?Ft(n):new Lt(n,void 0);if(""!=r.g)t&&(r.g=t+"."+r.g),Vt(r,r.m);else{var i=a.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new Lt(null,void 0);r&&Ut(s,r),t&&(s.g=t),i&&Vt(s,i),n&&(s.l=n),r=s}return n=e.D,t=e.za,n&&t&&Bt(r,n,t),Bt(r,"VER",e.ma),Qn(e,r),r}function ar(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return t=n&&e.Da&&!e.ra?new Sn(new wn({jb:!0})):new Sn(e.ra),t.Ka(e.H),t}function cr(){}function ur(){if(M&&!(10<=Number(H)))throw Error("Environmental error: no available transport.")}function lr(e,t){be.call(this),this.g=new Bn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.S=e,(e=t&&t.Yb)&&!C(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!C(t)&&(this.g.D=t,e=this.h,null!==e&&t in e&&(e=this.h,t in e&&delete e[t])),this.j=new fr(this)}function hr(e){ft.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function dr(){pt.call(this),this.status=1}function fr(e){this.g=e}r=Sn.prototype,r.Ka=function(e){this.L=e},r.da=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():ht.g(),this.C=this.u?ut(this.u):ut(ht),this.g.onreadystatechange=m(this.Ha,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(s){return void Dn(this,s)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!==typeof r.keys||"function"!==typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=a.FormData&&e instanceof a.FormData,!(0<=b(Nn,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[o,a]of n)this.g.setRequestHeader(o,a);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{jn(this),0<this.B&&((this.K=Rn(this.g))?(this.g.timeout=this.B,this.g.ontimeout=m(this.qa,this)):this.A=Fe(this.qa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(s){Dn(this,s)}},r.qa=function(){"undefined"!=typeof o&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ie(this,"timeout"),this.abort(8))},r.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Ie(this,"complete"),Ie(this,"abort"),Mn(this))},r.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Mn(this,!0)),Sn.X.M.call(this)},r.Ha=function(){this.s||(this.F||this.v||this.l?Pn(this):this.fb())},r.fb=function(){Pn(this)},r.aa=function(){try{return 2<Ln(this)?this.g.status:-1}catch(e){return-1}},r.fa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},r.Sa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Cn(t)}},r.Ea=function(){return this.m},r.Oa=function(){return"string"===typeof this.j?this.j:String(this.j)},r=Bn.prototype,r.ma=8,r.G=1,r.Ja=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new mt(this,this.j,e,void 0);let s=this.s;if(this.S&&(s?(s=ne(s),ie(s,this.S)):s=this.S),null!==this.o||this.N||(i.H=s,s=null),this.O)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(r="__data__"in r.g&&(r=r.g.__data__,"string"===typeof r)?r.length:void 0,void 0===r)break;if(t+=r,4096<t){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Yn(this,i,t),n=Ft(this.F),Bt(n,"RID",e),Bt(n,"CVER",22),this.D&&Bt(n,"X-HTTP-Session-Id",this.D),Qn(this,n),s&&(this.N?t="headers="+encodeURIComponent(String(Un(s)))+"&"+t:this.o&&Vn(n,this.o,s)),dn(this.h,i),this.Ya&&Bt(n,"TYPE","init"),this.O?(Bt(n,"$req",t),Bt(n,"SID","null"),i.Z=!0,bt(i,n,null)):bt(i,n,t),this.G=2}}else 3==this.G&&(e?Hn(this,e):0==this.i.length||un(this.h)||Hn(this))},r.Ia=function(){if(this.u=null,er(this),this.$&&!(this.K||null==this.g||0>=this.P)){var e=2*this.P;this.j.info("BP detection timer enabled: "+e),this.B=st(m(this.eb,this),e)}},r.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,rt(10),Kn(this),er(this))},r.cb=function(){null!=this.v&&(this.v=null,Kn(this),Jn(this),rt(19))},r.kb=function(e){e?(this.j.info("Successfully pinged google.com"),rt(2)):(this.j.info("Failed to ping google.com"),rt(1))},r=cr.prototype,r.xa=function(){},r.wa=function(){},r.va=function(){},r.ua=function(){},r.Ra=function(){},ur.prototype.g=function(e,t){return new lr(e,t)},_(lr,be),lr.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;rt(0),e.V=t,e.ia=n||{},e.L=e.Y,e.F=or(e,null,e.V),$n(e)},lr.prototype.close=function(){zn(this.g)},lr.prototype.u=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.v&&(n={},n.__data__=Ee(e),e=n);t.i.push(new on(t.ab++,e)),3==t.G&&$n(t)},lr.prototype.M=function(){this.g.l=null,delete this.j,zn(this.g),delete this.g,lr.X.M.call(this)},_(hr,ft),_(dr,pt),_(fr,cr),fr.prototype.xa=function(){Ie(this.g,"a")},fr.prototype.wa=function(e){Ie(this.g,new hr(e))},fr.prototype.va=function(e){Ie(this.g,new dr)},fr.prototype.ua=function(){Ie(this.g,"b")},ur.prototype.createWebChannel=ur.prototype.g,lr.prototype.send=lr.prototype.u,lr.prototype.open=lr.prototype.m,lr.prototype.close=lr.prototype.close,ot.NO_ERROR=0,ot.TIMEOUT=8,ot.HTTP_ERROR=6,at.COMPLETE="complete",lt.EventType=dt,dt.OPEN="a",dt.CLOSE="b",dt.ERROR="c",dt.MESSAGE="d",be.prototype.listen=be.prototype.N,Sn.prototype.listenOnce=Sn.prototype.O,Sn.prototype.getLastError=Sn.prototype.Oa,Sn.prototype.getLastErrorCode=Sn.prototype.Ea,Sn.prototype.getStatus=Sn.prototype.aa,Sn.prototype.getResponseJson=Sn.prototype.Sa,Sn.prototype.getResponseText=Sn.prototype.fa,Sn.prototype.send=Sn.prototype.da,Sn.prototype.setWithCredentials=Sn.prototype.Ka;var pr=s.createWebChannelTransport=function(){return new ur},gr=s.getStatEventTarget=function(){return Ze()},mr=s.ErrorCode=ot,yr=s.EventType=at,_r=s.Event=Xe,vr=s.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},wr=s.FetchXmlHttpFactory=wn,br=s.WebChannel=lt,Ir=s.XhrIo=Sn}).call(this,n("c8ba"))},c22d:function(e,t,n){"use strict";n.r(t);var r=n("7a23"),i=n("f80f"),s=n("5502"),o=n("589b"),a="firebase",c="9.13.0";Object(o["registerVersion"])(a,c,"app");var u=n("22e5"),l=n("1fd5"),h=n("1d25");const d="@firebase/installations",f="0.5.16",p=1e4,g="w:"+f,m="FIS_v2",y="https://firebaseinstallations.googleapis.com/v1",_=36e5,v="installations",w="Installations",b={["missing-app-config-values"]:'Missing App configuration value: "{$valueName}"',["not-registered"]:"Firebase Installation is not registered.",["installation-not-found"]:"Firebase Installation not found.",["request-failed"]:'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',["app-offline"]:"Could not process request. Application offline.",["delete-pending-registration"]:"Can't delete installation while there is a pending registration request."},I=new l["b"](v,w,b);function T(e){return e instanceof l["c"]&&e.code.includes("request-failed")}function E({projectId:e}){return`${y}/projects/${e}/installations`}function k(e){return{token:e.token,requestStatus:2,expiresIn:N(e.expiresIn),creationTime:Date.now()}}async function C(e,t){const n=await t.json(),r=n.error;return I.create("request-failed",{requestName:e,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function S({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function O(e,{refreshToken:t}){const n=S(e);return n.append("Authorization",R(t)),n}async function A(e){const t=await e();return t.status>=500&&t.status<600?e():t}function N(e){return Number(e.replace("s","000"))}function R(e){return`${m} ${e}`}async function D({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=E(e),i=S(e),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={fid:n,authVersion:m,appId:e.appId,sdkVersion:g},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await A(()=>fetch(r,a));if(c.ok){const e=await c.json(),t={fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:k(e.authToken)};return t}throw await C("Create Installation",c)}function x(e){return new Promise(t=>{setTimeout(t,e)})}function P(e){const t=btoa(String.fromCharCode(...e));return t.replace(/\+/g,"-").replace(/\//g,"_")}const M=/^[cdef][\w-]{21}$/,j="";function L(){try{const e=new Uint8Array(17),t=self.crypto||self.msCrypto;t.getRandomValues(e),e[0]=112+e[0]%16;const n=F(e);return M.test(n)?n:j}catch(e){return j}}function F(e){const t=P(e);return t.substr(0,22)}function U(e){return`${e.appName}!${e.appId}`}const V=new Map;function q(e,t){const n=U(e);B(n,t),z(n,t)}function B(e,t){const n=V.get(e);if(n)for(const r of n)r(t)}function z(e,t){const n=W();n&&n.postMessage({key:e,fid:t}),$()}let K=null;function W(){return!K&&"BroadcastChannel"in self&&(K=new BroadcastChannel("[Firebase] FID Change"),K.onmessage=e=>{B(e.data.key,e.data.fid)}),K}function $(){0===V.size&&K&&(K.close(),K=null)}const G="firebase-installations-database",H=1,Q="firebase-installations-store";let Y=null;function X(){return Y||(Y=Object(h["b"])(G,H,{upgrade:(e,t)=>{switch(t){case 0:e.createObjectStore(Q)}}})),Y}async function J(e,t){const n=U(e),r=await X(),i=r.transaction(Q,"readwrite"),s=i.objectStore(Q),o=await s.get(n);return await s.put(t,n),await i.done,o&&o.fid===t.fid||q(e,t.fid),t}async function Z(e){const t=U(e),n=await X(),r=n.transaction(Q,"readwrite");await r.objectStore(Q).delete(t),await r.done}async function ee(e,t){const n=U(e),r=await X(),i=r.transaction(Q,"readwrite"),s=i.objectStore(Q),o=await s.get(n),a=t(o);return void 0===a?await s.delete(n):await s.put(a,n),await i.done,!a||o&&o.fid===a.fid||q(e,a.fid),a}async function te(e){let t;const n=await ee(e.appConfig,n=>{const r=ne(n),i=re(e,r);return t=i.registrationPromise,i.installationEntry});return n.fid===j?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}function ne(e){const t=e||{fid:L(),registrationStatus:0};return ae(t)}function re(e,t){if(0===t.registrationStatus){if(!navigator.onLine){const e=Promise.reject(I.create("app-offline"));return{installationEntry:t,registrationPromise:e}}const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},r=ie(e,n);return{installationEntry:n,registrationPromise:r}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:se(e)}:{installationEntry:t}}async function ie(e,t){try{const n=await D(e,t);return J(e.appConfig,n)}catch(n){throw T(n)&&409===n.customData.serverCode?await Z(e.appConfig):await J(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}async function se(e){let t=await oe(e.appConfig);while(1===t.registrationStatus)await x(100),t=await oe(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await te(e);return n||t}return t}function oe(e){return ee(e,e=>{if(!e)throw I.create("installation-not-found");return ae(e)})}function ae(e){return ce(e)?{fid:e.fid,registrationStatus:0}:e}function ce(e){return 1===e.registrationStatus&&e.registrationTime+p<Date.now()}async function ue({appConfig:e,heartbeatServiceProvider:t},n){const r=le(e,n),i=O(e,n),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={installation:{sdkVersion:g,appId:e.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await A(()=>fetch(r,a));if(c.ok){const e=await c.json(),t=k(e);return t}throw await C("Generate Auth Token",c)}function le(e,{fid:t}){return`${E(e)}/${t}/authTokens:generate`}async function he(e,t=!1){let n;const r=await ee(e.appConfig,r=>{if(!ge(r))throw I.create("not-registered");const i=r.authToken;if(!t&&me(i))return r;if(1===i.requestStatus)return n=de(e,t),r;{if(!navigator.onLine)throw I.create("app-offline");const t=_e(r);return n=pe(e,t),t}}),i=n?await n:r.authToken;return i}async function de(e,t){let n=await fe(e.appConfig);while(1===n.authToken.requestStatus)await x(100),n=await fe(e.appConfig);const r=n.authToken;return 0===r.requestStatus?he(e,t):r}function fe(e){return ee(e,e=>{if(!ge(e))throw I.create("not-registered");const t=e.authToken;return ve(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function pe(e,t){try{const n=await ue(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return await J(e.appConfig,r),n}catch(n){if(!T(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await J(e.appConfig,n)}else await Z(e.appConfig);throw n}}function ge(e){return void 0!==e&&2===e.registrationStatus}function me(e){return 2===e.requestStatus&&!ye(e)}function ye(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+_}function _e(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}function ve(e){return 1===e.requestStatus&&e.requestTime+p<Date.now()}async function we(e){const t=e,{installationEntry:n,registrationPromise:r}=await te(t);return r?r.catch(console.error):he(t).catch(console.error),n.fid}async function be(e,t=!1){const n=e;await Ie(n);const r=await he(n,t);return r.token}async function Ie(e){const{registrationPromise:t}=await te(e);t&&await t}function Te(e){if(!e||!e.options)throw Ee("App Configuration");if(!e.name)throw Ee("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw Ee(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}function Ee(e){return I.create("missing-app-config-values",{valueName:e})}const ke="installations",Ce="installations-internal",Se=e=>{const t=e.getProvider("app").getImmediate(),n=Te(t),r=Object(o["_getProvider"])(t,"heartbeat"),i={app:t,appConfig:n,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()};return i},Oe=e=>{const t=e.getProvider("app").getImmediate(),n=Object(o["_getProvider"])(t,ke).getImmediate(),r={getId:()=>we(n),getToken:e=>be(n,e)};return r};function Ae(){Object(o["_registerComponent"])(new u["a"](ke,Se,"PUBLIC")),Object(o["_registerComponent"])(new u["a"](Ce,Oe,"PRIVATE"))}Ae(),Object(o["registerVersion"])(d,f),Object(o["registerVersion"])(d,f,"esm2017");const Ne="/firebase-messaging-sw.js",Re="/firebase-cloud-messaging-push-scope",De="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",xe="https://fcmregistrations.googleapis.com/v1",Pe="google.c.a.c_id",Me="google.c.a.c_l",je="google.c.a.ts",Le="google.c.a.e";var Fe,Ue;function Ve(e){const t=new Uint8Array(e),n=btoa(String.fromCharCode(...t));return n.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function qe(e){const t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(n),i=new Uint8Array(r.length);for(let s=0;s<r.length;++s)i[s]=r.charCodeAt(s);return i}(function(e){e[e["DATA_MESSAGE"]=1]="DATA_MESSAGE",e[e["DISPLAY_NOTIFICATION"]=3]="DISPLAY_NOTIFICATION"})(Fe||(Fe={})),function(e){e["PUSH_RECEIVED"]="push-received",e["NOTIFICATION_CLICKED"]="notification-clicked"}(Ue||(Ue={}));const Be="fcm_token_details_db",ze=5,Ke="fcm_token_object_Store";async function We(e){if("databases"in indexedDB){const e=await indexedDB.databases(),t=e.map(e=>e.name);if(!t.includes(Be))return null}let t=null;const n=await Object(h["b"])(Be,ze,{upgrade:async(n,r,i,s)=>{var o;if(r<2)return;if(!n.objectStoreNames.contains(Ke))return;const a=s.objectStore(Ke),c=await a.index("fcmSenderId").get(e);if(await a.clear(),c)if(2===r){const e=c;if(!e.auth||!e.p256dh||!e.endpoint)return;t={token:e.fcmToken,createTime:null!==(o=e.createTime)&&void 0!==o?o:Date.now(),subscriptionOptions:{auth:e.auth,p256dh:e.p256dh,endpoint:e.endpoint,swScope:e.swScope,vapidKey:"string"===typeof e.vapidKey?e.vapidKey:Ve(e.vapidKey)}}}else if(3===r){const e=c;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:Ve(e.auth),p256dh:Ve(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:Ve(e.vapidKey)}}}else if(4===r){const e=c;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:Ve(e.auth),p256dh:Ve(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:Ve(e.vapidKey)}}}}});return n.close(),await Object(h["a"])(Be),await Object(h["a"])("fcm_vapid_details_db"),await Object(h["a"])("undefined"),$e(t)?t:null}function $e(e){if(!e||!e.subscriptionOptions)return!1;const{subscriptionOptions:t}=e;return"number"===typeof e.createTime&&e.createTime>0&&"string"===typeof e.token&&e.token.length>0&&"string"===typeof t.auth&&t.auth.length>0&&"string"===typeof t.p256dh&&t.p256dh.length>0&&"string"===typeof t.endpoint&&t.endpoint.length>0&&"string"===typeof t.swScope&&t.swScope.length>0&&"string"===typeof t.vapidKey&&t.vapidKey.length>0}const Ge="firebase-messaging-database",He=1,Qe="firebase-messaging-store";let Ye=null;function Xe(){return Ye||(Ye=Object(h["b"])(Ge,He,{upgrade:(e,t)=>{switch(t){case 0:e.createObjectStore(Qe)}}})),Ye}async function Je(e){const t=tt(e),n=await Xe(),r=await n.transaction(Qe).objectStore(Qe).get(t);if(r)return r;{const t=await We(e.appConfig.senderId);if(t)return await Ze(e,t),t}}async function Ze(e,t){const n=tt(e),r=await Xe(),i=r.transaction(Qe,"readwrite");return await i.objectStore(Qe).put(t,n),await i.done,t}async function et(e){const t=tt(e),n=await Xe(),r=n.transaction(Qe,"readwrite");await r.objectStore(Qe).delete(t),await r.done}function tt({appConfig:e}){return e.appId}const nt={["missing-app-config-values"]:'Missing App configuration value: "{$valueName}"',["only-available-in-window"]:"This method is available in a Window context.",["only-available-in-sw"]:"This method is available in a service worker context.",["permission-default"]:"The notification permission was not granted and dismissed instead.",["permission-blocked"]:"The notification permission was not granted and blocked instead.",["unsupported-browser"]:"This browser doesn't support the API's required to use the Firebase SDK.",["indexed-db-unsupported"]:"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)",["failed-service-worker-registration"]:"We are unable to register the default service worker. {$browserErrorMessage}",["token-subscribe-failed"]:"A problem occurred while subscribing the user to FCM: {$errorInfo}",["token-subscribe-no-token"]:"FCM returned no token when subscribing the user to push.",["token-unsubscribe-failed"]:"A problem occurred while unsubscribing the user from FCM: {$errorInfo}",["token-update-failed"]:"A problem occurred while updating the user from FCM: {$errorInfo}",["token-update-no-token"]:"FCM returned no token when updating the user to push.",["use-sw-after-get-token"]:"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",["invalid-sw-registration"]:"The input to useServiceWorker() must be a ServiceWorkerRegistration.",["invalid-bg-handler"]:"The input to setBackgroundMessageHandler() must be a function.",["invalid-vapid-key"]:"The public VAPID key must be a string.",["use-vapid-key-after-get-token"]:"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},rt=new l["b"]("messaging","Messaging",nt);async function it(e,t){var n;const r=await ct(e),i=ut(t),s={method:"POST",headers:r,body:JSON.stringify(i)};let o;try{const t=await fetch(at(e.appConfig),s);o=await t.json()}catch(a){throw rt.create("token-subscribe-failed",{errorInfo:null===(n=a)||void 0===n?void 0:n.toString()})}if(o.error){const e=o.error.message;throw rt.create("token-subscribe-failed",{errorInfo:e})}if(!o.token)throw rt.create("token-subscribe-no-token");return o.token}async function st(e,t){var n;const r=await ct(e),i=ut(t.subscriptionOptions),s={method:"PATCH",headers:r,body:JSON.stringify(i)};let o;try{const n=await fetch(`${at(e.appConfig)}/${t.token}`,s);o=await n.json()}catch(a){throw rt.create("token-update-failed",{errorInfo:null===(n=a)||void 0===n?void 0:n.toString()})}if(o.error){const e=o.error.message;throw rt.create("token-update-failed",{errorInfo:e})}if(!o.token)throw rt.create("token-update-no-token");return o.token}async function ot(e,t){var n;const r=await ct(e),i={method:"DELETE",headers:r};try{const n=await fetch(`${at(e.appConfig)}/${t}`,i),r=await n.json();if(r.error){const e=r.error.message;throw rt.create("token-unsubscribe-failed",{errorInfo:e})}}catch(s){throw rt.create("token-unsubscribe-failed",{errorInfo:null===(n=s)||void 0===n?void 0:n.toString()})}}function at({projectId:e}){return`${xe}/projects/${e}/registrations`}async function ct({appConfig:e,installations:t}){const n=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":"FIS "+n})}function ut({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==De&&(i.web.applicationPubKey=r),i}const lt=6048e5;async function ht(e){const t=await gt(e.swRegistration,e.vapidKey),n={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:Ve(t.getKey("auth")),p256dh:Ve(t.getKey("p256dh"))},r=await Je(e.firebaseDependencies);if(r){if(mt(r.subscriptionOptions,n))return Date.now()>=r.createTime+lt?ft(e,{token:r.token,createTime:Date.now(),subscriptionOptions:n}):r.token;try{await ot(e.firebaseDependencies,r.token)}catch(i){console.warn(i)}return pt(e.firebaseDependencies,n)}return pt(e.firebaseDependencies,n)}async function dt(e){const t=await Je(e.firebaseDependencies);t&&(await ot(e.firebaseDependencies,t.token),await et(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function ft(e,t){try{const n=await st(e.firebaseDependencies,t),r=Object.assign(Object.assign({},t),{token:n,createTime:Date.now()});return await Ze(e.firebaseDependencies,r),n}catch(n){throw await dt(e),n}}async function pt(e,t){const n=await it(e,t),r={token:n,createTime:Date.now(),subscriptionOptions:t};return await Ze(e,r),r.token}async function gt(e,t){const n=await e.pushManager.getSubscription();return n||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:qe(t)})}function mt(e,t){const n=t.vapidKey===e.vapidKey,r=t.endpoint===e.endpoint,i=t.auth===e.auth,s=t.p256dh===e.p256dh;return n&&r&&i&&s}function yt(e){const t={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return _t(t,e),vt(t,e),wt(t,e),t}function _t(e,t){if(!t.notification)return;e.notification={};const n=t.notification.title;n&&(e.notification.title=n);const r=t.notification.body;r&&(e.notification.body=r);const i=t.notification.image;i&&(e.notification.image=i);const s=t.notification.icon;s&&(e.notification.icon=s)}function vt(e,t){t.data&&(e.data=t.data)}function wt(e,t){var n,r,i,s,o;if(!t.fcmOptions&&!(null===(n=t.notification)||void 0===n?void 0:n.click_action))return;e.fcmOptions={};const a=null!==(i=null===(r=t.fcmOptions)||void 0===r?void 0:r.link)&&void 0!==i?i:null===(s=t.notification)||void 0===s?void 0:s.click_action;a&&(e.fcmOptions.link=a);const c=null===(o=t.fcmOptions)||void 0===o?void 0:o.analytics_label;c&&(e.fcmOptions.analyticsLabel=c)}function bt(e){return"object"===typeof e&&!!e&&Pe in e}function It(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}function Tt(e){if(!e||!e.options)throw Et("App Configuration Object");if(!e.name)throw Et("App Name");const t=["projectId","apiKey","appId","messagingSenderId"],{options:n}=e;for(const r of t)if(!n[r])throw Et(r);return{appName:e.name,projectId:n.projectId,apiKey:n.apiKey,appId:n.appId,senderId:n.messagingSenderId}}function Et(e){return rt.create("missing-app-config-values",{valueName:e})}It("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),It("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class kt{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const r=Tt(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}async function Ct(e){var t;try{e.swRegistration=await navigator.serviceWorker.register(Ne,{scope:Re}),e.swRegistration.update().catch(()=>{})}catch(n){throw rt.create("failed-service-worker-registration",{browserErrorMessage:null===(t=n)||void 0===t?void 0:t.message})}}async function St(e,t){if(t||e.swRegistration||await Ct(e),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw rt.create("invalid-sw-registration");e.swRegistration=t}}async function Ot(e,t){t?e.vapidKey=t:e.vapidKey||(e.vapidKey=De)}async function At(e,t){if(!navigator)throw rt.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw rt.create("permission-blocked");return await Ot(e,null===t||void 0===t?void 0:t.vapidKey),await St(e,null===t||void 0===t?void 0:t.serviceWorkerRegistration),ht(e)}async function Nt(e,t,n){const r=Rt(t),i=await e.firebaseDependencies.analyticsProvider.get();i.logEvent(r,{message_id:n[Pe],message_name:n[Me],message_time:n[je],message_device_time:Math.floor(Date.now()/1e3)})}function Rt(e){switch(e){case Ue.NOTIFICATION_CLICKED:return"notification_open";case Ue.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}async function Dt(e,t){const n=t.data;if(!n.isFirebaseMessaging)return;e.onMessageHandler&&n.messageType===Ue.PUSH_RECEIVED&&("function"===typeof e.onMessageHandler?e.onMessageHandler(yt(n)):e.onMessageHandler.next(yt(n)));const r=n.data;bt(r)&&"1"===r[Le]&&await Nt(e,n.messageType,r)}const xt="@firebase/messaging",Pt="0.10.0",Mt=e=>{const t=new kt(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>Dt(t,e)),t},jt=e=>{const t=e.getProvider("messaging").getImmediate(),n={getToken:e=>At(t,e)};return n};function Lt(){Object(o["_registerComponent"])(new u["a"]("messaging",Mt,"PUBLIC")),Object(o["_registerComponent"])(new u["a"]("messaging-internal",jt,"PRIVATE")),Object(o["registerVersion"])(xt,Pt),Object(o["registerVersion"])(xt,Pt,"esm2017")}async function Ft(e){if(!navigator)throw rt.create("only-available-in-window");return e.swRegistration||await Ct(e),dt(e)}function Ut(e,t){if(!navigator)throw rt.create("only-available-in-window");return e.onMessageHandler=t,()=>{e.onMessageHandler=null}}async function Vt(e,t){return e=Object(l["z"])(e),At(e,t)}function qt(e){return e=Object(l["z"])(e),Ft(e)}function Bt(e,t){return e=Object(l["z"])(e),Ut(e,t)}Lt();var zt=n("7ded"),Kt=n("e691");const Wt="analytics",$t="firebase_id",Gt="origin",Ht=6e4,Qt="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Yt="https://www.googletagmanager.com/gtag/js",Xt=new Kt["b"]("@firebase/analytics");function Jt(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function Zt(e,t){const n=document.createElement("script");n.src=`${Yt}?l=${e}&id=${t}`,n.async=!0,document.head.appendChild(n)}function en(e){let t=[];return Array.isArray(window[e])?t=window[e]:window[e]=t,t}async function tn(e,t,n,r,i,s){const o=r[i];try{if(o)await t[o];else{const e=await Jt(n),r=e.find(e=>e.measurementId===i);r&&await t[r.appId]}}catch(a){Xt.error(a)}e("config",i,s)}async function nn(e,t,n,r,i){try{let s=[];if(i&&i["send_to"]){let e=i["send_to"];Array.isArray(e)||(e=[e]);const r=await Jt(n);for(const n of e){const e=r.find(e=>e.measurementId===n),i=e&&t[e.appId];if(!i){s=[];break}s.push(i)}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",r,i||{})}catch(s){Xt.error(s)}}function rn(e,t,n,r){async function i(i,s,o){try{"event"===i?await nn(e,t,n,s,o):"config"===i?await tn(e,t,n,r,s,o):"consent"===i?e("consent","update",o):e("set",s)}catch(a){Xt.error(a)}}return i}function sn(e,t,n,r,i){let s=function(...e){window[r].push(arguments)};return window[i]&&"function"===typeof window[i]&&(s=window[i]),window[i]=rn(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}function on(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(Yt)&&n.src.includes(e))return n;return null}const an={["already-exists"]:"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.",["already-initialized"]:"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.",["already-initialized-settings"]:"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",["interop-component-reg-failed"]:"Firebase Analytics Interop Component failed to instantiate: {$reason}",["invalid-analytics-context"]:"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",["indexeddb-unavailable"]:"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",["fetch-throttle"]:"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.",["config-fetch-failed"]:"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}",["no-api-key"]:'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',["no-app-id"]:'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'},cn=new l["b"]("analytics","Analytics",an),un=30,ln=1e3;class hn{constructor(e={},t=ln){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const dn=new hn;function fn(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function pn(e){var t;const{appId:n,apiKey:r}=e,i={method:"GET",headers:fn(r)},s=Qt.replace("{app-id}",n),o=await fetch(s,i);if(200!==o.status&&304!==o.status){let e="";try{const n=await o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(a){}throw cn.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()}async function gn(e,t=dn,n){const{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw cn.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw cn.create("no-api-key")}const o=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new vn;return setTimeout(async()=>{a.abort()},void 0!==n?n:Ht),mn({appId:r,apiKey:i,measurementId:s},o,a,t)}async function mn(e,{throttleEndTimeMillis:t,backoffCount:n},r,i=dn){var s,o;const{appId:a,measurementId:c}=e;try{await yn(r,t)}catch(u){if(c)return Xt.warn("Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID "+c+` provided in the "measurementId" field in the local Firebase config. [${null===(s=u)||void 0===s?void 0:s.message}]`),{appId:a,measurementId:c};throw u}try{const t=await pn(e);return i.deleteThrottleMetadata(a),t}catch(u){const t=u;if(!_n(t)){if(i.deleteThrottleMetadata(a),c)return Xt.warn("Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID "+c+` provided in the "measurementId" field in the local Firebase config. [${null===t||void 0===t?void 0:t.message}]`),{appId:a,measurementId:c};throw u}const s=503===Number(null===(o=null===t||void 0===t?void 0:t.customData)||void 0===o?void 0:o.httpStatus)?Object(l["l"])(n,i.intervalMillis,un):Object(l["l"])(n,i.intervalMillis),h={throttleEndTimeMillis:Date.now()+s,backoffCount:n+1};return i.setThrottleMetadata(a,h),Xt.debug(`Calling attemptFetch again in ${s} millis`),mn(e,h,r,i)}}function yn(e,t){return new Promise((n,r)=>{const i=Math.max(t-Date.now(),0),s=setTimeout(n,i);e.addEventListener(()=>{clearTimeout(s),r(cn.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}function _n(e){if(!(e instanceof l["c"])||!e.customData)return!1;const t=Number(e.customData["httpStatus"]);return 429===t||500===t||503===t||504===t}class vn{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}let wn,bn;async function In(e,t,n,r,i){if(i&&i.global)e("event",n,r);else{const i=await t,s=Object.assign(Object.assign({},r),{send_to:i});e("event",n,s)}}async function Tn(e,t,n,r){if(r&&r.global)return e("set",{screen_name:n}),Promise.resolve();{const r=await t;e("config",r,{update:!0,screen_name:n})}}async function En(e,t,n,r){if(r&&r.global)return e("set",{user_id:n}),Promise.resolve();{const r=await t;e("config",r,{update:!0,user_id:n})}}async function kn(e,t,n,r){if(r&&r.global){const t={};for(const e of Object.keys(n))t["user_properties."+e]=n[e];return e("set",t),Promise.resolve()}{const r=await t;e("config",r,{update:!0,user_properties:n})}}async function Cn(e,t){const n=await e;window["ga-disable-"+n]=!t}function Sn(e){bn=e}function On(e){wn=e}async function An(){var e;if(!Object(l["G"])())return Xt.warn(cn.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await Object(l["ab"])()}catch(t){return Xt.warn(cn.create("indexeddb-unavailable",{errorInfo:null===(e=t)||void 0===e?void 0:e.toString()}).message),!1}return!0}async function Nn(e,t,n,r,i,s,o){var a;const c=gn(e);c.then(t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&Xt.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>Xt.error(e)),t.push(c);const u=An().then(e=>e?r.getId():void 0),[l,h]=await Promise.all([c,u]);on(s)||Zt(s,l.measurementId),bn&&(i("consent","default",bn),Sn(void 0)),i("js",new Date);const d=null!==(a=null===o||void 0===o?void 0:o.config)&&void 0!==a?a:{};return d[Gt]="firebase",d.update=!0,null!=h&&(d[$t]=h),i("config",l.measurementId,d),wn&&(i("set",wn),On(void 0)),l.measurementId}class Rn{constructor(e){this.app=e}_delete(){return delete Dn[this.app.options.appId],Promise.resolve()}}let Dn={},xn=[];const Pn={};let Mn,jn,Ln="dataLayer",Fn="gtag",Un=!1;function Vn(e){if(Un)throw cn.create("already-initialized");e.dataLayerName&&(Ln=e.dataLayerName),e.gtagName&&(Fn=e.gtagName)}function qn(){const e=[];if(Object(l["D"])()&&e.push("This is a browser extension environment."),Object(l["e"])()||e.push("Cookies are not available."),e.length>0){const t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),n=cn.create("invalid-analytics-context",{errorInfo:t});Xt.warn(n.message)}}function Bn(e,t,n){qn();const r=e.options.appId;if(!r)throw cn.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw cn.create("no-api-key");Xt.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID '+e.options.measurementId+' provided in the "measurementId" field in the local Firebase config.')}if(null!=Dn[r])throw cn.create("already-exists",{id:r});if(!Un){en(Ln);const{wrappedGtag:e,gtagCore:t}=sn(Dn,xn,Pn,Ln,Fn);jn=e,Mn=t,Un=!0}Dn[r]=Nn(e,xn,Pn,t,Mn,Ln,n);const i=new Rn(e);return i}async function zn(){if(Object(l["D"])())return!1;if(!Object(l["e"])())return!1;if(!Object(l["G"])())return!1;try{const e=await Object(l["ab"])();return e}catch(e){return!1}}function Kn(e,t,n){e=Object(l["z"])(e),Tn(jn,Dn[e.app.options.appId],t,n).catch(e=>Xt.error(e))}function Wn(e,t,n){e=Object(l["z"])(e),En(jn,Dn[e.app.options.appId],t,n).catch(e=>Xt.error(e))}function $n(e,t,n){e=Object(l["z"])(e),kn(jn,Dn[e.app.options.appId],t,n).catch(e=>Xt.error(e))}function Gn(e,t){e=Object(l["z"])(e),Cn(Dn[e.app.options.appId],t).catch(e=>Xt.error(e))}function Hn(e,t,n,r){e=Object(l["z"])(e),In(jn,Dn[e.app.options.appId],t,n,r).catch(e=>Xt.error(e))}const Qn="@firebase/analytics",Yn="0.8.4";function Xn(){function e(e){try{const t=e.getProvider(Wt).getImmediate();return{logEvent:(e,n,r)=>Hn(t,e,n,r)}}catch(t){throw cn.create("interop-component-reg-failed",{reason:t})}}Object(o["_registerComponent"])(new u["a"](Wt,(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();return Bn(n,r,t)},"PUBLIC")),Object(o["_registerComponent"])(new u["a"]("analytics-internal",e,"PRIVATE")),Object(o["registerVersion"])(Qn,Yn),Object(o["registerVersion"])(Qn,Yn,"esm2017")}Xn();const Jn="@firebase/analytics-compat",Zn="0.1.17";class er{constructor(e,t){this.app=e,this._delegate=t}logEvent(e,t,n){Hn(this._delegate,e,t,n)}setCurrentScreen(e,t){Kn(this._delegate,e,t)}setUserId(e,t){Wn(this._delegate,e,t)}setUserProperties(e,t){$n(this._delegate,e,t)}setAnalyticsCollectionEnabled(e){Gn(this._delegate,e)}}var tr;(function(e){e["ADD_SHIPPING_INFO"]="add_shipping_info",e["ADD_PAYMENT_INFO"]="add_payment_info",e["ADD_TO_CART"]="add_to_cart",e["ADD_TO_WISHLIST"]="add_to_wishlist",e["BEGIN_CHECKOUT"]="begin_checkout",e["CHECKOUT_PROGRESS"]="checkout_progress",e["EXCEPTION"]="exception",e["GENERATE_LEAD"]="generate_lead",e["LOGIN"]="login",e["PAGE_VIEW"]="page_view",e["PURCHASE"]="purchase",e["REFUND"]="refund",e["REMOVE_FROM_CART"]="remove_from_cart",e["SCREEN_VIEW"]="screen_view",e["SEARCH"]="search",e["SELECT_CONTENT"]="select_content",e["SELECT_ITEM"]="select_item",e["SELECT_PROMOTION"]="select_promotion",e["SET_CHECKOUT_OPTION"]="set_checkout_option",e["SHARE"]="share",e["SIGN_UP"]="sign_up",e["TIMING_COMPLETE"]="timing_complete",e["VIEW_CART"]="view_cart",e["VIEW_ITEM"]="view_item",e["VIEW_ITEM_LIST"]="view_item_list",e["VIEW_PROMOTION"]="view_promotion",e["VIEW_SEARCH_RESULTS"]="view_search_results"})(tr||(tr={}));const nr=e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("analytics").getImmediate();return new er(t,n)};function rr(){const e={Analytics:er,settings:Vn,isSupported:zn,EventName:tr};zt["a"].INTERNAL.registerComponent(new u["a"]("analytics-compat",nr,"PUBLIC").setServiceProps(e).setMultipleInstances(!0))}rr(),zt["a"].registerVersion(Jn,Zn);const ir=new Map,sr={activated:!1,tokenObservers:[]},or={initialized:!1,enabled:!1};function ar(e){return ir.get(e)||sr}function cr(e,t){ir.set(e,t)}function ur(){return or}const lr="https://content-firebaseappcheck.googleapis.com/v1",hr="exchangeRecaptchaV3Token",dr="exchangeRecaptchaEnterpriseToken",fr="exchangeDebugToken",pr={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4},gr=864e5;class mr{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,this.nextErrorWaitInterval=r,r>i)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new l["a"],await yr(this.getNextRun(e)),this.pending.resolve(),await this.pending.promise,this.pending=new l["a"],await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const e=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),e}}}function yr(e){return new Promise(t=>{setTimeout(t,e)})}const _r={["already-initialized"]:"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.",["use-before-activation"]:"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.",["fetch-network-error"]:"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",["fetch-parse-error"]:"Fetch client could not parse response. Original error: {$originalErrorMessage}.",["fetch-status-error"]:"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",["storage-open"]:"Error thrown when opening storage. Original error: {$originalErrorMessage}.",["storage-get"]:"Error thrown when reading from storage. Original error: {$originalErrorMessage}.",["storage-set"]:"Error thrown when writing to storage. Original error: {$originalErrorMessage}.",["recaptcha-error"]:"ReCAPTCHA error.",["throttled"]:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},vr=new l["b"]("appCheck","AppCheck",_r);function wr(e=!1){var t;return e?null===(t=self.grecaptcha)||void 0===t?void 0:t.enterprise:self.grecaptcha}function br(e){if(!ar(e).activated)throw vr.create("use-before-activation",{appName:e.name})}function Ir(e){const t=Math.round(e/1e3),n=Math.floor(t/86400),r=Math.floor((t-3600*n*24)/3600),i=Math.floor((t-3600*n*24-3600*r)/60),s=t-3600*n*24-3600*r-60*i;let o="";return n&&(o+=Tr(n)+"d:"),r&&(o+=Tr(r)+"h:"),o+=Tr(i)+"m:"+Tr(s)+"s",o}function Tr(e){return 0===e?"00":e>=10?e.toString():"0"+e}async function Er({url:e,body:t},n){var r,i;const s={"Content-Type":"application/json"},o=n.getImmediate({optional:!0});if(o){const e=await o.getHeartbeatsHeader();e&&(s["X-Firebase-Client"]=e)}const a={method:"POST",body:JSON.stringify(t),headers:s};let c,u;try{c=await fetch(e,a)}catch(f){throw vr.create("fetch-network-error",{originalErrorMessage:null===(r=f)||void 0===r?void 0:r.message})}if(200!==c.status)throw vr.create("fetch-status-error",{httpStatus:c.status});try{u=await c.json()}catch(f){throw vr.create("fetch-parse-error",{originalErrorMessage:null===(i=f)||void 0===i?void 0:i.message})}const l=u.ttl.match(/^([\d.]+)(s)$/);if(!l||!l[2]||isNaN(Number(l[1])))throw vr.create("fetch-parse-error",{originalErrorMessage:"ttl field (timeToLive) is not in standard Protobuf Duration format: "+u.ttl});const h=1e3*Number(l[1]),d=Date.now();return{token:u.token,expireTimeMillis:d+h,issuedAtTimeMillis:d}}function kr(e,t){const{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${lr}/projects/${n}/apps/${r}:${hr}?key=${i}`,body:{recaptcha_v3_token:t}}}function Cr(e,t){const{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${lr}/projects/${n}/apps/${r}:${dr}?key=${i}`,body:{recaptcha_enterprise_token:t}}}function Sr(e,t){const{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${lr}/projects/${n}/apps/${r}:${fr}?key=${i}`,body:{debug_token:t}}}const Or="firebase-app-check-database",Ar=1,Nr="firebase-app-check-store",Rr="debug-token";let Dr=null;function xr(){return Dr||(Dr=new Promise((e,t)=>{var n;try{const n=indexedDB.open(Or,Ar);n.onsuccess=t=>{e(t.target.result)},n.onerror=e=>{var n;t(vr.create("storage-open",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))},n.onupgradeneeded=e=>{const t=e.target.result;switch(e.oldVersion){case 0:t.createObjectStore(Nr,{keyPath:"compositeKey"})}}}catch(r){t(vr.create("storage-open",{originalErrorMessage:null===(n=r)||void 0===n?void 0:n.message}))}}),Dr)}function Pr(e){return Ur(Vr(e))}function Mr(e,t){return Fr(Vr(e),t)}function jr(e){return Fr(Rr,e)}function Lr(){return Ur(Rr)}async function Fr(e,t){const n=await xr(),r=n.transaction(Nr,"readwrite"),i=r.objectStore(Nr),s=i.put({compositeKey:e,value:t});return new Promise((e,t)=>{s.onsuccess=t=>{e()},r.onerror=e=>{var n;t(vr.create("storage-set",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))}})}async function Ur(e){const t=await xr(),n=t.transaction(Nr,"readonly"),r=n.objectStore(Nr),i=r.get(e);return new Promise((e,t)=>{i.onsuccess=t=>{const n=t.target.result;e(n?n.value:void 0)},n.onerror=e=>{var n;t(vr.create("storage-get",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))}})}function Vr(e){return`${e.options.appId}-${e.name}`}const qr=new Kt["b"]("@firebase/app-check");async function Br(e){if(Object(l["G"])()){let n=void 0;try{n=await Pr(e)}catch(t){qr.warn("Failed to read token from IndexedDB. Error: "+t)}return n}}function zr(e,t){return Object(l["G"])()?Mr(e,t).catch(e=>{qr.warn("Failed to write token to IndexedDB. Error: "+e)}):Promise.resolve()}async function Kr(){let e=void 0;try{e=await Lr()}catch(t){}if(e)return e;{const e=Object(l["W"])();return jr(e).catch(e=>qr.warn("Failed to persist debug token to IndexedDB. Error: "+e)),e}}function Wr(){const e=ur();return e.enabled}async function $r(){const e=ur();if(e.enabled&&e.token)return e.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")}function Gr(){const e=Object(l["y"])(),t=ur();if(t.initialized=!0,"string"!==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN&&!0!==e.FIREBASE_APPCHECK_DEBUG_TOKEN)return;t.enabled=!0;const n=new l["a"];t.token=n,"string"===typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN?n.resolve(e.FIREBASE_APPCHECK_DEBUG_TOKEN):n.resolve(Kr())}const Hr={error:"UNKNOWN_ERROR"};function Qr(e){return l["h"].encodeString(JSON.stringify(e),!1)}async function Yr(e,t=!1){const n=e.app;br(n);const r=ar(n);let i=r.token,s=void 0;if(i&&!ni(i)&&(cr(n,Object.assign(Object.assign({},r),{token:void 0})),i=void 0),!i){const e=await r.cachedTokenPromise;e&&(ni(e)?i=e:await zr(n,void 0))}if(!t&&i&&ni(i))return{token:i.token};let o,a=!1;if(Wr()){r.exchangeTokenPromise||(r.exchangeTokenPromise=Er(Sr(n,await $r()),e.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),a=!0);const t=await r.exchangeTokenPromise;return await zr(n,t),cr(n,Object.assign(Object.assign({},r),{token:t})),{token:t.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),a=!0),i=await r.exchangeTokenPromise}catch(c){"appCheck/throttled"===c.code?qr.warn(c.message):qr.error(c),s=c}return i?s?o=ni(i)?{token:i.token,internalError:s}:ri(s):(o={token:i.token},cr(n,Object.assign(Object.assign({},r),{token:i})),await zr(n,i)):o=ri(s),a&&ti(n,o),o}function Xr(e,t,n,r){const{app:i}=e,s=ar(i),o={next:n,error:r,type:t};if(cr(i,Object.assign(Object.assign({},s),{tokenObservers:[...s.tokenObservers,o]})),s.token&&ni(s.token)){const t=s.token;Promise.resolve().then(()=>{n({token:t.token}),Zr(e)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Zr(e))}function Jr(e,t){const n=ar(e),r=n.tokenObservers.filter(e=>e.next!==t);0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),cr(e,Object.assign(Object.assign({},n),{tokenObservers:r}))}function Zr(e){const{app:t}=e,n=ar(t);let r=n.tokenRefresher;r||(r=ei(e),cr(t,Object.assign(Object.assign({},n),{tokenRefresher:r}))),!r.isRunning()&&n.isTokenAutoRefreshEnabled&&r.start()}function ei(e){const{app:t}=e;return new mr(async()=>{const n=ar(t);let r;if(r=n.token?await Yr(e,!0):await Yr(e),r.error)throw r.error;if(r.internalError)throw r.internalError},()=>!0,()=>{const e=ar(t);if(e.token){let t=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5;const n=e.token.expireTimeMillis-3e5;return t=Math.min(t,n),Math.max(0,t-Date.now())}return 0},pr.RETRIAL_MIN_WAIT,pr.RETRIAL_MAX_WAIT)}function ti(e,t){const n=ar(e).tokenObservers;for(const i of n)try{"EXTERNAL"===i.type&&null!=t.error?i.error(t.error):i.next(t)}catch(r){}}function ni(e){return e.expireTimeMillis-Date.now()>0}function ri(e){return{token:Qr(Hr),error:e}}class ii{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){const{tokenObservers:e}=ar(this.app);for(const t of e)Jr(this.app,t.next);return Promise.resolve()}}function si(e,t){return new ii(e,t)}function oi(e){return{getToken:t=>Yr(e,t),addTokenListener:t=>Xr(e,"INTERNAL",t),removeTokenListener:t=>Jr(e.app,t)}}const ai="@firebase/app-check",ci="0.5.16",ui="https://www.google.com/recaptcha/api.js",li="https://www.google.com/recaptcha/enterprise.js";function hi(e,t){const n=ar(e),r=new l["a"];cr(e,Object.assign(Object.assign({},n),{reCAPTCHAState:{initialized:r}}));const i=pi(e),s=wr(!1);return s?fi(e,t,s,i,r):yi(()=>{const n=wr(!1);if(!n)throw new Error("no recaptcha");fi(e,t,n,i,r)}),r.promise}function di(e,t){const n=ar(e),r=new l["a"];cr(e,Object.assign(Object.assign({},n),{reCAPTCHAState:{initialized:r}}));const i=pi(e),s=wr(!0);return s?fi(e,t,s,i,r):_i(()=>{const n=wr(!0);if(!n)throw new Error("no recaptcha");fi(e,t,n,i,r)}),r.promise}function fi(e,t,n,r,i){n.ready(()=>{mi(e,t,n,r),i.resolve(n)})}function pi(e){const t="fire_app_check_"+e.name,n=document.createElement("div");return n.id=t,n.style.display="none",document.body.appendChild(n),t}async function gi(e){br(e);const t=ar(e).reCAPTCHAState,n=await t.initialized.promise;return new Promise((t,r)=>{const i=ar(e).reCAPTCHAState;n.ready(()=>{t(n.execute(i.widgetId,{action:"fire_app_check"}))})})}function mi(e,t,n,r){const i=n.render(r,{sitekey:t,size:"invisible"}),s=ar(e);cr(e,Object.assign(Object.assign({},s),{reCAPTCHAState:Object.assign(Object.assign({},s.reCAPTCHAState),{widgetId:i})}))}function yi(e){const t=document.createElement("script");t.src=ui,t.onload=e,document.head.appendChild(t)}function _i(e){const t=document.createElement("script");t.src=li,t.onload=e,document.head.appendChild(t)}class vi{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){var e,t;Ti(this._throttleData);const n=await gi(this._app).catch(e=>{throw vr.create("recaptcha-error")});let r;try{r=await Er(kr(this._app,n),this._heartbeatServiceProvider)}catch(i){throw(null===(e=i.code)||void 0===e?void 0:e.includes("fetch-status-error"))?(this._throttleData=Ii(Number(null===(t=i.customData)||void 0===t?void 0:t.httpStatus),this._throttleData),vr.create("throttled",{time:Ir(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):i}return this._throttleData=null,r}initialize(e){this._app=e,this._heartbeatServiceProvider=Object(o["_getProvider"])(e,"heartbeat"),hi(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof vi&&this._siteKey===e._siteKey}}class wi{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){var e,t;Ti(this._throttleData);const n=await gi(this._app).catch(e=>{throw vr.create("recaptcha-error")});let r;try{r=await Er(Cr(this._app,n),this._heartbeatServiceProvider)}catch(i){throw(null===(e=i.code)||void 0===e?void 0:e.includes("fetch-status-error"))?(this._throttleData=Ii(Number(null===(t=i.customData)||void 0===t?void 0:t.httpStatus),this._throttleData),vr.create("throttled",{time:Ir(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):i}return this._throttleData=null,r}initialize(e){this._app=e,this._heartbeatServiceProvider=Object(o["_getProvider"])(e,"heartbeat"),di(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof wi&&this._siteKey===e._siteKey}}class bi{constructor(e){this._customProviderOptions=e}async getToken(){const e=await this._customProviderOptions.getToken(),t=Object(l["N"])(e.token),n=null!==t&&t<Date.now()&&t>0?1e3*t:Date.now();return Object.assign(Object.assign({},e),{issuedAtTimeMillis:n})}initialize(e){this._app=e}isEqual(e){return e instanceof bi&&this._customProviderOptions.getToken.toString()===e._customProviderOptions.getToken.toString()}}function Ii(e,t){if(404===e||403===e)return{backoffCount:1,allowRequestsAfter:Date.now()+gr,httpStatus:e};{const n=t?t.backoffCount:0,r=Object(l["l"])(n,1e3,2);return{backoffCount:n+1,allowRequestsAfter:Date.now()+r,httpStatus:e}}}function Ti(e){if(e&&Date.now()-e.allowRequestsAfter<=0)throw vr.create("throttled",{time:Ir(e.allowRequestsAfter-Date.now()),httpStatus:e.httpStatus})}function Ei(e=Object(o["getApp"])(),t){e=Object(l["z"])(e);const n=Object(o["_getProvider"])(e,"app-check");if(ur().initialized||Gr(),Wr()&&$r().then(e=>console.log(`App Check debug token: ${e}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),n.isInitialized()){const r=n.getImmediate(),i=n.getOptions();if(i.isTokenAutoRefreshEnabled===t.isTokenAutoRefreshEnabled&&i.provider.isEqual(t.provider))return r;throw vr.create("already-initialized",{appName:e.name})}const r=n.initialize({options:t});return ki(e,t.provider,t.isTokenAutoRefreshEnabled),ar(e).isTokenAutoRefreshEnabled&&Xr(r,"INTERNAL",()=>{}),r}function ki(e,t,n){const r=ar(e),i=Object.assign(Object.assign({},r),{activated:!0});i.provider=t,i.cachedTokenPromise=Br(e).then(t=>(t&&ni(t)&&(cr(e,Object.assign(Object.assign({},ar(e)),{token:t})),ti(e,{token:t.token})),t)),i.isTokenAutoRefreshEnabled=void 0===n?e.automaticDataCollectionEnabled:n,cr(e,i),i.provider.initialize(e)}function Ci(e,t){const n=e.app,r=ar(n);r.tokenRefresher&&(!0===t?r.tokenRefresher.start():r.tokenRefresher.stop()),cr(n,Object.assign(Object.assign({},r),{isTokenAutoRefreshEnabled:t}))}async function Si(e,t){const n=await Yr(e,t);if(n.error)throw n.error;return{token:n.token}}function Oi(e,t,n,r){let i=()=>{},s=()=>{};return i=null!=t.next?t.next.bind(t):t,null!=t.error?s=t.error.bind(t):n&&(s=n),Xr(e,"EXTERNAL",i,s),()=>Jr(e.app,i)}const Ai="app-check",Ni="app-check-internal";function Ri(){Object(o["_registerComponent"])(new u["a"](Ai,e=>{const t=e.getProvider("app").getImmediate(),n=e.getProvider("heartbeat");return si(t,n)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider(Ni).initialize()})),Object(o["_registerComponent"])(new u["a"](Ni,e=>{const t=e.getProvider("app-check").getImmediate();return oi(t)},"PUBLIC").setInstantiationMode("EXPLICIT")),Object(o["registerVersion"])(ai,ci)}Ri();const Di="@firebase/app-check-compat",xi="0.2.16",Pi={["use-before-activation"]:"App Check is being used before activate() is called for FirebaseApp {$appName}. Call activate() before instantiating other Firebase services."},Mi=new l["b"]("appCheck","AppCheck",Pi);class ji{constructor(e){this.app=e}activate(e,t){let n;n="string"===typeof e?new vi(e):e instanceof wi||e instanceof vi||e instanceof bi?e:new bi({getToken:e.getToken}),this._delegate=Ei(this.app,{provider:n,isTokenAutoRefreshEnabled:t})}setTokenAutoRefreshEnabled(e){if(!this._delegate)throw Mi.create("use-before-activation",{appName:this.app.name});Ci(this._delegate,e)}getToken(e){if(!this._delegate)throw Mi.create("use-before-activation",{appName:this.app.name});return Si(this._delegate,e)}onTokenChanged(e,t,n){if(!this._delegate)throw Mi.create("use-before-activation",{appName:this.app.name});return Oi(this._delegate,e,t,n)}}const Li=e=>{const t=e.getProvider("app-compat").getImmediate();return new ji(t)};function Fi(){zt["a"].INTERNAL.registerComponent(new u["a"]("appCheck-compat",Li,"PUBLIC").setServiceProps({ReCaptchaEnterpriseProvider:wi,ReCaptchaV3Provider:vi,CustomProvider:bi}))}Fi(),zt["a"].registerVersion(Di,xi);n("5994");var Ui=n("51b0");const Vi="@firebase/database-compat",qi="0.2.10",Bi=new Kt["b"]("@firebase/database-compat"),zi=function(e){const t="FIREBASE WARNING: "+e;Bi.warn(t)},Ki=function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!==typeof n)throw new Error(Object(l["s"])(e,t)+"must be a boolean.")},Wi=function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Object(l["s"])(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};class $i{constructor(e){this._delegate=e}cancel(e){Object(l["X"])("OnDisconnect.cancel",0,1,arguments.length),Object(l["Y"])("OnDisconnect.cancel","onComplete",e,!0);const t=this._delegate.cancel();return e&&t.then(()=>e(null),t=>e(t)),t}remove(e){Object(l["X"])("OnDisconnect.remove",0,1,arguments.length),Object(l["Y"])("OnDisconnect.remove","onComplete",e,!0);const t=this._delegate.remove();return e&&t.then(()=>e(null),t=>e(t)),t}set(e,t){Object(l["X"])("OnDisconnect.set",1,2,arguments.length),Object(l["Y"])("OnDisconnect.set","onComplete",t,!0);const n=this._delegate.set(e);return t&&n.then(()=>t(null),e=>t(e)),n}setWithPriority(e,t,n){Object(l["X"])("OnDisconnect.setWithPriority",2,3,arguments.length),Object(l["Y"])("OnDisconnect.setWithPriority","onComplete",n,!0);const r=this._delegate.setWithPriority(e,t);return n&&r.then(()=>n(null),e=>n(e)),r}update(e,t){if(Object(l["X"])("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){const t={};for(let n=0;n<e.length;++n)t[""+n]=e[n];e=t,zi("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Object(l["Y"])("OnDisconnect.update","onComplete",t,!0);const n=this._delegate.update(e);return t&&n.then(()=>t(null),e=>t(e)),n}}class Gi{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return Object(l["X"])("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class Hi{constructor(e,t){this._database=e,this._delegate=t}val(){return Object(l["X"])("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return Object(l["X"])("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return Object(l["X"])("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return Object(l["X"])("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return Object(l["X"])("DataSnapshot.child",0,1,arguments.length),e=String(e),Object(Ui["g"])("DataSnapshot.child","path",e,!1),new Hi(this._database,this._delegate.child(e))}hasChild(e){return Object(l["X"])("DataSnapshot.hasChild",1,1,arguments.length),Object(Ui["g"])("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return Object(l["X"])("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return Object(l["X"])("DataSnapshot.forEach",1,1,arguments.length),Object(l["Y"])("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new Hi(this._database,t)))}hasChildren(){return Object(l["X"])("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return Object(l["X"])("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return Object(l["X"])("DataSnapshot.ref",0,0,arguments.length),new Yi(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class Qi{constructor(e,t){this.database=e,this._delegate=t}on(e,t,n,r){var i;Object(l["X"])("Query.on",2,4,arguments.length),Object(l["Y"])("Query.on","callback",t,!1);const s=Qi.getCancelAndContextArgs_("Query.on",n,r),o=(e,n)=>{t.call(s.context,new Hi(this.database,e),n)};o.userCallback=t,o.context=s.context;const a=null===(i=s.cancel)||void 0===i?void 0:i.bind(s.context);switch(e){case"value":return Object(Ui["B"])(this._delegate,o,a),t;case"child_added":return Object(Ui["x"])(this._delegate,o,a),t;case"child_removed":return Object(Ui["A"])(this._delegate,o,a),t;case"child_changed":return Object(Ui["y"])(this._delegate,o,a),t;case"child_moved":return Object(Ui["z"])(this._delegate,o,a),t;default:throw new Error(Object(l["s"])("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){if(Object(l["X"])("Query.off",0,3,arguments.length),Wi("Query.off",e,!0),Object(l["Y"])("Query.off","callback",t,!0),Object(l["Z"])("Query.off","context",n,!0),t){const r=()=>{};r.userCallback=t,r.context=n,Object(Ui["w"])(this._delegate,e,r)}else Object(Ui["w"])(this._delegate,e)}get(){return Object(Ui["q"])(this._delegate).then(e=>new Hi(this.database,e))}once(e,t,n,r){Object(l["X"])("Query.once",1,4,arguments.length),Object(l["Y"])("Query.once","callback",t,!0);const i=Qi.getCancelAndContextArgs_("Query.once",n,r),s=new l["a"],o=(e,n)=>{const r=new Hi(this.database,e);t&&t.call(i.context,r,n),s.resolve(r)};o.userCallback=t,o.context=i.context;const a=e=>{i.cancel&&i.cancel.call(i.context,e),s.reject(e)};switch(e){case"value":Object(Ui["B"])(this._delegate,o,a,{onlyOnce:!0});break;case"child_added":Object(Ui["x"])(this._delegate,o,a,{onlyOnce:!0});break;case"child_removed":Object(Ui["A"])(this._delegate,o,a,{onlyOnce:!0});break;case"child_changed":Object(Ui["y"])(this._delegate,o,a,{onlyOnce:!0});break;case"child_moved":Object(Ui["z"])(this._delegate,o,a,{onlyOnce:!0});break;default:throw new Error(Object(l["s"])("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return s.promise}limitToFirst(e){return Object(l["X"])("Query.limitToFirst",1,1,arguments.length),new Qi(this.database,Object(Ui["H"])(this._delegate,Object(Ui["u"])(e)))}limitToLast(e){return Object(l["X"])("Query.limitToLast",1,1,arguments.length),new Qi(this.database,Object(Ui["H"])(this._delegate,Object(Ui["v"])(e)))}orderByChild(e){return Object(l["X"])("Query.orderByChild",1,1,arguments.length),new Qi(this.database,Object(Ui["H"])(this._delegate,Object(Ui["C"])(e)))}orderByKey(){return Object(l["X"])("Query.orderByKey",0,0,arguments.length),new Qi(this.database,Object(Ui["H"])(this._delegate,Object(Ui["D"])()))}orderByPriority(){return Object(l["X"])("Query.orderByPriority",0,0,arguments.length),new Qi(this.database,Object(Ui["H"])(this._delegate,Object(Ui["E"])()))}orderByValue(){return Object(l["X"])("Query.orderByValue",0,0,arguments.length),new Qi(this.database,Object(Ui["H"])(this._delegate,Object(Ui["F"])()))}startAt(e=null,t){return Object(l["X"])("Query.startAt",0,2,arguments.length),new Qi(this.database,Object(Ui["H"])(this._delegate,Object(Ui["R"])(e,t)))}startAfter(e=null,t){return Object(l["X"])("Query.startAfter",0,2,arguments.length),new Qi(this.database,Object(Ui["H"])(this._delegate,Object(Ui["Q"])(e,t)))}endAt(e=null,t){return Object(l["X"])("Query.endAt",0,2,arguments.length),new Qi(this.database,Object(Ui["H"])(this._delegate,Object(Ui["l"])(e,t)))}endBefore(e=null,t){return Object(l["X"])("Query.endBefore",0,2,arguments.length),new Qi(this.database,Object(Ui["H"])(this._delegate,Object(Ui["m"])(e,t)))}equalTo(e,t){return Object(l["X"])("Query.equalTo",1,2,arguments.length),new Qi(this.database,Object(Ui["H"])(this._delegate,Object(Ui["n"])(e,t)))}toString(){return Object(l["X"])("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return Object(l["X"])("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(Object(l["X"])("Query.isEqual",1,1,arguments.length),!(e instanceof Qi)){const e="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(e)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,n){const r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,Object(l["Y"])(e,"cancel",r.cancel,!0),r.context=n,Object(l["Z"])(e,"context",r.context,!0);else if(t)if("object"===typeof t&&null!==t)r.context=t;else{if("function"!==typeof t)throw new Error(Object(l["s"])(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r}get ref(){return new Yi(this.database,new Ui["d"](this._delegate._repo,this._delegate._path))}}class Yi extends Qi{constructor(e,t){super(e,new Ui["b"](t._repo,t._path,new Ui["c"],!1)),this.database=e,this._delegate=t}getKey(){return Object(l["X"])("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return Object(l["X"])("Reference.child",1,1,arguments.length),"number"===typeof e&&(e=String(e)),new Yi(this.database,Object(Ui["i"])(this._delegate,e))}getParent(){Object(l["X"])("Reference.parent",0,0,arguments.length);const e=this._delegate.parent;return e?new Yi(this.database,e):null}getRoot(){return Object(l["X"])("Reference.root",0,0,arguments.length),new Yi(this.database,this._delegate.root)}set(e,t){Object(l["X"])("Reference.set",1,2,arguments.length),Object(l["Y"])("Reference.set","onComplete",t,!0);const n=Object(Ui["N"])(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}update(e,t){if(Object(l["X"])("Reference.update",1,2,arguments.length),Array.isArray(e)){const t={};for(let n=0;n<e.length;++n)t[""+n]=e[n];e=t,zi("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Object(Ui["h"])("Reference.update",this._delegate._path),Object(l["Y"])("Reference.update","onComplete",t,!0);const n=Object(Ui["S"])(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}setWithPriority(e,t,n){Object(l["X"])("Reference.setWithPriority",2,3,arguments.length),Object(l["Y"])("Reference.setWithPriority","onComplete",n,!0);const r=Object(Ui["P"])(this._delegate,e,t);return n&&r.then(()=>n(null),e=>n(e)),r}remove(e){Object(l["X"])("Reference.remove",0,1,arguments.length),Object(l["Y"])("Reference.remove","onComplete",e,!0);const t=Object(Ui["K"])(this._delegate);return e&&t.then(()=>e(null),t=>e(t)),t}transaction(e,t,n){Object(l["X"])("Reference.transaction",1,3,arguments.length),Object(l["Y"])("Reference.transaction","transactionUpdate",e,!1),Object(l["Y"])("Reference.transaction","onComplete",t,!0),Ki("Reference.transaction","applyLocally",n,!0);const r=Object(Ui["L"])(this._delegate,e,{applyLocally:n}).then(e=>new Gi(e.committed,new Hi(this.database,e.snapshot)));return t&&r.then(e=>t(null,e.committed,e.snapshot),e=>t(e,!1,null)),r}setPriority(e,t){Object(l["X"])("Reference.setPriority",1,2,arguments.length),Object(l["Y"])("Reference.setPriority","onComplete",t,!0);const n=Object(Ui["O"])(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}push(e,t){Object(l["X"])("Reference.push",0,2,arguments.length),Object(l["Y"])("Reference.push","onComplete",t,!0);const n=Object(Ui["G"])(this._delegate,e),r=n.then(e=>new Yi(this.database,e));t&&r.then(()=>t(null),e=>t(e));const i=new Yi(this.database,n);return i.then=r.then.bind(r),i.catch=r.catch.bind(r,void 0),i}onDisconnect(){return Object(Ui["h"])("Reference.onDisconnect",this._delegate._path),new $i(new Ui["a"](this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class Xi{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:Ui["p"],forceLongPolling:Ui["o"]}}useEmulator(e,t,n={}){Object(Ui["j"])(this._delegate,e,t,n)}ref(e){if(Object(l["X"])("database.ref",0,1,arguments.length),e instanceof Yi){const t=Object(Ui["J"])(this._delegate,e.toString());return new Yi(this,t)}{const t=Object(Ui["I"])(this._delegate,e);return new Yi(this,t)}}refFromURL(e){const t="database.refFromURL";Object(l["X"])(t,1,1,arguments.length);const n=Object(Ui["J"])(this._delegate,e);return new Yi(this,n)}goOffline(){return Object(l["X"])("database.goOffline",0,0,arguments.length),Object(Ui["r"])(this._delegate)}goOnline(){return Object(l["X"])("database.goOnline",0,0,arguments.length),Object(Ui["s"])(this._delegate)}}function Ji({app:e,url:t,version:n,customAuthImpl:r,namespace:i,nodeAdmin:s=!1}){Object(Ui["f"])(n);const o=new u["c"]("auth-internal",new u["b"]("database-standalone"));return o.setComponent(new u["a"]("auth-internal",()=>r,"PRIVATE")),{instance:new Xi(Object(Ui["e"])(e,o,void 0,t,s),e),namespace:i}}Xi.ServerValue={TIMESTAMP:Object(Ui["M"])(),increment:e=>Object(Ui["t"])(e)};var Zi=Object.freeze({__proto__:null,initStandalone:Ji});const es=Xi.ServerValue;function ts(e){e.INTERNAL.registerComponent(new u["a"]("database-compat",(e,{instanceIdentifier:t})=>{const n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("database").getImmediate({identifier:t});return new Xi(r,n)},"PUBLIC").setServiceProps({Reference:Yi,Query:Qi,Database:Xi,DataSnapshot:Hi,enableLogging:Ui["k"],INTERNAL:Zi,ServerValue:es}).setMultipleInstances(!0)),e.registerVersion(Vi,qi)}ts(zt["a"]);var ns=n("0829");const rs="@firebase/firestore-compat",is="0.2.2";function ss(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new ns["g"]("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}function os(){if("undefined"===typeof Uint8Array)throw new ns["g"]("unimplemented","Uint8Arrays are not available in this environment.")}function as(){if(!Object(ns["r"])())throw new ns["g"]("unimplemented","Blobs are unavailable in Firestore in this environment.")}class cs{constructor(e){this._delegate=e}static fromBase64String(e){return as(),new cs(ns["b"].fromBase64String(e))}static fromUint8Array(e){return os(),new cs(ns["b"].fromUint8Array(e))}toBase64(){return as(),this._delegate.toBase64()}toUint8Array(){return os(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function us(e){return ls(e,["next","error","complete"])}function ls(e,t){if("object"!==typeof e||null===e)return!1;const n=e;for(const r of t)if(r in n&&"function"===typeof n[r])return!0;return!1}class hs{enableIndexedDbPersistence(e,t){return Object(ns["F"])(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return Object(ns["G"])(e._delegate)}clearIndexedDbPersistence(e){return Object(ns["x"])(e._delegate)}}class ds{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof ns["m"]||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();e.merge||t.host===e.host||Object(ns["s"])("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,n={}){Object(ns["A"])(this._delegate,e,t,n)}enableNetwork(){return Object(ns["H"])(this._delegate)}disableNetwork(){return Object(ns["D"])(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Object(ns["t"])("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Object(ns["lb"])(this._delegate)}onSnapshotsInSync(e){return Object(ns["Y"])(this._delegate,e)}get app(){if(!this._appCompat)throw new ns["g"]("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Ss(this,Object(ns["y"])(this._delegate,e))}catch(t){throw vs(t,"collection()","Firestore.collection()")}}doc(e){try{return new _s(this,Object(ns["E"])(this._delegate,e))}catch(t){throw vs(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Es(this,Object(ns["z"])(this._delegate,e))}catch(t){throw vs(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return Object(ns["db"])(this._delegate,t=>e(new gs(this,t)))}batch(){return Object(ns["K"])(this._delegate),new ms(new ns["l"](this._delegate,e=>Object(ns["L"])(this._delegate,e)))}loadBundle(e){return Object(ns["V"])(this._delegate,e)}namedQuery(e){return Object(ns["W"])(this._delegate,e).then(e=>e?new Es(this,e):null)}}class fs extends ns["a"]{constructor(e){super(),this.firestore=e}convertBytes(e){return new cs(new ns["b"](e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return _s.forKey(t,this.firestore,null)}}function ps(e){Object(ns["gb"])(e)}class gs{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new fs(e)}get(e){const t=Os(e);return this._delegate.get(t).then(e=>new Is(this._firestore,new ns["e"](this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){const r=Os(e);return n?(ss("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=Os(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=Os(e);return this._delegate.delete(t),this}}class ms{constructor(e){this._delegate=e}set(e,t,n){const r=Os(e);return n?(ss("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=Os(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=Os(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class ys{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new ns["i"](this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Ts(this._firestore,n),null!==t&&void 0!==t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=ys.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new ys(e,new fs(e),t),r.set(t,i)),i}}ys.INSTANCES=new WeakMap;class _s{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new fs(e)}static forPath(e,t,n){if(e.length%2!==0)throw new ns["g"]("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new _s(t,new ns["d"](t._delegate,n,new ns["n"](e)))}static forKey(e,t,n){return new _s(t,new ns["d"](t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Ss(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Ss(this.firestore,Object(ns["y"])(this._delegate,e))}catch(t){throw vs(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=Object(l["z"])(e),e instanceof ns["d"]&&Object(ns["cb"])(this._delegate,e)}set(e,t){t=ss("DocumentReference.set",t);try{return t?Object(ns["fb"])(this._delegate,e,t):Object(ns["fb"])(this._delegate,e)}catch(n){throw vs(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?Object(ns["kb"])(this._delegate,e):Object(ns["kb"])(this._delegate,e,t,...n)}catch(r){throw vs(r,"updateDoc()","DocumentReference.update()")}}delete(){return Object(ns["B"])(this._delegate)}onSnapshot(...e){const t=ws(e),n=bs(e,e=>new Is(this.firestore,new ns["e"](this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return Object(ns["X"])(this._delegate,t,n)}get(e){let t;return t="cache"===(null===e||void 0===e?void 0:e.source)?Object(ns["N"])(this._delegate):"server"===(null===e||void 0===e?void 0:e.source)?Object(ns["O"])(this._delegate):Object(ns["M"])(this._delegate),t.then(e=>new Is(this.firestore,new ns["e"](this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new _s(this.firestore,e?this._delegate.withConverter(ys.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function vs(e,t,n){return e.message=e.message.replace(t,n),e}function ws(e){for(const t of e)if("object"===typeof t&&!us(t))return t;return{}}function bs(e,t){var n,r;let i;return i=us(e[0])?e[0]:us(e[1])?e[1]:"function"===typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{i.next&&i.next(t(e))},error:null===(n=i.error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class Is{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new _s(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Object(ns["hb"])(this._delegate,e._delegate)}}class Ts extends Is{data(e){const t=this._delegate.data(e);return Object(ns["q"])(void 0!==t,"Document in a QueryDocumentSnapshot should exist"),t}}class Es{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new fs(e)}where(e,t,n){try{return new Es(this.firestore,Object(ns["ab"])(this._delegate,Object(ns["mb"])(e,t,n)))}catch(r){throw vs(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Es(this.firestore,Object(ns["ab"])(this._delegate,Object(ns["Z"])(e,t)))}catch(n){throw vs(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Es(this.firestore,Object(ns["ab"])(this._delegate,Object(ns["T"])(e)))}catch(t){throw vs(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Es(this.firestore,Object(ns["ab"])(this._delegate,Object(ns["U"])(e)))}catch(t){throw vs(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Es(this.firestore,Object(ns["ab"])(this._delegate,Object(ns["jb"])(...e)))}catch(t){throw vs(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Es(this.firestore,Object(ns["ab"])(this._delegate,Object(ns["ib"])(...e)))}catch(t){throw vs(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Es(this.firestore,Object(ns["ab"])(this._delegate,Object(ns["J"])(...e)))}catch(t){throw vs(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Es(this.firestore,Object(ns["ab"])(this._delegate,Object(ns["I"])(...e)))}catch(t){throw vs(t,"endAt()","Query.endAt()")}}isEqual(e){return Object(ns["bb"])(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null===e||void 0===e?void 0:e.source)?Object(ns["Q"])(this._delegate):"server"===(null===e||void 0===e?void 0:e.source)?Object(ns["R"])(this._delegate):Object(ns["P"])(this._delegate),t.then(e=>new Cs(this.firestore,new ns["j"](this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){const t=ws(e),n=bs(e,e=>new Cs(this.firestore,new ns["j"](this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return Object(ns["X"])(this._delegate,t,n)}withConverter(e){return new Es(this.firestore,e?this._delegate.withConverter(ys.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class ks{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Ts(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Cs{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Es(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Ts(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new ks(this._firestore,e))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new Ts(this._firestore,n))})}isEqual(e){return Object(ns["hb"])(this._delegate,e._delegate)}}class Ss extends Es{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new _s(this.firestore,e):null}doc(e){try{return new _s(this.firestore,void 0===e?Object(ns["E"])(this._delegate):Object(ns["E"])(this._delegate,e))}catch(t){throw vs(t,"doc()","CollectionReference.doc()")}}add(e){return Object(ns["u"])(this._delegate,e).then(e=>new _s(this.firestore,e))}isEqual(e){return Object(ns["cb"])(this._delegate,e._delegate)}withConverter(e){return new Ss(this.firestore,e?this._delegate.withConverter(ys.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Os(e){return Object(ns["p"])(e,ns["d"])}class As{constructor(...e){this._delegate=new ns["f"](...e)}static documentId(){return new As(ns["o"].keyField().canonicalString())}isEqual(e){return e=Object(l["z"])(e),e instanceof ns["f"]&&this._delegate._internalPath.isEqual(e._internalPath)}}class Ns{constructor(e){this._delegate=e}static serverTimestamp(){const e=Object(ns["eb"])();return e._methodName="FieldValue.serverTimestamp",new Ns(e)}static delete(){const e=Object(ns["C"])();return e._methodName="FieldValue.delete",new Ns(e)}static arrayUnion(...e){const t=Object(ns["w"])(...e);return t._methodName="FieldValue.arrayUnion",new Ns(t)}static arrayRemove(...e){const t=Object(ns["v"])(...e);return t._methodName="FieldValue.arrayRemove",new Ns(t)}static increment(e){const t=Object(ns["S"])(e);return t._methodName="FieldValue.increment",new Ns(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const Rs={Firestore:ds,GeoPoint:ns["h"],Timestamp:ns["k"],Blob:cs,Transaction:gs,WriteBatch:ms,DocumentReference:_s,DocumentSnapshot:Is,Query:Es,QueryDocumentSnapshot:Ts,QuerySnapshot:Cs,CollectionReference:Ss,FieldPath:As,FieldValue:Ns,setLogLevel:ps,CACHE_SIZE_UNLIMITED:ns["c"]};function Ds(e,t){e.INTERNAL.registerComponent(new u["a"]("firestore-compat",e=>{const n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("firestore").getImmediate();return t(n,r)},"PUBLIC").setServiceProps(Object.assign({},Rs)))}function xs(e){Ds(e,(e,t)=>new ds(e,t,new hs)),e.registerVersion(rs,is)}xs(zt["a"]);const Ps="type.googleapis.com/google.protobuf.Int64Value",Ms="type.googleapis.com/google.protobuf.UInt64Value";function js(e,t){const n={};for(const r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function Ls(e){if(null==e)return null;if(e instanceof Number&&(e=e.valueOf()),"number"===typeof e&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(e=>Ls(e));if("function"===typeof e||"object"===typeof e)return js(e,e=>Ls(e));throw new Error("Data cannot be encoded in JSON: "+e)}function Fs(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case Ps:case Ms:{const t=Number(e["value"]);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t}default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(e=>Fs(e)):"function"===typeof e||"object"===typeof e?js(e,e=>Fs(e)):e}const Us="functions",Vs={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class qs extends l["c"]{constructor(e,t,n){super(`${Us}/${e}`,t||""),this.details=n}}function Bs(e){if(e>=200&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function zs(e,t){let n=Bs(e),r=n,i=void 0;try{const e=t&&t.error;if(e){const t=e.status;if("string"===typeof t){if(!Vs[t])return new qs("internal","internal");n=Vs[t],r=t}const s=e.message;"string"===typeof s&&(r=s),i=e.details,void 0!==i&&(i=Fs(i))}}catch(s){}return"ok"===n?null:new qs(n,r,i)}class Ks{constructor(e,t,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(e=>this.auth=e,()=>{}),this.messaging||t.get().then(e=>this.messaging=e,()=>{}),this.appCheck||n.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return null===e||void 0===e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(e){return}}async getAppCheckToken(){if(this.appCheck){const e=await this.appCheck.getToken();return e.error?null:e.token}return null}async getContext(){const e=await this.getAuthToken(),t=await this.getMessagingToken(),n=await this.getAppCheckToken();return{authToken:e,messagingToken:t,appCheckToken:n}}}const Ws="us-central1";function $s(e){let t=null;return{promise:new Promise((n,r)=>{t=setTimeout(()=>{r(new qs("deadline-exceeded","deadline-exceeded"))},e)}),cancel:()=>{t&&clearTimeout(t)}}}class Gs{constructor(e,t,n,r,i=Ws,s){this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new Ks(t,n,r),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{const e=new URL(i);this.customDomain=e.origin,this.region=Ws}catch(o){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;if(null!==this.emulatorOrigin){const n=this.emulatorOrigin;return`${n}/${t}/${this.region}/${e}`}return null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function Hs(e,t,n){e.emulatorOrigin=`http://${t}:${n}`}function Qs(e,t,n){return r=>Js(e,t,r,n||{})}function Ys(e,t,n){return r=>Zs(e,t,r,n||{})}async function Xs(e,t,n,r){let i;n["Content-Type"]="application/json";try{i=await r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch(o){return{status:0,json:null}}let s=null;try{s=await i.json()}catch(o){}return{status:i.status,json:s}}function Js(e,t,n,r){const i=e._url(t);return Zs(e,i,n,r)}async function Zs(e,t,n,r){n=Ls(n);const i={data:n},s={},o=await e.contextProvider.getContext();o.authToken&&(s["Authorization"]="Bearer "+o.authToken),o.messagingToken&&(s["Firebase-Instance-ID-Token"]=o.messagingToken),null!==o.appCheckToken&&(s["X-Firebase-AppCheck"]=o.appCheckToken);const a=r.timeout||7e4,c=$s(a),u=await Promise.race([Xs(t,i,s,e.fetchImpl),c.promise,e.cancelAllRequests]);if(c.cancel(),!u)throw new qs("cancelled","Firebase Functions instance was deleted.");const l=zs(u.status,u.json);if(l)throw l;if(!u.json)throw new qs("internal","Response is not valid JSON object.");let h=u.json.data;if("undefined"===typeof h&&(h=u.json.result),"undefined"===typeof h)throw new qs("internal","Response is missing data field.");const d=Fs(h);return{data:d}}const eo="@firebase/functions",to="0.8.8",no="auth-internal",ro="app-check-internal",io="messaging-internal";function so(e,t){const n=(t,{instanceIdentifier:n})=>{const r=t.getProvider("app").getImmediate(),i=t.getProvider(no),s=t.getProvider(io),o=t.getProvider(ro);return new Gs(r,i,s,o,n,e)};Object(o["_registerComponent"])(new u["a"](Us,n,"PUBLIC").setMultipleInstances(!0)),Object(o["registerVersion"])(eo,to,t),Object(o["registerVersion"])(eo,to,"esm2017")}function oo(e,t,n){Hs(Object(l["z"])(e),t,n)}function ao(e,t,n){return Qs(Object(l["z"])(e),t,n)}function co(e,t,n){return Ys(Object(l["z"])(e),t,n)}so(fetch.bind(self));const uo="@firebase/functions-compat",lo="0.2.8";class ho{constructor(e,t){this.app=e,this._delegate=t,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(e,t){return ao(this._delegate,e,t)}httpsCallableFromURL(e,t){return co(this._delegate,e,t)}useFunctionsEmulator(e){const t=e.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?");if(null==t)throw new l["c"]("functions","No origin provided to useFunctionsEmulator()");if(null==t[2])throw new l["c"]("functions","Port missing in origin provided to useFunctionsEmulator()");return oo(this._delegate,t[1],Number(t[2]))}useEmulator(e,t){return oo(this._delegate,e,t)}}const fo="us-central1",po=(e,{instanceIdentifier:t})=>{const n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("functions").getImmediate({identifier:null!==t&&void 0!==t?t:fo});return new ho(n,r)};function go(){const e={Functions:ho};zt["a"].INTERNAL.registerComponent(new u["a"]("functions-compat",po,"PUBLIC").setServiceProps(e).setMultipleInstances(!0))}go(),zt["a"].registerVersion(uo,lo);const mo="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",yo="https://fcmregistrations.googleapis.com/v1",_o="FCM_MSG",vo="google.c.a.c_id",wo=3,bo=1;var Io,To;function Eo(e){const t=new Uint8Array(e),n=btoa(String.fromCharCode(...t));return n.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function ko(e){const t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(n),i=new Uint8Array(r.length);for(let s=0;s<r.length;++s)i[s]=r.charCodeAt(s);return i}(function(e){e[e["DATA_MESSAGE"]=1]="DATA_MESSAGE",e[e["DISPLAY_NOTIFICATION"]=3]="DISPLAY_NOTIFICATION"})(Io||(Io={})),function(e){e["PUSH_RECEIVED"]="push-received",e["NOTIFICATION_CLICKED"]="notification-clicked"}(To||(To={}));const Co="fcm_token_details_db",So=5,Oo="fcm_token_object_Store";async function Ao(e){if("databases"in indexedDB){const e=await indexedDB.databases(),t=e.map(e=>e.name);if(!t.includes(Co))return null}let t=null;const n=await Object(h["b"])(Co,So,{upgrade:async(n,r,i,s)=>{var o;if(r<2)return;if(!n.objectStoreNames.contains(Oo))return;const a=s.objectStore(Oo),c=await a.index("fcmSenderId").get(e);if(await a.clear(),c)if(2===r){const e=c;if(!e.auth||!e.p256dh||!e.endpoint)return;t={token:e.fcmToken,createTime:null!==(o=e.createTime)&&void 0!==o?o:Date.now(),subscriptionOptions:{auth:e.auth,p256dh:e.p256dh,endpoint:e.endpoint,swScope:e.swScope,vapidKey:"string"===typeof e.vapidKey?e.vapidKey:Eo(e.vapidKey)}}}else if(3===r){const e=c;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:Eo(e.auth),p256dh:Eo(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:Eo(e.vapidKey)}}}else if(4===r){const e=c;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:Eo(e.auth),p256dh:Eo(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:Eo(e.vapidKey)}}}}});return n.close(),await Object(h["a"])(Co),await Object(h["a"])("fcm_vapid_details_db"),await Object(h["a"])("undefined"),No(t)?t:null}function No(e){if(!e||!e.subscriptionOptions)return!1;const{subscriptionOptions:t}=e;return"number"===typeof e.createTime&&e.createTime>0&&"string"===typeof e.token&&e.token.length>0&&"string"===typeof t.auth&&t.auth.length>0&&"string"===typeof t.p256dh&&t.p256dh.length>0&&"string"===typeof t.endpoint&&t.endpoint.length>0&&"string"===typeof t.swScope&&t.swScope.length>0&&"string"===typeof t.vapidKey&&t.vapidKey.length>0}const Ro="firebase-messaging-database",Do=1,xo="firebase-messaging-store";let Po=null;function Mo(){return Po||(Po=Object(h["b"])(Ro,Do,{upgrade:(e,t)=>{switch(t){case 0:e.createObjectStore(xo)}}})),Po}async function jo(e){const t=Uo(e),n=await Mo(),r=await n.transaction(xo).objectStore(xo).get(t);if(r)return r;{const t=await Ao(e.appConfig.senderId);if(t)return await Lo(e,t),t}}async function Lo(e,t){const n=Uo(e),r=await Mo(),i=r.transaction(xo,"readwrite");return await i.objectStore(xo).put(t,n),await i.done,t}async function Fo(e){const t=Uo(e),n=await Mo(),r=n.transaction(xo,"readwrite");await r.objectStore(xo).delete(t),await r.done}function Uo({appConfig:e}){return e.appId}const Vo={["missing-app-config-values"]:'Missing App configuration value: "{$valueName}"',["only-available-in-window"]:"This method is available in a Window context.",["only-available-in-sw"]:"This method is available in a service worker context.",["permission-default"]:"The notification permission was not granted and dismissed instead.",["permission-blocked"]:"The notification permission was not granted and blocked instead.",["unsupported-browser"]:"This browser doesn't support the API's required to use the Firebase SDK.",["indexed-db-unsupported"]:"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)",["failed-service-worker-registration"]:"We are unable to register the default service worker. {$browserErrorMessage}",["token-subscribe-failed"]:"A problem occurred while subscribing the user to FCM: {$errorInfo}",["token-subscribe-no-token"]:"FCM returned no token when subscribing the user to push.",["token-unsubscribe-failed"]:"A problem occurred while unsubscribing the user from FCM: {$errorInfo}",["token-update-failed"]:"A problem occurred while updating the user from FCM: {$errorInfo}",["token-update-no-token"]:"FCM returned no token when updating the user to push.",["use-sw-after-get-token"]:"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",["invalid-sw-registration"]:"The input to useServiceWorker() must be a ServiceWorkerRegistration.",["invalid-bg-handler"]:"The input to setBackgroundMessageHandler() must be a function.",["invalid-vapid-key"]:"The public VAPID key must be a string.",["use-vapid-key-after-get-token"]:"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},qo=new l["b"]("messaging","Messaging",Vo);async function Bo(e,t){var n;const r=await $o(e),i=Go(t),s={method:"POST",headers:r,body:JSON.stringify(i)};let o;try{const t=await fetch(Wo(e.appConfig),s);o=await t.json()}catch(a){throw qo.create("token-subscribe-failed",{errorInfo:null===(n=a)||void 0===n?void 0:n.toString()})}if(o.error){const e=o.error.message;throw qo.create("token-subscribe-failed",{errorInfo:e})}if(!o.token)throw qo.create("token-subscribe-no-token");return o.token}async function zo(e,t){var n;const r=await $o(e),i=Go(t.subscriptionOptions),s={method:"PATCH",headers:r,body:JSON.stringify(i)};let o;try{const n=await fetch(`${Wo(e.appConfig)}/${t.token}`,s);o=await n.json()}catch(a){throw qo.create("token-update-failed",{errorInfo:null===(n=a)||void 0===n?void 0:n.toString()})}if(o.error){const e=o.error.message;throw qo.create("token-update-failed",{errorInfo:e})}if(!o.token)throw qo.create("token-update-no-token");return o.token}async function Ko(e,t){var n;const r=await $o(e),i={method:"DELETE",headers:r};try{const n=await fetch(`${Wo(e.appConfig)}/${t}`,i),r=await n.json();if(r.error){const e=r.error.message;throw qo.create("token-unsubscribe-failed",{errorInfo:e})}}catch(s){throw qo.create("token-unsubscribe-failed",{errorInfo:null===(n=s)||void 0===n?void 0:n.toString()})}}function Wo({projectId:e}){return`${yo}/projects/${e}/registrations`}async function $o({appConfig:e,installations:t}){const n=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":"FIS "+n})}function Go({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==mo&&(i.web.applicationPubKey=r),i}const Ho=6048e5;async function Qo(e){const t=await Zo(e.swRegistration,e.vapidKey),n={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:Eo(t.getKey("auth")),p256dh:Eo(t.getKey("p256dh"))},r=await jo(e.firebaseDependencies);if(r){if(ea(r.subscriptionOptions,n))return Date.now()>=r.createTime+Ho?Xo(e,{token:r.token,createTime:Date.now(),subscriptionOptions:n}):r.token;try{await Ko(e.firebaseDependencies,r.token)}catch(i){console.warn(i)}return Jo(e.firebaseDependencies,n)}return Jo(e.firebaseDependencies,n)}async function Yo(e){const t=await jo(e.firebaseDependencies);t&&(await Ko(e.firebaseDependencies,t.token),await Fo(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function Xo(e,t){try{const n=await zo(e.firebaseDependencies,t),r=Object.assign(Object.assign({},t),{token:n,createTime:Date.now()});return await Lo(e.firebaseDependencies,r),n}catch(n){throw await Yo(e),n}}async function Jo(e,t){const n=await Bo(e,t),r={token:n,createTime:Date.now(),subscriptionOptions:t};return await Lo(e,r),r.token}async function Zo(e,t){const n=await e.pushManager.getSubscription();return n||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:ko(t)})}function ea(e,t){const n=t.vapidKey===e.vapidKey,r=t.endpoint===e.endpoint,i=t.auth===e.auth,s=t.p256dh===e.p256dh;return n&&r&&i&&s}function ta(e){const t={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return na(t,e),ra(t,e),ia(t,e),t}function na(e,t){if(!t.notification)return;e.notification={};const n=t.notification.title;n&&(e.notification.title=n);const r=t.notification.body;r&&(e.notification.body=r);const i=t.notification.image;i&&(e.notification.image=i);const s=t.notification.icon;s&&(e.notification.icon=s)}function ra(e,t){t.data&&(e.data=t.data)}function ia(e,t){var n,r,i,s,o;if(!t.fcmOptions&&!(null===(n=t.notification)||void 0===n?void 0:n.click_action))return;e.fcmOptions={};const a=null!==(i=null===(r=t.fcmOptions)||void 0===r?void 0:r.link)&&void 0!==i?i:null===(s=t.notification)||void 0===s?void 0:s.click_action;a&&(e.fcmOptions.link=a);const c=null===(o=t.fcmOptions)||void 0===o?void 0:o.analytics_label;c&&(e.fcmOptions.analyticsLabel=c)}function sa(e){return"object"===typeof e&&!!e&&vo in e}function oa(e){return new Promise(t=>{setTimeout(t,e)})}async function aa(e,t){const n=ca(t,await e.firebaseDependencies.installations.getId());ua(e,n)}function ca(e,t){var n,r;const i={};return e.from&&(i.project_number=e.from),e.fcmMessageId&&(i.message_id=e.fcmMessageId),i.instance_id=t,e.notification?i.message_type=Io.DISPLAY_NOTIFICATION.toString():i.message_type=Io.DATA_MESSAGE.toString(),i.sdk_platform=wo.toString(),i.package_name=self.origin.replace(/(^\w+:|^)\/\//,""),e.collapse_key&&(i.collapse_key=e.collapse_key),i.event=bo.toString(),(null===(n=e.fcmOptions)||void 0===n?void 0:n.analytics_label)&&(i.analytics_label=null===(r=e.fcmOptions)||void 0===r?void 0:r.analytics_label),i}function ua(e,t){const n={};n.event_time_ms=Math.floor(Date.now()).toString(),n.source_extension_json_proto3=JSON.stringify(t),e.logEvents.push(n)}function la(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}async function ha(e,t){var n,r;const{newSubscription:i}=e;if(!i)return void await Yo(t);const s=await jo(t.firebaseDependencies);await Yo(t),t.vapidKey=null!==(r=null===(n=null===s||void 0===s?void 0:s.subscriptionOptions)||void 0===n?void 0:n.vapidKey)&&void 0!==r?r:mo,await Qo(t)}async function da(e,t){const n=ga(e);if(!n)return;t.deliveryMetricsExportedToBigQueryEnabled&&await aa(t,n);const r=await va();if(ya(r))return _a(r,n);if(n.notification&&await wa(pa(n)),t&&t.onBackgroundMessageHandler){const e=ta(n);"function"===typeof t.onBackgroundMessageHandler?await t.onBackgroundMessageHandler(e):t.onBackgroundMessageHandler.next(e)}}async function fa(e){var t,n;const r=null===(n=null===(t=e.notification)||void 0===t?void 0:t.data)||void 0===n?void 0:n[_o];if(!r)return;if(e.action)return;e.stopImmediatePropagation(),e.notification.close();const i=ba(r);if(!i)return;const s=new URL(i,self.location.href),o=new URL(self.location.origin);if(s.host!==o.host)return;let a=await ma(s);return a?a=await a.focus():(a=await self.clients.openWindow(i),await oa(3e3)),a?(r.messageType=To.NOTIFICATION_CLICKED,r.isFirebaseMessaging=!0,a.postMessage(r)):void 0}function pa(e){const t=Object.assign({},e.notification);return t.data={[_o]:e},t}function ga({data:e}){if(!e)return null;try{return e.json()}catch(t){return null}}async function ma(e){const t=await va();for(const n of t){const t=new URL(n.url,self.location.href);if(e.host===t.host)return n}return null}function ya(e){return e.some(e=>"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://"))}function _a(e,t){t.isFirebaseMessaging=!0,t.messageType=To.PUSH_RECEIVED;for(const n of e)n.postMessage(t)}function va(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function wa(e){var t;const{actions:n}=e,{maxActions:r}=Notification;return n&&r&&n.length>r&&console.warn(`This browser only supports ${r} actions. The remaining actions will not be displayed.`),self.registration.showNotification(null!==(t=e.title)&&void 0!==t?t:"",e)}function ba(e){var t,n,r;const i=null!==(n=null===(t=e.fcmOptions)||void 0===t?void 0:t.link)&&void 0!==n?n:null===(r=e.notification)||void 0===r?void 0:r.click_action;return i||(sa(e.data)?self.location.origin:null)}function Ia(e){if(!e||!e.options)throw Ta("App Configuration Object");if(!e.name)throw Ta("App Name");const t=["projectId","apiKey","appId","messagingSenderId"],{options:n}=e;for(const r of t)if(!n[r])throw Ta(r);return{appName:e.name,projectId:n.projectId,apiKey:n.apiKey,appId:n.appId,senderId:n.messagingSenderId}}function Ta(e){return qo.create("missing-app-config-values",{valueName:e})}la("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),la("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class Ea{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const r=Ia(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}const ka=e=>{const t=new Ea(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return self.addEventListener("push",e=>{e.waitUntil(da(e,t))}),self.addEventListener("pushsubscriptionchange",e=>{e.waitUntil(ha(e,t))}),self.addEventListener("notificationclick",e=>{e.waitUntil(fa(e))}),t};function Ca(){Object(o["_registerComponent"])(new u["a"]("messaging-sw",ka,"PUBLIC"))}function Sa(e,t){if(void 0!==self.document)throw qo.create("only-available-in-sw");return e.onBackgroundMessageHandler=t,()=>{e.onBackgroundMessageHandler=null}}function Oa(e,t){return e=Object(l["z"])(e),Sa(e,t)}Ca();const Aa="@firebase/messaging-compat",Na="0.1.20";function Ra(){return self&&"ServiceWorkerGlobalScope"in self?xa():Da()}function Da(){return"undefined"!==typeof window&&Object(l["G"])()&&Object(l["e"])()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}function xa(){return Object(l["G"])()&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}class Pa{constructor(e,t){this.app=e,this._delegate=t,this.app=e,this._delegate=t}async getToken(e){return Vt(this._delegate,e)}async deleteToken(){return qt(this._delegate)}onMessage(e){return Bt(this._delegate,e)}onBackgroundMessage(e){return Oa(this._delegate,e)}}const Ma=e=>self&&"ServiceWorkerGlobalScope"in self?new Pa(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging-sw").getImmediate()):new Pa(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging").getImmediate()),ja={isSupported:Ra};function La(){zt["a"].INTERNAL.registerComponent(new u["a"]("messaging-compat",Ma,"PUBLIC").setServiceProps(ja))}La(),zt["a"].registerVersion(Aa,Na);const Fa="firebasestorage.googleapis.com",Ua="storageBucket",Va=12e4,qa=6e5,Ba=1e3;class za extends l["c"]{constructor(e,t,n=0){super(Ka(e),`Firebase Storage: ${t} (${Ka(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,za.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Ka(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}function Ka(e){return"storage/"+e}function Wa(){const e="An unknown error occurred, please check the error payload for server response.";return new za("unknown",e)}function $a(e){return new za("object-not-found","Object '"+e+"' does not exist.")}function Ga(e){return new za("quota-exceeded","Quota for bucket '"+e+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Ha(){const e="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new za("unauthenticated",e)}function Qa(){return new za("unauthorized-app","This app does not have permission to access Firebase Storage on this project.")}function Ya(e){return new za("unauthorized","User does not have permission to access '"+e+"'.")}function Xa(){return new za("retry-limit-exceeded","Max retry time for operation exceeded, please try again.")}function Ja(){return new za("canceled","User canceled the upload/download.")}function Za(e){return new za("invalid-url","Invalid URL '"+e+"'.")}function ec(e){return new za("invalid-default-bucket","Invalid default bucket '"+e+"'.")}function tc(){return new za("no-default-bucket","No default bucket found. Did you set the '"+Ua+"' property when initializing the app?")}function nc(){return new za("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function rc(){return new za("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.")}function ic(){return new za("no-download-url","The given file does not have any download URLs.")}function sc(e){return new za("invalid-argument",e)}function oc(){return new za("app-deleted","The Firebase app was deleted.")}function ac(e){return new za("invalid-root-operation","The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function cc(e,t){return new za("invalid-format","String does not match format '"+e+"': "+t)}function uc(e){throw new za("internal-error","Internal error: "+e)}class lc{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=lc.makeFromUrl(e,t)}catch(r){return new lc(e,"")}if(""===n.path)return n;throw ec(e)}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)";function i(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}const s="(/(.*))?$",o=new RegExp("^gs://"+r+s,"i"),a={bucket:1,path:3};function c(e){e.path_=decodeURIComponent(e.path)}const u="v[A-Za-z0-9_]+",l=t.replace(/[.]/g,"\\."),h="(/([^?#]*).*)?$",d=new RegExp(`^https?://${l}/${u}/b/${r}/o${h}`,"i"),f={bucket:1,path:3},p=t===Fa?"(?:storage.googleapis.com|storage.cloud.google.com)":t,g="([^?#]*)",m=new RegExp(`^https?://${p}/${r}/${g}`,"i"),y={bucket:1,path:2},_=[{regex:o,indices:a,postModify:i},{regex:d,indices:f,postModify:c},{regex:m,indices:y,postModify:c}];for(let v=0;v<_.length;v++){const t=_[v],r=t.regex.exec(e);if(r){const e=r[t.indices.bucket];let i=r[t.indices.path];i||(i=""),n=new lc(e,i),t.postModify(n);break}}if(null==n)throw Za(e);return n}}class hc{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function dc(e,t,n){let r=1,i=null,s=null,o=!1,a=0;function c(){return 2===a}let u=!1;function l(...e){u||(u=!0,t.apply(null,e))}function h(t){i=setTimeout(()=>{i=null,e(f,c())},t)}function d(){s&&clearTimeout(s)}function f(e,...t){if(u)return void d();if(e)return d(),void l.call(null,e,...t);const n=c()||o;if(n)return d(),void l.call(null,e,...t);let i;r<64&&(r*=2),1===a?(a=2,i=0):i=1e3*(r+Math.random()),h(i)}let p=!1;function g(e){p||(p=!0,d(),u||(null!==i?(e||(a=2),clearTimeout(i),h(0)):e||(a=1)))}return h(0),s=setTimeout(()=>{o=!0,g(!0)},n),g}function fc(e){e(!1)}function pc(e){return void 0!==e}function gc(e){return"function"===typeof e}function mc(e){return"object"===typeof e&&!Array.isArray(e)}function yc(e){return"string"===typeof e||e instanceof String}function _c(e){return vc()&&e instanceof Blob}function vc(){return"undefined"!==typeof Blob&&!Object(l["I"])()}function wc(e,t,n,r){if(r<t)throw sc(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw sc(`Invalid value for '${e}'. Expected ${n} or less.`)}function bc(e,t,n){let r=t;return null==n&&(r="https://"+t),`${n}://${r}/v0${e}`}function Ic(e){const t=encodeURIComponent;let n="?";for(const r in e)if(e.hasOwnProperty(r)){const i=t(r)+"="+t(e[r]);n=n+i+"&"}return n=n.slice(0,-1),n}var Tc;function Ec(e,t){const n=e>=500&&e<600,r=[408,429],i=-1!==r.indexOf(e),s=-1!==t.indexOf(e);return n||i||s}(function(e){e[e["NO_ERROR"]=0]="NO_ERROR",e[e["NETWORK_ERROR"]=1]="NETWORK_ERROR",e[e["ABORT"]=2]="ABORT"})(Tc||(Tc={}));class kc{constructor(e,t,n,r,i,s,o,a,c,u,l,h=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=l,this.retry=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){const e=(e,t)=>{if(t)return void e(!1,new Cc(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===Tc.NO_ERROR,i=n.getStatus();if((!t||Ec(i,this.additionalRetryCodes_))&&this.retry){const t=n.getErrorCode()===Tc.ABORT;return void e(!1,new Cc(!1,null,t))}const s=-1!==this.successCodes_.indexOf(i);e(!0,new Cc(s,n))})},t=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(i,i.getResponse());pc(e)?n(e):n()}catch(s){r(s)}else if(null!==i){const e=Wa();e.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,e)):r(e)}else if(t.canceled){const e=this.appDelete_?oc():Ja();r(e)}else{const e=Xa();r(e)}};this.canceled_?t(!1,new Cc(!1,null,!0)):this.backoffId_=dc(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&fc(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class Cc{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function Sc(e,t){null!==t&&t.length>0&&(e["Authorization"]="Firebase "+t)}function Oc(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!==t&&void 0!==t?t:"AppManager")}function Ac(e,t){t&&(e["X-Firebase-GMPID"]=t)}function Nc(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}function Rc(e,t,n,r,i,s,o=!0){const a=Ic(e.urlParams),c=e.url+a,u=Object.assign({},e.headers);return Ac(u,t),Sc(u,n),Oc(u,s),Nc(u,r),new kc(c,e.method,u,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,o)}function Dc(){return"undefined"!==typeof BlobBuilder?BlobBuilder:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function xc(...e){const t=Dc();if(void 0!==t){const n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(vc())return new Blob(e);throw new za("unsupported-environment","This browser doesn't seem to support creating Blobs")}function Pc(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.mozSlice?e.mozSlice(t,n):e.slice?e.slice(t,n):null}function Mc(e){return atob(e)}const jc={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Lc{constructor(e,t){this.data=e,this.contentType=t||null}}function Fc(e,t){switch(e){case jc.RAW:return new Lc(Uc(t));case jc.BASE64:case jc.BASE64URL:return new Lc(qc(e,t));case jc.DATA_URL:return new Lc(zc(t),Kc(t))}throw Wa()}function Uc(e){const t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r<=127)t.push(r);else if(r<=2047)t.push(192|r>>6,128|63&r);else if(55296===(64512&r)){const i=n<e.length-1&&56320===(64512&e.charCodeAt(n+1));if(i){const i=r,s=e.charCodeAt(++n);r=65536|(1023&i)<<10|1023&s,t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)}else t.push(239,191,189)}else 56320===(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function Vc(e){let t;try{t=decodeURIComponent(e)}catch(n){throw cc(jc.DATA_URL,"Malformed data URL.")}return Uc(t)}function qc(e,t){switch(e){case jc.BASE64:{const n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r){const t=n?"-":"_";throw cc(e,"Invalid character '"+t+"' found: is it base64url encoded?")}break}case jc.BASE64URL:{const n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r){const t=n?"+":"/";throw cc(e,"Invalid character '"+t+"' found: is it base64 encoded?")}t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=Mc(t)}catch(i){throw cc(e,"Invalid character found")}const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}class Bc{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw cc(jc.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;null!=n&&(this.base64=Wc(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=e.substring(e.indexOf(",")+1)}}function zc(e){const t=new Bc(e);return t.base64?qc(jc.BASE64,t.rest):Vc(t.rest)}function Kc(e){const t=new Bc(e);return t.contentType}function Wc(e,t){const n=e.length>=t.length;return!!n&&e.substring(e.length-t.length)===t}class $c{constructor(e,t){let n=0,r="";_c(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(_c(this.data_)){const n=this.data_,r=Pc(n,e,t);return null===r?null:new $c(r)}{const n=new Uint8Array(this.data_.buffer,e,t-e);return new $c(n,!0)}}static getBlob(...e){if(vc()){const t=e.map(e=>e instanceof $c?e.data_:e);return new $c(xc.apply(null,t))}{const t=e.map(e=>yc(e)?Fc(jc.RAW,e).data:e.data_);let n=0;t.forEach(e=>{n+=e.byteLength});const r=new Uint8Array(n);let i=0;return t.forEach(e=>{for(let t=0;t<e.length;t++)r[i++]=e[t]}),new $c(r,!0)}}uploadData(){return this.data_}}function Gc(e){let t;try{t=JSON.parse(e)}catch(n){return null}return mc(t)?t:null}function Hc(e){if(0===e.length)return null;const t=e.lastIndexOf("/");if(-1===t)return"";const n=e.slice(0,t);return n}function Qc(e,t){const n=t.split("/").filter(e=>e.length>0).join("/");return 0===e.length?n:e+"/"+n}function Yc(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function Xc(e,t){return t}class Jc{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||Xc}}let Zc=null;function eu(e){return!yc(e)||e.length<2?e:Yc(e)}function tu(){if(Zc)return Zc;const e=[];function t(e,t){return eu(t)}e.push(new Jc("bucket")),e.push(new Jc("generation")),e.push(new Jc("metageneration")),e.push(new Jc("name","fullPath",!0));const n=new Jc("name");function r(e,t){return void 0!==t?Number(t):t}n.xform=t,e.push(n);const i=new Jc("size");return i.xform=r,e.push(i),e.push(new Jc("timeCreated")),e.push(new Jc("updated")),e.push(new Jc("md5Hash",null,!0)),e.push(new Jc("cacheControl",null,!0)),e.push(new Jc("contentDisposition",null,!0)),e.push(new Jc("contentEncoding",null,!0)),e.push(new Jc("contentLanguage",null,!0)),e.push(new Jc("contentType",null,!0)),e.push(new Jc("metadata","customMetadata",!0)),Zc=e,Zc}function nu(e,t){function n(){const n=e["bucket"],r=e["fullPath"],i=new lc(n,r);return t._makeStorageReference(i)}Object.defineProperty(e,"ref",{get:n})}function ru(e,t,n){const r={type:"file"},i=n.length;for(let s=0;s<i;s++){const e=n[s];r[e.local]=e.xform(r,t[e.server])}return nu(r,e),r}function iu(e,t,n){const r=Gc(t);if(null===r)return null;const i=r;return ru(e,i,n)}function su(e,t,n,r){const i=Gc(t);if(null===i)return null;if(!yc(i["downloadTokens"]))return null;const s=i["downloadTokens"];if(0===s.length)return null;const o=encodeURIComponent,a=s.split(","),c=a.map(t=>{const i=e["bucket"],s=e["fullPath"],a="/b/"+o(i)+"/o/"+o(s),c=bc(a,n,r),u=Ic({alt:"media",token:t});return c+u});return c[0]}function ou(e,t){const n={},r=t.length;for(let i=0;i<r;i++){const r=t[i];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}const au="prefixes",cu="items";function uu(e,t,n){const r={prefixes:[],items:[],nextPageToken:n["nextPageToken"]};if(n[au])for(const i of n[au]){const n=i.replace(/\/$/,""),s=e._makeStorageReference(new lc(t,n));r.prefixes.push(s)}if(n[cu])for(const i of n[cu]){const n=e._makeStorageReference(new lc(t,i["name"]));r.items.push(n)}return r}function lu(e,t,n){const r=Gc(n);if(null===r)return null;const i=r;return uu(e,t,i)}class hu{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function du(e){if(!e)throw Wa()}function fu(e,t){function n(n,r){const i=iu(e,r,t);return du(null!==i),i}return n}function pu(e,t){function n(n,r){const i=lu(e,t,r);return du(null!==i),i}return n}function gu(e,t){function n(n,r){const i=iu(e,r,t);return du(null!==i),su(i,r,e.host,e._protocol)}return n}function mu(e){function t(t,n){let r;return r=401===t.getStatus()?t.getErrorText().includes("Firebase App Check token is invalid")?Qa():Ha():402===t.getStatus()?Ga(e.bucket):403===t.getStatus()?Ya(e.path):n,r.status=t.getStatus(),r.serverResponse=n.serverResponse,r}return t}function yu(e){const t=mu(e);function n(n,r){let i=t(n,r);return 404===n.getStatus()&&(i=$a(e.path)),i.serverResponse=r.serverResponse,i}return n}function _u(e,t,n){const r=t.fullServerUrl(),i=bc(r,e.host,e._protocol),s="GET",o=e.maxOperationRetryTime,a=new hu(i,s,fu(e,n),o);return a.errorHandler=yu(t),a}function vu(e,t,n,r,i){const s={};t.isRoot?s["prefix"]="":s["prefix"]=t.path+"/",n&&n.length>0&&(s["delimiter"]=n),r&&(s["pageToken"]=r),i&&(s["maxResults"]=i);const o=t.bucketOnlyServerUrl(),a=bc(o,e.host,e._protocol),c="GET",u=e.maxOperationRetryTime,l=new hu(a,c,pu(e,t.bucket),u);return l.urlParams=s,l.errorHandler=mu(t),l}function wu(e,t,n){const r=t.fullServerUrl(),i=bc(r,e.host,e._protocol),s="GET",o=e.maxOperationRetryTime,a=new hu(i,s,gu(e,n),o);return a.errorHandler=yu(t),a}function bu(e,t,n,r){const i=t.fullServerUrl(),s=bc(i,e.host,e._protocol),o="PATCH",a=ou(n,r),c={"Content-Type":"application/json; charset=utf-8"},u=e.maxOperationRetryTime,l=new hu(s,o,fu(e,r),u);return l.headers=c,l.body=a,l.errorHandler=yu(t),l}function Iu(e,t){const n=t.fullServerUrl(),r=bc(n,e.host,e._protocol),i="DELETE",s=e.maxOperationRetryTime;function o(e,t){}const a=new hu(r,i,o,s);return a.successCodes=[200,204],a.errorHandler=yu(t),a}function Tu(e,t){return e&&e["contentType"]||t&&t.type()||"application/octet-stream"}function Eu(e,t,n){const r=Object.assign({},n);return r["fullPath"]=e.path,r["size"]=t.size(),r["contentType"]||(r["contentType"]=Tu(null,t)),r}function ku(e,t,n,r,i){const s=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}const c=a();o["Content-Type"]="multipart/related; boundary="+c;const u=Eu(t,r,i),l=ou(u,n),h="--"+c+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+l+"\r\n--"+c+"\r\nContent-Type: "+u["contentType"]+"\r\n\r\n",d="\r\n--"+c+"--",f=$c.getBlob(h,r,d);if(null===f)throw nc();const p={name:u["fullPath"]},g=bc(s,e.host,e._protocol),m="POST",y=e.maxUploadRetryTime,_=new hu(g,m,fu(e,n),y);return _.urlParams=p,_.headers=o,_.body=f.uploadData(),_.errorHandler=mu(t),_}class Cu{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function Su(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(i){du(!1)}const r=t||["active"];return du(!!n&&-1!==r.indexOf(n)),n}function Ou(e,t,n,r,i){const s=t.bucketOnlyServerUrl(),o=Eu(t,r,i),a={name:o["fullPath"]},c=bc(s,e.host,e._protocol),u="POST",l={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":""+r.size(),"X-Goog-Upload-Header-Content-Type":o["contentType"],"Content-Type":"application/json; charset=utf-8"},h=ou(o,n),d=e.maxUploadRetryTime;function f(e){let t;Su(e);try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(n){du(!1)}return du(yc(t)),t}const p=new hu(c,u,f,d);return p.urlParams=a,p.headers=l,p.body=h,p.errorHandler=mu(t),p}function Au(e,t,n,r){const i={"X-Goog-Upload-Command":"query"};function s(e){const t=Su(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(s){du(!1)}n||du(!1);const i=Number(n);return du(!isNaN(i)),new Cu(i,r.size(),"final"===t)}const o="POST",a=e.maxUploadRetryTime,c=new hu(n,o,s,a);return c.headers=i,c.errorHandler=mu(t),c}const Nu=262144;function Ru(e,t,n,r,i,s,o,a){const c=new Cu(0,0);if(o?(c.current=o.current,c.total=o.total):(c.current=0,c.total=r.size()),r.size()!==c.total)throw rc();const u=c.total-c.current;let l=u;i>0&&(l=Math.min(l,i));const h=c.current,d=h+l;let f="";f=0===l?"finalize":u===l?"upload, finalize":"upload";const p={"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":""+c.current},g=r.slice(h,d);if(null===g)throw nc();function m(e,n){const i=Su(e,["active","final"]),o=c.current+l,a=r.size();let u;return u="final"===i?fu(t,s)(e,n):null,new Cu(o,a,"final"===i,u)}const y="POST",_=t.maxUploadRetryTime,v=new hu(n,y,m,_);return v.headers=p,v.body=g.uploadData(),v.progressCallback=a||null,v.errorHandler=mu(e),v}const Du={STATE_CHANGED:"state_changed"},xu={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Pu(e){switch(e){case"running":case"pausing":case"canceling":return xu.RUNNING;case"paused":return xu.PAUSED;case"success":return xu.SUCCESS;case"canceled":return xu.CANCELED;case"error":return xu.ERROR;default:return xu.ERROR}}class Mu{constructor(e,t,n){const r=gc(e)||null!=t||null!=n;if(r)this.next=e,this.error=null!==t&&void 0!==t?t:void 0,this.complete=null!==n&&void 0!==n?n:void 0;else{const t=e;this.next=t.next,this.error=t.error,this.complete=t.complete}}}function ju(e){return(...t)=>{Promise.resolve().then(()=>e(...t))}}let Lu=null;class Fu{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Tc.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Tc.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Tc.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r){if(this.sent_)throw uc("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw uc("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw uc("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw uc("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw uc("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class Uu extends Fu{initXhr(){this.xhr_.responseType="text"}}function Vu(){return Lu?Lu():new Uu}class qu{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=tu(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{if(this._request=void 0,this._chunkMultiplier=1,e._codeEquals("canceled"))this._needToFetchStatus=!0,this.completeTransitions_();else{const t=this.isExponentialBackoffExpired();if(Ec(e.status,[])){if(!t)return this.sleepTime=Math.max(2*this.sleepTime,Ba),this._needToFetchStatus=!0,void this.completeTransitions_();e=Xa()}this._error=e,this._transition("error")}},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals("canceled")?this.completeTransitions_():(this._error=e,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>262144}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([t,n])=>{switch(this._state){case"running":e(t,n);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,t)=>{const n=Ou(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,Vu,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((t,n)=>{const r=Au(this._ref.storage,this._ref._location,e,this._blob),i=this._ref.storage._makeRequest(r,Vu,t,n);this._request=i,i.getPromise().then(e=>{e=e,this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=Nu*this._chunkMultiplier,t=new Cu(this._transferred,this._blob.size()),n=this._uploadUrl;this._resolveToken((r,i)=>{let s;try{s=Ru(this._ref._location,this._ref.storage,n,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(a){return this._error=a,void this._transition("error")}const o=this._ref.storage._makeRequest(s,Vu,r,i,!1);this._request=o,o.getPromise().then(e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){const e=Nu*this._chunkMultiplier;2*e<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{const n=_u(this._ref.storage,this._ref._location,this._mappings),r=this._ref.storage._makeRequest(n,Vu,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{const n=ku(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,Vu,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=Ja(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const e=Pu(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const i=new Mu(t||void 0,n||void 0,r||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise();const e=this._observers.slice();e.forEach(e=>{this._notifyObserver(e)})}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(Pu(this._state)){case xu.SUCCESS:ju(this._resolve.bind(null,this.snapshot))();break;case xu.CANCELED:case xu.ERROR:const t=this._reject;ju(t.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){const t=Pu(this._state);switch(t){case xu.RUNNING:case xu.PAUSED:e.next&&ju(e.next.bind(e,this.snapshot))();break;case xu.SUCCESS:e.complete&&ju(e.complete.bind(e))();break;case xu.CANCELED:case xu.ERROR:e.error&&ju(e.error.bind(e,this._error))();break;default:e.error&&ju(e.error.bind(e,this._error))()}}resume(){const e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){const e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){const e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class Bu{constructor(e,t){this._service=e,this._location=t instanceof lc?t:lc.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Bu(e,t)}get root(){const e=new lc(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Yc(this._location.path)}get storage(){return this._service}get parent(){const e=Hc(this._location.path);if(null===e)return null;const t=new lc(this._location.bucket,e);return new Bu(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw ac(e)}}function zu(e,t,n){return e._throwIfRoot("uploadBytesResumable"),new qu(e,new $c(t),n)}function Ku(e){const t={prefixes:[],items:[]};return Wu(e,t).then(()=>t)}async function Wu(e,t,n){const r={pageToken:n},i=await $u(e,r);t.prefixes.push(...i.prefixes),t.items.push(...i.items),null!=i.nextPageToken&&await Wu(e,t,i.nextPageToken)}function $u(e,t){null!=t&&"number"===typeof t.maxResults&&wc("options.maxResults",1,1e3,t.maxResults);const n=t||{},r=vu(e.storage,e._location,"/",n.pageToken,n.maxResults);return e.storage.makeRequestWithTokens(r,Vu)}function Gu(e){e._throwIfRoot("getMetadata");const t=_u(e.storage,e._location,tu());return e.storage.makeRequestWithTokens(t,Vu)}function Hu(e,t){e._throwIfRoot("updateMetadata");const n=bu(e.storage,e._location,t,tu());return e.storage.makeRequestWithTokens(n,Vu)}function Qu(e){e._throwIfRoot("getDownloadURL");const t=wu(e.storage,e._location,tu());return e.storage.makeRequestWithTokens(t,Vu).then(e=>{if(null===e)throw ic();return e})}function Yu(e){e._throwIfRoot("deleteObject");const t=Iu(e.storage,e._location);return e.storage.makeRequestWithTokens(t,Vu)}function Xu(e,t){const n=Qc(e._location.path,t),r=new lc(e._location.bucket,n);return new Bu(e.storage,r)}function Ju(e){return/^[A-Za-z]+:\/\//.test(e)}function Zu(e,t){return new Bu(e,t)}function el(e,t){if(e instanceof il){const n=e;if(null==n._bucket)throw tc();const r=new Bu(n,n._bucket);return null!=t?el(r,t):r}return void 0!==t?Xu(e,t):e}function tl(e,t){if(t&&Ju(t)){if(e instanceof il)return Zu(e,t);throw sc("To use ref(service, url), the first argument must be a Storage instance.")}return el(e,t)}function nl(e,t){const n=null===t||void 0===t?void 0:t[Ua];return null==n?null:lc.makeFromBucketSpec(n,e)}function rl(e,t,n,r={}){e.host=`${t}:${n}`,e._protocol="http";const{mockUserToken:i}=r;i&&(e._overrideAuthToken="string"===typeof i?i:Object(l["n"])(i,e.app.options.projectId))}class il{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=Fa,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Va,this._maxUploadRetryTime=qa,this._requests=new Set,this._bucket=null!=r?lc.makeFromBucketSpec(r,this._host):nl(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=lc.makeFromBucketSpec(this._url,e):this._bucket=nl(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){wc("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){wc("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();return t.token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Bu(this,e)}_makeRequest(e,t,n,r,i=!0){if(this._deleted)return new hc(oc());{const s=Rc(e,this._appId,n,r,t,this._firebaseVersion,i);return this._requests.add(s),s.getPromise().then(()=>this._requests.delete(s),()=>this._requests.delete(s)),s}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const sl="@firebase/storage",ol="0.9.13",al="storage";function cl(e,t,n){return e=Object(l["z"])(e),zu(e,t,n)}function ul(e){return e=Object(l["z"])(e),Gu(e)}function ll(e,t){return e=Object(l["z"])(e),Hu(e,t)}function hl(e,t){return e=Object(l["z"])(e),$u(e,t)}function dl(e){return e=Object(l["z"])(e),Ku(e)}function fl(e){return e=Object(l["z"])(e),Qu(e)}function pl(e){return e=Object(l["z"])(e),Yu(e)}function gl(e,t){return e=Object(l["z"])(e),tl(e,t)}function ml(e,t){return Xu(e,t)}function yl(e,t,n,r={}){rl(e,t,n,r)}function _l(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return new il(n,r,i,t,o["SDK_VERSION"])}function vl(){Object(o["_registerComponent"])(new u["a"](al,_l,"PUBLIC").setMultipleInstances(!0)),Object(o["registerVersion"])(sl,ol,""),Object(o["registerVersion"])(sl,ol,"esm2017")}vl();class wl{constructor(e,t,n){this._delegate=e,this.task=t,this.ref=n}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class bl{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new wl(this._delegate.snapshot,this,this._ref)}then(e,t){return this._delegate.then(t=>{if(e)return e(new wl(t,this,this._ref))},t)}on(e,t,n,r){let i=void 0;return t&&(i="function"===typeof t?e=>t(new wl(e,this,this._ref)):{next:t.next?e=>t.next(new wl(e,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,i,n||void 0,r||void 0)}}class Il{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new Tl(e,this._service))}get items(){return this._delegate.items.map(e=>new Tl(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}class Tl{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){const t=ml(this._delegate,e);return new Tl(t,this.storage)}get root(){return new Tl(this._delegate.root,this.storage)}get parent(){const e=this._delegate.parent;return null==e?null:new Tl(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new bl(cl(this._delegate,e,t),this)}putString(e,t=jc.RAW,n){this._throwIfRoot("putString");const r=Fc(t,e),i=Object.assign({},n);return null==i["contentType"]&&null!=r.contentType&&(i["contentType"]=r.contentType),new bl(new qu(this._delegate,new $c(r.data,!0),i),this)}listAll(){return dl(this._delegate).then(e=>new Il(e,this.storage))}list(e){return hl(this._delegate,e||void 0).then(e=>new Il(e,this.storage))}getMetadata(){return ul(this._delegate)}updateMetadata(e){return ll(this._delegate,e)}getDownloadURL(){return fl(this._delegate)}delete(){return this._throwIfRoot("delete"),pl(this._delegate)}_throwIfRoot(e){if(""===this._delegate._location.path)throw ac(e)}}class El{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(kl(e))throw sc("ref() expected a child path but got a URL, use refFromURL instead.");return new Tl(gl(this._delegate,e),this)}refFromURL(e){if(!kl(e))throw sc("refFromURL() expected a full URL but got a child path, use ref() instead.");try{lc.makeFromUrl(e,this._delegate.host)}catch(t){throw sc("refFromUrl() expected a valid full URL but got an invalid one.")}return new Tl(gl(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,n={}){yl(this._delegate,e,t,n)}}function kl(e){return/^[A-Za-z]+:\/\//.test(e)}const Cl="@firebase/storage-compat",Sl="0.1.21",Ol="storage-compat";function Al(e,{instanceIdentifier:t}){const n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("storage").getImmediate({identifier:t}),i=new El(n,r);return i}function Nl(e){const t={TaskState:xu,TaskEvent:Du,StringFormat:jc,Storage:El,Reference:Tl};e.INTERNAL.registerComponent(new u["a"](Ol,Al,"PUBLIC").setServiceProps(t).setMultipleInstances(!0)),e.registerVersion(Cl,Sl)}Nl(zt["a"]);const Rl="@firebase/performance",Dl="0.5.16",xl=Dl,Pl="FB-PERF-TRACE-START",Ml="FB-PERF-TRACE-STOP",jl="FB-PERF-TRACE-MEASURE",Ll="_wt_",Fl="_fp",Ul="_fcp",Vl="_fid",ql="@firebase/performance/config",Bl="@firebase/performance/configexpire",zl="performance",Kl="Performance",Wl={["trace started"]:"Trace {$traceName} was started before.",["trace stopped"]:"Trace {$traceName} is not running.",["nonpositive trace startTime"]:"Trace {$traceName} startTime should be positive.",["nonpositive trace duration"]:"Trace {$traceName} duration should be positive.",["no window"]:"Window is not available.",["no app id"]:"App id is not available.",["no project id"]:"Project id is not available.",["no api key"]:"Api key is not available.",["invalid cc log"]:"Attempted to queue invalid cc event",["FB not default"]:"Performance can only start when Firebase app instance is the default one.",["RC response not ok"]:"RC response is not ok",["invalid attribute name"]:"Attribute name {$attributeName} is invalid.",["invalid attribute value"]:"Attribute value {$attributeValue} is invalid.",["invalid custom metric name"]:"Custom metric name {$customMetricName} is invalid",["invalid String merger input"]:"Input for String merger is invalid, contact support team to resolve.",["already initialized"]:"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."},$l=new l["b"](zl,Kl,Wl),Gl=new Kt["b"](Kl);let Hl,Ql,Yl,Xl;Gl.logLevel=Kt["a"].INFO;class Jl{constructor(e){if(this.window=e,!e)throw $l.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,n){this.performance&&this.performance.measure&&this.performance.measure(e,t,n)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&Object(l["e"])()?!!Object(l["G"])()||(Gl.info("IndexedDB is not supported by current browswer"),!1):(Gl.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,t){if(!this.PerformanceObserver)return;const n=new this.PerformanceObserver(e=>{for(const n of e.getEntries())t(n)});n.observe({entryTypes:[e]})}static getInstance(){return void 0===Hl&&(Hl=new Jl(Ql)),Hl}}function Zl(e){Ql=e}function eh(e){const t=e.getId();return t.then(e=>{Yl=e}),t}function th(){return Yl}function nh(e){const t=e.getToken();return t.then(e=>{}),t}function rh(e,t){const n=e.length-t.length;if(n<0||n>1)throw $l.create("invalid String merger input");const r=[];for(let i=0;i<e.length;i++)r.push(e.charAt(i)),t.length>i&&r.push(t.charAt(i));return r.join("")}class ih{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=rh("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=rh("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return void 0===Xl&&(Xl=new ih),Xl}}var sh;(function(e){e[e["UNKNOWN"]=0]="UNKNOWN",e[e["VISIBLE"]=1]="VISIBLE",e[e["HIDDEN"]=2]="HIDDEN"})(sh||(sh={}));const oh=["firebase_","google_","ga_"],ah=new RegExp("^[a-zA-Z]\\w*$"),ch=40,uh=100;function lh(){const e=Jl.getInstance().navigator;return"serviceWorker"in e?e.serviceWorker.controller?2:3:1}function hh(){const e=Jl.getInstance().document,t=e.visibilityState;switch(t){case"visible":return sh.VISIBLE;case"hidden":return sh.HIDDEN;default:return sh.UNKNOWN}}function dh(){const e=Jl.getInstance().navigator,t=e.connection,n=t&&t.effectiveType;switch(n){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}function fh(e){if(0===e.length||e.length>ch)return!1;const t=oh.some(t=>e.startsWith(t));return!t&&!!e.match(ah)}function ph(e){return 0!==e.length&&e.length<=uh}function gh(e){var t;const n=null===(t=e.options)||void 0===t?void 0:t.appId;if(!n)throw $l.create("no app id");return n}function mh(e){var t;const n=null===(t=e.options)||void 0===t?void 0:t.projectId;if(!n)throw $l.create("no project id");return n}function yh(e){var t;const n=null===(t=e.options)||void 0===t?void 0:t.apiKey;if(!n)throw $l.create("no api key");return n}const _h="0.0.1",vh={loggingEnabled:!0},wh="FIREBASE_INSTALLATIONS_AUTH";function bh(e,t){const n=Ih();return n?(Ch(n),Promise.resolve()):kh(e,t).then(Ch).then(e=>Th(e),()=>{})}function Ih(){const e=Jl.getInstance().localStorage;if(!e)return;const t=e.getItem(Bl);if(!t||!Sh(t))return;const n=e.getItem(ql);if(n)try{const e=JSON.parse(n);return e}catch(r){return}}function Th(e){const t=Jl.getInstance().localStorage;e&&t&&(t.setItem(ql,JSON.stringify(e)),t.setItem(Bl,String(Date.now()+60*ih.getInstance().configTimeToLive*60*1e3)))}const Eh="Could not fetch config, will use default configs";function kh(e,t){return nh(e.installations).then(n=>{const r=mh(e.app),i=yh(e.app),s=`https://firebaseremoteconfig.googleapis.com/v1/projects/${r}/namespaces/fireperf:fetch?key=${i}`,o=new Request(s,{method:"POST",headers:{Authorization:`${wh} ${n}`},body:JSON.stringify({app_instance_id:t,app_instance_id_token:n,app_id:gh(e.app),app_version:xl,sdk_version:_h})});return fetch(o).then(e=>{if(e.ok)return e.json();throw $l.create("RC response not ok")})}).catch(()=>{Gl.info(Eh)})}function Ch(e){if(!e)return e;const t=ih.getInstance(),n=e.entries||{};return void 0!==n.fpr_enabled?t.loggingEnabled="true"===String(n.fpr_enabled):t.loggingEnabled=vh.loggingEnabled,n.fpr_log_source?t.logSource=Number(n.fpr_log_source):vh.logSource&&(t.logSource=vh.logSource),n.fpr_log_endpoint_url?t.logEndPointUrl=n.fpr_log_endpoint_url:vh.logEndPointUrl&&(t.logEndPointUrl=vh.logEndPointUrl),n.fpr_log_transport_key?t.transportKey=n.fpr_log_transport_key:vh.transportKey&&(t.transportKey=vh.transportKey),void 0!==n.fpr_vc_network_request_sampling_rate?t.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate):void 0!==vh.networkRequestsSamplingRate&&(t.networkRequestsSamplingRate=vh.networkRequestsSamplingRate),void 0!==n.fpr_vc_trace_sampling_rate?t.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate):void 0!==vh.tracesSamplingRate&&(t.tracesSamplingRate=vh.tracesSamplingRate),t.logTraceAfterSampling=Oh(t.tracesSamplingRate),t.logNetworkAfterSampling=Oh(t.networkRequestsSamplingRate),e}function Sh(e){return Number(e)>Date.now()}function Oh(e){return Math.random()<=e}let Ah,Nh=1;function Rh(e){return Nh=2,Ah=Ah||xh(e),Ah}function Dh(){return 3===Nh}function xh(e){return Ph().then(()=>eh(e.installations)).then(t=>bh(e,t)).then(()=>Mh(),()=>Mh())}function Ph(){const e=Jl.getInstance().document;return new Promise(t=>{if(e&&"complete"!==e.readyState){const n=()=>{"complete"===e.readyState&&(e.removeEventListener("readystatechange",n),t())};e.addEventListener("readystatechange",n)}else t()})}function Mh(){Nh=3}const jh=1e4,Lh=5500,Fh=3,Uh=1e3;let Vh,qh=Fh,Bh=[],zh=!1;function Kh(){zh||(Wh(Lh),zh=!0)}function Wh(e){setTimeout(()=>{if(0!==qh)return Bh.length?void $h():Wh(jh)},e)}function $h(){const e=Bh.splice(0,Uh),t=e.map(e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)})),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:ih.getInstance().logSource,log_event:t};Gh(n,e).catch(()=>{Bh=[...e,...Bh],qh--,Gl.info(`Tries left: ${qh}.`),Wh(jh)})}function Gh(e,t){return Hh(e).then(e=>(e.ok||Gl.info("Call to Firebase backend failed."),e.json())).then(e=>{const n=Number(e.nextRequestWaitMillis);let r=jh;isNaN(n)||(r=Math.max(n,r));const i=e.logResponseDetails;Array.isArray(i)&&i.length>0&&"RETRY_REQUEST_LATER"===i[0].responseAction&&(Bh=[...t,...Bh],Gl.info("Retry transport request later.")),qh=Fh,Wh(r)})}function Hh(e){const t=ih.getInstance().getFlTransportFullUrl();return fetch(t,{method:"POST",body:JSON.stringify(e)})}function Qh(e){if(!e.eventTime||!e.message)throw $l.create("invalid cc log");Bh=[...Bh,e]}function Yh(e){return(...t)=>{const n=e(...t);Qh({message:n,eventTime:Date.now()})}}function Xh(e,t){Vh||(Vh=Yh(td)),Vh(e,t)}function Jh(e){const t=ih.getInstance();!t.instrumentationEnabled&&e.isAuto||(t.dataCollectionEnabled||e.isAuto)&&Jl.getInstance().requiredApisAvailable()&&(e.isAuto&&hh()!==sh.VISIBLE||(Dh()?Zh(e):Rh(e.performanceController).then(()=>Zh(e),()=>Zh(e))))}function Zh(e){if(!th())return;const t=ih.getInstance();t.loggingEnabled&&t.logTraceAfterSampling&&setTimeout(()=>Xh(e,1),0)}function ed(e){const t=ih.getInstance();if(!t.instrumentationEnabled)return;const n=e.url,r=t.logEndPointUrl.split("?")[0],i=t.flTransportEndpointUrl.split("?")[0];n!==r&&n!==i&&t.loggingEnabled&&t.logNetworkAfterSampling&&setTimeout(()=>Xh(e,0),0)}function td(e,t){return 0===t?nd(e):rd(e)}function nd(e){const t={url:e.url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs},n={application_info:id(e.performanceController.app),network_request_metric:t};return JSON.stringify(n)}function rd(e){const t={name:e.name,is_auto:e.isAuto,client_start_time_us:e.startTimeUs,duration_us:e.durationUs};0!==Object.keys(e.counters).length&&(t.counters=e.counters);const n=e.getAttributes();0!==Object.keys(n).length&&(t.custom_attributes=n);const r={application_info:id(e.performanceController.app),trace_metric:t};return JSON.stringify(r)}function id(e){return{google_app_id:gh(e),app_instance_id:th(),web_app_info:{sdk_version:xl,page_url:Jl.getInstance().getUrl(),service_worker_status:lh(),visibility_state:hh(),effective_connection_type:dh()},application_process_state:0}}const sd=100,od="_",ad=[Fl,Ul,Vl];function cd(e,t){return!(0===e.length||e.length>sd)&&(t&&t.startsWith(Ll)&&ad.indexOf(e)>-1||!e.startsWith(od))}function ud(e){const t=Math.floor(e);return t<e&&Gl.info(`Metric value should be an Integer, setting the value as : ${t}.`),t}class ld{constructor(e,t,n=!1,r){this.performanceController=e,this.name=t,this.isAuto=n,this.state=1,this.customAttributes={},this.counters={},this.api=Jl.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=`${Pl}-${this.randomId}-${this.name}`,this.traceStopMark=`${Ml}-${this.randomId}-${this.name}`,this.traceMeasure=r||`${jl}-${this.randomId}-${this.name}`,r&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw $l.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw $l.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),Jh(this)}record(e,t,n){if(e<=0)throw $l.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw $l.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),n&&n.attributes&&(this.customAttributes=Object.assign({},n.attributes)),n&&n.metrics)for(const r of Object.keys(n.metrics))isNaN(Number(n.metrics[r]))||(this.counters[r]=Math.floor(Number(n.metrics[r])));Jh(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(!cd(e,this.name))throw $l.create("invalid custom metric name",{customMetricName:e});this.counters[e]=ud(null!==t&&void 0!==t?t:0)}getMetric(e){return this.counters[e]||0}putAttribute(e,t){const n=fh(e),r=ph(t);if(n&&r)this.customAttributes[e]=t;else{if(!n)throw $l.create("invalid attribute name",{attributeName:e});if(!r)throw $l.create("invalid attribute value",{attributeValue:t})}}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){const e=this.api.getEntriesByName(this.traceMeasure),t=e&&e[0];t&&(this.durationUs=Math.floor(1e3*t.duration),this.startTimeUs=Math.floor(1e3*(t.startTime+this.api.getTimeOrigin())))}static createOobTrace(e,t,n,r){const i=Jl.getInstance().getUrl();if(!i)return;const s=new ld(e,Ll+i,!0),o=Math.floor(1e3*Jl.getInstance().getTimeOrigin());s.setStartTime(o),t&&t[0]&&(s.setDuration(Math.floor(1e3*t[0].duration)),s.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),s.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),s.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd)));const a="first-paint",c="first-contentful-paint";if(n){const e=n.find(e=>e.name===a);e&&e.startTime&&s.putMetric(Fl,Math.floor(1e3*e.startTime));const t=n.find(e=>e.name===c);t&&t.startTime&&s.putMetric(Ul,Math.floor(1e3*t.startTime)),r&&s.putMetric(Vl,Math.floor(1e3*r))}Jh(s)}static createUserTimingTrace(e,t){const n=new ld(e,t,!1,t);Jh(n)}}function hd(e,t){const n=t;if(!n||void 0===n.responseStart)return;const r=Jl.getInstance().getTimeOrigin(),i=Math.floor(1e3*(n.startTime+r)),s=n.responseStart?Math.floor(1e3*(n.responseStart-n.startTime)):void 0,o=Math.floor(1e3*(n.responseEnd-n.startTime)),a=n.name&&n.name.split("?")[0],c={performanceController:e,url:a,responsePayloadBytes:n.transferSize,startTimeUs:i,timeToResponseInitiatedUs:s,timeToResponseCompletedUs:o};ed(c)}const dd=5e3;function fd(e){th()&&(setTimeout(()=>gd(e),0),setTimeout(()=>pd(e),0),setTimeout(()=>md(e),0))}function pd(e){const t=Jl.getInstance(),n=t.getEntriesByType("resource");for(const r of n)hd(e,r);t.setupObserver("resource",t=>hd(e,t))}function gd(e){const t=Jl.getInstance(),n=t.getEntriesByType("navigation"),r=t.getEntriesByType("paint");if(t.onFirstInputDelay){let i=setTimeout(()=>{ld.createOobTrace(e,n,r),i=void 0},dd);t.onFirstInputDelay(t=>{i&&(clearTimeout(i),ld.createOobTrace(e,n,r,t))})}else ld.createOobTrace(e,n,r)}function md(e){const t=Jl.getInstance(),n=t.getEntriesByType("measure");for(const r of n)yd(e,r);t.setupObserver("measure",t=>yd(e,t))}function yd(e,t){const n=t.name;n.substring(0,jl.length)!==jl&&ld.createUserTimingTrace(e,n)}class _d{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(void 0!==(null===e||void 0===e?void 0:e.dataCollectionEnabled)&&(this.dataCollectionEnabled=e.dataCollectionEnabled),void 0!==(null===e||void 0===e?void 0:e.instrumentationEnabled)&&(this.instrumentationEnabled=e.instrumentationEnabled),Jl.getInstance().requiredApisAvailable()?Object(l["ab"])().then(e=>{e&&(Kh(),Rh(this).then(()=>fd(this),()=>fd(this)),this.initialized=!0)}).catch(e=>{Gl.info("Environment doesn't support IndexedDB: "+e)}):Gl.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){ih.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return ih.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){ih.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return ih.getInstance().dataCollectionEnabled}}const vd="[DEFAULT]";function wd(e,t){return e=Object(l["z"])(e),new ld(e,t)}const bd=(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if(n.name!==vd)throw $l.create("FB not default");if("undefined"===typeof window)throw $l.create("no window");Zl(window);const i=new _d(n,r);return i._init(t),i};function Id(){Object(o["_registerComponent"])(new u["a"]("performance",bd,"PUBLIC")),Object(o["registerVersion"])(Rl,Dl),Object(o["registerVersion"])(Rl,Dl,"esm2017")}Id();class Td{constructor(e,t){this.app=e,this._delegate=t}get instrumentationEnabled(){return this._delegate.instrumentationEnabled}set instrumentationEnabled(e){this._delegate.instrumentationEnabled=e}get dataCollectionEnabled(){return this._delegate.dataCollectionEnabled}set dataCollectionEnabled(e){this._delegate.dataCollectionEnabled=e}trace(e){return wd(this._delegate,e)}}const Ed="@firebase/performance-compat",kd="0.1.16";function Cd(e){e.INTERNAL.registerComponent(new u["a"]("performance-compat",Sd,"PUBLIC")),e.registerVersion(Ed,kd)}function Sd(e){const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("performance").getImmediate();return new Td(t,n)}Cd(zt["a"]);const Od="@firebase/remote-config",Ad="0.3.15";class Nd{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}const Rd="remote-config",Dd={["registration-window"]:"Undefined window object. This SDK only supports usage in a browser environment.",["registration-project-id"]:"Undefined project identifier. Check Firebase app initialization.",["registration-api-key"]:"Undefined API key. Check Firebase app initialization.",["registration-app-id"]:"Undefined app identifier. Check Firebase app initialization.",["storage-open"]:"Error thrown when opening storage. Original error: {$originalErrorMessage}.",["storage-get"]:"Error thrown when reading from storage. Original error: {$originalErrorMessage}.",["storage-set"]:"Error thrown when writing to storage. Original error: {$originalErrorMessage}.",["storage-delete"]:"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.",["fetch-client-network"]:"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",["fetch-timeout"]:'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',["fetch-throttle"]:'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',["fetch-client-parse"]:"Fetch client could not parse response. Original error: {$originalErrorMessage}.",["fetch-status"]:"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",["indexed-db-unavailable"]:"Indexed DB is not supported by current browser"},xd=new l["b"]("remoteconfig","Remote Config",Dd);function Pd(e,t){return e instanceof l["c"]&&-1!==e.code.indexOf(t)}const Md=!1,jd="",Ld=0,Fd=["1","true","t","yes","y","on"];class Ud{constructor(e,t=jd){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return"static"===this._source?Md:Fd.indexOf(this._value.toLowerCase())>=0}asNumber(){if("static"===this._source)return Ld;let e=Number(this._value);return isNaN(e)&&(e=Ld),e}getSource(){return this._source}}async function Vd(e){const t=Object(l["z"])(e),[n,r]=await Promise.all([t._storage.getLastSuccessfulFetchResponse(),t._storage.getActiveConfigEtag()]);return!!(n&&n.config&&n.eTag&&n.eTag!==r)&&(await Promise.all([t._storageCache.setActiveConfig(n.config),t._storage.setActiveConfigEtag(n.eTag)]),!0)}function qd(e){const t=Object(l["z"])(e);return t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0})),t._initializePromise}async function Bd(e){const t=Object(l["z"])(e),n=new Nd;setTimeout(async()=>{n.abort()},t.settings.fetchTimeoutMillis);try{await t._client.fetch({cacheMaxAgeMillis:t.settings.minimumFetchIntervalMillis,signal:n}),await t._storageCache.setLastFetchStatus("success")}catch(r){const e=Pd(r,"fetch-throttle")?"throttle":"failure";throw await t._storageCache.setLastFetchStatus(e),r}}function zd(e){const t=Object(l["z"])(e);return Qd(t._storageCache.getActiveConfig(),t.defaultConfig).reduce((t,n)=>(t[n]=Gd(e,n),t),{})}function Kd(e,t){return Gd(Object(l["z"])(e),t).asBoolean()}function Wd(e,t){return Gd(Object(l["z"])(e),t).asNumber()}function $d(e,t){return Gd(Object(l["z"])(e),t).asString()}function Gd(e,t){const n=Object(l["z"])(e);n._isInitializationComplete||n._logger.debug(`A value was requested for key "${t}" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.`);const r=n._storageCache.getActiveConfig();return r&&void 0!==r[t]?new Ud("remote",r[t]):n.defaultConfig&&void 0!==n.defaultConfig[t]?new Ud("default",String(n.defaultConfig[t])):(n._logger.debug(`Returning static value for key "${t}". Define a default or remote value if this is unintentional.`),new Ud("static"))}function Hd(e,t){const n=Object(l["z"])(e);switch(t){case"debug":n._logger.logLevel=Kt["a"].DEBUG;break;case"silent":n._logger.logLevel=Kt["a"].SILENT;break;default:n._logger.logLevel=Kt["a"].ERROR}}function Qd(e={},t={}){return Object.keys(Object.assign(Object.assign({},e),t))}class Yd{constructor(e,t,n,r){this.client=e,this.storage=t,this.storageCache=n,this.logger=r}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;const n=Date.now()-t,r=n<=e;return this.logger.debug(`Config fetch cache check. Cache age millis: ${n}. Cache max age millis (minimumFetchIntervalMillis setting): ${e}. Is cache hit: ${r}.`),r}async fetch(e){const[t,n]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(n&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return n;e.eTag=n&&n.eTag;const r=await this.client.fetch(e),i=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return 200===r.status&&i.push(this.storage.setLastSuccessfulFetchResponse(r)),await Promise.all(i),r}}function Xd(e=navigator){return e.languages&&e.languages[0]||e.language}class Jd{constructor(e,t,n,r,i,s){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=s}async fetch(e){var t,n,r;const[i,s]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),o=window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com",a=`${o}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,c={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":e.eTag||"*"},u={sdk_version:this.sdkVersion,app_instance_id:i,app_instance_id_token:s,app_id:this.appId,language_code:Xd()},l={method:"POST",headers:c,body:JSON.stringify(u)},h=fetch(a,l),d=new Promise((t,n)=>{e.signal.addEventListener(()=>{const e=new Error("The operation was aborted.");e.name="AbortError",n(e)})});let f;try{await Promise.race([h,d]),f=await h}catch(_){let e="fetch-client-network";throw"AbortError"===(null===(t=_)||void 0===t?void 0:t.name)&&(e="fetch-timeout"),xd.create(e,{originalErrorMessage:null===(n=_)||void 0===n?void 0:n.message})}let p=f.status;const g=f.headers.get("ETag")||void 0;let m,y;if(200===f.status){let e;try{e=await f.json()}catch(_){throw xd.create("fetch-client-parse",{originalErrorMessage:null===(r=_)||void 0===r?void 0:r.message})}m=e["entries"],y=e["state"]}if("INSTANCE_STATE_UNSPECIFIED"===y?p=500:"NO_CHANGE"===y?p=304:"NO_TEMPLATE"!==y&&"EMPTY_CONFIG"!==y||(m={}),304!==p&&200!==p)throw xd.create("fetch-status",{httpStatus:p});return{status:p,eTag:g,config:m}}}function Zd(e,t){return new Promise((n,r)=>{const i=Math.max(t-Date.now(),0),s=setTimeout(n,i);e.addEventListener(()=>{clearTimeout(s),r(xd.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}function ef(e){if(!(e instanceof l["c"])||!e.customData)return!1;const t=Number(e.customData["httpStatus"]);return 429===t||500===t||503===t||504===t}class tf{constructor(e,t){this.client=e,this.storage=t}async fetch(e){const t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(e,{throttleEndTimeMillis:t,backoffCount:n}){await Zd(e.signal,t);try{const t=await this.client.fetch(e);return await this.storage.deleteThrottleMetadata(),t}catch(r){if(!ef(r))throw r;const t={throttleEndTimeMillis:Date.now()+Object(l["l"])(n),backoffCount:n+1};return await this.storage.setThrottleMetadata(t),this.attemptFetch(e,t)}}}const nf=6e4,rf=432e5;class sf{constructor(e,t,n,r,i){this.app=e,this._client=t,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:nf,minimumFetchIntervalMillis:rf},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}function of(e,t){var n;const r=e.target.error||void 0;return xd.create(t,{originalErrorMessage:r&&(null===(n=r)||void 0===n?void 0:n.message)})}const af="app_namespace_store",cf="firebase_remote_config",uf=1;function lf(){return new Promise((e,t)=>{var n;try{const n=indexedDB.open(cf,uf);n.onerror=e=>{t(of(e,"storage-open"))},n.onsuccess=t=>{e(t.target.result)},n.onupgradeneeded=e=>{const t=e.target.result;switch(e.oldVersion){case 0:t.createObjectStore(af,{keyPath:"compositeKey"})}}}catch(r){t(xd.create("storage-open",{originalErrorMessage:null===(n=r)||void 0===n?void 0:n.message}))}})}class hf{constructor(e,t,n,r=lf()){this.appId=e,this.appName=t,this.namespace=n,this.openDbPromise=r}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(e){const t=await this.openDbPromise;return new Promise((n,r)=>{var i;const s=t.transaction([af],"readonly"),o=s.objectStore(af),a=this.createCompositeKey(e);try{const e=o.get(a);e.onerror=e=>{r(of(e,"storage-get"))},e.onsuccess=e=>{const t=e.target.result;n(t?t.value:void 0)}}catch(c){r(xd.create("storage-get",{originalErrorMessage:null===(i=c)||void 0===i?void 0:i.message}))}})}async set(e,t){const n=await this.openDbPromise;return new Promise((r,i)=>{var s;const o=n.transaction([af],"readwrite"),a=o.objectStore(af),c=this.createCompositeKey(e);try{const e=a.put({compositeKey:c,value:t});e.onerror=e=>{i(of(e,"storage-set"))},e.onsuccess=()=>{r()}}catch(u){i(xd.create("storage-set",{originalErrorMessage:null===(s=u)||void 0===s?void 0:s.message}))}})}async delete(e){const t=await this.openDbPromise;return new Promise((n,r)=>{var i;const s=t.transaction([af],"readwrite"),o=s.objectStore(af),a=this.createCompositeKey(e);try{const e=o.delete(a);e.onerror=e=>{r(of(e,"storage-delete"))},e.onsuccess=()=>{n()}}catch(c){r(xd.create("storage-delete",{originalErrorMessage:null===(i=c)||void 0===i?void 0:i.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class df{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){const e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),n=this.storage.getActiveConfig(),r=await e;r&&(this.lastFetchStatus=r);const i=await t;i&&(this.lastSuccessfulFetchTimestampMillis=i);const s=await n;s&&(this.activeConfig=s)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}function ff(){function e(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("undefined"===typeof window)throw xd.create("registration-window");if(!Object(l["G"])())throw xd.create("indexed-db-unavailable");const{projectId:i,apiKey:s,appId:a}=n.options;if(!i)throw xd.create("registration-project-id");if(!s)throw xd.create("registration-api-key");if(!a)throw xd.create("registration-app-id");t=t||"firebase";const c=new hf(a,n.name,t),u=new df(c),h=new Kt["b"](Od);h.logLevel=Kt["a"].ERROR;const d=new Jd(r,o["SDK_VERSION"],t,i,s,a),f=new tf(d,c),p=new Yd(f,c,u,h),g=new sf(n,p,u,c,h);return qd(g),g}Object(o["_registerComponent"])(new u["a"](Rd,e,"PUBLIC").setMultipleInstances(!0)),Object(o["registerVersion"])(Od,Ad),Object(o["registerVersion"])(Od,Ad,"esm2017")}async function pf(e){return e=Object(l["z"])(e),await Bd(e),Vd(e)}async function gf(){if(!Object(l["G"])())return!1;try{const e=await Object(l["ab"])();return e}catch(e){return!1}}ff();class mf{constructor(e,t){this.app=e,this._delegate=t}get defaultConfig(){return this._delegate.defaultConfig}set defaultConfig(e){this._delegate.defaultConfig=e}get fetchTimeMillis(){return this._delegate.fetchTimeMillis}get lastFetchStatus(){return this._delegate.lastFetchStatus}get settings(){return this._delegate.settings}set settings(e){this._delegate.settings=e}activate(){return Vd(this._delegate)}ensureInitialized(){return qd(this._delegate)}fetch(){return Bd(this._delegate)}fetchAndActivate(){return pf(this._delegate)}getAll(){return zd(this._delegate)}getBoolean(e){return Kd(this._delegate,e)}getNumber(e){return Wd(this._delegate,e)}getString(e){return $d(this._delegate,e)}getValue(e){return Gd(this._delegate,e)}setLogLevel(e){Hd(this._delegate,e)}}const yf="@firebase/remote-config-compat",_f="0.1.16";function vf(e){e.INTERNAL.registerComponent(new u["a"]("remoteConfig-compat",wf,"PUBLIC").setMultipleInstances(!0).setServiceProps({isSupported:gf})),e.registerVersion(yf,_f)}function wf(e,{instanceIdentifier:t}){const n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("remote-config").getImmediate({identifier:t});return new mf(n,r)}vf(zt["a"]);var bf="firebase",If="9.13.0";zt["a"].registerVersion(bf,If,"app-compat");var Tf="firebase",Ef="9.13.0";console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the module builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nCommonJS Modules:\nconst firebase = require('firebase/app');\nrequire('firebase/<PACKAGE>');\n\nES Modules:\nimport firebase from 'firebase/app';\nimport 'firebase/<PACKAGE>';\n\nTypescript:\nimport firebase from 'firebase/app';\nimport 'firebase/<PACKAGE>';\n"),zt["a"].registerVersion(Tf,Ef,"compat");let kf=!1;function Cf(){var e=/(iPhone|iPad|iPod);[^OS]*OS (\d)/,t=navigator.userAgent.match(e);return!!t}function Sf(){var e=navigator.userAgent||"",t=e.includes("Android")&&e.includes("Version/")||e.includes("wv"),n=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(e);return t||n}console.log(Cf()),"https:"!==window.location.protocol||Cf()||Sf()?console.log("No inicializando o Firebase no webview"):(console.log("Inicializando o Firebase na aplicao web"),zt["a"].initializeApp(firebaseConfig),kf=zt["a"].messaging());var Of=kf;const Af={key:0},Nf=Object(r["createElementVNode"])("i",{class:"fas fa-bell",style:{color:"silver"}},null,-1),Rf=[Nf],Df={key:1},xf=Object(r["createElementVNode"])("i",{class:"fas fa-bell"},null,-1),Pf=[xf];var Mf={__name:"push-notification-btn",setup(e){const t=Object(s["b"])(),n=Object(r["ref"])(!1),o=Object(r["ref"])(!1);Object(r["onMounted"])(()=>{!1!==Of&&(n.value=!0,Of.getToken({vapidKey:vapidKey}).then(e=>{e?(console.log("client token",e),t.dispatch("setToken",e),o.value=!0):console.log("No registration token available. Request permission to generate one.")}).catch(e=>{console.log("An error occurred while retrieving token. ",e)}))});const a=()=>{Of.getToken({vapidKey:vapidKey}).then(e=>{e?(console.log("client token",e),t.dispatch("setToken",e),o.value=!0):console.log("No registration token available. Request permission to generate one.")}).catch(e=>{console.log("An error occurred while retrieving token. ",e)})};return(e,t)=>n.value?(Object(r["openBlock"])(),Object(r["createBlock"])(Object(r["unref"])(i["a"]),{key:0,content:o.value?"Desabilitar Notificaes":"Habilitar Notificaes"},{default:Object(r["withCtx"])(()=>[Object(r["createElementVNode"])("div",{id:"mute",onClick:t[0]||(t[0]=e=>a()),style:{cursor:"pointer","font-size":"1.2rem",margin:"0.3rem 0.5rem"}},[o.value?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",Df,Pf)):(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",Af,Rf))])]),_:1},8,["content"])):Object(r["createCommentVNode"])("",!0)}};const jf=Mf;t["default"]=jf},e691:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return l})),n.d(t,"d",(function(){return h}));const r=[];var i;(function(e){e[e["DEBUG"]=0]="DEBUG",e[e["VERBOSE"]=1]="VERBOSE",e[e["INFO"]=2]="INFO",e[e["WARN"]=3]="WARN",e[e["ERROR"]=4]="ERROR",e[e["SILENT"]=5]="SILENT"})(i||(i={}));const s={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},o=i.INFO,a={[i.DEBUG]:"log",[i.VERBOSE]:"log",[i.INFO]:"info",[i.WARN]:"warn",[i.ERROR]:"error"},c=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=a[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class u{constructor(e){this.name=e,this._logLevel=o,this._logHandler=c,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in i))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?s[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,i.DEBUG,...e),this._logHandler(this,i.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,i.VERBOSE,...e),this._logHandler(this,i.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,i.INFO,...e),this._logHandler(this,i.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,i.WARN,...e),this._logHandler(this,i.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,i.ERROR,...e),this._logHandler(this,i.ERROR,...e)}}function l(e){r.forEach(t=>{t.setLogLevel(e)})}function h(e,t){for(const n of r){let r=null;t&&t.level&&(r=s[t.level]),n.userLogHandler=null===e?null:(t,n,...s)=>{const o=s.map(e=>{if(null==e)return null;if("string"===typeof e)return e;if("number"===typeof e||"boolean"===typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(t){return null}}).filter(e=>e).join(" ");n>=(null!==r&&void 0!==r?r:t.logLevel)&&e({level:i[n].toLowerCase(),message:o,args:s,type:t.name})}}}}}]);